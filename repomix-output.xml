This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitattributes
.gitignore
actions/application-actions.ts
actions/client-actions.ts
actions/dashboard-actions.ts
actions/notice-actions.ts
actions/portal-actions.ts
actions/schedule-actions.ts
app/(admin)/create-profile/page.tsx
app/(admin)/dashboard/page.tsx
app/(admin)/layout.tsx
app/(admin)/notices-management/page.tsx
app/(auth)/layout.tsx
app/(auth)/sign-in/[[...sign-in]]/page.tsx
app/(auth)/sign-up/[[...sign-up]]/page.tsx
app/(portal)/apply/page.tsx
app/(portal)/layout.tsx
app/(portal)/mypage/page.tsx
app/(public)/about/greeting/page.tsx
app/(public)/about/history/page.tsx
app/(public)/about/location/page.tsx
app/(public)/about/organization/page.tsx
app/(public)/about/page.tsx
app/(public)/apply/guide/page.tsx
app/(public)/community/cases/page.tsx
app/(public)/community/gallery/page.tsx
app/(public)/community/page.tsx
app/(public)/info/devices/page.tsx
app/(public)/info/government-support/page.tsx
app/(public)/info/page.tsx
app/(public)/info/recommendation/page.tsx
app/(public)/info/repair-center/page.tsx
app/(public)/info/resources/page.tsx
app/(public)/info/reusable-devices/page.tsx
app/(public)/layout.tsx
app/(public)/notices/[id]/page.tsx
app/(public)/notices/page.tsx
app/(public)/page.tsx
app/(public)/services/aftercare/page.tsx
app/(public)/services/community-linkage/page.tsx
app/(public)/services/consultation/page.tsx
app/(public)/services/custom-support/page.tsx
app/(public)/services/device-service/page.tsx
app/(public)/services/education-promotion/page.tsx
app/(public)/services/exhibition/page.tsx
app/(public)/services/maintenance/page.tsx
app/(public)/services/page.tsx
app/(public)/services/reuse/page.tsx
app/admin/clients/[id]/page.tsx
app/admin/clients/page.tsx
app/admin/create-profile/page.tsx
app/admin/dashboard/page.tsx
app/admin/layout.tsx
app/admin/notices-management/page.tsx
app/admin/page.tsx
app/api/admin/session/route.ts
app/api/notices/upload/route.ts
app/api/profile/create/route.ts
app/api/webhooks/clerk/route.ts
app/globals.css
app/layout.tsx
components.json
components/accessibility/accessibility-toolbar.tsx
components/accessibility/keyboard-navigator.tsx
components/common/file-uploader.tsx
components/common/loading-spinner.tsx
components/common/logo.tsx
components/common/status-badge.tsx
components/features/admin/notices/NoticeAttachmentManager.tsx
components/features/admin/notices/NoticeCreateDialog.tsx
components/features/admin/notices/NoticeEditDialog.tsx
components/features/admin/notices/NoticeList.tsx
components/features/application/forms/ServiceConsultForm.tsx
components/features/application/forms/ServiceCustomForm.tsx
components/features/application/forms/ServiceRentalForm.tsx
components/features/application/forms/ServiceRepairForm.tsx
components/features/application/ServiceApplicationWizard.tsx
components/features/application/ServiceCategorySelector.tsx
components/features/application/success-modal.tsx
components/features/application/wizard-step-nav.tsx
components/features/crm/ClientHistoryTable.tsx
components/features/crm/ClientProfileCard.tsx
components/features/crm/ClientTable.tsx
components/features/dashboard/AdminDashboardContent.tsx
components/features/dashboard/AdminDashboardKpi.tsx
components/features/dashboard/AdminNewRequestList.tsx
components/features/dashboard/AdminTodaySchedule.tsx
components/features/landing/HomeCalendarCompact.tsx
components/features/landing/HomeCommunityNews.tsx
components/features/landing/HomeGallerySlider.tsx
components/features/landing/HomeHeroSection.tsx
components/features/landing/HomeNoticeTabs.tsx
components/features/landing/HomePublicCalendar.tsx
components/features/landing/HomeQuickMenuGrid.tsx
components/features/notices/NoticeAttachments.tsx
components/features/notices/NoticeShareButton.tsx
components/features/portal/ClientRentStatus.tsx
components/features/portal/ClientTimelineItem.tsx
components/features/portal/ClientTimelineList.tsx
components/layout/admin-header.tsx
components/layout/admin-sidebar.tsx
components/layout/mobile-bottom-nav.tsx
components/layout/portal-header.tsx
components/layout/public-footer.tsx
components/layout/public-header.tsx
components/providers/clerk-provider.tsx
components/providers/query-provider.tsx
components/ui/accordion.tsx
components/ui/badge.tsx
components/ui/button.tsx
components/ui/calendar.tsx
components/ui/card.tsx
components/ui/checkbox.tsx
components/ui/dialog.tsx
components/ui/dropdown-menu.tsx
components/ui/hover-card.tsx
components/ui/input.tsx
components/ui/label.tsx
components/ui/popover.tsx
components/ui/radio-group.tsx
components/ui/select.tsx
components/ui/table.tsx
components/ui/tabs.tsx
components/ui/textarea.tsx
docs/2024년 보조기기센터 사업안내.pdf
docs/보조기기센터사업안내.md
docs/assessform.md
docs/client_secret_1077314230614-i4309irh0f5khian21djrpt21aoh08g7.apps.googleusercontent.com.json
docs/counsilform.md
docs/DB_SCHEMA_ANALYSIS.md
docs/DIR.md
docs/Mermaid.md
docs/MRD.md
docs/PRD.md
docs/processform.md
docs/Readme.md
docs/TODO.md
docs/TRD.md
env.example
eslint.config.mjs
lib/hooks/useDashboardStats.ts
lib/stores/application-store.ts
lib/supabase/client.ts
lib/supabase/server.ts
lib/utils.ts
lib/utils/permissions.ts
lib/validators.ts
middleware.ts
migrations/002_add_applications_fields.sql
migrations/003_add_inventory_fields.sql
migrations/004_create_service_logs.sql
migrations/005_create_schedules.sql
migrations/006_create_notices.sql
migrations/007_create_rentals.sql
migrations/008_add_notice_attachments.sql
next.config.mjs
package.json
postcss.config.mjs
tailwind.config.ts
tsconfig.json
types/database.types.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="actions/client-actions.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { hasAdminOrStaffPermission } from "@/lib/utils/permissions"
import { Database } from "@/types/database.types"

type Client = Database["public"]["Tables"]["clients"]["Row"]

export interface ClientWithStats extends Client {
  application_count?: number
  last_service_date?: string | null
}

export interface ClientSearchParams {
  query?: string // 이름 또는 생년월일 검색
  disability_type?: string // 장애유형 필터
  limit?: number
  offset?: number
}

export interface ClientHistoryItem {
  id: string
  type: "application" | "schedule" | "service_log"
  date: string
  title: string
  description: string | null
  status?: string | null
  category?: string | null
}

/**
 * 대상자 검색 (이름/생년월일)
 */
export async function searchClients(params: ClientSearchParams = {}): Promise<{
  success: boolean
  clients?: ClientWithStats[]
  total?: number
  error?: string
}> {
  try {
    const hasPermission = await hasAdminOrStaffPermission()
    if (!hasPermission) {
      return { success: false, error: "권한이 없습니다" }
    }

    const supabase = await createClient()
    const { query, disability_type, limit = 50, offset = 0 } = params

    let queryBuilder = supabase
      .from("clients")
      .select("*", { count: "exact" })

    // 이름 또는 생년월일 검색
    if (query) {
      // 생년월일 형식인지 확인 (YYYY-MM-DD)
      if (query.match(/^\d{4}-\d{2}-\d{2}$/)) {
        // 생년월일로 검색
        queryBuilder = queryBuilder.eq("birth_date", query)
      } else {
        // 이름으로 검색 (ilike는 대소문자 구분 없음)
        queryBuilder = queryBuilder.ilike("name", `%${query}%`)
      }
    }

    // 장애유형 필터
    if (disability_type) {
      queryBuilder = queryBuilder.eq("disability_type", disability_type)
    }

    // 정렬: 최근 업데이트 순
    queryBuilder = queryBuilder.order("updated_at", { ascending: false, nullsFirst: false })
      .order("created_at", { ascending: false })

    // 페이지네이션
    queryBuilder = queryBuilder.range(offset, offset + limit - 1)

    const { data, error, count } = await queryBuilder

    if (error) {
      console.error("대상자 검색 실패:", error)
      return { success: false, error: "대상자 검색에 실패했습니다" }
    }

    // 각 클라이언트의 신청서 개수 조회
    const clients: ClientWithStats[] = await Promise.all(
      (data || []).map(async (client: Client) => {
        const { count } = await supabase
          .from("applications")
          .select("*", { count: "exact", head: true })
          .eq("client_id", client.id)

        return {
          ...client,
          application_count: count || 0,
        }
      })
    )

    return {
      success: true,
      clients,
      total: count || 0,
    }
  } catch (error) {
    console.error("Unexpected error in searchClients:", error)
    return { success: false, error: "예상치 못한 오류가 발생했습니다" }
  }
}

/**
 * 대상자 상세 정보 조회 (ID로)
 */
export async function getClientById(clientId: string): Promise<{
  success: boolean
  client?: Client
  error?: string
}> {
  try {
    const hasPermission = await hasAdminOrStaffPermission()
    if (!hasPermission) {
      return { success: false, error: "권한이 없습니다" }
    }

    const supabase = await createClient()

    const { data, error } = await supabase
      .from("clients")
      .select("*")
      .eq("id", clientId)
      .single()

    if (error) {
      console.error("대상자 조회 실패:", error)
      return { success: false, error: "대상자 조회에 실패했습니다" }
    }

    return { success: true, client: data }
  } catch (error) {
    console.error("Unexpected error in getClientById:", error)
    return { success: false, error: "예상치 못한 오류가 발생했습니다" }
  }
}

/**
 * 대상자 정보 수정
 */
export async function updateClient(
  clientId: string,
  updates: Partial<Omit<Client, "id" | "created_at">>
): Promise<{
  success: boolean
  client?: Client
  error?: string
}> {
  try {
    const hasPermission = await hasAdminOrStaffPermission()
    if (!hasPermission) {
      return { success: false, error: "권한이 없습니다" }
    }

    const supabase = await createClient()

    // updated_at 자동 업데이트
    const { data, error } = await supabase
      .from("clients")
      .update({
        ...updates,
        updated_at: new Date().toISOString(),
      })
      .eq("id", clientId)
      .select()
      .single()

    if (error) {
      console.error("대상자 수정 실패:", error)
      return { success: false, error: "대상자 수정에 실패했습니다" }
    }

    return { success: true, client: data }
  } catch (error) {
    console.error("Unexpected error in updateClient:", error)
    return { success: false, error: "예상치 못한 오류가 발생했습니다" }
  }
}

/**
 * 대상자 서비스 이용 이력 조회 (5대 사업 통합)
 */
export async function getClientHistory(clientId: string): Promise<{
  success: boolean
  history?: ClientHistoryItem[]
  error?: string
}> {
  try {
    const hasPermission = await hasAdminOrStaffPermission()
    if (!hasPermission) {
      return { success: false, error: "권한이 없습니다" }
    }

    const supabase = await createClient()

    // 1. 신청서 이력
    const { data: applications, error: appsError } = await supabase
      .from("applications")
      .select("id, status, category, sub_category, created_at, updated_at")
      .eq("client_id", clientId)
      .order("created_at", { ascending: false })

    if (appsError) {
      console.error("신청서 이력 조회 실패:", appsError)
    }

    // 2. 일정 이력
    const { data: schedules, error: schedulesError } = await supabase
      .from("schedules")
      .select("id, schedule_type, scheduled_date, scheduled_time, status, created_at")
      .eq("client_id", clientId)
      .order("scheduled_date", { ascending: false })
      .order("scheduled_time", { ascending: false })

    if (schedulesError) {
      console.error("일정 이력 조회 실패:", schedulesError)
    }

    // 3. 서비스 로그 이력 (applications를 통해 조회)
    // 먼저 해당 클라이언트의 applications를 조회
    const { data: clientApplications } = await supabase
      .from("applications")
      .select("id")
      .eq("client_id", clientId)

    const applicationIds = clientApplications?.map((app) => app.id) || []
    let serviceLogs: any[] = []

    if (applicationIds.length > 0) {
      const { data: logs, error: logsError } = await supabase
        .from("service_logs")
        .select("id, service_type, service_area, service_date, created_at")
        .in("application_id", applicationIds)
        .order("service_date", { ascending: false })

      if (logsError) {
        console.error("서비스 로그 이력 조회 실패:", logsError)
      } else {
        serviceLogs = logs || []
      }
    }

    // 모든 이력을 하나의 배열로 통합
    const history: ClientHistoryItem[] = []

    // 신청서 이력 추가
    applications?.forEach((app) => {
      const categoryMap: Record<string, string> = {
        consult: "상담",
        experience: "체험",
        custom: "맞춤형",
        aftercare: "사후관리",
        education: "교육/홍보",
      }

      const subCategoryMap: Record<string, string> = {
        repair: "수리",
        rental: "대여",
        custom_make: "제작",
        visit: "방문",
        exhibition: "전시",
        cleaning: "소독/세척",
        reuse: "재사용",
      }

      const categoryName = categoryMap[app.category || ""] || app.category || "기타"
      const subCategoryName = subCategoryMap[app.sub_category || ""] || app.sub_category || ""
      const title = subCategoryName ? `${categoryName} - ${subCategoryName}` : categoryName

      history.push({
        id: app.id,
        type: "application",
        date: app.created_at || "",
        title,
        description: `상태: ${app.status || "접수"}`,
        status: app.status || null,
        category: app.category || null,
      })
    })

    // 일정 이력 추가
    schedules?.forEach((schedule) => {
      const scheduleTypeMap: Record<string, string> = {
        visit: "방문",
        consultation: "상담",
        assessment: "평가",
        delivery: "배송",
        pickup: "픽업",
      }

      const typeName = scheduleTypeMap[schedule.schedule_type || ""] || schedule.schedule_type || "일정"
      const timeStr = schedule.scheduled_time 
        ? `${schedule.scheduled_date} ${schedule.scheduled_time}` 
        : schedule.scheduled_date || ""

      history.push({
        id: schedule.id,
        type: "schedule",
        date: schedule.scheduled_date || schedule.created_at || "",
        title: typeName,
        description: timeStr,
        status: schedule.status || null,
      })
    })

    // 서비스 로그 이력 추가
    serviceLogs?.forEach((log) => {
      const serviceTypeMap: Record<string, string> = {
        repair: "수리",
        custom_make: "제작",
        rental: "대여",
        education: "교육",
        cleaning: "소독/세척",
      }

      const typeName = serviceTypeMap[log.service_type || ""] || log.service_type || "서비스"
      const areaName = log.service_area || ""

      history.push({
        id: log.id,
        type: "service_log",
        date: log.service_date || log.created_at || "",
        title: typeName,
        description: areaName,
      })
    })

    // 날짜순으로 정렬 (최신순)
    history.sort((a, b) => {
      const dateA = new Date(a.date).getTime()
      const dateB = new Date(b.date).getTime()
      return dateB - dateA
    })

    return { success: true, history }
  } catch (error) {
    console.error("Unexpected error in getClientHistory:", error)
    return { success: false, error: "예상치 못한 오류가 발생했습니다" }
  }
}
</file>

<file path="app/admin/clients/[id]/page.tsx">
import { getClientById, getClientHistory } from "@/actions/client-actions"
import { ClientProfileCard } from "@/components/features/crm/ClientProfileCard"
import { ClientHistoryTable } from "@/components/features/crm/ClientHistoryTable"
import { hasAdminOrStaffPermission } from "@/lib/utils/permissions"
import { redirect, notFound } from "next/navigation"
import { Button } from "@/components/ui/button"
import Link from "next/link"
import { ArrowLeft } from "lucide-react"

interface ClientDetailPageProps {
  params: Promise<{ id: string }>
}

export default async function ClientDetailPage({ params }: ClientDetailPageProps) {
  // 권한 확인
  const hasPermission = await hasAdminOrStaffPermission()
  if (!hasPermission) {
    console.log("[대상자 상세] 권한 없음 - 홈으로 리다이렉트")
    redirect("/")
  }

  const { id } = await params

  // 대상자 정보 조회
  const clientResult = await getClientById(id)
  if (!clientResult.success || !clientResult.client) {
    notFound()
  }

  // 서비스 이력 조회
  const historyResult = await getClientHistory(id)
  const history = historyResult.success ? historyResult.history || [] : []

  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <div className="mb-6">
        <Button asChild variant="ghost" className="mb-4">
          <Link href="/admin/clients">
            <ArrowLeft className="mr-2 h-4 w-4" />
            목록으로
          </Link>
        </Button>
        <h1 className="text-responsive-xl font-bold text-foreground mb-2">
          대상자 상세 정보
        </h1>
        <p className="text-muted-foreground">
          {clientResult.client.name}님의 상세 정보 및 서비스 이용 이력
        </p>
      </div>

      <div className="space-y-6">
        <ClientProfileCard client={clientResult.client} />
        <ClientHistoryTable history={history} />
      </div>
    </div>
  )
}
</file>

<file path="app/admin/clients/page.tsx">
import { searchClients } from "@/actions/client-actions"
import { ClientTable } from "@/components/features/crm/ClientTable"
import { hasAdminOrStaffPermission } from "@/lib/utils/permissions"
import { redirect } from "next/navigation"

export default async function ClientsPage() {
  // 권한 확인
  const hasPermission = await hasAdminOrStaffPermission()
  if (!hasPermission) {
    console.log("[대상자 관리] 권한 없음 - 홈으로 리다이렉트")
    redirect("/")
  }

  // 초기 데이터 로드
  const result = await searchClients({ limit: 20 })
  const initialClients = result.success ? result.clients || [] : []
  const initialTotal = result.success ? result.total || 0 : 0

  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <div className="mb-8">
        <h1 className="text-responsive-xl font-bold text-foreground mb-2">
          대상자 관리
        </h1>
        <p className="text-muted-foreground">
          대상자 정보를 검색하고 관리할 수 있습니다
        </p>
      </div>

      <ClientTable initialClients={initialClients} initialTotal={initialTotal} />
    </div>
  )
}
</file>

<file path="components/features/crm/ClientHistoryTable.tsx">
"use client"

import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { type ClientHistoryItem } from "@/actions/client-actions"
import { format } from "date-fns"
import { ko } from "date-fns/locale"
import { FileText, Calendar, Wrench, Clock } from "lucide-react"

interface ClientHistoryTableProps {
  history: ClientHistoryItem[]
}

export function ClientHistoryTable({ history }: ClientHistoryTableProps) {
  const formatDate = (dateString: string) => {
    try {
      return format(new Date(dateString), "yyyy년 MM월 dd일", { locale: ko })
    } catch {
      return dateString
    }
  }

  const getTypeIcon = (type: string) => {
    switch (type) {
      case "application":
        return <FileText className="h-4 w-4" />
      case "schedule":
        return <Calendar className="h-4 w-4" />
      case "service_log":
        return <Wrench className="h-4 w-4" />
      default:
        return <Clock className="h-4 w-4" />
    }
  }

  const getTypeLabel = (type: string) => {
    switch (type) {
      case "application":
        return "신청"
      case "schedule":
        return "일정"
      case "service_log":
        return "서비스"
      default:
        return type
    }
  }

  const getStatusBadge = (status: string | null) => {
    if (!status) return null

    const statusMap: Record<string, { label: string; variant: "default" | "secondary" | "destructive" | "outline" }> = {
      접수: { label: "접수", variant: "outline" },
      배정: { label: "배정", variant: "secondary" },
      진행: { label: "진행", variant: "default" },
      완료: { label: "완료", variant: "default" },
      반려: { label: "반려", variant: "destructive" },
    }

    const statusInfo = statusMap[status] || { label: status, variant: "outline" as const }
    return (
      <Badge variant={statusInfo.variant} className="ml-2">
        {statusInfo.label}
      </Badge>
    )
  }

  if (history.length === 0) {
    return (
      <Card>
        <CardHeader>
          <CardTitle>서비스 이용 이력</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="py-12 text-center text-muted-foreground">
            <Clock className="mx-auto h-12 w-12 mb-4 opacity-50" />
            <p>서비스 이용 이력이 없습니다</p>
          </div>
        </CardContent>
      </Card>
    )
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle>서비스 이용 이력</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="space-y-4">
          {history.map((item, index) => (
            <div
              key={`${item.type}-${item.id}`}
              className="flex gap-4 pb-4 border-b last:border-0 last:pb-0"
            >
              {/* 타임라인 아이콘 */}
              <div className="flex flex-col items-center">
                <div className="flex h-8 w-8 items-center justify-center rounded-full bg-primary/10 text-primary">
                  {getTypeIcon(item.type)}
                </div>
                {index < history.length - 1 && (
                  <div className="w-0.5 h-full bg-border mt-2" />
                )}
              </div>

              {/* 내용 */}
              <div className="flex-1 min-w-0">
                <div className="flex items-start justify-between gap-2">
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-1">
                      <span className="text-sm font-medium">{item.title}</span>
                      <Badge variant="outline" className="text-xs">
                        {getTypeLabel(item.type)}
                      </Badge>
                      {getStatusBadge(item.status)}
                    </div>
                    {item.description && (
                      <p className="text-sm text-muted-foreground mb-2">{item.description}</p>
                    )}
                    <p className="text-xs text-muted-foreground">
                      {formatDate(item.date)}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </CardContent>
    </Card>
  )
}
</file>

<file path="components/features/crm/ClientProfileCard.tsx">
"use client"

import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { Database } from "@/types/database.types"
import { format } from "date-fns"
import { ko } from "date-fns/locale"
import { User, Phone, Calendar, MapPin, Home, Heart } from "lucide-react"

type Client = Database["public"]["Tables"]["clients"]["Row"]

interface ClientProfileCardProps {
  client: Client
}

export function ClientProfileCard({ client }: ClientProfileCardProps) {
  const formatDate = (dateString: string | null) => {
    if (!dateString) return "-"
    try {
      return format(new Date(dateString), "yyyy년 MM월 dd일", { locale: ko })
    } catch {
      return dateString
    }
  }

  const calculateAge = (birthDate: string | null) => {
    if (!birthDate) return null
    try {
      const birth = new Date(birthDate)
      const today = new Date()
      let age = today.getFullYear() - birth.getFullYear()
      const monthDiff = today.getMonth() - birth.getMonth()
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
        age--
      }
      return age
    } catch {
      return null
    }
  }

  const age = calculateAge(client.birth_date)

  return (
    <Card>
      <CardHeader>
        <div className="flex items-center justify-between">
          <CardTitle className="flex items-center gap-2">
            <User className="h-5 w-5" />
            기본 정보
          </CardTitle>
          {client.gender && (
            <Badge variant="outline">{client.gender}</Badge>
          )}
        </div>
      </CardHeader>
      <CardContent>
        <div className="grid gap-4 md:grid-cols-2">
          {/* 기본 정보 */}
          <div className="space-y-3">
            <div className="flex items-start gap-3">
              <User className="h-4 w-4 mt-0.5 text-muted-foreground" />
              <div>
                <p className="text-sm font-medium">이름</p>
                <p className="text-sm text-muted-foreground">{client.name}</p>
              </div>
            </div>

            <div className="flex items-start gap-3">
              <Calendar className="h-4 w-4 mt-0.5 text-muted-foreground" />
              <div>
                <p className="text-sm font-medium">생년월일</p>
                <p className="text-sm text-muted-foreground">
                  {formatDate(client.birth_date)}
                  {age !== null && ` (만 ${age}세)`}
                </p>
              </div>
            </div>

            {client.registration_number && (
              <div className="flex items-start gap-3">
                <User className="h-4 w-4 mt-0.5 text-muted-foreground" />
                <div>
                  <p className="text-sm font-medium">등록번호</p>
                  <p className="text-sm text-muted-foreground">{client.registration_number}</p>
                </div>
              </div>
            )}

            {client.contact && (
              <div className="flex items-start gap-3">
                <Phone className="h-4 w-4 mt-0.5 text-muted-foreground" />
                <div>
                  <p className="text-sm font-medium">연락처</p>
                  <p className="text-sm text-muted-foreground">{client.contact}</p>
                </div>
              </div>
            )}

            {client.guardian_contact && (
              <div className="flex items-start gap-3">
                <Phone className="h-4 w-4 mt-0.5 text-muted-foreground" />
                <div>
                  <p className="text-sm font-medium">보호자 연락처</p>
                  <p className="text-sm text-muted-foreground">{client.guardian_contact}</p>
                </div>
              </div>
            )}
          </div>

          {/* 주소 및 주거 정보 */}
          <div className="space-y-3">
            {client.address && (
              <div className="flex items-start gap-3">
                <MapPin className="h-4 w-4 mt-0.5 text-muted-foreground" />
                <div>
                  <p className="text-sm font-medium">주소</p>
                  <p className="text-sm text-muted-foreground">{client.address}</p>
                </div>
              </div>
            )}

            {client.housing_type && (
              <div className="flex items-start gap-3">
                <Home className="h-4 w-4 mt-0.5 text-muted-foreground" />
                <div>
                  <p className="text-sm font-medium">주거형태</p>
                  <p className="text-sm text-muted-foreground">{client.housing_type}</p>
                </div>
              </div>
            )}

            {client.has_elevator !== null && (
              <div className="flex items-start gap-3">
                <Home className="h-4 w-4 mt-0.5 text-muted-foreground" />
                <div>
                  <p className="text-sm font-medium">엘리베이터</p>
                  <p className="text-sm text-muted-foreground">
                    {client.has_elevator ? "있음" : "없음"}
                  </p>
                </div>
              </div>
            )}

            {client.obstacles && (
              <div className="flex items-start gap-3">
                <MapPin className="h-4 w-4 mt-0.5 text-muted-foreground" />
                <div>
                  <p className="text-sm font-medium">장애물</p>
                  <p className="text-sm text-muted-foreground">{client.obstacles}</p>
                </div>
              </div>
            )}
          </div>
        </div>

        {/* 장애 정보 */}
        {(client.disability_type || client.disability_grade || client.disability_cause) && (
          <div className="mt-6 pt-6 border-t">
            <div className="flex items-center gap-2 mb-4">
              <Heart className="h-4 w-4 text-muted-foreground" />
              <p className="text-sm font-medium">장애 정보</p>
            </div>
            <div className="grid gap-3 md:grid-cols-3">
              {client.disability_type && (
                <div>
                  <p className="text-sm font-medium">장애유형</p>
                  <Badge variant="secondary" className="mt-1">
                    {client.disability_type}
                  </Badge>
                </div>
              )}
              {client.disability_grade && (
                <div>
                  <p className="text-sm font-medium">장애정도</p>
                  <p className="text-sm text-muted-foreground mt-1">{client.disability_grade}</p>
                </div>
              )}
              {client.disability_cause && (
                <div>
                  <p className="text-sm font-medium">장애발생원인</p>
                  <p className="text-sm text-muted-foreground mt-1">{client.disability_cause}</p>
                </div>
              )}
            </div>
            {client.disability_onset_date && (
              <div className="mt-3">
                <p className="text-sm font-medium">장애발생시기</p>
                <p className="text-sm text-muted-foreground mt-1">
                  {formatDate(client.disability_onset_date)}
                </p>
              </div>
            )}
          </div>
        )}

        {/* 경제 상황 */}
        {client.economic_status && (
          <div className="mt-6 pt-6 border-t">
            <p className="text-sm font-medium mb-2">경제상황</p>
            <p className="text-sm text-muted-foreground">{client.economic_status}</p>
          </div>
        )}
      </CardContent>
    </Card>
  )
}
</file>

<file path="components/features/crm/ClientTable.tsx">
"use client"

import { useState, useEffect } from "react"
import { searchClients, type ClientWithStats } from "@/actions/client-actions"
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table"
import { Input } from "@/components/ui/input"
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Loader2, Search, User } from "lucide-react"
import Link from "next/link"
import { format } from "date-fns"
import { ko } from "date-fns/locale"

interface ClientTableProps {
  initialClients?: ClientWithStats[]
  initialTotal?: number
}

export function ClientTable({ initialClients = [], initialTotal = 0 }: ClientTableProps) {
  const [clients, setClients] = useState<ClientWithStats[]>(initialClients)
  const [total, setTotal] = useState(initialTotal)
  const [isLoading, setIsLoading] = useState(false)
  const [searchQuery, setSearchQuery] = useState("")
  const [disabilityType, setDisabilityType] = useState<string>("")
  const [currentPage, setCurrentPage] = useState(1)
  const itemsPerPage = 20

  const handleSearch = async () => {
    setIsLoading(true)
    try {
      const result = await searchClients({
        query: searchQuery || undefined,
        disability_type: disabilityType || undefined,
        limit: itemsPerPage,
        offset: (currentPage - 1) * itemsPerPage,
      })

      if (result.success && result.clients) {
        setClients(result.clients)
        setTotal(result.total || 0)
      }
    } catch (error) {
      console.error("대상자 검색 실패:", error)
    } finally {
      setIsLoading(false)
    }
  }

  useEffect(() => {
    handleSearch()
  }, [currentPage, disabilityType])

  // 검색어 변경 시 디바운스
  useEffect(() => {
    const timer = setTimeout(() => {
      if (currentPage === 1) {
        handleSearch()
      } else {
        setCurrentPage(1)
      }
    }, 500)

    return () => clearTimeout(timer)
  }, [searchQuery])

  const totalPages = Math.ceil(total / itemsPerPage)

  const formatDate = (dateString: string | null) => {
    if (!dateString) return "-"
    try {
      return format(new Date(dateString), "yyyy-MM-dd", { locale: ko })
    } catch {
      return dateString
    }
  }

  const calculateAge = (birthDate: string | null) => {
    if (!birthDate) return "-"
    try {
      const birth = new Date(birthDate)
      const today = new Date()
      let age = today.getFullYear() - birth.getFullYear()
      const monthDiff = today.getMonth() - birth.getMonth()
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
        age--
      }
      return `${age}세`
    } catch {
      return "-"
    }
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle>대상자 목록</CardTitle>
      </CardHeader>
      <CardContent>
        {/* 검색 및 필터 */}
        <div className="mb-6 flex flex-col gap-4 sm:flex-row">
          <div className="relative flex-1">
            <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
            <Input
              placeholder="이름 또는 생년월일(YYYY-MM-DD)로 검색"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="pl-10"
            />
          </div>
          <Select value={disabilityType} onValueChange={setDisabilityType}>
            <SelectTrigger className="w-full sm:w-[200px]">
              <SelectValue placeholder="장애유형" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="">전체</SelectItem>
              <SelectItem value="지체장애">지체장애</SelectItem>
              <SelectItem value="뇌병변장애">뇌병변장애</SelectItem>
              <SelectItem value="시각장애">시각장애</SelectItem>
              <SelectItem value="청각장애">청각장애</SelectItem>
              <SelectItem value="언어장애">언어장애</SelectItem>
              <SelectItem value="지적장애">지적장애</SelectItem>
              <SelectItem value="자폐성장애">자폐성장애</SelectItem>
              <SelectItem value="정신장애">정신장애</SelectItem>
              <SelectItem value="신장장애">신장장애</SelectItem>
              <SelectItem value="심장장애">심장장애</SelectItem>
              <SelectItem value="호흡기장애">호흡기장애</SelectItem>
              <SelectItem value="간장애">간장애</SelectItem>
              <SelectItem value="안면장애">안면장애</SelectItem>
              <SelectItem value="장루·요루장애">장루·요루장애</SelectItem>
              <SelectItem value="뇌전증장애">뇌전증장애</SelectItem>
            </SelectContent>
          </Select>
          <Button onClick={handleSearch} disabled={isLoading}>
            {isLoading ? (
              <>
                <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                검색 중...
              </>
            ) : (
              <>
                <Search className="mr-2 h-4 w-4" />
                검색
              </>
            )}
          </Button>
        </div>

        {/* 결과 개수 */}
        <div className="mb-4 text-sm text-muted-foreground">
          총 {total}명의 대상자를 찾았습니다
        </div>

        {/* 테이블 */}
        {isLoading && clients.length === 0 ? (
          <div className="flex items-center justify-center py-12">
            <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
          </div>
        ) : clients.length === 0 ? (
          <div className="py-12 text-center text-muted-foreground">
            <User className="mx-auto h-12 w-12 mb-4 opacity-50" />
            <p>검색 결과가 없습니다</p>
          </div>
        ) : (
          <>
            <div className="rounded-md border">
              <Table>
                <TableHeader>
                  <TableRow>
                    <TableHead>이름</TableHead>
                    <TableHead>생년월일</TableHead>
                    <TableHead>나이</TableHead>
                    <TableHead>성별</TableHead>
                    <TableHead>장애유형</TableHead>
                    <TableHead>연락처</TableHead>
                    <TableHead>신청 건수</TableHead>
                    <TableHead className="text-right">관리</TableHead>
                  </TableRow>
                </TableHeader>
                <TableBody>
                  {clients.map((client) => (
                    <TableRow key={client.id}>
                      <TableCell className="font-medium">{client.name}</TableCell>
                      <TableCell>{formatDate(client.birth_date)}</TableCell>
                      <TableCell>{calculateAge(client.birth_date)}</TableCell>
                      <TableCell>{client.gender || "-"}</TableCell>
                      <TableCell>{client.disability_type || "-"}</TableCell>
                      <TableCell>{client.contact || "-"}</TableCell>
                      <TableCell>
                        <span className="inline-flex items-center rounded-full bg-primary/10 px-2.5 py-0.5 text-xs font-medium text-primary">
                          {client.application_count || 0}건
                        </span>
                      </TableCell>
                      <TableCell className="text-right">
                        <Button asChild variant="ghost" size="sm">
                          <Link href={`/admin/clients/${client.id}`}>상세보기</Link>
                        </Button>
                      </TableCell>
                    </TableRow>
                  ))}
                </TableBody>
              </Table>
            </div>

            {/* 페이지네이션 */}
            {totalPages > 1 && (
              <div className="mt-4 flex items-center justify-between">
                <div className="text-sm text-muted-foreground">
                  {currentPage} / {totalPages} 페이지
                </div>
                <div className="flex gap-2">
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={() => setCurrentPage((p) => Math.max(1, p - 1))}
                    disabled={currentPage === 1 || isLoading}
                  >
                    이전
                  </Button>
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={() => setCurrentPage((p) => Math.min(totalPages, p + 1))}
                    disabled={currentPage === totalPages || isLoading}
                  >
                    다음
                  </Button>
                </div>
              </div>
            )}
          </>
        )}
      </CardContent>
    </Card>
  )
}
</file>

<file path="components/ui/table.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
))
TableBody.displayName = "TableBody"

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className
    )}
    {...props}
  />
))
TableFooter.displayName = "TableFooter"

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props}
  />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className
    )}
    {...props}
  />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
))
TableCell.displayName = "TableCell"

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props}
  />
))
TableCaption.displayName = "TableCaption"

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}
</file>

<file path="docs/보조기기센터사업안내.md">
2024년 보조기기센터 사업안내 (전체 텍스트)
발행: 보건복지부, 국립재활원 중앙보조기기센터
발간등록번호: 11-1352000-003643-10
[제1장] 2024년 개정사항 안내
I. 2024년 주요 변경 사항
사업추진방식 명확화 (제2장)
지역보조기기센터: 장애인보조기기법 제14조1항에 따른 직접수행 또는 같은법 제14조제3항에 따른 위탁운영 명시.
인력운영기준 강화 (제2장)
팀원 인력 기준: 최소 4명 (기존 최소 1~3명 이상에서 구체화)
주요업무: 서비스 대상자 이력관리, 초기접수, 상담 및 정보제공(콜센터, 체험), 맞춤형 지원(대여, 제작, 교부 평가), 사후관리(점검, 세척, 재사용), 교육 및 홍보 등.
개인정보 보호 규정 신설 (제2장)
기본원칙: 개인정보보호법 준수.
필수 조치사항: 수집 및 이용 목적 제한, 목적 외 이용 금지, 파기 절차, 유출 통지 등.
교육 이수: 개인정보처리자 정기 교육 의무화.
예산 집행 기준 변경 (제2장)
국내여비 지급표 인상:
일비: 20,000원 → 25,000원
식비: 20,000원 → 25,000원
근무지외 여비 인상:
일비: 10,000원 → 12,500원
식비: 20,000원 → 25,000원
위탁·재위탁 평가 (제2장)
신규 위탁 시 선정 계획 및 결과를 위탁 계약 전까지 보건복지부에 제출.
재위탁 시 계약 만료 90일 전까지 보건복지부 종합평가결과를 반영한 계획 제출.
사업 내용 재편 (제3장)
기존 '사업 수행 가이드북' 내용을 '보조기기센터 사업'으로 명칭 변경 및 체계화.
지역사회연계 항목 삭제 (사업 내용에 통합).
맞춤형 지원사업에 '장애인보조기기 교부사업 맞춤형 평가지원' 명시.
사후관리 지원사업에 '보조기기 재사용 지원' 항목 구체화.
평가지표 개선 (부록)
사업수행실적(40점), 사업운영관리(10점), 자원관리(10점), 서비스 효과성(10점), 질적평가(30점)으로 배점 및 항목 조정.
[제2장] 보조기기센터 운영
I. 보조기기센터 개요

1. 사업목적 및 목표
   목적: 효율적인 보조기기 지원 및 활용촉진을 통해 장애인 및 노인 등의 활동제약을 최소화하고, 완전한 사회참여 및 삶의 질 향상을 도모함으로써 사회통합에 기여.
   목표:
   촘촘한 보조기기서비스 전달체계 구축.
   통합적 보조기기서비스 지원 허브망 구축.
   장애인 및 노인의 보조기기 사용 사각지대 해소.
2. 추진근거
   ｢장애인ㆍ노인 등을 위한 보조기기 지원 및 활용촉진에 관한 법률｣ 제13조(중앙), 제14조(지역).
   대상자: 장애인복지법상 장애인, 노인장기요양보험법상 노인, 국가유공자 등.
3. 사업개요
   기간: 단년도 계속사업.
   예산: 중앙(국비 100%), 지역(국비 50%, 지방비 50% 이상 매칭).
4. 설치현황
   중앙 1개소, 지역 16개소 (서울, 부산, 대구, 인천, 광주, 대전, 울산, 세종, 경기, 강원, 충북, 충남, 전북, 전남, 경북, 경남, 제주).
   II. 사업 주체별 역할
   보건복지부: 설치계획 수립/지원, 관리 감독/평가, 교부/정산, 지정/사업 관리.
   시·도: 위탁 및 사업 관리, 관리 감독/지도점검, 교부/정산.
   중앙보조기기센터: 컨트롤타워, 정책연구, 전문인력 교육, 정보수집/DB구축, 지역센터 지원, 모니터링, 국제협력.
   지역보조기기센터: 서비스 전달체계 허브, 사례관리(상담/평가/적용 등), 전시체험장 운영, 정보제공/교육/홍보, 지역연계, 대여/수리/개조/재사용 등.
   III. 보조기기센터의 설치 및 운영
5. 명칭 및 로고: "& AT" (National & Assistive Technology) 로고 사용.
6. 설치기준 (최소면적)
   중앙: 231㎡ 이상 (전시장 내/외부, 사무공간, 회의실 등 필수).
   지역: 220㎡ 이상 (전시장 내/외부, 사무공간, 상담실, 기초평가실, 제작실, 물류창고실 필수).
   전시장: 내부 66㎡, 외부 33㎡ 이상.
   제작실/물류창고: 각 26㎡ 이상.
7. 인력운영기준
   센터장 1인, 일정 인원 상근 원칙.
   지역센터 최소 인원 5명 이상 (센터장, 실장, 팀원 4명 구조 권장).
   자격: 보조공학사, 사회복지사, 물리/작업치료사, 보조기기 기사 등.
   IV. 보조기기센터 사업
8. 중앙보조기기센터 사업
   정책연구/개발, 지역센터 운영 지원, 정보 수집/DB 구축, 전문인력 교육, 모니터링, 국제협력.
9. 지역보조기기센터 사업
   상담 및 정보제공(콜센터, 체험).
   맞춤형 지원(대여, 제작, 교부평가).
   사후관리(소독/세척, 점검/수리, 재사용).
   교육/홍보, 자체발굴사업.
   V. 보조기기 정보 구축 및 운영
   보조기기 이용자 정보 관리 시스템(사례관리 DB) 운영.
   정보제공 웹사이트 운영 (품목 정보, 지원사업 안내 등).
   VI. 개인정보 보호
   개인정보보호법 준수.
   수집 시 동의서 징구, 목적 외 이용 금지, 안전성 확보 조치, 유출 시 통지 의무.
   개인정보 취급자 정기 교육 실시.
   VII. 보조기기센터의 예산
10. 총칙: 재무회계 규정 준수, e-나라도움 시스템 사용.
11. 예산 편성: 회계연도 1.1~12.31.
12. 집행 기준 (주요사항)
    인건비: 총 사업비의 85% 초과 불가. 상용임금, 퇴직금, 4대보험 등.
    운영비: 일반수용비, 공공요금, 임차료, 시설장비유지비, 재료비 등.
    여비: 공무원 여비 규정 준용.
    국내여비: 일비 25,000원, 식비 25,000원, 숙박비 실비(상한액 적용).
    업무추진비: 식/음료비, 회의비. 건당 50만원 이상 시 명단 증빙.
    자산취득비: 내구연수 준수, 물품관리법 의거 관리.
13. 정산: 회계연도 종료 후 2개월 이내 정산보고서 제출. 잔액 반납.
    VIII. 보조기기센터의 보고 및 행정
    보고: 사업계획서(1월), 실적보고(반기별), 결과/정산보고(익년 2월), 변경사항(분기별).
    행정조치: 위탁/재위탁 평가 결과에 따라 주의, 시정, 경고, 지원정지, 선정취소 가능.
    IX. 복무 및 기타사항
    근무: 주 5일, 1일 8시간. 초과근무 월 20시간 내 원칙.
    휴가: 연차 유급휴가, 병가, 공가, 특별휴가(경조사) 등 규정 준수.
    경조사: 결혼(5일), 출산(배우자 10일), 사망(배우자/부모 5일) 등.
    징계: 징계위원회 구성, 징계 종류(해고, 정직, 감봉, 견책).
    해고 제한: 정당한 사유 없는 해고 금지, 30일 전 예고.
    X. 보조기기센터의 평가
    평가체계: 복지부 주관, 중앙/시도 협력. 서면/현장평가 병행.
    결과활용: 인센티브 제공 또는 부진 시 수탁기관 변경/재선정.
    [제3장] 보조기기센터 사업 (세부 가이드)
    I. 보조기기 상담 및 정보제공사업
    상담: 접수 → 초기상담 → 욕구파악/평가. (기록지 작성 필수)
    콜센터(1670-5529): 단순 정보제공 및 타 기관 연계. 실적 관리.
    체험지원: 전시장 내 기기 직접 체험, 견학 프로그램 운영.
    II. 보조기기 맞춤형 지원사업
    대여:
    단기/장기 대여. 1인 연간 3종 이하, 최대 1년(연장 1회/2회 가능).
    파손/분실 시 사용자 책임 명시.
    맞춤 제작 지원:
    기성품 사용 불가 시 개조/제작.
    지원금: 1인 10만원 기준(재료비). 초과 시 자부담.
    장애인보조기기 교부사업 맞춤형 평가지원:
    지자체 의뢰 → 상담/평가 → 적합 기기 추천(결과 제출) → 검수/사후관리.
    III. 사후관리 지원사업
    소독 및 세척: 위생 관리. 전용 장비 활용.
    점검 및 수리:
    경정비 및 부품 교체.
    지원금: 1인 연간 10만원 기준. 전문 수리업체 연계 가능.
    재사용 지원:
    유휴 기기 기증/수거 → 세척/수리/점검 → 재보급(대여/지급).
    IV. 교육 및 홍보사업
    교육: 종사자 역량 강화, 공무원/관련 전문가 교육, 사용자 교육.
    홍보: 온/오프라인 홍보, 홍보물 제작, 보조기기 인식 개선 캠페인.
    [부록] 관련 서식 및 규정 (Page 110~194)
    (아래는 각 첨부 서식의 주요 내용을 요약한 텍스트입니다)
    [첨부 1] 지역보조기기센터 운영규정
    제1장 총칙: 목적, 용어 정의, 운영원칙.
    제2장 사업수행: 사업 범위(상담, 맞춤형지원, 사후관리 등).
    제3장 운영 및 관리: 중앙센터와 협력, 시설 구축, 행정보고체계, 사업계획 제출.
    제4장 운영자문위원회: 설치, 기능(사업계획 자문 등), 구성(7인 이내), 회의(연 1회 이상).
    제5장 인사 및 복무: 직원 자격, 채용, 복무 규정.
    제6장 예산 및 정산: 국고/지방비 매칭, 정산 원칙.
    제7장 기타: 성희롱 예방, 직장 내 괴롭힘 금지 조항 포함.
    [첨부 2] 보조기기센터 보수지침서
    호봉 확정 및 승급: 경력 환산 기준표(갑 100%, 을 80%), 승급 기간(1년).
    보수 지급: 기본급(호봉표 적용), 수당(초과근무, 명절휴가비, 직무수행경비, 가족수당 등).
    퇴직금: 근로자퇴직급여 보장법 준수.
    [별표 1] 경력환산기준표: 동일 계통(100%), 유사 계통(80%).
    [별표 2] 2024년 보수표: 1호봉 2,090,180원 ~ 30호봉 4,286,360원 (단위: 원).
    [첨부 3] 개인정보보호법 주요내용 및 처리방침(예시)
    개인정보 수집·이용 근거, 제3자 제공 제한, 파기 절차, 안전성 확보 조치 등.
    [첨부 4] 보안서약서
    개인정보 보호 준수 서약 양식.
    [첨부 5] 보조기기 사례관리사업 협약서
    시·도지사와 주관기관장 간의 협약 내용 (사업비, 수행기간, 권리와 의무 등).
    [첨부 6] 업무협약서(MOU)
    협력기관 간 정보공유, 자원연계 등을 위한 양식.
    [첨부 7] 시설 설치 기준 (상세)
    전시장, 상담실, 기초평가실, 제작실, 물류창고, 교육실 등의 세부 면적 및 용도 기술.
    [첨부 8] 정산보고서
    총괄표 및 세목별 집행내역 양식.
    [첨부 9] 사업비 내역 변경 요청서
    예산 전용 및 변경 승인 요청 양식.
    [첨부 10] 자산관리대장
    품목, 구입일, 가격, 구입처, 사용위치, 상태 등을 기록하는 장부 양식.
    [첨부 11] 자산입고서
    물품 입고 시 사진, 규격, 가격 등을 기록.
    [첨부 12] 보조기기 대여 계약서
    제공자와 사용자 간의 대여 기간, 준수사항, 분실/파손 책임 명시.
    [첨부 13] 대여 및 반납확인 대장
    대여일, 품목, 수량, 반납예정일 관리 양식.
    [첨부 14] 보조기기 인수·인계서
    물품 이동 시 인수자와 인계자 서명 양식.
    [첨부 15] 변경사항 보고서
    인력, 사업내용, 예산 변경 시 제출.
    [첨부 16] 사업 실적 보고
    상담, 콜센터, 체험, 대여, 제작, 사후관리, 교육, 홍보 등 각 영역별 실적 통계 양식.
    [첨부 17] 평가지표 (개선안)
    사업수행실적(40점): 서비스 제공, 사후관리, 교육, 홍보, 지역연계 등.
    운영관리(10점): 콜센터, 견학, 홈페이지, 실적보고.
    자원관리(10점): 회계, 인력, 시설, 자산 관리.
    서비스 효과성(10점): 서비스 만족도.
    질적평가(30점): 사업계획 적절성, 서비스 충실성, 성과관리, 문제해결 등.
    [첨부 18] 콜센터 입력 양식
    의뢰인 정보, 대상자 정보, 상담 내용(욕구, 답변) 기록.
    [첨부 19] 상담 기록지 (필수양식)
    대상자 기본정보(주거, 경제상황, 장애정보).
    신체기능 체크(관절가동범위 등).
    보유 보조기기 및 주요 활동 장소/환경 기록.
    [첨부 20] 보조기기 서비스 진행 기록지 (필수양식)
    서비스 연도, 급여 유형(공적/민간).
    서비스 과정별(상담-평가-적용-대여-제작-점검 등) 진행 상황 기록.
    [첨부 21] 보조기기 서비스 평가지 (필수양식)
    영역별 상세 평가 항목:
    휠체어 및 이동: 신체 치수, 조작 능력, 욕창 유무, 이동 환경.
    일상생활동작(ADL): 식사, 목욕, 옷입기, 화장실 사용 등 자립도.
    감각(시각/청각): 시력, 청력, 대체감각 활용 가능성.
    자세 유지: 골반, 척추, 관절 상태, 신체 치수 측정.
    주택 및 환경개조: 주거 형태, 개조 필요 영역(경사로, 화장실 등).
    컴퓨터 접근: 사용 자세, 입력 장치(마우스/키보드) 사용 능력.
    레저: 사용 환경, 신체 기능.
    보완대체의사소통(AAC): 언어/인지 능력, 사용 신체 부위, 상징 이해도.
    자동차 개조: 운전 면허, 필요 보조기기(핸들, 브레이크 등).
    [첨부 22] 보조기기 재원 확보서
    구입비, 재료비, 인건비 등 소요 예산 및 자부담 내역서.
    [첨부 23] 보조기기 점검 및 세척 서비스 점검표
    서비스 전/후 상태(오염도, 세균 측정 등) 및 조치 내용 기록.
    [첨부 24] 보조기기 (제작·수리) 내역서
    투입된 재료, 규격, 금액(본인부담금 포함) 상세 내역.
    [첨부 25] 보조기기 (제작·수리) 결과서
    전/후 사진, 작업 내용, 소요 시간 및 비용 결과 보고.
    [첨부 26] 보조기기 품목별 서비스 영역
    주요 보조기기 품목(휠체어, 욕창방석, 의사소통장치 등)과 해당 서비스 영역(이동, ADL, AAC 등) 매칭표.
    [첨부 27] 장애인보조기기 교부사업 평가표
    사용자 실태: 사용 장소, 자가 사용 정도.
    장애 정보: 장애 유형 및 상태 기술.
    지원 적정성:
    교부 환경 적정성.
    장애 상태와 기기 적합성.
    활용 계획 및 효과성 점수화 (10점 만점 척도).
    종합 의견: 적합/부적합/취소 판정 및 추천 기기 명시.
    [첨부 28] 가정방문 안전 수칙 (Page 194)
    가정방문은 필요시 2인 1조 출장 권고.
    방문 전 방해요인(개 짖는 소리 등) 확인.
    오해 소지(취침, 음주, 탈의 등)가 있는 상황 시 진입 금지.
    출입문 가까운 쪽에 자리 잡고 대피로 확보.
    집안 둘러보기 시 사전 양해 구하기.
    신체적 접촉 금지, 부적절한 언행 삼가.
    성적 괴롭힘 발생 시 단호하게 중지 요구 및 현장 이탈.
    폭언, 폭행, 위협 발생 시 신속히 벗어나고 증거 확보(녹취 등).
    동행자는 위험 여부 주시 및 상황 보고 임무 수행.
</file>

<file path="eslint.config.mjs">
import js from "@eslint/js";
import tsPlugin from "@typescript-eslint/eslint-plugin";
import tsParser from "@typescript-eslint/parser";
import reactPlugin from "eslint-plugin-react";
import reactHooksPlugin from "eslint-plugin-react-hooks";
import nextPlugin from "@next/eslint-plugin-next";
import globals from "globals";

export default [
  js.configs.recommended,
  nextPlugin.configs.recommended,
  nextPlugin.configs["core-web-vitals"],
  {
    files: ["**/*.{js,jsx,ts,tsx}"],
    languageOptions: {
      parser: tsParser,
      parserOptions: {
        ecmaVersion: "latest",
        sourceType: "module",
        ecmaFeatures: { jsx: true },
      },
      globals: {
        ...globals.browser,
        ...globals.node,
      },
    },
    plugins: {
      "@typescript-eslint": tsPlugin,
      react: reactPlugin,
      "react-hooks": reactHooksPlugin,
    },
    rules: {
      "react/react-in-jsx-scope": "off",
      "@next/next/no-img-element": "warn",
    },
  },
];
</file>

<file path=".gitattributes">
# 줄바꿈 문자 설정
* text=auto eol=lf

# 바이너리 파일
*.png binary
*.jpg binary
*.jpeg binary
*.gif binary
*.ico binary
*.pdf binary
*.zip binary
*.exe binary

# Lock 파일은 LF 유지
pnpm-lock.yaml text eol=lf
package-lock.json text eol=lf
yarn.lock text eol=lf
</file>

<file path="actions/application-actions.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { type ApplicationForm } from "@/lib/validators"
import { auth } from "@clerk/nextjs/server"
import { revalidatePath } from "next/cache"

export async function createApplication(
  formData: ApplicationForm
): Promise<{ success: boolean; applicationId?: string; error?: string }> {
  try {
    const { userId } = await auth()
    
    if (!userId) {
      return { success: false, error: "로그인이 필요합니다" }
    }

    const supabase = await createClient()

    // 사용자 프로필 조회
    const { data: profile, error: profileError } = await supabase
      .from("profiles")
      .select("id")
      .eq("clerk_user_id", userId)
      .single()

    if (profileError || !profile) {
      return { success: false, error: "사용자 정보를 찾을 수 없습니다" }
    }

    // 클라이언트 정보 조회 또는 생성
    // TODO: 실제로는 클라이언트 정보를 먼저 확인하고 없으면 생성해야 함
    // 여기서는 간단히 profile.id를 client_id로 사용 (실제로는 별도 clients 테이블 조회 필요)
    const { data: client, error: clientError } = await supabase
      .from("clients")
      .select("id")
      .eq("id", profile.id) // 임시로 profile.id 사용 (실제로는 별도 로직 필요)
      .single()

    let clientId: string

    if (clientError || !client) {
      // 클라이언트가 없으면 생성 (실제로는 더 많은 정보 필요)
      const { data: newClient, error: createClientError } = await supabase
        .from("clients")
        .insert({
          name: formData.contact, // 임시 (실제로는 폼에서 이름 받아야 함)
        })
        .select("id")
        .single()

      if (createClientError || !newClient) {
        return { success: false, error: "클라이언트 정보 생성에 실패했습니다" }
      }

      clientId = newClient.id
    } else {
      clientId = client.id
    }

    // 신청서 생성
    const applicationData: {
      client_id: string
      category: string | null
      sub_category: string | null
      desired_date: string | null
      status: string
      service_year: number | null
    } = {
      client_id: clientId,
      category: formData.category,
      sub_category: formData.sub_category || null,
      desired_date: formData.desired_date
        ? formData.desired_date.toISOString().split("T")[0]
        : null,
      status: "접수",
      service_year: new Date().getFullYear(),
    }

    const { data: application, error: applicationError } = await supabase
      .from("applications")
      .insert(applicationData)
      .select("id")
      .single()

    if (applicationError || !application) {
      console.error("Application creation error:", applicationError)
      return {
        success: false,
        error: "신청서 생성에 실패했습니다: " + (applicationError?.message || "알 수 없는 오류"),
      }
    }

    revalidatePath("/portal/apply")
    revalidatePath("/portal/mypage")

    return {
      success: true,
      applicationId: application.id,
    }
  } catch (error) {
    console.error("Unexpected error in createApplication:", error)
    return {
      success: false,
      error: "예상치 못한 오류가 발생했습니다",
    }
  }
}
</file>

<file path="actions/dashboard-actions.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { hasAdminOrStaffPermission } from "@/lib/utils/permissions"

export interface DashboardStats {
  newToday: number
  inProgress: number
  completedToday: number
}

export interface NewApplication {
  id: string
  category: string | null
  sub_category: string | null
  status: string | null
  created_at: string | null
  client: {
    id: string
    name: string
  } | null
}

export interface TodaySchedule {
  id: string
  schedule_type: string
  scheduled_date: string
  scheduled_time: string | null
  address: string | null
  notes: string | null
  client: {
    id: string
    name: string
  } | null
  staff: {
    id: string
    full_name: string | null
  } | null
}

/**
 * 대시보드 통계 조회 (오늘의 실적 요약)
 */
export async function getDashboardStats(): Promise<{
  success: boolean
  stats?: DashboardStats
  error?: string
}> {
  try {
    const hasPermission = await hasAdminOrStaffPermission()
    if (!hasPermission) {
      return { success: false, error: "권한이 없습니다" }
    }

    const supabase = await createClient()

    // 오늘 날짜 시작 시간 (00:00:00)
    const today = new Date()
    today.setHours(0, 0, 0, 0)
    const todayStart = today.toISOString()

    // 오늘 날짜 종료 시간 (23:59:59)
    const todayEnd = new Date()
    todayEnd.setHours(23, 59, 59, 999)
    const todayEndStr = todayEnd.toISOString()

    // 오늘의 신규 접수 건수
    const { count: newTodayCount, error: newTodayError } = await supabase
      .from("applications")
      .select("*", { count: "exact", head: true })
      .eq("status", "접수")
      .gte("created_at", todayStart)
      .lte("created_at", todayEndStr)

    if (newTodayError) {
      console.error("오늘의 신규 접수 조회 실패:", newTodayError)
    }

    // 진행 중 건수
    const { count: inProgressCount, error: inProgressError } = await supabase
      .from("applications")
      .select("*", { count: "exact", head: true })
      .eq("status", "진행")

    if (inProgressError) {
      console.error("진행 중 건수 조회 실패:", inProgressError)
    }

    // 오늘 완료 건수
    const { count: completedTodayCount, error: completedTodayError } = await supabase
      .from("applications")
      .select("*", { count: "exact", head: true })
      .eq("status", "완료")
      .gte("updated_at", todayStart)
      .lte("updated_at", todayEndStr)

    if (completedTodayError) {
      console.error("오늘 완료 건수 조회 실패:", completedTodayError)
    }

    const stats: DashboardStats = {
      newToday: newTodayCount || 0,
      inProgress: inProgressCount || 0,
      completedToday: completedTodayCount || 0,
    }

    return { success: true, stats }
  } catch (error) {
    console.error("Unexpected error in getDashboardStats:", error)
    return { success: false, error: "예상치 못한 오류가 발생했습니다" }
  }
}

/**
 * 신규 접수 건 리스트 조회 (최신순)
 */
export async function getNewApplications(limit: number = 10): Promise<{
  success: boolean
  applications?: NewApplication[]
  error?: string
}> {
  try {
    const hasPermission = await hasAdminOrStaffPermission()
    if (!hasPermission) {
      return { success: false, error: "권한이 없습니다" }
    }

    const supabase = await createClient()

    const { data, error } = await supabase
      .from("applications")
      .select(
        `
        id,
        category,
        sub_category,
        status,
        created_at,
        clients (
          id,
          name
        )
      `
      )
      .eq("status", "접수")
      .order("created_at", { ascending: false })
      .limit(limit)

    if (error) {
      console.error("신규 접수 조회 실패:", error)
      return { success: false, error: "신규 접수 조회에 실패했습니다" }
    }

    const applications: NewApplication[] =
      data?.map((app: any) => ({
        id: app.id,
        category: app.category,
        sub_category: app.sub_category,
        status: app.status,
        created_at: app.created_at,
        client: app.clients
          ? {
              id: app.clients.id,
              name: app.clients.name,
            }
          : null,
      })) || []

    return { success: true, applications }
  } catch (error) {
    console.error("Unexpected error in getNewApplications:", error)
    return { success: false, error: "예상치 못한 오류가 발생했습니다" }
  }
}

/**
 * 오늘의 일정 조회 (방문 예정)
 */
export async function getTodaySchedules(): Promise<{
  success: boolean
  schedules?: TodaySchedule[]
  error?: string
}> {
  try {
    const hasPermission = await hasAdminOrStaffPermission()
    if (!hasPermission) {
      return { success: false, error: "권한이 없습니다" }
    }

    const supabase = await createClient()

    // 오늘 날짜 (YYYY-MM-DD 형식)
    const today = new Date()
    const todayStr = today.toISOString().split("T")[0]

    const { data, error } = await supabase
      .from("schedules")
      .select(
        `
        id,
        schedule_type,
        scheduled_date,
        scheduled_time,
        address,
        notes,
        clients (
          id,
          name
        ),
        profiles (
          id,
          full_name
        )
      `
      )
      .eq("scheduled_date", todayStr)
      .order("scheduled_time", { ascending: true, nullsFirst: false })

    if (error) {
      console.error("오늘의 일정 조회 실패:", error)
      return { success: false, error: "오늘의 일정 조회에 실패했습니다" }
    }

    const schedules: TodaySchedule[] =
      data?.map((schedule: any) => ({
        id: schedule.id,
        schedule_type: schedule.schedule_type,
        scheduled_date: schedule.scheduled_date,
        scheduled_time: schedule.scheduled_time,
        address: schedule.address,
        notes: schedule.notes,
        client: schedule.clients
          ? {
              id: schedule.clients.id,
              name: schedule.clients.name,
            }
          : null,
        staff: schedule.profiles
          ? {
              id: schedule.profiles.id,
              full_name: schedule.profiles.full_name,
            }
          : null,
      })) || []

    return { success: true, schedules }
  } catch (error) {
    console.error("Unexpected error in getTodaySchedules:", error)
    return { success: false, error: "예상치 못한 오류가 발생했습니다" }
  }
}
</file>

<file path="actions/portal-actions.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { auth } from "@clerk/nextjs/server"

export interface ServiceHistory {
  id: string
  type: "application" | "service_log" | "rental" | "intake"
  // 공통 필드
  date: string | null // 서비스 제공일 또는 신청일
  created_at: string | null
  // Application 관련
  category?: string | null
  sub_category?: string | null
  status?: string | null
  desired_date?: string | null
  // Service Log 관련
  service_type?: string | null // repair, custom_make, cleaning, reuse, inspection 등
  service_date?: string | null
  item_name?: string | null
  work_description?: string | null
  // Rental 관련
  rental_start_date?: string | null
  rental_end_date?: string | null
  inventory_name?: string | null
  // Intake 관련
  consult_date?: string | null
}

export interface RentalStatus {
  id: string
  inventory_id: string
  rental_start_date: string
  rental_end_date: string
  return_date: string | null
  status: string | null
  extension_count: number | null
  inventory_name: string | null
  inventory_model: string | null
}

/**
 * 현재 로그인한 사용자의 통합 서비스 이력 조회
 * (신청, 상담, 맞춤제작, 재사용지원, 수리및점검, 소독및세척, 대여 포함)
 */
export async function getMyServiceHistory(): Promise<{
  success: boolean
  history?: ServiceHistory[]
  error?: string
}> {
  try {
    const { userId } = await auth()

    if (!userId) {
      return { success: false, error: "로그인이 필요합니다" }
    }

    const supabase = await createClient()

    // 사용자 프로필 조회
    const { data: profile, error: profileError } = await supabase
      .from("profiles")
      .select("id")
      .eq("clerk_user_id", userId)
      .single()

    if (profileError || !profile) {
      return { success: false, error: "사용자 정보를 찾을 수 없습니다" }
    }

    // 클라이언트 정보 조회
    const { data: client, error: clientError } = await supabase
      .from("clients")
      .select("id")
      .eq("id", profile.id)
      .single()

    if (clientError || !client) {
      return { success: true, history: [] }
    }

    const clientId = client.id
    const allHistory: ServiceHistory[] = []

    // 1. 신청 이력 (applications)
    const { data: applications } = await supabase
      .from("applications")
      .select("id, category, sub_category, status, desired_date, created_at")
      .eq("client_id", clientId)

    if (applications) {
      applications.forEach((app) => {
        allHistory.push({
          id: app.id,
          type: "application",
          date: app.desired_date || app.created_at,
          created_at: app.created_at,
          category: app.category,
          sub_category: app.sub_category,
          status: app.status,
          desired_date: app.desired_date,
        })
      })
    }

    // 2. 서비스 로그 (service_logs) - 수리, 맞춤제작, 소독, 재사용, 점검 등
    // 먼저 해당 클라이언트의 applications를 조회
    const { data: clientApplications } = await supabase
      .from("applications")
      .select("id")
      .eq("client_id", clientId)

    const applicationIds = clientApplications?.map((app) => app.id) || []

    let serviceLogs: any[] = []
    if (applicationIds.length > 0) {
      const { data: logs } = await supabase
        .from("service_logs")
        .select("id, service_type, service_date, item_name, work_description, created_at, application_id")
        .in("application_id", applicationIds)

      serviceLogs = logs || []
    }

    if (serviceLogs) {
      serviceLogs.forEach((log: any) => {
        allHistory.push({
          id: log.id,
          type: "service_log",
          date: log.service_date || log.created_at,
          created_at: log.created_at,
          service_type: log.service_type,
          service_date: log.service_date,
          item_name: log.item_name,
          work_description: log.work_description,
        })
      })
    }

    // 3. 상담 기록 (intake_records)
    let intakeRecords: any[] = []
    if (applicationIds.length > 0) {
      const { data: records } = await supabase
        .from("intake_records")
        .select("id, consult_date, created_at, application_id")
        .in("application_id", applicationIds)

      intakeRecords = records || []
    }

    if (intakeRecords) {
      intakeRecords.forEach((record: any) => {
        allHistory.push({
          id: record.id,
          type: "intake",
          date: record.consult_date || record.created_at,
          created_at: record.created_at,
          consult_date: record.consult_date,
        })
      })
    }

    // 4. 대여 이력 (rentals) - 대여 중인 것만이 아니라 모든 대여 이력
    const { data: rentals } = await supabase
      .from("rentals")
      .select(
        `
        id,
        rental_start_date,
        rental_end_date,
        created_at,
        status,
        inventory_id,
        inventory:inventory_id(name)
      `
      )
      .eq("client_id", clientId)

    if (rentals) {
      rentals.forEach((rental: any) => {
        allHistory.push({
          id: rental.id,
          type: "rental",
          date: rental.rental_start_date || rental.created_at,
          created_at: rental.created_at,
          rental_start_date: rental.rental_start_date,
          rental_end_date: rental.rental_end_date,
          inventory_name: rental.inventory?.name || null,
          status: rental.status,
        })
      })
    }

    // 날짜순으로 정렬 (최신순)
    allHistory.sort((a, b) => {
      const dateA = a.date || a.created_at || ""
      const dateB = b.date || b.created_at || ""
      return dateB.localeCompare(dateA)
    })

    return {
      success: true,
      history: allHistory,
    }
  } catch (error) {
    console.error("Unexpected error in getMyServiceHistory:", error)
    return {
      success: false,
      error: "예상치 못한 오류가 발생했습니다",
    }
  }
}

/**
 * 현재 로그인한 사용자의 대여 중인 기기 조회
 */
export async function getMyRentals(): Promise<{
  success: boolean
  rentals?: RentalStatus[]
  error?: string
}> {
  try {
    const { userId } = await auth()

    if (!userId) {
      return { success: false, error: "로그인이 필요합니다" }
    }

    const supabase = await createClient()

    // 사용자 프로필 조회
    const { data: profile, error: profileError } = await supabase
      .from("profiles")
      .select("id")
      .eq("clerk_user_id", userId)
      .single()

    if (profileError || !profile) {
      return { success: false, error: "사용자 정보를 찾을 수 없습니다" }
    }

    // 클라이언트 정보 조회
    const { data: client, error: clientError } = await supabase
      .from("clients")
      .select("id")
      .eq("id", profile.id)
      .single()

    if (clientError || !client) {
      // 클라이언트가 없으면 빈 배열 반환
      return { success: true, rentals: [] }
    }

    // 대여 중인 기기 조회 (status가 'rented'인 것만)
    const { data: rentals, error: rentalsError } = await supabase
      .from("rentals")
      .select(
        `
        id,
        inventory_id,
        rental_start_date,
        rental_end_date,
        return_date,
        status,
        extension_count,
        inventory:inventory_id (
          name,
          model
        )
      `
      )
      .eq("client_id", client.id)
      .eq("status", "rented")
      .order("rental_end_date", { ascending: true })

    if (rentalsError) {
      console.error("Rentals fetch error:", rentalsError)
      return { success: false, error: "대여 정보 조회에 실패했습니다" }
    }

    // 데이터 변환
    const formattedRentals: RentalStatus[] =
      rentals?.map((rental: any) => ({
        id: rental.id,
        inventory_id: rental.inventory_id,
        rental_start_date: rental.rental_start_date,
        rental_end_date: rental.rental_end_date,
        return_date: rental.return_date,
        status: rental.status,
        extension_count: rental.extension_count,
        inventory_name: rental.inventory?.name || null,
        inventory_model: rental.inventory?.model || null,
      })) || []

    return {
      success: true,
      rentals: formattedRentals,
    }
  } catch (error) {
    console.error("Unexpected error in getMyRentals:", error)
    return {
      success: false,
      error: "예상치 못한 오류가 발생했습니다",
    }
  }
}
</file>

<file path="actions/schedule-actions.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { format, startOfMonth, endOfMonth } from "date-fns"
import { ko } from "date-fns/locale"

export interface PublicSchedule {
  id: string
  schedule_type: "exhibition" | "education"
  scheduled_date: string
  scheduled_time: string | null
  address: string | null
  notes: string | null
  status: "scheduled" | "completed" | "cancelled"
}

/**
 * 공개 일정 조회 (견학, 교육 일정만)
 * schedule_type이 'exhibition' 또는 'education'인 일정만 반환
 */
export async function getPublicSchedules(
  year?: number,
  month?: number
): Promise<PublicSchedule[]> {
  const supabase = await createClient()

  let query = supabase
    .from("schedules")
    .select("id, schedule_type, scheduled_date, scheduled_time, address, notes, status")
    .in("schedule_type", ["exhibition", "education"])
    .eq("status", "scheduled")
    .order("scheduled_date", { ascending: true })

  // 특정 년/월 필터링
  if (year && month) {
    const startDate = startOfMonth(new Date(year, month - 1))
    const endDate = endOfMonth(new Date(year, month - 1))

    query = query
      .gte("scheduled_date", format(startDate, "yyyy-MM-dd"))
      .lte("scheduled_date", format(endDate, "yyyy-MM-dd"))
  }

  const { data, error } = await query

  if (error) {
    console.error("공개 일정 조회 실패:", error)
    return []
  }

  return data || []
}

/**
 * 특정 날짜의 공개 일정 조회
 */
export async function getPublicSchedulesByDate(
  date: Date
): Promise<PublicSchedule[]> {
  const dateStr = format(date, "yyyy-MM-dd")
  const supabase = await createClient()

  const { data, error } = await supabase
    .from("schedules")
    .select("id, schedule_type, scheduled_date, scheduled_time, address, notes, status")
    .in("schedule_type", ["exhibition", "education"])
    .eq("scheduled_date", dateStr)
    .eq("status", "scheduled")
    .order("scheduled_time", { ascending: true })

  if (error) {
    console.error("일정 조회 실패:", error)
    return []
  }

  return data || []
}
</file>

<file path="app/(auth)/layout.tsx">
export default function AuthLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return <>{children}</>
}
</file>

<file path="app/(auth)/sign-in/[[...sign-in]]/page.tsx">
import { SignIn } from '@clerk/nextjs'

export default function SignInPage() {
  return (
    <div className="flex min-h-screen items-center justify-center">
      <SignIn />
    </div>
  )
}
</file>

<file path="app/(auth)/sign-up/[[...sign-up]]/page.tsx">
import { SignUp } from '@clerk/nextjs'

export default function SignUpPage() {
  return (
    <div className="flex min-h-screen items-center justify-center">
      <SignUp />
    </div>
  )
}
</file>

<file path="app/(portal)/apply/page.tsx">
import { ServiceApplicationWizard } from "@/components/features/application/ServiceApplicationWizard"
import { auth } from "@clerk/nextjs/server"
import { redirect } from "next/navigation"

export default async function ApplyPage() {
  const { userId } = await auth()

  if (!userId) {
    redirect("/sign-in")
  }

  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <ServiceApplicationWizard />
    </div>
  )
}
</file>

<file path="app/(public)/about/greeting/page.tsx">
export default function GreetingPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        인사말
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          인사말 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/about/history/page.tsx">
export default function HistoryPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        연혁
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          연혁 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/about/location/page.tsx">
export default function LocationPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        찾아오시는 길
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          찾아오시는 길 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/about/organization/page.tsx">
export default function OrganizationPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        조직도
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          조직도 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/about/page.tsx">
export default function AboutPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        센터소개
      </h1>
      <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-2 mt-8">
        <a
          href="/about/greeting"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">인사말</h2>
          <p className="text-sm text-muted-foreground">
            센터장의 인사말을 확인하세요.
          </p>
        </a>
        <a
          href="/about/organization"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">조직도</h2>
          <p className="text-sm text-muted-foreground">
            센터의 조직 구조를 확인하세요.
          </p>
        </a>
        <a
          href="/about/history"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">연혁</h2>
          <p className="text-sm text-muted-foreground">
            센터의 역사와 주요 연혁을 확인하세요.
          </p>
        </a>
        <a
          href="/about/location"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">찾아오시는 길</h2>
          <p className="text-sm text-muted-foreground">
            센터 위치와 오시는 길을 확인하세요.
          </p>
        </a>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/apply/guide/page.tsx">
export default function ApplyGuidePage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        서비스 이용 안내
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          서비스 이용 안내 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/community/cases/page.tsx">
export default function CasesPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        보조기기 서비스 사례
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          보조기기 서비스 사례 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/community/gallery/page.tsx">
export default function GalleryPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        활동갤러리
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          활동갤러리 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/community/page.tsx">
export default function CommunityPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        커뮤니티
      </h1>
      <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3 mt-8">
        <a
          href="/notices"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">공지사항</h2>
          <p className="text-sm text-muted-foreground">
            센터의 주요 공지사항을 확인하세요.
          </p>
        </a>
        <a
          href="/community/gallery"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">활동갤러리</h2>
          <p className="text-sm text-muted-foreground">
            센터의 다양한 활동 사진을 확인하세요.
          </p>
        </a>
        <a
          href="/community/cases"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">보조기기 서비스 사례</h2>
          <p className="text-sm text-muted-foreground">
            실제 서비스 사례를 확인하세요.
          </p>
        </a>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/info/devices/page.tsx">
export default function DevicesPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        보유 보조기기
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          보유 보조기기 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/info/government-support/page.tsx">
export default function GovernmentSupportPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        정부지원사업안내
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          정부지원사업안내 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/info/page.tsx">
export default function InfoPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        보조기기 정보
      </h1>
      <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3 mt-8">
        <a
          href="/info/devices"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">보유 보조기기</h2>
          <p className="text-sm text-muted-foreground">
            센터에서 보유하고 있는 보조기기 목록을 확인하세요.
          </p>
        </a>
        <a
          href="/info/reusable-devices"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">재사용 보조기기</h2>
          <p className="text-sm text-muted-foreground">
            재사용 가능한 보조기기를 확인하세요.
          </p>
        </a>
        <a
          href="/info/recommendation"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">나에게 맞는 보조기기</h2>
          <p className="text-sm text-muted-foreground">
            개인에게 맞는 보조기기를 추천받으세요.
          </p>
        </a>
        <a
          href="/info/repair-center"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">보조기기 수리센터 안내</h2>
          <p className="text-sm text-muted-foreground">
            보조기기 수리센터 이용 안내를 확인하세요.
          </p>
        </a>
        <a
          href="/info/government-support"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">정부지원사업안내</h2>
          <p className="text-sm text-muted-foreground">
            정부 지원사업 정보를 확인하세요.
          </p>
        </a>
        <a
          href="/info/resources"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">자료실</h2>
          <p className="text-sm text-muted-foreground">
            보조기기 관련 자료를 다운로드하세요.
          </p>
        </a>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/info/recommendation/page.tsx">
export default function RecommendationPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        나에게 맞는 보조기기
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          나에게 맞는 보조기기 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/info/repair-center/page.tsx">
export default function RepairCenterPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        보조기기 수리센터 안내
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          보조기기 수리센터 안내 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/info/resources/page.tsx">
export default function ResourcesPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        자료실
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          자료실 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/info/reusable-devices/page.tsx">
export default function ReusableDevicesPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        재사용 보조기기
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          재사용 보조기기 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/layout.tsx">
import { PublicHeader } from "@/components/layout/public-header"
import { PublicFooter } from "@/components/layout/public-footer"

export default function PublicLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div className="flex min-h-screen flex-col">
      <PublicHeader />
      <main className="flex-1">{children}</main>
      <PublicFooter />
    </div>
  )
}
</file>

<file path="app/(public)/services/aftercare/page.tsx">
export default function AftercarePage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        사후관리
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <div className="grid gap-6 md:grid-cols-3 mt-8">
          <div className="p-6 rounded-lg border bg-card">
            <h2 className="text-lg font-semibold mb-3">소독/세척</h2>
            <p className="text-sm text-muted-foreground">
              보조기기의 위생 관리를 위한 소독 및 세척 서비스입니다.
            </p>
          </div>
          <div className="p-6 rounded-lg border bg-card">
            <h2 className="text-lg font-semibold mb-3">점검/수리</h2>
            <p className="text-sm text-muted-foreground">
              보조기기의 정기 점검 및 수리 서비스를 제공합니다.
            </p>
          </div>
          <div className="p-6 rounded-lg border bg-card">
            <h2 className="text-lg font-semibold mb-3">재사용</h2>
            <p className="text-sm text-muted-foreground">
              사용하지 않는 보조기기를 재사용할 수 있도록 지원합니다.
            </p>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/services/community-linkage/page.tsx">
export default function CommunityLinkagePage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        지역사회연계
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          지역사회연계 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/services/consultation/page.tsx">
export default function ConsultationPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        상담 및 정보제공
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <div className="grid gap-6 md:grid-cols-2 mt-8">
          <div className="p-6 rounded-lg border bg-card">
            <h2 className="text-lg font-semibold mb-3">콜센터</h2>
            <p className="text-sm text-muted-foreground">
              전화를 통한 보조기기 상담 및 정보 제공 서비스입니다.
            </p>
          </div>
          <div className="p-6 rounded-lg border bg-card">
            <h2 className="text-lg font-semibold mb-3">체험</h2>
            <p className="text-sm text-muted-foreground">
              다양한 보조기기를 직접 체험해볼 수 있는 서비스입니다.
            </p>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/services/custom-support/page.tsx">
export default function CustomSupportPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        맞춤형 지원
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <div className="grid gap-6 md:grid-cols-3 mt-8">
          <div className="p-6 rounded-lg border bg-card">
            <h2 className="text-lg font-semibold mb-3">대여</h2>
            <p className="text-sm text-muted-foreground">
              일시적으로 보조기기를 대여할 수 있는 서비스입니다.
            </p>
          </div>
          <div className="p-6 rounded-lg border bg-card">
            <h2 className="text-lg font-semibold mb-3">제작</h2>
            <p className="text-sm text-muted-foreground">
              개인에게 맞는 맞춤형 보조기기를 제작해드립니다.
            </p>
          </div>
          <div className="p-6 rounded-lg border bg-card">
            <h2 className="text-lg font-semibold mb-3">교부평가</h2>
            <p className="text-sm text-muted-foreground">
              보조기기 교부를 위한 평가 서비스를 제공합니다.
            </p>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/services/device-service/page.tsx">
export default function DeviceServicePage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        보조기기 서비스
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          보조기기 서비스 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/services/education-promotion/page.tsx">
export default function EducationPromotionPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        교육/홍보
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <div className="mt-8">
          <div className="p-6 rounded-lg border bg-card">
            <h2 className="text-lg font-semibold mb-3">교육/홍보</h2>
            <p className="text-sm text-muted-foreground">
              보조기기 활용 교육 및 홍보 활동을 진행합니다.
            </p>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/services/exhibition/page.tsx">
export default function ExhibitionPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        전시장 견학 및 교육
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          전시장 견학 및 교육 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/services/maintenance/page.tsx">
export default function MaintenancePage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        보조기기 유지 관리
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          보조기기 유지 관리 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/services/page.tsx">
import Link from "next/link"

export default function ServicesPage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        주요사업
      </h1>
      <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-2 mt-8">
        <Link
          href="/services/consultation"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">상담 및 정보제공</h2>
          <p className="text-sm text-muted-foreground mb-2">
            상담 및 정보제공 서비스를 제공합니다.
          </p>
          <p className="text-xs text-muted-foreground/70">
            콜센터, 체험
          </p>
        </Link>
        <Link
          href="/services/custom-support"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">맞춤형 지원</h2>
          <p className="text-sm text-muted-foreground mb-2">
            개인에게 맞는 맞춤형 지원 서비스를 제공합니다.
          </p>
          <p className="text-xs text-muted-foreground/70">
            대여, 제작, 교부평가
          </p>
        </Link>
        <Link
          href="/services/aftercare"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">사후관리</h2>
          <p className="text-sm text-muted-foreground mb-2">
            보조기기의 지속적인 사후관리 서비스를 제공합니다.
          </p>
          <p className="text-xs text-muted-foreground/70">
            소독/세척, 점검/수리, 재사용
          </p>
        </Link>
        <Link
          href="/services/education-promotion"
          className="p-6 rounded-lg border bg-card hover:bg-accent transition-colors"
        >
          <h2 className="text-lg font-semibold mb-2">교육/홍보</h2>
          <p className="text-sm text-muted-foreground mb-2">
            보조기기 활용 교육 및 홍보 활동을 진행합니다.
          </p>
          <p className="text-xs text-muted-foreground/70">
            교육/홍보
          </p>
        </Link>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/services/reuse/page.tsx">
export default function ReusePage() {
  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <h1 className="text-responsive-xl font-bold text-foreground mb-6">
        보조기기 재사용
      </h1>
      <div className="prose prose-sm sm:prose-base max-w-none dark:prose-invert">
        <p className="text-muted-foreground">
          보조기기 재사용 페이지입니다.
        </p>
      </div>
    </div>
  )
}
</file>

<file path="app/admin/create-profile/page.tsx">
"use client"

import { useState, useEffect } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { useRouter } from "next/navigation"

export default function CreateProfilePage() {
  const router = useRouter()
  const [loading, setLoading] = useState(false)
  const [result, setResult] = useState<any>(null)
  const [error, setError] = useState<string | null>(null)

  const handleCreateProfile = async () => {
    setLoading(true)
    setError(null)
    setResult(null)

    try {
      const response = await fetch("/api/profile/create", {
        method: "POST",
      })

      const data = await response.json()

      if (!response.ok) {
        setError(data.error || "프로필 생성에 실패했습니다")
        return
      }

      setResult(data)
      
      // 프로필 생성 성공 시 대시보드로 이동
      if (data.success) {
        setTimeout(() => {
          router.push("/admin/dashboard")
        }, 2000)
      }
    } catch (err) {
      setError("요청 중 오류가 발생했습니다: " + String(err))
    } finally {
      setLoading(false)
    }
  }

  const handleCheckProfile = async () => {
    setLoading(true)
    setError(null)
    setResult(null)

    try {
      const response = await fetch("/api/profile/create", {
        method: "GET",
      })

      const data = await response.json()

      if (!response.ok) {
        setError(data.error || "프로필 조회에 실패했습니다")
        return
      }

      setResult(data)
    } catch (err) {
      setError("요청 중 오류가 발생했습니다: " + String(err))
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="container mx-auto px-4 py-8 max-w-2xl">
      <Card>
        <CardHeader>
          <CardTitle>프로필 생성/확인</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="flex gap-4">
            <Button
              onClick={handleCheckProfile}
              disabled={loading}
              variant="outline"
            >
              프로필 확인
            </Button>
            <Button
              onClick={handleCreateProfile}
              disabled={loading}
            >
              프로필 생성 (Manager 권한)
            </Button>
          </div>

          {loading && (
            <p className="text-sm text-muted-foreground">처리 중...</p>
          )}

          {error && (
            <div className="p-4 bg-destructive/10 border border-destructive/20 rounded-md">
              <p className="text-sm font-medium text-destructive">오류</p>
              <p className="text-sm text-destructive/80">{error}</p>
            </div>
          )}

          {result && (
            <div className="p-4 bg-muted rounded-md space-y-2">
              <p className="text-sm font-medium">결과:</p>
              <pre className="text-xs bg-background p-3 rounded border overflow-auto">
                {JSON.stringify(result, null, 2)}
              </pre>
            </div>
          )}

          <div className="pt-4 border-t space-y-2 text-sm text-muted-foreground">
            <p><strong>사용 방법:</strong></p>
            <ol className="list-decimal list-inside space-y-1">
              <li>먼저 "프로필 확인" 버튼을 눌러 현재 상태를 확인하세요</li>
              <li>프로필이 없다면 "프로필 생성" 버튼을 눌러 생성하세요</li>
              <li>생성된 프로필의 role은 "manager"로 설정됩니다</li>
              <li>생성 후 공지사항 관리 페이지로 이동할 수 있습니다</li>
            </ol>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}
</file>

<file path="app/admin/dashboard/page.tsx">
import { hasAdminOrStaffPermission } from "@/lib/utils/permissions"
import { redirect } from "next/navigation"
import { AdminDashboardContent } from "@/components/features/dashboard/AdminDashboardContent"

export default async function AdminDashboardPage() {
  // 개발 환경에서는 권한 체크를 완전히 우회하여 페이지 렌더링
  // 프로덕션 환경에서만 권한 체크 수행
  const isDevelopment = process.env.NODE_ENV !== "production"
  
  if (!isDevelopment) {
    try {
      const hasPermission = await hasAdminOrStaffPermission()
      if (!hasPermission) {
        console.log("[대시보드] 권한 없음 - 홈으로 리다이렉트")
        redirect("/")
      }
      console.log("[대시보드] 권한 확인 완료 - 페이지 렌더링")
    } catch (error) {
      console.error("[대시보드] 권한 확인 중 오류:", error)
      redirect("/")
    }
  }
  // 개발 환경: 권한 체크를 완전히 우회하고 바로 페이지 렌더링

  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <div className="mb-8">
        <h1 className="text-responsive-xl font-bold text-foreground mb-2">
          통합 대시보드
        </h1>
        <p className="text-muted-foreground">
          오늘의 실적과 신규 접수 건을 확인하실 수 있습니다
        </p>
      </div>

      <AdminDashboardContent />
    </div>
  )
}
</file>

<file path="app/admin/layout.tsx">
import { AdminSidebar } from "@/components/layout/admin-sidebar"
import { AdminHeader } from "@/components/layout/admin-header"

export default function AdminLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div className="flex min-h-screen flex-col">
      <AdminHeader />
      <div className="flex flex-1">
        <AdminSidebar />
        <main className="flex-1 overflow-auto">{children}</main>
      </div>
    </div>
  )
}
</file>

<file path="app/admin/notices-management/page.tsx">
import { getAllNotices, deleteNotice } from "@/actions/notice-actions"
import { NoticeList } from "@/components/features/admin/notices/NoticeList"
import { NoticeCreateDialog } from "@/components/features/admin/notices/NoticeCreateDialog"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Plus } from "lucide-react"
import { hasAdminOrStaffPermission } from "@/lib/utils/permissions"
import { redirect } from "next/navigation"

export default async function AdminNoticesPage() {
  // 권한 확인
  const hasPermission = await hasAdminOrStaffPermission()
  if (!hasPermission) {
    console.log("[공지사항 관리] 권한 없음 - 홈으로 리다이렉트")
    redirect("/")
  }
  
  console.log("[공지사항 관리] 권한 확인 완료 - 페이지 렌더링")

  // 공지사항 목록 조회
  const result = await getAllNotices()
  const notices = result.success ? result.notices || [] : []

  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <div className="mb-8">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-responsive-xl font-bold text-foreground mb-2">
              새 글 관리
            </h1>
            <p className="text-muted-foreground">
              게시글을 작성, 수정, 삭제할 수 있습니다
            </p>
          </div>
          <NoticeCreateDialog>
            <Button>
              <Plus className="mr-2 h-4 w-4" />
              새 글 작성
            </Button>
          </NoticeCreateDialog>
        </div>
      </div>

      <Card>
        <CardHeader>
          <CardTitle>공지사항 목록</CardTitle>
        </CardHeader>
        <CardContent>
          <NoticeList initialNotices={notices} />
        </CardContent>
      </Card>
    </div>
  )
}
</file>

<file path="app/admin/page.tsx">
"use client"

import { useSignIn, useUser } from "@clerk/nextjs"
import { useRouter, useSearchParams } from "next/navigation"
import { useState, useEffect } from "react"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Loader2, Lock, Mail } from "lucide-react"

export default function AdminSignInPage() {
  const router = useRouter()
  const searchParams = useSearchParams()
  const redirectUrl = searchParams.get('redirect_url') || '/admin/dashboard'
  const { signIn, setActive, isLoaded } = useSignIn()
  const { user, isLoaded: userLoaded } = useUser()
  
  const [email, setEmail] = useState("")
  const [password, setPassword] = useState("")
  const [error, setError] = useState("")
  const [isLoading, setIsLoading] = useState(false)
  const [isCheckingSession, setIsCheckingSession] = useState(true)

  // 이미 로그인된 상태인지 확인하고 관리자 세션 설정
  useEffect(() => {
    if (!userLoaded) return

    if (user) {
      // 이미 로그인된 상태라면 관리자 세션 쿠키만 설정
      setIsCheckingSession(true)
      fetch('/api/admin/session', {
        method: 'POST',
      })
        .then(async (response) => {
          if (response.ok) {
            // 세션 설정 성공 시 리다이렉트
            router.push(redirectUrl)
          } else {
            const data = await response.json()
            setError(data.error || "관리자 권한이 없습니다. 관리자 계정으로 로그인해주세요.")
            setIsCheckingSession(false)
          }
        })
        .catch((error) => {
          console.error('세션 설정 중 오류:', error)
          setError('세션 설정 중 오류가 발생했습니다.')
          setIsCheckingSession(false)
        })
    } else {
      setIsCheckingSession(false)
    }
  }, [user, userLoaded, router, redirectUrl])

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError("")
    setIsLoading(true)

    if (!isLoaded || !signIn) {
      setError("로그인 시스템을 초기화하는 중입니다. 잠시 후 다시 시도해주세요.")
      setIsLoading(false)
      return
    }

    // 이미 로그인된 상태라면 로그인 시도하지 않음
    if (user) {
      // 관리자 세션 쿠키만 설정
      const sessionResponse = await fetch('/api/admin/session', {
        method: 'POST',
      })

      if (sessionResponse.ok) {
        router.push(redirectUrl)
      } else {
        const data = await sessionResponse.json()
        setError(data.error || "관리자 권한이 없습니다. 관리자 계정으로 로그인해주세요.")
        setIsLoading(false)
      }
      return
    }

    try {
      // Clerk 로그인 시도
      const result = await signIn.create({
        identifier: email,
        password: password,
      })

      if (result.status === "complete") {
        // 세션 활성화
        await setActive({ session: result.createdSessionId })
        
        // 관리자 세션 쿠키 설정
        const sessionResponse = await fetch('/api/admin/session', {
          method: 'POST',
        })

        if (sessionResponse.ok) {
          // 세션 설정 성공 시 리다이렉트
          router.push(redirectUrl)
        } else {
          const data = await sessionResponse.json()
          setError(data.error || "관리자 권한이 없습니다. 관리자 계정으로 로그인해주세요.")
          setIsLoading(false)
        }
      } else {
        setError("로그인 처리 중 오류가 발생했습니다.")
        setIsLoading(false)
      }
    } catch (err: any) {
      console.error("로그인 실패:", err)
      
      // "Session already exists" 에러는 무시하고 관리자 세션만 설정
      if (err.errors?.[0]?.message?.includes("already signed in") || 
          err.errors?.[0]?.message?.includes("Session already exists")) {
        // 이미 로그인된 상태이므로 관리자 세션만 설정
        const sessionResponse = await fetch('/api/admin/session', {
          method: 'POST',
        })

        if (sessionResponse.ok) {
          router.push(redirectUrl)
        } else {
          const data = await sessionResponse.json()
          setError(data.error || "관리자 권한이 없습니다. 관리자 계정으로 로그인해주세요.")
          setIsLoading(false)
        }
      } else {
        setError(
          err.errors?.[0]?.message || 
          "이메일 또는 비밀번호가 올바르지 않습니다. 다시 확인해주세요."
        )
        setIsLoading(false)
      }
    }
  }

  // 세션 확인 중이면 로딩 표시
  if (isCheckingSession) {
    return (
      <div className="flex min-h-screen items-center justify-center bg-gradient-to-br from-background to-muted/50 p-4">
        <Card className="w-full max-w-md shadow-lg">
          <CardContent className="p-6">
            <div className="flex flex-col items-center justify-center space-y-4">
              <Loader2 className="h-8 w-8 animate-spin text-primary" />
              <p className="text-sm text-muted-foreground">관리자 세션을 확인하는 중...</p>
            </div>
          </CardContent>
        </Card>
      </div>
    )
  }

  return (
    <div className="flex min-h-screen items-center justify-center bg-gradient-to-br from-background to-muted/50 p-4">
      <Card className="w-full max-w-md shadow-lg">
        <CardHeader className="space-y-1 text-center">
          <div className="mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-primary/10">
            <Lock className="h-6 w-6 text-primary" />
          </div>
          <CardTitle className="text-2xl font-bold">관리자 로그인</CardTitle>
          <CardDescription>
            관리자 권한이 있는 계정으로 로그인해주세요
          </CardDescription>
        </CardHeader>
        <CardContent>
          <form onSubmit={handleSubmit} className="space-y-4">
            <div className="space-y-2">
              <Label htmlFor="email">이메일</Label>
              <div className="relative">
                <Mail className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
                <Input
                  id="email"
                  type="email"
                  placeholder="admin@example.com"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  className="pl-10"
                  required
                  disabled={isLoading}
                  autoComplete="email"
                />
              </div>
            </div>
            
            <div className="space-y-2">
              <Label htmlFor="password">비밀번호</Label>
              <div className="relative">
                <Lock className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
                <Input
                  id="password"
                  type="password"
                  placeholder="비밀번호를 입력하세요"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="pl-10"
                  required
                  disabled={isLoading}
                  autoComplete="current-password"
                />
              </div>
            </div>

            {error && (
              <div className="rounded-md bg-destructive/10 border border-destructive/20 p-3">
                <p className="text-sm text-destructive">{error}</p>
              </div>
            )}

            <Button
              type="submit"
              className="w-full"
              disabled={isLoading || !email || !password}
            >
              {isLoading ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  로그인 중...
                </>
              ) : (
                "로그인"
              )}
            </Button>
          </form>
        </CardContent>
      </Card>
    </div>
  )
}
</file>

<file path="app/api/admin/session/route.ts">
import { auth } from "@clerk/nextjs/server"
import { hasAdminOrStaffPermission } from "@/lib/utils/permissions"
import { NextResponse } from "next/server"
import { cookies } from "next/headers"

/**
 * 관리자 세션 쿠키 설정
 * POST: 관리자 로그인 후 세션 쿠키 설정
 * GET: 관리자 세션 쿠키 확인
 * DELETE: 관리자 세션 쿠키 삭제 (로그아웃)
 */
export async function POST() {
  try {
    const { userId } = await auth()
    
    if (!userId) {
      return NextResponse.json(
        { error: "로그인이 필요합니다" },
        { status: 401 }
      )
    }

    // 권한 확인
    const hasPermission = await hasAdminOrStaffPermission()
    
    if (!hasPermission) {
      return NextResponse.json(
        { error: "관리자 권한이 없습니다" },
        { status: 403 }
      )
    }

    // 관리자 세션 쿠키 설정
    const cookieStore = await cookies()
    cookieStore.set('admin_session', 'true', {
      httpOnly: true,
      secure: process.env.NODE_ENV === 'production',
      sameSite: 'lax',
      maxAge: 60 * 60 * 24, // 24시간
      path: '/',
    })

    return NextResponse.json({ 
      success: true,
      message: "관리자 세션이 설정되었습니다"
    })
  } catch (error) {
    console.error("관리자 세션 설정 실패:", error)
    return NextResponse.json(
      { error: "세션 설정에 실패했습니다" },
      { status: 500 }
    )
  }
}

/**
 * 관리자 세션 쿠키 확인
 */
export async function GET() {
  try {
    const cookieStore = await cookies()
    const adminSession = cookieStore.get('admin_session')?.value
    
    if (!adminSession) {
      return NextResponse.json({
        hasAdminSession: false,
        message: "관리자 세션이 없습니다"
      })
    }

    // 세션이 있으면 권한도 확인
    const { userId } = await auth()
    if (!userId) {
      return NextResponse.json({
        hasAdminSession: false,
        message: "로그인이 필요합니다"
      })
    }

    const hasPermission = await hasAdminOrStaffPermission()
    
    return NextResponse.json({
      hasAdminSession: true,
      hasPermission,
      message: hasPermission ? "관리자 세션이 유효합니다" : "권한이 없습니다"
    })
  } catch (error) {
    console.error("관리자 세션 확인 실패:", error)
    return NextResponse.json(
      { error: "세션 확인에 실패했습니다" },
      { status: 500 }
    )
  }
}

/**
 * 관리자 세션 쿠키 삭제 (로그아웃)
 */
export async function DELETE() {
  try {
    const cookieStore = await cookies()
    cookieStore.delete('admin_session')

    return NextResponse.json({
      success: true,
      message: "관리자 세션이 삭제되었습니다"
    })
  } catch (error) {
    console.error("관리자 세션 삭제 실패:", error)
    return NextResponse.json(
      { error: "세션 삭제에 실패했습니다" },
      { status: 500 }
    )
  }
}
</file>

<file path="app/api/notices/upload/route.ts">
import { auth } from "@clerk/nextjs/server"
import { createClient } from "@/lib/supabase/server"
import { hasAdminOrStaffPermission } from "@/lib/utils/permissions"
import { NextResponse } from "next/server"

export async function POST(req: Request) {
  try {
    // 권한 확인
    const hasPermission = await hasAdminOrStaffPermission()
    if (!hasPermission) {
      return NextResponse.json(
        { error: "권한이 없습니다" },
        { status: 403 }
      )
    }

    const { userId } = await auth()
    if (!userId) {
      return NextResponse.json(
        { error: "로그인이 필요합니다" },
        { status: 401 }
      )
    }

    const formData = await req.formData()
    const file = formData.get("file") as File | null

    if (!file) {
      return NextResponse.json(
        { error: "파일이 없습니다" },
        { status: 400 }
      )
    }

    // 파일 타입 확인
    const fileType = file.type
    const isImage = fileType.startsWith("image/")
    const isPDF = fileType === "application/pdf"
    
    if (!isImage && !isPDF) {
      return NextResponse.json(
        { error: "이미지 또는 PDF 파일만 업로드 가능합니다" },
        { status: 400 }
      )
    }

    // 파일 크기 제한 (10MB)
    const maxSize = 10 * 1024 * 1024
    if (file.size > maxSize) {
      return NextResponse.json(
        { error: "파일 크기는 10MB를 초과할 수 없습니다" },
        { status: 400 }
      )
    }

    const supabase = await createClient()

    // 파일명 생성 (타임스탬프 + 원본 파일명)
    const timestamp = Date.now()
    const fileName = `${timestamp}-${file.name.replace(/[^a-zA-Z0-9.-]/g, "_")}`
    const filePath = `notices/${userId}/${fileName}`

    // Supabase Storage에 업로드
    const fileBuffer = await file.arrayBuffer()
    
    console.log("파일 업로드 시도:", {
      fileName: file.name,
      fileSize: file.size,
      fileType: fileType,
      filePath: filePath,
      userId: userId,
    })
    
    const { data: uploadData, error: uploadError } = await supabase.storage
      .from("notices")
      .upload(filePath, fileBuffer, {
        contentType: fileType,
        upsert: false,
      })

    if (uploadError) {
      console.error("파일 업로드 실패:", {
        error: uploadError,
        message: uploadError.message,
        statusCode: uploadError.statusCode,
        errorCode: uploadError.error,
      })
      
      // 버킷이 없는 경우 더 명확한 에러 메시지
      const errorMessage = uploadError.message || String(uploadError)
      if (
        errorMessage.includes("Bucket") || 
        errorMessage.includes("not found") ||
        errorMessage.includes("does not exist") ||
        uploadError.statusCode === 404
      ) {
        return NextResponse.json(
          { 
            error: "Storage 버킷이 설정되지 않았습니다. Supabase 대시보드에서 'notices' 버킷을 생성해주세요.",
            details: errorMessage,
            code: "BUCKET_NOT_FOUND"
          },
          { status: 500 }
        )
      }
      
      return NextResponse.json(
        { 
          error: "파일 업로드에 실패했습니다", 
          details: errorMessage,
          code: uploadError.error || "UPLOAD_FAILED"
        },
        { status: 500 }
      )
    }

    // 공개 URL 생성
    const { data: urlData } = supabase.storage
      .from("notices")
      .getPublicUrl(filePath)

    return NextResponse.json({
      success: true,
      url: urlData.publicUrl,
      name: file.name,
      size: file.size,
      type: isImage ? "image" : "pdf",
    })
  } catch (error) {
    console.error("파일 업로드 중 오류:", error)
    const errorMessage = error instanceof Error ? error.message : String(error)
    const errorStack = error instanceof Error ? error.stack : undefined
    return NextResponse.json(
      { 
        error: "예상치 못한 오류가 발생했습니다", 
        details: errorMessage,
        ...(errorStack && { stack: errorStack })
      },
      { status: 500 }
    )
  }
}
</file>

<file path="app/api/webhooks/clerk/route.ts">
import { Webhook } from 'svix'
import { headers } from 'next/headers'
import { WebhookEvent } from '@clerk/nextjs/server'
import { createClient } from '@/lib/supabase/server'

export async function POST(req: Request) {
  const WEBHOOK_SECRET = process.env.WEBHOOK_SECRET

  if (!WEBHOOK_SECRET) {
    throw new Error('WEBHOOK_SECRET이 설정되지 않았습니다.')
  }

  // 헤더에서 svix 헤더 가져오기
  const headerPayload = await headers()
  const svix_id = headerPayload.get('svix-id')
  const svix_timestamp = headerPayload.get('svix-timestamp')
  const svix_signature = headerPayload.get('svix-signature')

  if (!svix_id || !svix_timestamp || !svix_signature) {
    return new Response('svix 헤더가 없습니다', { status: 400 })
  }

  // 본문 가져오기
  const payload = await req.json()
  const body = JSON.stringify(payload)

  // Webhook 검증
  const wh = new Webhook(WEBHOOK_SECRET)

  let evt: WebhookEvent

  try {
    evt = wh.verify(body, {
      'svix-id': svix_id,
      'svix-timestamp': svix_timestamp,
      'svix-signature': svix_signature,
    }) as WebhookEvent
  } catch (err) {
    console.error('Webhook 검증 실패:', err)
    return new Response('Webhook 검증 실패', { status: 400 })
  }

  const { id } = evt.data
  const eventType = evt.type

  const supabase = await createClient()

  // 유저 생성 시 Supabase profiles 테이블 동기화
  if (eventType === 'user.created') {
    const { id: userId, email_addresses, first_name, last_name } = evt.data

    const fullName = [first_name, last_name].filter(Boolean).join(' ') || null
    const email = email_addresses?.[0]?.email_address || null

    const { error } = await supabase.from('profiles').insert({
      clerk_user_id: userId,
      email,
      full_name: fullName,
      role: 'user', // 기본값
    })

    if (error) {
      console.error('프로필 생성 실패:', error)
      return new Response('프로필 생성 실패', { status: 500 })
    }

    console.log('프로필 생성 성공:', userId)
  }

  // 유저 삭제 시 정리 로직
  if (eventType === 'user.deleted') {
    const { id: userId } = evt.data

    // profiles 테이블에서 삭제 (CASCADE 설정에 따라 관련 데이터도 자동 삭제)
    const { error } = await supabase
      .from('profiles')
      .delete()
      .eq('clerk_user_id', userId!)

    if (error) {
      console.error('프로필 삭제 실패:', error)
      return new Response('프로필 삭제 실패', { status: 500 })
    }

    console.log('프로필 삭제 성공:', userId)
  }

  return new Response('Webhook 처리 완료', { status: 200 })
}
</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "app/globals.css",
    "baseColor": "slate",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  }
}
</file>

<file path="components/accessibility/accessibility-toolbar.tsx">
"use client"

import { useState, useEffect } from "react"
import { Button } from "@/components/ui/button"
import {
  ZoomIn,
  ZoomOut,
  Contrast,
  Volume2,
  Keyboard,
  X,
} from "lucide-react"
import { cn } from "@/lib/utils"

export function AccessibilityToolbar() {
  const [isOpen, setIsOpen] = useState(false)
  const [zoomLevel, setZoomLevel] = useState(100)
  const [highContrast, setHighContrast] = useState(false)
  const [isSpeaking, setIsSpeaking] = useState(false)

  // 로컬 스토리지에서 설정 불러오기
  useEffect(() => {
    const savedZoom = localStorage.getItem("a11y-zoom")
    const savedContrast = localStorage.getItem("a11y-high-contrast")
    
    if (savedZoom) {
      setZoomLevel(Number(savedZoom))
      applyZoom(Number(savedZoom))
    }
    
    if (savedContrast === "true") {
      setHighContrast(true)
      document.documentElement.classList.add("high-contrast")
    }
  }, [])

  // 화면 확대/축소 적용
  const applyZoom = (level: number) => {
    document.documentElement.style.fontSize = `${level}%`
    localStorage.setItem("a11y-zoom", level.toString())
  }

  const handleZoomIn = () => {
    const newZoom = Math.min(zoomLevel + 10, 200)
    setZoomLevel(newZoom)
    applyZoom(newZoom)
  }

  const handleZoomOut = () => {
    const newZoom = Math.max(zoomLevel - 10, 50)
    setZoomLevel(newZoom)
    applyZoom(newZoom)
  }

  const handleResetZoom = () => {
    setZoomLevel(100)
    applyZoom(100)
  }

  // 고대비 모드 전환
  const toggleHighContrast = () => {
    const newContrast = !highContrast
    setHighContrast(newContrast)
    
    if (newContrast) {
      document.documentElement.classList.add("high-contrast")
      localStorage.setItem("a11y-high-contrast", "true")
    } else {
      document.documentElement.classList.remove("high-contrast")
      localStorage.setItem("a11y-high-contrast", "false")
    }
  }

  // 음성 출력 (TTS)
  const handleSpeak = () => {
    if (isSpeaking) {
      window.speechSynthesis.cancel()
      setIsSpeaking(false)
      return
    }

    const textToSpeak = document.body.innerText
    if (textToSpeak && "speechSynthesis" in window) {
      const utterance = new SpeechSynthesisUtterance(textToSpeak)
      utterance.lang = "ko-KR"
      utterance.rate = 0.9
      utterance.pitch = 1
      utterance.volume = 1

      utterance.onend = () => setIsSpeaking(false)
      utterance.onerror = () => setIsSpeaking(false)

      window.speechSynthesis.speak(utterance)
      setIsSpeaking(true)
    }
  }

  // 키보드 단축키
  useEffect(() => {
    const handleKeyPress = (e: KeyboardEvent) => {
      // Alt + A: 접근성 툴바 열기/닫기
      if (e.altKey && e.key === "a") {
        e.preventDefault()
        setIsOpen(!isOpen)
      }
      // Alt + +: 확대
      if (e.altKey && e.key === "+") {
        e.preventDefault()
        handleZoomIn()
      }
      // Alt + -: 축소
      if (e.altKey && e.key === "-") {
        e.preventDefault()
        handleZoomOut()
      }
      // Alt + 0: 확대/축소 리셋
      if (e.altKey && e.key === "0") {
        e.preventDefault()
        handleResetZoom()
      }
      // Alt + H: 고대비 모드
      if (e.altKey && e.key === "h") {
        e.preventDefault()
        toggleHighContrast()
      }
      // Alt + S: 음성 출력
      if (e.altKey && e.key === "s") {
        e.preventDefault()
        handleSpeak()
      }
    }

    window.addEventListener("keydown", handleKeyPress)
    return () => window.removeEventListener("keydown", handleKeyPress)
  }, [isOpen, zoomLevel, highContrast, isSpeaking])

  if (!isOpen) {
    return (
      <button
        onClick={() => setIsOpen(true)}
        className="fixed bottom-4 right-4 z-50 rounded-full bg-primary p-3 text-primary-foreground shadow-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
        aria-label="접근성 도구 열기"
        title="접근성 도구 (Alt + A)"
      >
        <Keyboard className="h-5 w-5" />
      </button>
    )
  }

  return (
    <div
      className="fixed bottom-4 right-4 z-50 rounded-lg border bg-card p-4 shadow-lg"
      role="toolbar"
      aria-label="접근성 도구"
    >
      <div className="flex items-center justify-between mb-4">
        <h2 className="text-sm font-semibold">접근성 도구</h2>
        <Button
          variant="ghost"
          size="icon"
          onClick={() => setIsOpen(false)}
          aria-label="접근성 도구 닫기"
        >
          <X className="h-4 w-4" />
        </Button>
      </div>

      <div className="space-y-3">
        {/* 화면 확대/축소 */}
        <div className="space-y-2">
          <div className="flex items-center justify-between">
            <span className="text-xs font-medium">화면 확대/축소</span>
            <span className="text-xs text-muted-foreground">{zoomLevel}%</span>
          </div>
          <div className="flex items-center gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={handleZoomOut}
              aria-label="화면 축소 (Alt + -)"
              title="화면 축소 (Alt + -)"
            >
              <ZoomOut className="h-4 w-4" />
            </Button>
            <Button
              variant="outline"
              size="sm"
              onClick={handleResetZoom}
              aria-label="화면 크기 리셋 (Alt + 0)"
              title="화면 크기 리셋 (Alt + 0)"
            >
              {zoomLevel}%
            </Button>
            <Button
              variant="outline"
              size="sm"
              onClick={handleZoomIn}
              aria-label="화면 확대 (Alt + +)"
              title="화면 확대 (Alt + +)"
            >
              <ZoomIn className="h-4 w-4" />
            </Button>
          </div>
        </div>

        {/* 고대비 모드 */}
        <Button
          variant={highContrast ? "default" : "outline"}
          size="sm"
          onClick={toggleHighContrast}
          className="w-full justify-start"
          aria-label="고대비 모드 전환 (Alt + H)"
          title="고대비 모드 전환 (Alt + H)"
        >
          <Contrast className="mr-2 h-4 w-4" />
          고대비 모드 {highContrast ? "ON" : "OFF"}
        </Button>

        {/* 음성 출력 */}
        <Button
          variant={isSpeaking ? "default" : "outline"}
          size="sm"
          onClick={handleSpeak}
          className="w-full justify-start"
          aria-label="음성 출력 (Alt + S)"
          title="음성 출력 (Alt + S)"
          disabled={!("speechSynthesis" in window)}
        >
          <Volume2 className="mr-2 h-4 w-4" />
          {isSpeaking ? "음성 출력 중지" : "음성 출력"}
        </Button>
      </div>

      <div className="mt-4 pt-4 border-t">
        <p className="text-xs text-muted-foreground">
          단축키: Alt + A (열기/닫기), Alt + +/- (확대/축소), Alt + 0 (리셋), Alt + H (고대비), Alt + S (음성)
        </p>
      </div>
    </div>
  )
}
</file>

<file path="components/accessibility/keyboard-navigator.tsx">
"use client"

import { useEffect, useState } from "react"
import { cn } from "@/lib/utils"

/**
 * 키보드 네비게이션을 위한 스캔 모드 컴포넌트
 * Tab 키로 모든 포커스 가능한 요소를 순차적으로 탐색할 수 있도록 지원
 */
export function KeyboardNavigator() {
  const [isScanMode, setIsScanMode] = useState(false)
  const [currentFocusIndex, setCurrentFocusIndex] = useState(0)

  useEffect(() => {
    // 스캔 모드 활성화/비활성화 (Alt + K)
    const handleKeyPress = (e: KeyboardEvent) => {
      if (e.altKey && e.key === "k") {
        e.preventDefault()
        setIsScanMode((prev) => !prev)
      }
    }

    window.addEventListener("keydown", handleKeyPress)
    return () => window.removeEventListener("keydown", handleKeyPress)
  }, [])

  // 스캔 모드일 때 모든 포커스 가능한 요소 찾기
  useEffect(() => {
    if (!isScanMode) {
      setCurrentFocusIndex(0)
      return
    }

    const updateFocusableElements = () => {
      const focusableElements = document.querySelectorAll(
        'a[href], button:not([disabled]), input:not([disabled]), textarea:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])'
      )

      const handleTab = (e: KeyboardEvent) => {
        if (e.key === "Tab") {
          e.preventDefault()
          
          const elementsArray = Array.from(focusableElements) as HTMLElement[]
          
          setCurrentFocusIndex((prev) => {
            let newIndex: number
            
            if (e.shiftKey) {
              // Shift + Tab: 이전 요소
              newIndex = prev > 0 ? prev - 1 : elementsArray.length - 1
            } else {
              // Tab: 다음 요소
              newIndex = prev < elementsArray.length - 1 ? prev + 1 : 0
            }
            
            // 포커스 적용
            const element = elementsArray[newIndex]
            if (element) {
              element.focus()
              element.scrollIntoView({ behavior: "smooth", block: "center" })
            }
            
            return newIndex
          })
        }

        // Escape: 스캔 모드 종료
        if (e.key === "Escape") {
          setIsScanMode(false)
          setCurrentFocusIndex(0)
        }
      }

      window.addEventListener("keydown", handleTab)
      return () => window.removeEventListener("keydown", handleTab)
    }

    const cleanup = updateFocusableElements()
    
    // DOM 변경 감지를 위한 MutationObserver
    const observer = new MutationObserver(() => {
      // 포커스 가능한 요소가 변경되면 인덱스 리셋
      setCurrentFocusIndex(0)
    })
    
    observer.observe(document.body, {
      childList: true,
      subtree: true,
    })

    return () => {
      cleanup()
      observer.disconnect()
    }
  }, [isScanMode])

  // 스캔 모드 인디케이터
  if (isScanMode) {
    return (
      <div
        className="fixed top-4 left-1/2 -translate-x-1/2 z-50 rounded-md bg-primary px-4 py-2 text-primary-foreground text-sm font-medium shadow-lg"
        role="status"
        aria-live="polite"
      >
        키보드 스캔 모드 활성화 (Tab: 다음, Shift+Tab: 이전, Esc: 종료)
      </div>
    )
  }

  return null
}
</file>

<file path="components/common/loading-spinner.tsx">
import { cn } from "@/lib/utils"

interface LoadingSpinnerProps {
  className?: string
  size?: "sm" | "md" | "lg"
}

export function LoadingSpinner({ className, size = "md" }: LoadingSpinnerProps) {
  const sizeClasses = {
    sm: "h-4 w-4",
    md: "h-8 w-8",
    lg: "h-12 w-12",
  }

  return (
    <div
      className={cn(
        "animate-spin rounded-full border-2 border-muted border-t-primary",
        sizeClasses[size],
        className
      )}
      role="status"
      aria-label="로딩 중"
    >
      <span className="sr-only">로딩 중...</span>
    </div>
  )
}
</file>

<file path="components/features/admin/notices/NoticeAttachmentManager.tsx">
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { FileUploader } from "@/components/common/file-uploader"
import { X, Image as ImageIcon, FileText, Youtube, Loader2 } from "lucide-react"
import { Card } from "@/components/ui/card"

export interface Attachment {
  type: "image" | "pdf" | "youtube"
  url: string
  name: string
  size?: number
}

interface NoticeAttachmentManagerProps {
  attachments: Attachment[]
  onChange: (attachments: Attachment[]) => void
}

export function NoticeAttachmentManager({
  attachments,
  onChange,
}: NoticeAttachmentManagerProps) {
  const [uploading, setUploading] = useState(false)
  const [youtubeUrl, setYoutubeUrl] = useState("")

  const handleFileUpload = async (files: File[]) => {
    setUploading(true)
    try {
      const uploadPromises = files.map(async (file) => {
        const formData = new FormData()
        formData.append("file", file)

        const response = await fetch("/api/notices/upload", {
          method: "POST",
          body: formData,
        })

        if (!response.ok) {
          // 응답 본문을 먼저 텍스트로 읽기
          let responseText = ""
          try {
            responseText = await response.text()
          } catch (e) {
            console.error("응답 본문 읽기 실패:", e)
            responseText = `응답을 읽을 수 없습니다 (${response.status})`
          }
          
          let errorData: any = null
          
          // JSON으로 파싱 시도
          if (responseText && responseText.trim()) {
            try {
              errorData = JSON.parse(responseText)
            } catch (e) {
              // JSON 파싱 실패 - 텍스트를 그대로 사용
              console.warn("JSON 파싱 실패, 텍스트 사용:", responseText)
              errorData = { error: responseText }
            }
          } else {
            // 응답 본문이 비어있음
            errorData = { error: `서버 오류 (${response.status} ${response.statusText})` }
          }
          
          // 에러 메시지 추출
          const errorMessage = 
            errorData?.error || 
            errorData?.details || 
            errorData?.message ||
            responseText ||
            `업로드 실패 (${response.status} ${response.statusText})`
          
          // 상세한 에러 정보 로깅 (개별적으로 로깅하여 직렬화 문제 방지)
          console.error("=== 파일 업로드 API 오류 ===")
          console.error("HTTP Status:", response.status)
          console.error("HTTP Status Text:", response.statusText)
          console.error("Response Text:", responseText || "(비어있음)")
          console.error("Response Text Length:", responseText?.length || 0)
          console.error("Error Data:", errorData)
          console.error("Error Data Type:", typeof errorData)
          console.error("Error Data Keys:", errorData ? Object.keys(errorData) : [])
          console.error("File Name:", file.name)
          console.error("File Size:", file.size)
          console.error("File Type:", file.type)
          console.error("===========================")
          
          throw new Error(errorMessage)
        }

        const data = await response.json()
        return {
          type: data.type as "image" | "pdf",
          url: data.url,
          name: data.name,
          size: data.size,
        }
      })

      const uploadedFiles = await Promise.all(uploadPromises)
      onChange([...attachments, ...uploadedFiles])
    } catch (error) {
      console.error("파일 업로드 오류:", error)
      const errorMessage = error instanceof Error ? error.message : "파일 업로드에 실패했습니다"
      
      // Storage 버킷 관련 에러인 경우 더 자세한 안내
      if (errorMessage.includes("버킷") || errorMessage.includes("Bucket")) {
        alert(
          "파일 업로드를 사용하려면 Supabase Storage 버킷을 생성해야 합니다.\n\n" +
          "생성 방법:\n" +
          "1. Supabase 대시보드 접속\n" +
          "2. Storage 메뉴로 이동\n" +
          "3. 'Create a new bucket' 클릭\n" +
          "4. 버킷 이름: 'notices'\n" +
          "5. Public bucket 활성화\n" +
          "6. 생성 후 다시 시도해주세요."
        )
      } else {
        alert(errorMessage)
      }
    } finally {
      setUploading(false)
    }
  }

  const handleAddYoutube = () => {
    if (!youtubeUrl.trim()) return

    // 유튜브 URL에서 비디오 ID 추출
    const youtubeRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/
    const match = youtubeUrl.match(youtubeRegex)

    if (!match) {
      alert("올바른 유튜브 링크를 입력해주세요")
      return
    }

    const videoId = match[1]
    const embedUrl = `https://www.youtube.com/embed/${videoId}`

    onChange([
      ...attachments,
      {
        type: "youtube",
        url: embedUrl,
        name: `유튜브 동영상 (${videoId})`,
      },
    ])

    setYoutubeUrl("")
  }

  const handleRemove = (index: number) => {
    onChange(attachments.filter((_, i) => i !== index))
  }

  return (
    <div className="space-y-4">
      <div className="space-y-2">
        <div className="flex items-center justify-between">
          <label className="text-sm font-medium">첨부파일</label>
          <span className="text-xs text-muted-foreground">
            이미지, PDF, 유튜브 링크
          </span>
        </div>
        
        {/* 파일 업로드 */}
        <FileUploader
          onUpload={handleFileUpload}
          accept="image/*,application/pdf"
          multiple={true}
          maxSize={10 * 1024 * 1024} // 10MB
        />
        
        <p className="text-xs text-muted-foreground">
          💡 파일 업로드를 사용하려면 Supabase Storage에 'notices' 버킷이 필요합니다.
        </p>

        {/* 유튜브 링크 추가 */}
        <div className="flex gap-2">
          <Input
            type="url"
            placeholder="유튜브 링크를 입력하세요 (예: https://www.youtube.com/watch?v=...)"
            value={youtubeUrl}
            onChange={(e) => setYoutubeUrl(e.target.value)}
            className="flex-1"
          />
          <Button
            type="button"
            onClick={handleAddYoutube}
            disabled={!youtubeUrl.trim() || uploading}
            variant="outline"
          >
            <Youtube className="mr-2 h-4 w-4" />
            추가
          </Button>
        </div>

        {uploading && (
          <div className="flex items-center gap-2 text-sm text-muted-foreground">
            <Loader2 className="h-4 w-4 animate-spin" />
            업로드 중...
          </div>
        )}
      </div>

      {/* 첨부파일 목록 */}
      {attachments.length > 0 && (
        <div className="space-y-2">
          <p className="text-sm font-medium">첨부된 파일 ({attachments.length})</p>
          <div className="grid gap-2">
            {attachments.map((attachment, index) => (
              <Card key={index} className="p-3">
                <div className="flex items-center justify-between gap-2">
                  <div className="flex items-center gap-2 flex-1 min-w-0">
                    {attachment.type === "image" && (
                      <ImageIcon className="h-4 w-4 text-muted-foreground flex-shrink-0" />
                    )}
                    {attachment.type === "pdf" && (
                      <FileText className="h-4 w-4 text-muted-foreground flex-shrink-0" />
                    )}
                    {attachment.type === "youtube" && (
                      <Youtube className="h-4 w-4 text-red-500 flex-shrink-0" />
                    )}
                    <span className="text-sm truncate">{attachment.name}</span>
                    {attachment.size && (
                      <span className="text-xs text-muted-foreground">
                        ({(attachment.size / 1024).toFixed(1)} KB)
                      </span>
                    )}
                  </div>
                  <Button
                    type="button"
                    variant="ghost"
                    size="sm"
                    onClick={() => handleRemove(index)}
                    className="flex-shrink-0"
                  >
                    <X className="h-4 w-4" />
                  </Button>
                </div>
              </Card>
            ))}
          </div>
        </div>
      )}
    </div>
  )
}
</file>

<file path="components/features/application/forms/ServiceConsultForm.tsx">
"use client"

import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import { consultApplicationSchema, type ConsultApplicationForm } from "@/lib/validators"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Textarea } from "@/components/ui/textarea"
import { Button } from "@/components/ui/button"
import { useApplicationStore } from "@/lib/stores/application-store"
import { RadioGroup, RadioGroupItem } from "@/components/ui/radio-group"
import { cn } from "@/lib/utils"

export function ServiceConsultForm() {
  const { formData, setFormData, setCurrentStep } = useApplicationStore()

  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
    setValue,
    watch,
  } = useForm<ConsultApplicationForm>({
    resolver: zodResolver(consultApplicationSchema),
    defaultValues: {
      category: "consult",
      ...formData,
    } as Partial<ConsultApplicationForm>,
  })

  const consultType = watch("consult_type")

  const onSubmit = async (data: ConsultApplicationForm) => {
    setFormData(data)
    setCurrentStep(3)
  }

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      <div className="space-y-2">
        <Label>상담 유형 *</Label>
        <RadioGroup
          value={consultType}
          onValueChange={(value) => setValue("consult_type", value as "phone" | "visit" | "center")}
          className="flex flex-col gap-3"
        >
          <div className="flex items-center space-x-2">
            <RadioGroupItem value="phone" id="phone" />
            <Label htmlFor="phone" className="font-normal cursor-pointer">
              전화 상담
            </Label>
          </div>
          <div className="flex items-center space-x-2">
            <RadioGroupItem value="visit" id="visit" />
            <Label htmlFor="visit" className="font-normal cursor-pointer">
              방문 상담
            </Label>
          </div>
          <div className="flex items-center space-x-2">
            <RadioGroupItem value="center" id="center" />
            <Label htmlFor="center" className="font-normal cursor-pointer">
              센터 방문
            </Label>
          </div>
        </RadioGroup>
        {errors.consult_type && (
          <p className="text-sm text-destructive" role="alert">
            {errors.consult_type.message}
          </p>
        )}
      </div>

      {consultType === "visit" && (
        <div className="space-y-2">
          <Label htmlFor="address">방문 주소 *</Label>
          <Input
            id="address"
            {...register("address")}
            placeholder="방문이 필요한 경우 주소를 입력해주세요"
          />
        </div>
      )}

      <div className="space-y-2">
        <Label htmlFor="preferred_time">희망 상담 시간 (선택사항)</Label>
        <Input
          id="preferred_time"
          {...register("preferred_time")}
          placeholder="예: 오전 10시 ~ 오후 2시"
        />
      </div>

      <div className="space-y-2">
        <Label htmlFor="consult_purpose">상담 목적 *</Label>
        <Textarea
          id="consult_purpose"
          {...register("consult_purpose")}
          placeholder="상담 목적을 자세히 설명해주세요 (10자 이상)"
          rows={5}
          aria-invalid={errors.consult_purpose ? "true" : "false"}
        />
        {errors.consult_purpose && (
          <p className="text-sm text-destructive" role="alert">
            {errors.consult_purpose.message}
          </p>
        )}
      </div>

      <div className="space-y-2">
        <Label htmlFor="contact">연락처 *</Label>
        <Input
          id="contact"
          type="tel"
          {...register("contact")}
          placeholder="010-1234-5678"
          aria-invalid={errors.contact ? "true" : "false"}
        />
        {errors.contact && (
          <p className="text-sm text-destructive" role="alert">
            {errors.contact.message}
          </p>
        )}
      </div>

      <div className="flex gap-4">
        <Button
          type="button"
          variant="outline"
          onClick={() => setCurrentStep(1)}
          className="flex-1"
        >
          이전
        </Button>
        <Button type="submit" disabled={isSubmitting} className="flex-1">
          {isSubmitting ? "처리 중..." : "다음"}
        </Button>
      </div>
    </form>
  )
}
</file>

<file path="components/features/application/forms/ServiceCustomForm.tsx">
"use client"

import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import { customApplicationSchema, type CustomApplicationForm } from "@/lib/validators"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Textarea } from "@/components/ui/textarea"
import { Button } from "@/components/ui/button"
import { useApplicationStore } from "@/lib/stores/application-store"

export function ServiceCustomForm() {
  const { formData, setFormData, setCurrentStep } = useApplicationStore()

  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
  } = useForm<CustomApplicationForm>({
    resolver: zodResolver(customApplicationSchema),
    defaultValues: {
      category: "custom",
      sub_category: "custom_make",
      ...formData,
    } as Partial<CustomApplicationForm>,
  })

  const onSubmit = async (data: CustomApplicationForm) => {
    setFormData(data)
    setCurrentStep(3)
  }

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      <div className="space-y-2">
        <Label htmlFor="device_name">제작을 원하는 기기명 *</Label>
        <Input
          id="device_name"
          {...register("device_name")}
          placeholder="예: 맞춤형 휠체어, 목발 등"
          aria-invalid={errors.device_name ? "true" : "false"}
        />
        {errors.device_name && (
          <p className="text-sm text-destructive" role="alert">
            {errors.device_name.message}
          </p>
        )}
      </div>

      <div className="space-y-2">
        <Label htmlFor="specifications">제작 사양 *</Label>
        <Textarea
          id="specifications"
          {...register("specifications")}
          placeholder="제작 사양을 자세히 설명해주세요 (10자 이상)"
          rows={5}
          aria-invalid={errors.specifications ? "true" : "false"}
        />
        {errors.specifications && (
          <p className="text-sm text-destructive" role="alert">
            {errors.specifications.message}
          </p>
        )}
      </div>

      <div className="space-y-2">
        <Label htmlFor="measurements">치수 정보 (선택사항)</Label>
        <Textarea
          id="measurements"
          {...register("measurements")}
          placeholder="필요한 치수 정보를 입력해주세요"
          rows={3}
        />
      </div>

      <div className="space-y-2">
        <Label htmlFor="contact">연락처 *</Label>
        <Input
          id="contact"
          type="tel"
          {...register("contact")}
          placeholder="010-1234-5678"
          aria-invalid={errors.contact ? "true" : "false"}
        />
        {errors.contact && (
          <p className="text-sm text-destructive" role="alert">
            {errors.contact.message}
          </p>
        )}
      </div>

      <div className="space-y-2">
        <Label htmlFor="description">추가 설명 *</Label>
        <Textarea
          id="description"
          {...register("description")}
          placeholder="기타 필요한 사항을 입력해주세요 (10자 이상)"
          rows={4}
          aria-invalid={errors.description ? "true" : "false"}
        />
        {errors.description && (
          <p className="text-sm text-destructive" role="alert">
            {errors.description.message}
          </p>
        )}
      </div>

      <div className="flex gap-4">
        <Button
          type="button"
          variant="outline"
          onClick={() => setCurrentStep(1)}
          className="flex-1"
        >
          이전
        </Button>
        <Button type="submit" disabled={isSubmitting} className="flex-1">
          {isSubmitting ? "처리 중..." : "다음"}
        </Button>
      </div>
    </form>
  )
}
</file>

<file path="components/features/application/forms/ServiceRentalForm.tsx">
"use client"

import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import { rentalApplicationSchema, type RentalApplicationForm } from "@/lib/validators"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Textarea } from "@/components/ui/textarea"
import { Button } from "@/components/ui/button"
import { useApplicationStore } from "@/lib/stores/application-store"
import { Calendar } from "@/components/ui/calendar"
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover"
import { CalendarIcon } from "lucide-react"
import { format } from "date-fns"
import { ko } from "date-fns/locale"
import { cn } from "@/lib/utils"
import { useState } from "react"

export function ServiceRentalForm() {
  const { formData, setFormData, setCurrentStep, selectedCategory } = useApplicationStore()
  const [rentalStartDate, setRentalStartDate] = useState<Date | undefined>(
    formData?.rental_start_date ? new Date(formData.rental_start_date) : undefined
  )
  const [rentalEndDate, setRentalEndDate] = useState<Date | undefined>(
    formData?.rental_end_date ? new Date(formData.rental_end_date) : undefined
  )

  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
    setValue,
  } = useForm<RentalApplicationForm>({
    resolver: zodResolver(rentalApplicationSchema),
    defaultValues: {
      category: (selectedCategory as "experience" | "custom") || "experience",
      sub_category: "rental",
      ...formData,
    } as Partial<RentalApplicationForm>,
  })

  const onSubmit = async (data: RentalApplicationForm) => {
    setFormData(data)
    setCurrentStep(3)
  }

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      <div className="space-y-2">
        <Label htmlFor="device_name">대여를 원하는 기기명 *</Label>
        <Input
          id="device_name"
          {...register("device_name")}
          placeholder="예: 휠체어, 목발 등"
          aria-invalid={errors.device_name ? "true" : "false"}
        />
        {errors.device_name && (
          <p className="text-sm text-destructive" role="alert">
            {errors.device_name.message}
          </p>
        )}
      </div>

      <div className="grid gap-4 md:grid-cols-2">
        <div className="space-y-2">
          <Label htmlFor="rental_start_date">대여 시작일 *</Label>
          <Popover>
            <PopoverTrigger asChild>
              <Button
                variant="outline"
                className={cn(
                  "w-full justify-start text-left font-normal",
                  !rentalStartDate && "text-muted-foreground"
                )}
              >
                <CalendarIcon className="mr-2 h-4 w-4" />
                {rentalStartDate ? (
                  format(rentalStartDate, "yyyy년 MM월 dd일", { locale: ko })
                ) : (
                  <span>시작일 선택</span>
                )}
              </Button>
            </PopoverTrigger>
            <PopoverContent className="w-auto p-0" align="start">
              <Calendar
                mode="single"
                selected={rentalStartDate}
                onSelect={(date) => {
                  setRentalStartDate(date)
                  setValue("rental_start_date", date!)
                }}
                locale={ko}
              />
            </PopoverContent>
          </Popover>
          {errors.rental_start_date && (
            <p className="text-sm text-destructive" role="alert">
              {errors.rental_start_date.message}
            </p>
          )}
        </div>

        <div className="space-y-2">
          <Label htmlFor="rental_end_date">대여 종료일 *</Label>
          <Popover>
            <PopoverTrigger asChild>
              <Button
                variant="outline"
                className={cn(
                  "w-full justify-start text-left font-normal",
                  !rentalEndDate && "text-muted-foreground"
                )}
              >
                <CalendarIcon className="mr-2 h-4 w-4" />
                {rentalEndDate ? (
                  format(rentalEndDate, "yyyy년 MM월 dd일", { locale: ko })
                ) : (
                  <span>종료일 선택</span>
                )}
              </Button>
            </PopoverTrigger>
            <PopoverContent className="w-auto p-0" align="start">
              <Calendar
                mode="single"
                selected={rentalEndDate}
                onSelect={(date) => {
                  setRentalEndDate(date)
                  setValue("rental_end_date", date!)
                }}
                disabled={(date) => rentalStartDate ? date < rentalStartDate : false}
                locale={ko}
              />
            </PopoverContent>
          </Popover>
          {errors.rental_end_date && (
            <p className="text-sm text-destructive" role="alert">
              {errors.rental_end_date.message}
            </p>
          )}
        </div>
      </div>

      <div className="space-y-2">
        <Label htmlFor="purpose">대여 목적 *</Label>
        <Textarea
          id="purpose"
          {...register("purpose")}
          placeholder="대여 목적을 자세히 설명해주세요 (10자 이상)"
          rows={4}
          aria-invalid={errors.purpose ? "true" : "false"}
        />
        {errors.purpose && (
          <p className="text-sm text-destructive" role="alert">
            {errors.purpose.message}
          </p>
        )}
      </div>

      <div className="space-y-2">
        <Label htmlFor="contact">연락처 *</Label>
        <Input
          id="contact"
          type="tel"
          {...register("contact")}
          placeholder="010-1234-5678"
          aria-invalid={errors.contact ? "true" : "false"}
        />
        {errors.contact && (
          <p className="text-sm text-destructive" role="alert">
            {errors.contact.message}
          </p>
        )}
      </div>

      <div className="flex gap-4">
        <Button
          type="button"
          variant="outline"
          onClick={() => setCurrentStep(1)}
          className="flex-1"
        >
          이전
        </Button>
        <Button type="submit" disabled={isSubmitting} className="flex-1">
          {isSubmitting ? "처리 중..." : "다음"}
        </Button>
      </div>
    </form>
  )
}
</file>

<file path="components/features/application/forms/ServiceRepairForm.tsx">
"use client"

import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import { repairApplicationSchema, type RepairApplicationForm } from "@/lib/validators"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Textarea } from "@/components/ui/textarea"
import { Button } from "@/components/ui/button"
import { useApplicationStore } from "@/lib/stores/application-store"
import { Calendar } from "@/components/ui/calendar"
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover"
import { CalendarIcon } from "lucide-react"
import { format } from "date-fns"
import { ko } from "date-fns/locale"
import { cn } from "@/lib/utils"
import { useState } from "react"

export function ServiceRepairForm() {
  const { formData, setFormData, setCurrentStep } = useApplicationStore()
  const [desiredDate, setDesiredDate] = useState<Date | undefined>(
    formData?.desired_date ? new Date(formData.desired_date) : undefined
  )

  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
    setValue,
    watch,
  } = useForm<RepairApplicationForm>({
    resolver: zodResolver(repairApplicationSchema),
    defaultValues: {
      category: "aftercare",
      sub_category: "repair",
      ...formData,
    } as Partial<RepairApplicationForm>,
  })

  const onSubmit = async (data: RepairApplicationForm) => {
    setFormData(data)
    setCurrentStep(3) // 확인 단계로 이동
  }

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      <div className="space-y-2">
        <Label htmlFor="device_name">기기명 *</Label>
        <Input
          id="device_name"
          {...register("device_name")}
          placeholder="예: 휠체어, 목발 등"
          aria-invalid={errors.device_name ? "true" : "false"}
          aria-describedby={errors.device_name ? "device_name-error" : undefined}
        />
        {errors.device_name && (
          <p id="device_name-error" className="text-sm text-destructive" role="alert">
            {errors.device_name.message}
          </p>
        )}
      </div>

      <div className="space-y-2">
        <Label htmlFor="device_model">모델명 (선택사항)</Label>
        <Input
          id="device_model"
          {...register("device_model")}
          placeholder="예: ABC-123"
        />
      </div>

      <div className="space-y-2">
        <Label htmlFor="issue_description">문제 상황 *</Label>
        <Textarea
          id="issue_description"
          {...register("issue_description")}
          placeholder="기기의 문제 상황을 자세히 설명해주세요 (10자 이상)"
          rows={5}
          aria-invalid={errors.issue_description ? "true" : "false"}
          aria-describedby={errors.issue_description ? "issue_description-error" : undefined}
        />
        {errors.issue_description && (
          <p id="issue_description-error" className="text-sm text-destructive" role="alert">
            {errors.issue_description.message}
          </p>
        )}
      </div>

      <div className="space-y-2">
        <Label htmlFor="desired_date">희망 수리 일자 (선택사항)</Label>
        <Popover>
          <PopoverTrigger asChild>
            <Button
              variant="outline"
              className={cn(
                "w-full justify-start text-left font-normal",
                !desiredDate && "text-muted-foreground"
              )}
            >
              <CalendarIcon className="mr-2 h-4 w-4" />
              {desiredDate ? (
                format(desiredDate, "yyyy년 MM월 dd일", { locale: ko })
              ) : (
                <span>날짜 선택</span>
              )}
            </Button>
          </PopoverTrigger>
          <PopoverContent className="w-auto p-0" align="start">
            <Calendar
              mode="single"
              selected={desiredDate}
              onSelect={(date) => {
                setDesiredDate(date)
                setValue("desired_date", date)
              }}
              locale={ko}
            />
          </PopoverContent>
        </Popover>
      </div>

      <div className="space-y-2">
        <Label htmlFor="contact">연락처 *</Label>
        <Input
          id="contact"
          type="tel"
          {...register("contact")}
          placeholder="010-1234-5678"
          aria-invalid={errors.contact ? "true" : "false"}
          aria-describedby={errors.contact ? "contact-error" : undefined}
        />
        {errors.contact && (
          <p id="contact-error" className="text-sm text-destructive" role="alert">
            {errors.contact.message}
          </p>
        )}
      </div>

      <div className="space-y-2">
        <Label htmlFor="address">주소 (선택사항)</Label>
        <Input
          id="address"
          {...register("address")}
          placeholder="방문 수리가 필요한 경우 주소를 입력해주세요"
        />
      </div>

      <div className="space-y-2">
        <Label htmlFor="description">추가 설명 *</Label>
        <Textarea
          id="description"
          {...register("description")}
          placeholder="기타 필요한 사항을 입력해주세요 (10자 이상)"
          rows={4}
          aria-invalid={errors.description ? "true" : "false"}
          aria-describedby={errors.description ? "description-error" : undefined}
        />
        {errors.description && (
          <p id="description-error" className="text-sm text-destructive" role="alert">
            {errors.description.message}
          </p>
        )}
      </div>

      <div className="flex gap-4">
        <Button
          type="button"
          variant="outline"
          onClick={() => setCurrentStep(1)}
          className="flex-1"
        >
          이전
        </Button>
        <Button type="submit" disabled={isSubmitting} className="flex-1">
          {isSubmitting ? "처리 중..." : "다음"}
        </Button>
      </div>
    </form>
  )
}
</file>

<file path="components/features/application/ServiceApplicationWizard.tsx">
"use client"

import { useState } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { WizardStepNav } from "./wizard-step-nav"
import { ServiceCategorySelector } from "./ServiceCategorySelector"
import { ServiceRepairForm } from "./forms/ServiceRepairForm"
import { ServiceRentalForm } from "./forms/ServiceRentalForm"
import { ServiceConsultForm } from "./forms/ServiceConsultForm"
import { ServiceCustomForm } from "./forms/ServiceCustomForm"
import { SuccessModal } from "./success-modal"
import { useApplicationStore } from "@/lib/stores/application-store"
import { createApplication } from "@/actions/application-actions"
import { Button } from "@/components/ui/button"
import { useRouter } from "next/navigation"

const stepLabels = ["카테고리 선택", "신청서 작성", "확인 및 제출"]

export function ServiceApplicationWizard() {
  const router = useRouter()
  const {
    currentStep,
    selectedCategory,
    formData,
    setCurrentStep,
    reset,
  } = useApplicationStore()
  const [isSubmitting, setIsSubmitting] = useState(false)
  const [showSuccessModal, setShowSuccessModal] = useState(false)
  const [applicationId, setApplicationId] = useState<string>()

  // 단계별 컴포넌트 렌더링
  const renderStepContent = () => {
    switch (currentStep) {
      case 1:
        return <ServiceCategorySelector />

      case 2:
        if (!selectedCategory) {
          return (
            <div className="text-center py-8">
              <p className="text-muted-foreground">
                먼저 서비스 카테고리를 선택해주세요.
              </p>
              <Button
                onClick={() => setCurrentStep(1)}
                className="mt-4"
              >
                카테고리 선택으로 돌아가기
              </Button>
            </div>
          )
        }

        // 카테고리에 따른 폼 선택
        switch (selectedCategory) {
          case "aftercare":
            return <ServiceRepairForm />
          case "experience":
          case "custom":
            return <ServiceRentalForm />
          case "consult":
            return <ServiceConsultForm />
          case "education":
            return <ServiceCustomForm />
          default:
            return <ServiceConsultForm />
        }

      case 3:
        if (!formData) {
          return (
            <div className="text-center py-8">
              <p className="text-muted-foreground">
                신청서 정보가 없습니다.
              </p>
              <Button
                onClick={() => setCurrentStep(1)}
                className="mt-4"
              >
                처음부터 다시 시작
              </Button>
            </div>
          )
        }

        return (
          <div className="space-y-6">
            <div>
              <h3 className="text-lg font-semibold mb-4">신청 내용 확인</h3>
              <div className="space-y-4 p-4 border rounded-lg bg-muted/50">
                <div>
                  <span className="font-medium">카테고리:</span>{" "}
                  {selectedCategory === "consult"
                    ? "상담 및 정보제공"
                    : selectedCategory === "experience"
                    ? "체험"
                    : selectedCategory === "custom"
                    ? "맞춤형 지원"
                    : selectedCategory === "aftercare"
                    ? "사후관리"
                    : "교육/홍보"}
                </div>
                {formData.sub_category && (
                  <div>
                    <span className="font-medium">세부 카테고리:</span>{" "}
                    {formData.sub_category}
                  </div>
                )}
                {formData.contact && (
                  <div>
                    <span className="font-medium">연락처:</span> {formData.contact}
                  </div>
                )}
                {formData.description && (
                  <div>
                    <span className="font-medium">설명:</span>
                    <p className="mt-1 text-sm">{formData.description}</p>
                  </div>
                )}
              </div>
            </div>

            <div className="flex gap-4">
              <Button
                variant="outline"
                onClick={() => setCurrentStep(2)}
                className="flex-1"
              >
                이전
              </Button>
              <Button
                onClick={handleSubmit}
                disabled={isSubmitting}
                className="flex-1"
              >
                {isSubmitting ? "제출 중..." : "신청 제출"}
              </Button>
            </div>
          </div>
        )

      default:
        return null
    }
  }

  const handleSubmit = async () => {
    if (!formData) return

    setIsSubmitting(true)
    try {
      const result = await createApplication(formData as any)

      if (result.success) {
        setApplicationId(result.applicationId)
        setShowSuccessModal(true)
        reset()
      } else {
        alert(result.error || "신청 제출에 실패했습니다")
      }
    } catch (error) {
      console.error("Application submission error:", error)
      alert("예상치 못한 오류가 발생했습니다")
    } finally {
      setIsSubmitting(false)
    }
  }

  return (
    <div className="w-full max-w-4xl mx-auto">
      <Card>
        <CardHeader>
          <CardTitle>서비스 신청</CardTitle>
          <WizardStepNav
            currentStep={currentStep}
            totalSteps={3}
            stepLabels={stepLabels}
          />
        </CardHeader>
        <CardContent className="pt-6">
          {renderStepContent()}
        </CardContent>
      </Card>

      <SuccessModal
        open={showSuccessModal}
        applicationId={applicationId}
        onClose={() => {
          setShowSuccessModal(false)
          router.push("/portal/mypage")
        }}
      />
    </div>
  )
}
</file>

<file path="components/features/application/ServiceCategorySelector.tsx">
"use client"

import { Card, CardContent } from "@/components/ui/card"
import { useApplicationStore } from "@/lib/stores/application-store"
import { cn } from "@/lib/utils"
import {
  MessageSquare,
  TestTube,
  Wrench,
  Heart,
  GraduationCap,
} from "lucide-react"

const serviceCategories = [
  {
    id: "consult",
    label: "상담 및 정보제공",
    description: "전화, 방문, 센터 방문 상담",
    icon: MessageSquare,
    subCategories: [
      { id: "visit", label: "방문 상담" },
      { id: "exhibition", label: "견학" },
    ],
  },
  {
    id: "experience",
    label: "체험",
    description: "보조기기 체험 및 대여",
    icon: TestTube,
    subCategories: [{ id: "rental", label: "대여" }],
  },
  {
    id: "custom",
    label: "맞춤형 지원",
    description: "맞춤 제작 및 대여",
    icon: Wrench,
    subCategories: [
      { id: "custom_make", label: "맞춤 제작" },
      { id: "rental", label: "대여" },
    ],
  },
  {
    id: "aftercare",
    label: "사후관리",
    description: "수리, 소독, 점검, 재사용",
    icon: Heart,
    subCategories: [
      { id: "repair", label: "수리" },
      { id: "cleaning", label: "소독/세척" },
      { id: "reuse", label: "재사용" },
    ],
  },
  {
    id: "education",
    label: "교육/홍보",
    description: "보조기기 활용 교육 및 홍보",
    icon: GraduationCap,
    subCategories: [],
  },
]

export function ServiceCategorySelector() {
  const { selectedCategory, setSelectedCategory, setSelectedSubCategory } =
    useApplicationStore()

  const selectedCategoryData = serviceCategories.find(
    (cat) => cat.id === selectedCategory
  )

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-lg font-semibold mb-2">서비스 카테고리 선택</h2>
        <p className="text-sm text-muted-foreground">
          원하시는 서비스 카테고리를 선택해주세요
        </p>
      </div>

      {/* 메인 카테고리 선택 */}
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        {serviceCategories.map((category) => {
          const Icon = category.icon
          const isSelected = selectedCategory === category.id

          return (
            <Card
              key={category.id}
              className={cn(
                "cursor-pointer transition-all hover:border-primary",
                isSelected && "border-primary ring-2 ring-primary"
              )}
              onClick={() => {
                setSelectedCategory(category.id)
                setSelectedSubCategory(null)
              }}
              role="button"
              tabIndex={0}
              onKeyDown={(e) => {
                if (e.key === "Enter" || e.key === " ") {
                  e.preventDefault()
                  setSelectedCategory(category.id)
                  setSelectedSubCategory(null)
                }
              }}
              aria-label={`${category.label} 선택`}
            >
              <CardContent className="p-6">
                <div className="flex items-start gap-4">
                  <div
                    className={cn(
                      "p-3 rounded-lg",
                      isSelected
                        ? "bg-primary text-primary-foreground"
                        : "bg-muted"
                    )}
                  >
                    <Icon className="h-6 w-6" />
                  </div>
                  <div className="flex-1">
                    <h3 className="font-semibold mb-1">{category.label}</h3>
                    <p className="text-xs text-muted-foreground">
                      {category.description}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
          )
        })}
      </div>

      {/* 세부 카테고리 선택 (메인 카테고리가 선택된 경우) */}
      {selectedCategoryData &&
        selectedCategoryData.subCategories.length > 0 && (
          <div className="mt-6">
            <h3 className="text-sm font-semibold mb-3">
              세부 카테고리 선택 (선택사항)
            </h3>
            <div className="flex flex-wrap gap-2">
              {selectedCategoryData.subCategories.map((subCategory) => {
                const { selectedSubCategory, setSelectedSubCategory } =
                  useApplicationStore.getState()
                const isSelected = selectedSubCategory === subCategory.id

                return (
                  <button
                    key={subCategory.id}
                    type="button"
                    onClick={() => setSelectedSubCategory(subCategory.id)}
                    className={cn(
                      "px-4 py-2 rounded-md border text-sm transition-colors",
                      isSelected
                        ? "bg-primary text-primary-foreground border-primary"
                        : "bg-background hover:bg-accent"
                    )}
                    aria-label={`${subCategory.label} 선택`}
                  >
                    {subCategory.label}
                  </button>
                )
              })}
            </div>
          </div>
        )}
    </div>
  )
}
</file>

<file path="components/features/application/success-modal.tsx">
"use client"

import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog"
import { Button } from "@/components/ui/button"
import { CheckCircle2 } from "lucide-react"
import { useRouter } from "next/navigation"

interface SuccessModalProps {
  open: boolean
  applicationId?: string
  onClose: () => void
}

export function SuccessModal({ open, applicationId, onClose }: SuccessModalProps) {
  const router = useRouter()

  const handleGoToMyPage = () => {
    onClose()
    router.push("/portal/mypage")
  }

  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent className="sm:max-w-md">
        <DialogHeader>
          <div className="flex justify-center mb-4">
            <CheckCircle2 className="h-16 w-16 text-primary" />
          </div>
          <DialogTitle className="text-center">신청이 완료되었습니다</DialogTitle>
          <DialogDescription className="text-center">
            서비스 신청이 정상적으로 접수되었습니다.
            {applicationId && (
              <span className="block mt-2 text-xs">
                신청번호: {applicationId.substring(0, 8)}...
              </span>
            )}
          </DialogDescription>
        </DialogHeader>
        <DialogFooter className="flex-col sm:flex-row gap-2">
          <Button variant="outline" onClick={onClose} className="w-full sm:w-auto">
            닫기
          </Button>
          <Button onClick={handleGoToMyPage} className="w-full sm:w-auto">
            마이페이지로 이동
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  )
}
</file>

<file path="components/features/application/wizard-step-nav.tsx">
"use client"

import { cn } from "@/lib/utils"
import { Check } from "lucide-react"

interface WizardStepNavProps {
  currentStep: number
  totalSteps: number
  stepLabels: string[]
}

export function WizardStepNav({
  currentStep,
  totalSteps,
  stepLabels,
}: WizardStepNavProps) {
  return (
    <nav aria-label="신청 단계" className="w-full">
      <ol className="flex items-center justify-between w-full">
        {stepLabels.map((label, index) => {
          const step = index + 1
          const isCompleted = step < currentStep
          const isCurrent = step === currentStep
          const isPending = step > currentStep

          return (
            <li
              key={step}
              className="flex items-center flex-1"
              aria-current={isCurrent ? "step" : undefined}
            >
              <div className="flex items-center flex-1">
                {/* 단계 번호/체크 아이콘 */}
                <div
                  className={cn(
                    "flex items-center justify-center w-10 h-10 rounded-full border-2 transition-colors",
                    isCompleted &&
                      "bg-primary border-primary text-primary-foreground",
                    isCurrent &&
                      "bg-primary border-primary text-primary-foreground",
                    isPending &&
                      "bg-background border-muted-foreground text-muted-foreground"
                  )}
                  aria-label={`${label} ${isCompleted ? "완료" : isCurrent ? "진행 중" : "대기 중"}`}
                >
                  {isCompleted ? (
                    <Check className="h-5 w-5" />
                  ) : (
                    <span className="text-sm font-semibold">{step}</span>
                  )}
                </div>

                {/* 단계 라벨 */}
                <div className="ml-3 hidden sm:block">
                  <p
                    className={cn(
                      "text-sm font-medium",
                      isCurrent && "text-primary",
                      isPending && "text-muted-foreground",
                      isCompleted && "text-foreground"
                    )}
                  >
                    {label}
                  </p>
                </div>

                {/* 연결선 */}
                {step < totalSteps && (
                  <div
                    className={cn(
                      "flex-1 h-0.5 mx-4 transition-colors",
                      isCompleted ? "bg-primary" : "bg-muted"
                    )}
                    aria-hidden="true"
                  />
                )}
              </div>
            </li>
          )
        })}
      </ol>
    </nav>
  )
}
</file>

<file path="components/features/dashboard/AdminDashboardContent.tsx">
"use client"

import { AdminDashboardKpi } from "./AdminDashboardKpi"
import { AdminNewRequestList } from "./AdminNewRequestList"
import { AdminTodaySchedule } from "./AdminTodaySchedule"
import { useDashboardStats, useNewApplications, useTodaySchedules } from "@/lib/hooks/useDashboardStats"
import { Loader2 } from "lucide-react"

export function AdminDashboardContent() {
  const { data: stats, isLoading: statsLoading, error: statsError } = useDashboardStats()
  const { data: applications, isLoading: applicationsLoading } = useNewApplications(10)
  const { data: schedules, isLoading: schedulesLoading } = useTodaySchedules()

  if (statsLoading || applicationsLoading || schedulesLoading) {
    return (
      <div className="flex items-center justify-center py-12">
        <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
      </div>
    )
  }

  if (statsError || !stats) {
    return (
      <div className="rounded-lg border border-destructive/50 bg-destructive/10 p-4">
        <p className="text-sm text-destructive">
          대시보드 데이터를 불러오는 중 오류가 발생했습니다
        </p>
      </div>
    )
  }

  return (
    <div className="space-y-6">
      {/* KPI 카드 */}
      <AdminDashboardKpi stats={stats} />

      {/* 신규 접수 및 오늘의 일정 */}
      <div className="grid gap-6 md:grid-cols-2">
        <AdminNewRequestList applications={applications || []} />
        <AdminTodaySchedule schedules={schedules || []} />
      </div>
    </div>
  )
}
</file>

<file path="components/features/dashboard/AdminDashboardKpi.tsx">
"use client"

import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { type DashboardStats } from "@/actions/dashboard-actions"
import { FileText, Clock, CheckCircle2 } from "lucide-react"

interface AdminDashboardKpiProps {
  stats: DashboardStats
}

export function AdminDashboardKpi({ stats }: AdminDashboardKpiProps) {
  const kpiItems = [
    {
      title: "오늘의 신규 접수",
      value: stats.newToday,
      icon: FileText,
      color: "text-blue-600",
      bgColor: "bg-blue-50 dark:bg-blue-950",
    },
    {
      title: "진행 중",
      value: stats.inProgress,
      icon: Clock,
      color: "text-orange-600",
      bgColor: "bg-orange-50 dark:bg-orange-950",
    },
    {
      title: "오늘 완료",
      value: stats.completedToday,
      icon: CheckCircle2,
      color: "text-green-600",
      bgColor: "bg-green-50 dark:bg-green-950",
    },
  ]

  return (
    <div className="grid gap-4 md:grid-cols-3">
      {kpiItems.map((item) => {
        const Icon = item.icon
        return (
          <Card key={item.title}>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium text-muted-foreground">
                {item.title}
              </CardTitle>
              <div className={`rounded-full p-2 ${item.bgColor}`}>
                <Icon className={`h-4 w-4 ${item.color}`} />
              </div>
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold text-foreground">{item.value}</div>
              <p className="text-xs text-muted-foreground mt-1">건</p>
            </CardContent>
          </Card>
        )
      })}
    </div>
  )
}
</file>

<file path="components/features/dashboard/AdminNewRequestList.tsx">
"use client"

import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { type NewApplication } from "@/actions/dashboard-actions"
import { format } from "date-fns"
import { ko } from "date-fns/locale"
import Link from "next/link"
import { FileText, Calendar, ArrowRight } from "lucide-react"
import { Badge } from "@/components/ui/badge"

interface AdminNewRequestListProps {
  applications: NewApplication[]
}

const getCategoryLabel = (category: string | null) => {
  if (!category) return "미분류"
  const categoryMap: Record<string, string> = {
    consult: "상담 및 정보제공",
    repair: "수리",
    rental: "대여",
    custom: "맞춤형 지원",
    edu: "교육/홍보",
  }
  return categoryMap[category] || category
}

export function AdminNewRequestList({ applications }: AdminNewRequestListProps) {
  if (applications.length === 0) {
    return (
      <Card>
        <CardHeader>
          <CardTitle>신규 접수</CardTitle>
        </CardHeader>
        <CardContent>
          <p className="text-sm text-muted-foreground text-center py-4">
            신규 접수 건이 없습니다
          </p>
        </CardContent>
      </Card>
    )
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle>신규 접수</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="space-y-3">
          {applications.map((app) => (
            <Link
              key={app.id}
              href={`/admin/clients/${app.client?.id || ""}`}
              className="block p-3 rounded-lg border hover:bg-accent transition-colors"
            >
              <div className="flex items-start justify-between gap-4">
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2 mb-1">
                    <FileText className="h-4 w-4 text-muted-foreground flex-shrink-0" />
                    <span className="font-medium text-foreground truncate">
                      {app.client?.name || "이름 없음"}
                    </span>
                  </div>
                  <div className="flex items-center gap-2 flex-wrap">
                    <Badge variant="outline" className="text-xs">
                      {getCategoryLabel(app.category)}
                    </Badge>
                    {app.sub_category && (
                      <span className="text-xs text-muted-foreground">
                        {app.sub_category}
                      </span>
                    )}
                  </div>
                </div>
                <div className="flex items-center gap-2 text-xs text-muted-foreground whitespace-nowrap">
                  <Calendar className="h-3 w-3" />
                  {app.created_at
                    ? format(new Date(app.created_at), "MM.dd HH:mm", { locale: ko })
                    : "-"}
                </div>
                <ArrowRight className="h-4 w-4 text-muted-foreground flex-shrink-0" />
              </div>
            </Link>
          ))}
        </div>
      </CardContent>
    </Card>
  )
}
</file>

<file path="components/features/dashboard/AdminTodaySchedule.tsx">
"use client"

import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { type TodaySchedule } from "@/actions/dashboard-actions"
import { Calendar, Clock, MapPin, User, FileText } from "lucide-react"
import { format } from "date-fns"
import { ko } from "date-fns/locale"

interface AdminTodayScheduleProps {
  schedules: TodaySchedule[]
}

const getScheduleTypeLabel = (type: string) => {
  const typeMap: Record<string, string> = {
    visit: "방문",
    consultation: "상담",
    assessment: "평가",
    delivery: "배송",
    pickup: "픽업",
    other: "기타",
  }
  return typeMap[type] || type
}

export function AdminTodaySchedule({ schedules }: AdminTodayScheduleProps) {
  if (schedules.length === 0) {
    return (
      <Card>
        <CardHeader>
          <CardTitle>오늘의 일정</CardTitle>
        </CardHeader>
        <CardContent>
          <p className="text-sm text-muted-foreground text-center py-4">
            오늘 예정된 일정이 없습니다
          </p>
        </CardContent>
      </Card>
    )
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle>오늘의 일정</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="space-y-4">
          {schedules.map((schedule) => (
            <div
              key={schedule.id}
              className="p-4 rounded-lg border hover:bg-accent transition-colors"
            >
              <div className="flex items-start justify-between gap-4 mb-2">
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2 mb-1">
                    <Calendar className="h-4 w-4 text-muted-foreground flex-shrink-0" />
                    <span className="font-medium text-foreground">
                      {getScheduleTypeLabel(schedule.schedule_type)}
                    </span>
                  </div>
                  {schedule.client && (
                    <div className="flex items-center gap-2 mb-1">
                      <User className="h-3 w-3 text-muted-foreground" />
                      <span className="text-sm text-foreground">
                        {schedule.client.name}
                      </span>
                    </div>
                  )}
                  {schedule.address && (
                    <div className="flex items-center gap-2 mb-1">
                      <MapPin className="h-3 w-3 text-muted-foreground" />
                      <span className="text-sm text-muted-foreground truncate">
                        {schedule.address}
                      </span>
                    </div>
                  )}
                  {schedule.notes && (
                    <div className="flex items-start gap-2 mt-2">
                      <FileText className="h-3 w-3 text-muted-foreground mt-0.5 flex-shrink-0" />
                      <span className="text-sm text-muted-foreground">
                        {schedule.notes}
                      </span>
                    </div>
                  )}
                </div>
                <div className="flex flex-col items-end gap-1 text-xs text-muted-foreground whitespace-nowrap">
                  {schedule.scheduled_time && (
                    <div className="flex items-center gap-1">
                      <Clock className="h-3 w-3" />
                      {schedule.scheduled_time}
                    </div>
                  )}
                  {schedule.staff && (
                    <div className="text-xs text-muted-foreground">
                      {schedule.staff.full_name || "담당자"}
                    </div>
                  )}
                </div>
              </div>
            </div>
          ))}
        </div>
      </CardContent>
    </Card>
  )
}
</file>

<file path="components/features/landing/HomeCalendarCompact.tsx">
"use client"

import { useState, useEffect } from "react"
import { Calendar } from "@/components/ui/calendar"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { buttonVariants } from "@/components/ui/button"
import { getPublicSchedules, getPublicSchedulesByDate, type PublicSchedule } from "@/actions/schedule-actions"
import { format } from "date-fns"
import { ko } from "date-fns/locale"
import { Calendar as CalendarIcon, Clock, MapPin } from "lucide-react"
import { cn } from "@/lib/utils"

interface HomeCalendarCompactProps {
  initialSchedules?: PublicSchedule[]
}

export function HomeCalendarCompact({ initialSchedules = [] }: HomeCalendarCompactProps) {
  const [selectedDate, setSelectedDate] = useState<Date | undefined>(new Date())
  const [schedules, setSchedules] = useState<PublicSchedule[]>(initialSchedules)
  const [selectedSchedules, setSelectedSchedules] = useState<PublicSchedule[]>([])

  // 날짜 선택 시 해당 날짜의 일정 조회
  useEffect(() => {
    if (selectedDate) {
      getPublicSchedulesByDate(selectedDate).then(setSelectedSchedules)
    }
  }, [selectedDate])

  // 날짜에 일정이 있는지 확인하는 함수
  const hasSchedule = (date: Date): boolean => {
    const dateStr = format(date, "yyyy-MM-dd")
    return schedules.some((schedule) => schedule.scheduled_date === dateStr)
  }

  // 날짜 클릭 핸들러
  const handleDateSelect = (date: Date | undefined) => {
    if (!date) return
    setSelectedDate(date)
    const dateStr = format(date, "yyyy-MM-dd")
    const daySchedules = schedules.filter(
      (schedule) => schedule.scheduled_date === dateStr
    )
    setSelectedSchedules(daySchedules)
  }

  return (
    <Card className="h-full">
      <CardHeader>
        <CardTitle className="flex items-center gap-2 text-lg">
          <CalendarIcon className="h-5 w-5" />
          공개 일정 캘린더
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* 캘린더 */}
        <div className="w-full">
          <Calendar
            mode="single"
            selected={selectedDate}
            onSelect={handleDateSelect}
            modifiers={{
              hasSchedule: (date) => hasSchedule(date),
            }}
            modifiersClassNames={{
              hasSchedule: "bg-primary/10 text-primary font-semibold",
            }}
            className="rounded-md border w-full"
            classNames={{
              months: "w-full",
              month: "w-full",
              caption: "flex justify-center pt-1 relative items-center w-full",
              caption_label: "text-sm font-medium",
              nav: "space-x-1 flex items-center",
              table: "w-full border-collapse space-y-1",
              head_row: "flex w-full",
              head_cell: "text-muted-foreground rounded-md flex-1 font-normal text-sm text-center py-2 flex items-center justify-center",
              row: "flex w-full mt-2",
              cell: "flex-1 h-16 text-center text-sm p-0 relative flex items-center justify-center [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
              day: cn(
                buttonVariants({ variant: "ghost" }),
                "h-16 w-full p-0 font-normal aria-selected:opacity-100 text-base flex items-center justify-center"
              ),
              day_selected: "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground",
            }}
          />
        </div>

        {/* 선택된 날짜의 일정 목록 */}
        {selectedDate && (
          <div className="space-y-2">
            <h3 className="text-sm font-semibold text-foreground">
              {format(selectedDate, "yyyy년 MM월 dd일", { locale: ko })} 일정
            </h3>
            {selectedSchedules.length === 0 ? (
              <p className="text-xs text-muted-foreground">
                선택한 날짜에 일정이 없습니다.
              </p>
            ) : (
              <div className="space-y-2">
                {selectedSchedules.map((schedule) => (
                  <div
                    key={schedule.id}
                    className="p-3 rounded-md border bg-card hover:bg-accent transition-colors"
                  >
                    <div className="flex items-start justify-between gap-2 mb-2">
                      <Badge
                        variant={
                          schedule.schedule_type === "exhibition"
                            ? "default"
                            : "secondary"
                        }
                        className="text-xs"
                      >
                        {schedule.schedule_type === "exhibition" ? "견학" : "교육"}
                      </Badge>
                      {schedule.scheduled_time && (
                        <div className="flex items-center gap-1 text-xs text-muted-foreground">
                          <Clock className="h-3 w-3" />
                          {schedule.scheduled_time.substring(0, 5)}
                        </div>
                      )}
                    </div>
                    {schedule.address && (
                      <div className="flex items-center gap-1 text-xs text-muted-foreground">
                        <MapPin className="h-3 w-3" />
                        <span className="line-clamp-1">{schedule.address}</span>
                      </div>
                    )}
                    {schedule.notes && (
                      <p className="text-xs text-foreground mt-1 line-clamp-2">
                        {schedule.notes}
                      </p>
                    )}
                  </div>
                ))}
              </div>
            )}
          </div>
        )}
      </CardContent>
    </Card>
  )
}
</file>

<file path="components/features/notices/NoticeAttachments.tsx">
"use client"

import { Card, CardContent } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Image as ImageIcon, FileText, Youtube, Download, ExternalLink } from "lucide-react"
import type { Attachment } from "@/actions/notice-actions"
import Image from "next/image"

interface NoticeAttachmentsProps {
  attachments: Attachment[]
}

export function NoticeAttachments({ attachments }: NoticeAttachmentsProps) {
  if (!attachments || attachments.length === 0) {
    return null
  }

  return (
    <div className="mt-6 space-y-4">
      <h3 className="text-lg font-semibold">첨부파일</h3>
      <div className="grid gap-4">
        {attachments.map((attachment, index) => (
          <Card key={index}>
            <CardContent className="p-4">
              {attachment.type === "image" && (
                <div className="space-y-2">
                  <div className="flex items-center gap-2 mb-2">
                    <ImageIcon className="h-5 w-5 text-muted-foreground" />
                    <span className="font-medium">{attachment.name}</span>
                    {attachment.size && (
                      <span className="text-sm text-muted-foreground">
                        ({(attachment.size / 1024).toFixed(1)} KB)
                      </span>
                    )}
                  </div>
                  <div className="relative w-full h-64 sm:h-96 rounded-lg overflow-hidden border">
                    <Image
                      src={attachment.url}
                      alt={attachment.name}
                      fill
                      className="object-contain"
                      sizes="(max-width: 768px) 100vw, (max-width: 1200px) 80vw, 70vw"
                    />
                  </div>
                  <Button
                    variant="outline"
                    size="sm"
                    asChild
                    className="w-full sm:w-auto"
                  >
                    <a href={attachment.url} target="_blank" rel="noopener noreferrer">
                      <ExternalLink className="mr-2 h-4 w-4" />
                      원본 보기
                    </a>
                  </Button>
                </div>
              )}

              {attachment.type === "pdf" && (
                <div className="space-y-2">
                  <div className="flex items-center gap-2">
                    <FileText className="h-5 w-5 text-muted-foreground" />
                    <span className="font-medium">{attachment.name}</span>
                    {attachment.size && (
                      <span className="text-sm text-muted-foreground">
                        ({(attachment.size / 1024).toFixed(1)} KB)
                      </span>
                    )}
                  </div>
                  <div className="flex gap-2">
                    <Button variant="outline" size="sm" asChild>
                      <a href={attachment.url} target="_blank" rel="noopener noreferrer">
                        <ExternalLink className="mr-2 h-4 w-4" />
                        새 창에서 열기
                      </a>
                    </Button>
                    <Button variant="outline" size="sm" asChild>
                      <a href={attachment.url} download>
                        <Download className="mr-2 h-4 w-4" />
                        다운로드
                      </a>
                    </Button>
                  </div>
                </div>
              )}

              {attachment.type === "youtube" && (
                <div className="space-y-2">
                  <div className="flex items-center gap-2 mb-2">
                    <Youtube className="h-5 w-5 text-red-500" />
                    <span className="font-medium">{attachment.name}</span>
                  </div>
                  <div className="relative w-full aspect-video rounded-lg overflow-hidden border bg-black">
                    <iframe
                      src={attachment.url}
                      title={attachment.name}
                      className="absolute inset-0 w-full h-full"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                      allowFullScreen
                    />
                  </div>
                </div>
              )}
            </CardContent>
          </Card>
        ))}
      </div>
    </div>
  )
}
</file>

<file path="components/features/notices/NoticeShareButton.tsx">
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Share2, Check, Copy } from "lucide-react"
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu"

interface NoticeShareButtonProps {
  noticeId: string
  noticeTitle: string
}

export function NoticeShareButton({
  noticeId,
  noticeTitle,
}: NoticeShareButtonProps) {
  const [copied, setCopied] = useState(false)

  const shareUrl = typeof window !== "undefined" 
    ? `${window.location.origin}/notices/${noticeId}`
    : ""

  const handleCopyLink = async () => {
    try {
      await navigator.clipboard.writeText(shareUrl)
      setCopied(true)
      setTimeout(() => setCopied(false), 2000)
    } catch (error) {
      console.error("링크 복사 실패:", error)
      alert("링크 복사에 실패했습니다")
    }
  }

  const handleShare = async () => {
    if (navigator.share) {
      try {
        await navigator.share({
          title: noticeTitle,
          text: noticeTitle,
          url: shareUrl,
        })
      } catch (error) {
        // 사용자가 공유를 취소한 경우는 에러로 처리하지 않음
        if ((error as Error).name !== "AbortError") {
          console.error("공유 실패:", error)
        }
      }
    } else {
      // Web Share API를 지원하지 않는 경우 링크 복사
      handleCopyLink()
    }
  }

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="outline" size="sm">
          <Share2 className="mr-2 h-4 w-4" />
          공유
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end">
        <DropdownMenuItem onClick={handleShare}>
          <Share2 className="mr-2 h-4 w-4" />
          공유하기
        </DropdownMenuItem>
        <DropdownMenuItem onClick={handleCopyLink}>
          {copied ? (
            <>
              <Check className="mr-2 h-4 w-4" />
              복사됨
            </>
          ) : (
            <>
              <Copy className="mr-2 h-4 w-4" />
              링크 복사
            </>
          )}
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  )
}
</file>

<file path="components/features/portal/ClientRentStatus.tsx">
"use client"

import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { format, differenceInDays, isPast, isToday } from "date-fns"
import { ko } from "date-fns/locale"
import { cn } from "@/lib/utils"
import type { RentalStatus } from "@/actions/portal-actions"
import { Calendar, Package, AlertTriangle } from "lucide-react"

interface ClientRentStatusProps {
  rentals: RentalStatus[]
}

export function ClientRentStatus({ rentals }: ClientRentStatusProps) {
  if (rentals.length === 0) {
    return (
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Package className="h-5 w-5" />
            대여 중인 기기
          </CardTitle>
        </CardHeader>
        <CardContent>
          <p className="text-sm text-muted-foreground text-center py-4">
            현재 대여 중인 기기가 없습니다
          </p>
        </CardContent>
      </Card>
    )
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Package className="h-5 w-5" />
          대여 중인 기기 ({rentals.length}개)
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        {rentals.map((rental) => {
          const endDate = new Date(rental.rental_end_date)
          const daysRemaining = differenceInDays(endDate, new Date())
          const isOverdue = isPast(endDate) && !isToday(endDate)
          const isDueToday = isToday(endDate)

          return (
            <div
              key={rental.id}
              className={cn(
                "p-4 rounded-lg border",
                isOverdue && "border-destructive bg-destructive/5",
                isDueToday && "border-yellow-500 bg-yellow-500/10"
              )}
            >
              <div className="flex items-start justify-between gap-4 mb-3">
                <div className="flex-1">
                  <h3 className="font-semibold text-foreground">
                    {rental.inventory_name || "기기명 없음"}
                  </h3>
                  {rental.inventory_model && (
                    <p className="text-sm text-muted-foreground mt-1">
                      모델: {rental.inventory_model}
                    </p>
                  )}
                </div>
                {isOverdue && (
                  <Badge variant="destructive" className="flex items-center gap-1">
                    <AlertTriangle className="h-3 w-3" />
                    연체
                  </Badge>
                )}
                {isDueToday && (
                  <Badge variant="outline" className="flex items-center gap-1 border-yellow-500 text-yellow-600 dark:text-yellow-500">
                    <AlertTriangle className="h-3 w-3" />
                    오늘 반납
                  </Badge>
                )}
              </div>

              <div className="space-y-2 text-sm">
                <div className="flex items-center gap-2 text-muted-foreground">
                  <Calendar className="h-4 w-4" />
                  <span>
                    대여 기간:{" "}
                    {format(new Date(rental.rental_start_date), "yyyy년 MM월 dd일", {
                      locale: ko,
                    })}{" "}
                    ~{" "}
                    {format(endDate, "yyyy년 MM월 dd일", { locale: ko })}
                  </span>
                </div>

                {rental.extension_count && rental.extension_count > 0 && (
                  <div className="text-xs text-muted-foreground">
                    연장 횟수: {rental.extension_count}회
                  </div>
                )}

                <div
                  className={cn(
                    "font-semibold",
                    isOverdue && "text-destructive",
                    isDueToday && "text-yellow-600 dark:text-yellow-500",
                    !isOverdue && !isDueToday && "text-foreground"
                  )}
                >
                  {isOverdue ? (
                    <span>연체 {Math.abs(daysRemaining)}일</span>
                  ) : isDueToday ? (
                    <span>오늘 반납 예정</span>
                  ) : (
                    <span>반납까지 {daysRemaining}일 남음</span>
                  )}
                </div>
              </div>
            </div>
          )
        })}
      </CardContent>
    </Card>
  )
}
</file>

<file path="components/features/portal/ClientTimelineItem.tsx">
"use client"

import { Card, CardContent } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { format } from "date-fns"
import { ko } from "date-fns/locale"
import { cn } from "@/lib/utils"
import type { ServiceHistory } from "@/actions/portal-actions"
import {
  MessageSquare,
  TestTube,
  Wrench,
  Heart,
  GraduationCap,
  Clock,
  CheckCircle2,
  XCircle,
  AlertCircle,
  Package,
  Scissors,
  Recycle,
  Settings,
  Droplets,
} from "lucide-react"

// 서비스 타입별 아이콘 및 라벨
const serviceTypeConfig: Record<
  string,
  { icon: React.ComponentType<{ className?: string }>; label: string; color: string }
> = {
  // Service Log 타입
  repair: { icon: Wrench, label: "수리 및 점검", color: "text-blue-600" },
  custom_make: { icon: Scissors, label: "맞춤 제작", color: "text-purple-600" },
  cleaning: { icon: Droplets, label: "소독 및 세척", color: "text-green-600" },
  reuse: { icon: Recycle, label: "재사용 지원", color: "text-orange-600" },
  inspection: { icon: Settings, label: "점검", color: "text-blue-600" },
  maintenance: { icon: Settings, label: "유지관리", color: "text-gray-600" },
  education: { icon: GraduationCap, label: "교육", color: "text-indigo-600" },
  rental: { icon: Package, label: "대여", color: "text-cyan-600" },
  // Application 카테고리
  consult: { icon: MessageSquare, label: "상담 및 정보제공", color: "text-primary" },
  experience: { icon: TestTube, label: "체험", color: "text-primary" },
  custom: { icon: Wrench, label: "맞춤형 지원", color: "text-primary" },
  aftercare: { icon: Heart, label: "사후관리", color: "text-primary" },
  // 기타
  intake: { icon: MessageSquare, label: "상담", color: "text-primary" },
}

const categoryLabels: Record<string, string> = {
  consult: "상담 및 정보제공",
  experience: "체험",
  custom: "맞춤형 지원",
  aftercare: "사후관리",
  education: "교육/홍보",
}

const subCategoryLabels: Record<string, string> = {
  repair: "수리",
  rental: "대여",
  custom_make: "맞춤 제작",
  visit: "방문",
  exhibition: "견학",
  cleaning: "소독/세척",
  reuse: "재사용",
}

const statusConfig: Record<
  string,
  { label: string; variant: "default" | "secondary" | "destructive" | "outline"; icon: React.ComponentType<{ className?: string }> }
> = {
  접수: {
    label: "접수",
    variant: "secondary",
    icon: Clock,
  },
  배정: {
    label: "배정",
    variant: "default",
    icon: AlertCircle,
  },
  진행: {
    label: "진행 중",
    variant: "default",
    icon: Clock,
  },
  완료: {
    label: "완료",
    variant: "default",
    icon: CheckCircle2,
  },
  반려: {
    label: "반려",
    variant: "destructive",
    icon: XCircle,
  },
  rented: {
    label: "대여 중",
    variant: "default",
    icon: Package,
  },
  returned: {
    label: "반납 완료",
    variant: "default",
    icon: CheckCircle2,
  },
  overdue: {
    label: "연체",
    variant: "destructive",
    icon: AlertCircle,
  },
}

interface ClientTimelineItemProps {
  history: ServiceHistory
}

export function ClientTimelineItem({ history }: ClientTimelineItemProps) {
  // 타입별 아이콘 및 라벨 결정
  let Icon = MessageSquare
  let label = "서비스"
  let color = "text-primary"

  if (history.type === "service_log" && history.service_type) {
    const config = serviceTypeConfig[history.service_type]
    if (config) {
      Icon = config.icon
      label = config.label
      color = config.color
    } else {
      Icon = Settings
      label = history.service_type
    }
  } else if (history.type === "rental") {
    Icon = Package
    label = "대여"
    color = "text-cyan-600"
  } else if (history.type === "intake") {
    Icon = MessageSquare
    label = "상담"
    color = "text-primary"
  } else if (history.type === "application" && history.category) {
    const config = serviceTypeConfig[history.category]
    if (config) {
      Icon = config.icon
      label = config.label
      color = config.color
    } else {
      label = categoryLabels[history.category] || history.category
    }
  }

  // 상태 표시
  let statusBadge = null
  if (history.type === "application" && history.status) {
    const statusInfo = statusConfig[history.status] || statusConfig["접수"]
    const StatusIcon = statusInfo.icon
    statusBadge = (
      <Badge variant={statusInfo.variant} className="flex items-center gap-1">
        <StatusIcon className="h-3 w-3" />
        {statusInfo.label}
      </Badge>
    )
  } else if (history.type === "rental" && history.status) {
    const statusInfo = statusConfig[history.status] || statusConfig["rented"]
    const StatusIcon = statusInfo.icon
    statusBadge = (
      <Badge variant={statusInfo.variant} className="flex items-center gap-1">
        <StatusIcon className="h-3 w-3" />
        {statusInfo.label}
      </Badge>
    )
  } else if (history.type === "service_log") {
    statusBadge = (
      <Badge variant="default" className="flex items-center gap-1">
        <CheckCircle2 className="h-3 w-3" />
        완료
      </Badge>
    )
  } else if (history.type === "intake") {
    statusBadge = (
      <Badge variant="default" className="flex items-center gap-1">
        <CheckCircle2 className="h-3 w-3" />
        상담 완료
      </Badge>
    )
  }

  // 세부 정보
  const subLabel =
    history.type === "application" && history.sub_category
      ? subCategoryLabels[history.sub_category] || history.sub_category
      : history.type === "service_log" && history.item_name
      ? history.item_name
      : history.type === "rental" && history.inventory_name
      ? history.inventory_name
      : null

  return (
    <Card className="relative">
      <CardContent className="p-4 sm:p-6">
        <div className="flex items-start gap-4">
          {/* 아이콘 */}
          <div className="flex-shrink-0">
            <div className={cn("p-3 rounded-lg bg-primary/10", color)}>
              <Icon className="h-5 w-5" />
            </div>
          </div>

          {/* 내용 */}
          <div className="flex-1 min-w-0">
            <div className="flex items-start justify-between gap-2 mb-2">
              <div>
                <h3 className="font-semibold text-foreground">{label}</h3>
                {subLabel && (
                  <p className="text-sm text-muted-foreground mt-1">{subLabel}</p>
                )}
                {history.type === "service_log" && history.work_description && (
                  <p className="text-xs text-muted-foreground mt-1 line-clamp-2">
                    {history.work_description}
                  </p>
                )}
              </div>
              {statusBadge}
            </div>

            <div className="space-y-1 text-sm text-muted-foreground">
              {/* 날짜 표시 */}
              {history.type === "rental" && history.rental_start_date && (
                <div className="flex items-center gap-1">
                  <span>대여 기간:</span>
                  <span>
                    {format(new Date(history.rental_start_date), "yyyy년 MM월 dd일", {
                      locale: ko,
                    })}
                    {history.rental_end_date && (
                      <>
                        {" ~ "}
                        {format(new Date(history.rental_end_date), "yyyy년 MM월 dd일", {
                          locale: ko,
                        })}
                      </>
                    )}
                  </span>
                </div>
              )}
              {history.type === "intake" && history.consult_date && (
                <div className="flex items-center gap-1">
                  <span>상담일:</span>
                  <span>
                    {format(new Date(history.consult_date), "yyyy년 MM월 dd일", {
                      locale: ko,
                    })}
                  </span>
                </div>
              )}
              {history.type === "service_log" && history.service_date && (
                <div className="flex items-center gap-1">
                  <span>서비스일:</span>
                  <span>
                    {format(new Date(history.service_date), "yyyy년 MM월 dd일", {
                      locale: ko,
                    })}
                  </span>
                </div>
              )}
              {history.type === "application" && history.desired_date && (
                <div className="flex items-center gap-1">
                  <span>희망일:</span>
                  <span>
                    {format(new Date(history.desired_date), "yyyy년 MM월 dd일", {
                      locale: ko,
                    })}
                  </span>
                </div>
              )}
              <div className="flex items-center gap-1">
                <span>
                  {history.type === "application"
                    ? "신청일"
                    : history.type === "service_log"
                    ? "등록일"
                    : history.type === "rental"
                    ? "대여 시작일"
                    : "등록일"}
                  :
                </span>
                <span>
                  {history.date
                    ? format(new Date(history.date), "yyyy년 MM월 dd일", { locale: ko })
                    : history.created_at
                    ? format(new Date(history.created_at), "yyyy년 MM월 dd일", {
                        locale: ko,
                      })
                    : "-"}
                </span>
              </div>
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  )
}
</file>

<file path="components/features/portal/ClientTimelineList.tsx">
"use client"

import { ClientTimelineItem } from "./ClientTimelineItem"
import type { ServiceHistory } from "@/actions/portal-actions"
import { Card, CardContent } from "@/components/ui/card"
import { AlertCircle } from "lucide-react"

interface ClientTimelineListProps {
  history: ServiceHistory[]
}

export function ClientTimelineList({ history }: ClientTimelineListProps) {
  if (history.length === 0) {
    return (
      <Card>
        <CardContent className="p-8 text-center">
          <AlertCircle className="h-12 w-12 text-muted-foreground mx-auto mb-4" />
          <p className="text-muted-foreground">서비스 이력이 없습니다</p>
          <p className="text-sm text-muted-foreground mt-2">
            서비스를 신청하시면 이력이 표시됩니다
          </p>
        </CardContent>
      </Card>
    )
  }

  return (
    <div className="space-y-4">
      {history.map((item) => (
        <ClientTimelineItem key={`${item.type}-${item.id}`} history={item} />
      ))}
    </div>
  )
}
</file>

<file path="components/layout/portal-header.tsx">
"use client"

import { Logo } from "@/components/common/logo"
import { UserButton } from "@clerk/nextjs"
import { Button } from "@/components/ui/button"
import Link from "next/link"
import { Bell, Home } from "lucide-react"

export function PortalHeader() {
  return (
    <header className="sticky top-0 z-40 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 md:block hidden">
      <div className="container flex h-14 sm:h-16 items-center justify-between px-4 sm:px-6">
        <Link href="/portal" className="flex items-center">
          <Logo />
        </Link>
        <nav className="flex items-center gap-2 sm:gap-4">
          <Button asChild variant="ghost" size="sm" className="text-xs sm:text-sm">
            <Link href="/notices">
              <Bell className="h-4 w-4 mr-2" />
              공지사항
            </Link>
          </Button>
          <Button asChild variant="ghost" size="sm" className="text-xs sm:text-sm">
            <Link href="/">
              <Home className="h-4 w-4 mr-2" />
              홈으로
            </Link>
          </Button>
          <UserButton afterSignOutUrl="/" />
        </nav>
      </div>
    </header>
  )
}
</file>

<file path="components/providers/clerk-provider.tsx">
"use client"

import { ClerkProvider as ClerkProviderBase } from "@clerk/nextjs"

interface ClerkProviderProps {
  children: React.ReactNode
}

export function ClerkProvider({ children }: ClerkProviderProps) {
  return (
    <ClerkProviderBase
      dynamic
      appearance={{
        elements: {
          rootBox: "w-full",
        },
      }}
    >
      {children}
    </ClerkProviderBase>
  )
}
</file>

<file path="components/providers/query-provider.tsx">
"use client"

import { QueryClient, QueryClientProvider } from "@tanstack/react-query"
import { useState } from "react"

export function QueryProvider({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(
    () =>
      new QueryClient({
        defaultOptions: {
          queries: {
            staleTime: 60 * 1000, // 1분
            refetchOnWindowFocus: false,
          },
        },
      })
  )

  return (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  )
}
</file>

<file path="components/ui/accordion.tsx">
import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))

AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }
</file>

<file path="components/ui/badge.tsx">
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }
</file>

<file path="components/ui/button.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }
</file>

<file path="components/ui/calendar.tsx">
import * as React from "react"
import { ChevronLeft, ChevronRight } from "lucide-react"
import { DayPicker } from "react-day-picker"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

export type CalendarProps = React.ComponentProps<typeof DayPicker>

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: CalendarProps) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",
        month: "space-y-4",
        caption: "flex justify-center pt-1 relative items-center",
        caption_label: "text-sm font-medium",
        nav: "space-x-1 flex items-center",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-y-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"
        ),
        day_range_end: "day-range-end",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ ...props }) => <ChevronLeft className="h-4 w-4" />,
        IconRight: ({ ...props }) => <ChevronRight className="h-4 w-4" />,
      }}
      {...props}
    />
  )
}
Calendar.displayName = "Calendar"

export { Calendar }
</file>

<file path="components/ui/card.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }
</file>

<file path="components/ui/checkbox.tsx">
import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }
</file>

<file path="components/ui/dialog.tsx">
import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}
</file>

<file path="components/ui/dropdown-menu.tsx">
import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger

const DropdownMenuGroup = DropdownMenuPrimitive.Group

const DropdownMenuPortal = DropdownMenuPrimitive.Portal

const DropdownMenuSub = DropdownMenuPrimitive.Sub

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  )
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}
</file>

<file path="components/ui/hover-card.tsx">
import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

const HoverCard = HoverCardPrimitive.Root

const HoverCardTrigger = HoverCardPrimitive.Trigger

const HoverCardContent = React.forwardRef<
  React.ElementRef<typeof HoverCardPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <HoverCardPrimitive.Content
    ref={ref}
    align={align}
    sideOffset={sideOffset}
    className={cn(
      "z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
HoverCardContent.displayName = HoverCardPrimitive.Content.displayName

export { HoverCard, HoverCardTrigger, HoverCardContent }
</file>

<file path="components/ui/input.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

export interface InputProps
  extends React.InputHTMLAttributes<HTMLInputElement> {}

const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }
</file>

<file path="components/ui/label.tsx">
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }
</file>

<file path="components/ui/popover.tsx">
import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent }
</file>

<file path="components/ui/radio-group.tsx">
import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn("grid gap-2", className)}
      {...props}
      ref={ref}
    />
  )
})
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
})
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName

export { RadioGroup, RadioGroupItem }
</file>

<file path="components/ui/select.tsx">
import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}
</file>

<file path="components/ui/tabs.tsx">
import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }
</file>

<file path="components/ui/textarea.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

export interface TextareaProps
  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}

const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, ...props }, ref) => {
    return (
      <textarea
        className={cn(
          "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Textarea.displayName = "Textarea"

export { Textarea }
</file>

<file path="docs/assessform.md">
[첨부 19] 상담 기록지 (필수양식)
등록번호 : 00-000
상담 기록지
상담일: 0000.00.00. / 상담자:
[대상자 정보]
이 름:
생년월일(나이)/성별: / 남, 여
연락처(e-mail): 본인) / 보호자)
주 소:
주 거 형 태: [ ]단독주택( 층) [ ]다가구주택( 층) [ ]아파트( 층) [ ]기타( )
엘리베이터 [ ]무 [ ]유
장애물( )
경 제 상 황: [ ]기초생활수급자 [ ]차상위 [ ]건강보험
연계가능재원:
[ ]보조기기교부사업 [ ]보장구 건강보험 [ ]보장구 의료급여 [ ]노인장기요양보험
[ ]정보통신보조기기 [ ]고용공단 보조공학기기 [ ]산업재해 재활보조기기지원 [ ]보철구지급사업
[ ]기타( [ ]자동차보험 [ ]민간급여( ) [ ]바우처지원)
장애유형/정도: 장애( [ ]심한 [ ]심하지 않은)
요 양 등 급:
장애발생원인:
장애 발생 시기:
[현재 장애 상태]
신체 (관절가동범위 및 근력 등 체크)
(좌측 L / 우측 R)
어깨관절(L) / (R)
위팔(L) / (R)
팔꿉관절(L) / (R)
아래팔(L) / (R)
손목(L) / (R)
손(L) / (R)
엉덩관절(L) / (R)
넓적다리(L) / (R)
무릎관절(L) / (R)
종아리(L) / (R)
발목(L) / (R)
발(L) / (R)
※제한부위 체크
인지/감각 기능
[ ]언어 [ ]인지 [ ]시각 [ ]청각 [ ]머리 [ ]목 [ ]체간 [ ]척수 손상
[상 담 내 용 및 이용자욕구]
(장애상태 상세, 직업, 가족력, 이력사항, 질병, 약물, 이용서비스 등)
[보유보조기기]
보조기기명(활용여부) / 수급경로(년도)
보조기기명(활용여부) / 수급경로(년도)
[주요 활동 장소]
[ ]집 [ ]학교 [ ]직장 [ ]지역사회 [ ]병원 [ ]기타( )
[활동 / 환경]
활동사항 (학습, 업무, ADL):
활동 시 자세: [ ]누운자세 [ ]앉은자세 [ ]선 자세 [ ]기타
활동 주지원자: [ ]가족 [ ]친구 [ ]간병인 [ ]활동보조인 [ ]기타( )
[환경 제한 사항]
[첨부 20] 보조기기 서비스 진행 기록지 (필수양식)
등록번호 : 00-000
보조기기 서비스 진행 기록지
서비스 연도: 0000
[기본 정보]
담 당 자 명:
서 비 스 영 역 (해당서비스):
최초상담일: /
[지원 구분]
공 적 급 여: [ ]보조기기교부사업 [ ]보장구 (의료급여,건강보험) [ ]복지용구 [ ]장애인고용공단 (보조공학기기) [ ]정보통신보조기기 [ ]산재 [ ]보철구 [ ]그 외( )
민 간 급 여: 사업명 / 지원처
센 터 지 원:
기 타:
[진행 내역]
품목명:
과 정:
[ ]상담·평가 [ ]시험적용 [ ]정보제공 [ ]대여 [ ]교육훈련 [ ]개조제작 [ ]재원확보 [ ]유지관리 [ ]종결 [ ]사후관리 [ ]사례회의
비 고:
(반복 서식 생략 - 동일 양식으로 기록)
[첨부 21] 보조기기 서비스 평가지 (필수양식)
등록번호 : 00-000
보조기기 서비스 평가지
[(WC)휠체어 및 이동]
작성일 : . . . 작성자 :
키 / 몸 무 게:
기 립 성 저 혈 압: [ ]없음 [ ]있음
스 스 로 서 기: [ ]가능 [ ]지지물 도움이 있을 경우 가능 [ ]불가능
자 가 보 행: [ ]가능 [ ]보조인 혹은 보조기기의 도움이 있을 경우 가능 [ ]불가능
옮겨앉기(transfer): [ ]가능 [ ]보조인 혹은 보조기기의 도움이 있을 경우 가능 [ ]불가능
이 동 방 법: [ ]실내( ) / [ ]실외( )
조작능력: [ ]손(왼손, 오른손) [ ]발(왼발, 오른발) [ ]턱 [ ]머리 [ ]호흡 [ ]기타( )
욕창: [ ]이력 없음 [ ]있음(부위 : , 시기 : ) / [ ]현재 없음 [ ]현재 있음(부위 : )
자가추진: [ ]수 동 휠체어 ([ ]가능 [ ]일부 가능 [ ]불가능)
필요기능: [ ]수 동 휠체어 / [ ]전 동 휠체어 / [ ]스쿠터 ([ ]틸팅 [ ]리클라이닝 [ ]엘리베이팅 [ ]레그 엘리베이팅 [ ]스탠딩 [ ]기타)
측 정:
시트깊이(SD):
시트너비(SW):
바닥~시트높이(SH):
팔걸이높이(AH):
발걸이높이(LH):
발판높이(FL):
어깨높이(SDH):
등받이높이(BH):
기 타:
액세서리: [ ]필요( ) [ ]불필요
[ ]보행보조차, 워커: 주된 이동장소 / 지표면 편평도 / 잡는 힘 / 양손 사용 여부
[ ]목 발 , 지 팡 이:
[ ]기 타 보 조 기 기:
기타사항/평가자의견:
추 천 보 조 기 기:
향 후 계 획: [ ]시험적용 [ ]정보제공 [ ]대여 [ ]교육 및 훈련 [ ]개조 [ ]제작 [ ]재원확보 [ ]점검 [ ]세척 [ ]수리 [ ]재사용 [ ]기타
[(ADL)일상생활동작]
작성일 : . . . 작성자 :
등록번호 : 00-000
[ ]몸 치 장 하 기: [ ]자가 수행 가능 [ ]보조기기사용 or 도움으로 수행 가능( ) [ ]완전의존
[ ]식 사 하 기: [ ]자가수행 가능 [ ]보조기기사용 or 도움으로 수행 가능( ) [ ]완전의존
[ ]목 욕 하 기: [ ]자가 수행 가능 [ ]보조기기사용 or 도움으로 수행 가능( ) [ ]완전의존
[ ]옷 입 기: [ ]자가 수행 가능 [ ]보조기기사용 or 도움으로 수행 가능( ) [ ]완전의존
[ ]화장실 이동과 사 용: [ ]자가 수행 가능 [ ]보조기기사용 or 도움으로 수행 가능( ) [ ]완전의존
[ ]대 변 조 절: [ ]자가 수행 가능 [ ]보조기기사용 or 도움으로 수행 가능( ) [ ]완전의존
[ ]소 변 조 절: [ ]자가 수행 가능 [ ]보조기기사용 or 도움으로 수행 가능( ) [ ]완전의존
[ ]욕 창:
욕창: [ ]있음(부위 : ) [ ]없음
발생이력: [ ]있음(부위 : , 시기 : ) [ ]없음
욕창발생징후: [ ]있음 [ ]없음
[ ]욕창예방보조기 기:
유형: [ ]방석 [ ]매트리스
사이즈: 가로( ) × 세로( ) × 높이( )
종류: [ ]공기 [ ]스펀지 [ ]젤 [ ]기타( )
[ ]스마트기기:
보유여부: [ ]보유 [ ]미보유
사용희망여부: [ ]사용희망 [ ]사용계획 없음
사용가능한 대체입력방식: [ ]스틱([ ]입 [ ]손 [ ]머리 [ ]기타 ) [ ]음성 [ ]스위치 [ ]기타
거치대 필요여부: [ ]필요함 [ ]필요하지 않음
기 타 사 항 / 평 가 자 의 견:
추 천 보 조 기 기:
향 후 계 획: [ ]시험적용 [ ]정보제공 [ ]대여 [ ]교육 및 훈련 [ ]개조 [ ]제작 [ ]재원확보 [ ]점검 [ ]세척 [ ]수리 [ ]재사용 [ ]기타
[(S)감각]
작성일 : . . . 작성자 :
등록번호 : 00-000
[시 각]
우측:
시 각 적 결 함: [ ]없음 [ ]저시력([ ]편측 무시 [ ]중복시각 [ ]기타 ) [ ]전맹
시 야 결 함: [ ]없음 [ ]있음
좌측:
시 각 적 결 함: [ ]없음 [ ]저시력([ ]편측 무시 [ ]중복시각 [ ]기타 ) [ ]전맹
시 야 결 함: [ ]없음 [ ]있음
대체가능감각: [ ]시각(확대) [ ]청각 [ ]촉각
선 호 색 상: [ ]없음 [ ]있음 ([ ]파랑/노랑 [ ]흑/백 [ ]기타)
선 호 위 치: [ ]없음 [ ]있음 ([ ]왼쪽 [ ]오른쪽)
조 명 상 태: [ ]영향 없음 [ ]있음
확대 글자 해독: [ ]가능 [ ]불가능 [ ]해당없음
점 자 판 독: [ ]가능 [ ]불가능 [ ]해당없음
데이지플레이어: [ ]사용가능 [ ]사용불가능
컴 퓨 터 사 용: [ ]사용가능 [ ]사용불가능
보 행: [ ]독립보행가능 [ ]의존적보행([ ]흰지팡이 [ ]보호자 [ ]안내견 [ ]기타)
[청 각]
청 각 적 결 함: [ ]없음 [ ]난청(Lt / Rt) [ ]기타( )
청 신 경 손 상: [ ]없음 [ ]있음 [ ]모름 [ ]기타( )
언 어 장 애: [ ]없음 [ ]있음
주된 소통 방법: [ ]구화 [ ]수화 [ ]필담 [ ]기타( )
대체가능감각: [ ]시각 [ ]청각(확대) [ ]촉각 [ ]기타( )
큰 소 리 반 응: [ ]없음 [ ]있음( )
진 동 감 지: [ ]가능 [ ]불가능
보 청 기: [ ]사용 [ ]미사용([ ]불필요 [ ]사용불가(사유: ))
기타사항/평가자의 견:
추천보조기 기:
향후계획: [ ]시험적용 [ ]정보제공 [ ]대여 [ ]교육 및 훈련 [ ]개조 [ ]제작 [ ]재원확보 [ ]점검 [ ]세척 [ ]수리 [ ]재사용 [ ]기타
[(SP)앉기 및 자세]
작성일 : . . . 작성자 :
등록번호 : 00-000
주된활동자세: [ ]앉은 자세 [ ]누운 자세 [ ]선 자세 [ ]기타( )
[자 세 평 가]
골 반 (전/후방 경사 상태, 측방 경사 상태, 전후 회전 상태)
[ ]중립 [ ]후방 [ ]전방 / [ ]중립 [ ]Rt경사 [ ]Lt경사 / [ ]중립 [ ]R전방 [ ]L전방
[ ]구축 [ ]부분구축 [ ]교정가능 (각 항목별 체크)
체 간 (전/후만 상태, 측만 상태, 회전 상태)
[ ]정상 [ ]후만 [ ]전만 / [ ]정상 [ ]R측만 [ ]L측만 / [ ]정상 [ ]R전방 [ ]L전방
[ ]구축 [ ]부분구축 [ ]교정가능 (각 항목별 체크)
엉 덩 관 절 (내/외전 상태, 바람받이변형 상태, 굴곡/신전 상태)
[ ]중립 [ ]외전 [ ]내전 / [ ]중립 [ ]R변형 [ ]L변형 / [ ]굴곡 [ ]중립 [ ]신전
[ ]구축 [ ]부분구축 [ ]교정가능 (각 항목별 체크)
무 릎 관 절 / 발관절 (굴곡/신전 상태, 배굴/저굴 상태)
[ ]굴곡 [ ]중립 [ ]신전 / [ ]저굴 [ ]중립 [ ]배굴
[ ]구축 [ ]부분구축 [ ]교정가능 (각 항목별 체크)
머 리 / 목 (굴곡/신전 상태, 회전 상태, 측면 굴곡 상태)
[ ]굴곡 [ ]중립 [ ]신전 / [ ]중립 [ ]R회전 [ ]L회전 / [ ]중립 [ ]R굴곡 [ ]L굴곡
[ ]구축 [ ]부분구축 [ ]교정가능 (각 항목별 체크)
[신 체 치 수 측 정]
(키(신장): ) (몸무게: )
A 앉은 어깨 높이 / F 가슴 너비
B 앉은 겨드랑이 높이 / G 앉은 오금 높이
C 앉은 엉덩이 오금 수평 길이 / H 슬관절 너비
D 허리 두께 / I 팔꿈치 높이
E 앉은엉덩이너비(양대전자너비) / P 앉은 팔꿈치 높이
카시트 필요 여부: [ ]필요( [ ]ISO FIX [ ]기타 옵션( )) [ ]불필요
기 타 사 항 / 평 가 자 의 견:
추천보조기기:
향 후 계 획: [ ]시험적용 [ ]정보제공 [ ]대여 [ ]교육 및 훈련 [ ]개조 [ ]제작 [ ]재원확보 [ ]점검 [ ]세척 [ ]수리 [ ]재사용 [ ]기타
[(EC)주택 및 환경개조]
작성일 : . . . 작성자 :
등록번호 : 00-000
주 거 형 태: [ ]아파트( 층) [ ]단독주택( 층) [ ]연립( 층) [ ]오피스텔( 층) [ ]기타( )
주 택 소 유 형 태: [ ]자가 [ ]전세 [ ]월세 [ ]영구임대 [ ]기타
개 조 여 부: [ ]개조하지 않음 [ ]개조함 (상세내용 : )
단 차 해 소: [ ]필요(위치 , 높이 , 너비 ) [ ]불필요
[환경개조 필요영역]
매개시설: [ ]외부접근로 [ ]주차구역 [ ]출입구
내부시설: [ ]출입문 [ ]복도 [ ]계단 [ ]경사로 [ ]승강기
위생시설: [ ]화장실 접근 [ ]대소변기 [ ]세면대 [ ]욕실
기 타:
개 조 가 능 여 부: [ ]가능 [ ]불가능(사유 : )
[IoT 평 가]
제어희망 장 비: [ ]전등 [ ]창문 [ ]TV [ ]가스벨브 [ ]현관문 [ ]보일러 [ ]초인종 [ ]기타( )
대체입력 수 단: [ ]스마트폰 [ ]스위치 [ ]음성 [ ]기타
기 타 사 항 / 평 가 자 의 견:
추 천 보 조 기 기:
향 후 계 획: [ ]시험적용 [ ]정보제공 [ ]대여 [ ]교육 및 훈련 [ ]개조 [ ]제작 [ ]재원확보 [ ]점검 [ ]세척 [ ]수리 [ ]재사용 [ ]기타
[(CA)컴퓨터접근]
작성일 : . . . 작성자 :
등록번호 : 00-000
컴 퓨 터 소 유: [ ]있음([ ]노트북 [ ]데스크탑) [ ]없음
컴 퓨 터 사 용 경 험: [ ]있음 [ ]없음
현 재 컴 퓨 터 사 용 자 세: [ ]앉은 자세 [ ]바로 누운 자세 [ ]옆으로 누운 자세 [ ]기타
원하는 컴퓨터 사 용 자 세: [ ]앉은 자세 [ ]바로 누운 자세 [ ]옆으로 누운 자세 [ ]기타
일반마우스사용: [ ]사용 가능 [ ]보조 도구와 함께 혹은 개조하여 사용 [ ]사용 불가능
일반키보드사용: [ ]사용 가능 [ ]보조 도구와 함께 혹은 개조하여 사용 [ ]사용 불가능
컴 퓨 터 사 용 에 적 합 한 신 체 부 위:
[ ]눈 [ ]머리 [ ]입술 [ ]왼팔 [ ]오른팔 [ ]손(왼손/오른손/양손)
[ ]손가락([ ]왼손/[ ]오른손/[ ]양손) [ ]왼발/다리 [ ]오른발/다리 [ ]기타( )
필 요 사 항: [ ]단어 예측 [ ]마운팅 [ ]키가드 [ ]고정키 [ ]마우스 속도 조절 [ ]기타( )
기 타 사 항 / 평 가 자 의 견:
추 천 보 조 기 기:
향 후 계 획: [ ]시험적용 [ ]정보제공 [ ]대여 [ ]교육 및 훈련 [ ]개조 [ ]제작 [ ]재원확보 [ ]점검 [ ]세척 [ ]수리 [ ]재사용 [ ]기타
[(L)레저]
작성일 : . . . 작성자 :
등록번호 : 00-000
사 용 환 경: [ ]실내( ) [ ]실외([ ]산 [ ]바다 [ ]강 [ ]기타( ))
[근 골 격 계]
자 세 의 정 렬: [ ]대칭 [ ]비대칭
기능적 각도 유지: [ ]가능( ) [ ]일부가능( ) [ ]불가능( )
전 방 미 끄 러 짐: [ ]없음 [ ]있음
척 추 의 변 형: [ ]해당 없음 [ ]전만( °) [ ]측만( °) [ ]후만( °)
관 절 구 축: [ ]해당 없음 [ ]있음(부위 : )
견 관 절: [ ]해당 없음 [ ]탈구(Lt / Rt) [ ]아탈구(Lt / Rt)
고 관 절: [ ]해당 없음 [ ]탈구(Lt / Rt) [ ]아탈구(Lt / Rt)
독립적 체위 변환: [ ]가능 [ ]불가능
착 석:
균 형 유 지: [ ]가능 [ ]보조기기 있을 경우 가능 [ ]불가능
지 지 필 요: [ ]필요 [ ]보조기기 있을 경우 가능 [ ]불필요
[ ]인지적결함: [ ]없음 [ ]있음([ ]입체감각 [ ]도서감각 [ ]실행 [ ]시지각 [ ]신체상 [ ]기타)
[ ]운동및훈련: [ ]상하지운동 [ ]스트레칭 [ ]밸런스유지 [ ]기타
기 타 사 항 / 평 가 자 의 견:
추천보조기기:
향 후 계 획: [ ]시험적용 [ ]정보제공 [ ]대여 [ ]교육 및 훈련 [ ]개조 [ ]제작 [ ]재원확보 [ ]점검 [ ]세척 [ ]수리 [ ]재사용 [ ]기타
[(AAC) 보완대체의사소통]
작성일 : . . . 작성자 :
등록번호 : 00-000
[ ]타기관검사결과: [ ]없음 [ ]있음(표현 언어 : 세, 수용 언어 : 세)
발 성 / 발 화: 발성([ ]유 [ ]무) 발화([ ]유 [ ]무)
대 체 수 단: [ ]구어 [ ]수화 [ ]필담 [ ]제스처 [ ]스마트기기 [ ]기타( )
[의사소통]
인사하기, 관심표현, 주의끌기, 물건 및 행동요구, 부정하기 중 3가지 이상에서 표현하는 방법:
[ ]구어표현이 어려움
[ ]표정이나 제스처, 제한된발성(웃음, 울음소리 등)으로 표현
[ ]한 낱말 수준으로 대답
[ ]2~3개의 단어 조합, 짧은 구, 전보식 문장 수준의 발화
[ ]완벽한 문장
질문 및 예측하기, 명료화요청, 선택하기, 감정 및 상태표현 중 3가지 이상에서 표현하는 방법:
[ ]구어표현이 어려움
[ ]표정이나 제스처, 제한된발성(웃음, 울음소리 등)으로 표현
[ ]한 낱말 수준으로 대답
[ ]2~3개의 단어 조합, 짧은 구, 전보식 문장 수준의 발화
[ ]완벽한 문장
말 명 료 도:
(가까운 사람): [ ]모두 이해가능 [ ]대부분 이해가능 [ ]일부 이해가능 [ ]대부분 이해불가능 [ ]전혀 이해불가능
(낯 선 사 람): [ ]모두 이해가능 [ ]대부분 이해가능 [ ]일부 이해가능 [ ]대부분 이해불가능 [ ]전혀 이해불가능
청 각 적 이 해 력:
[ ]간단한 지시나 예/아니오 질문에 반응하지 못함
[ ]간단한 지시나 예/아니오 질문에 반응할 수 있으며, 제스처가 함께 제시되면 일부 대화가 가능함
[ ]친숙하고 반복되는 일상적 상황에서 일부 대화가 가능함
[ ]일상적 상황에서 대화가 가능하며, 억양이나 제스처를 이해함
[ ]은유적 표현도 이해할 수 있으며, 짧은 이야기를 듣고 이해할 수 있음
상 징 화: [ ]인지하지 못함 [ ]실물 또는 모형 [ ]사진 [ ]그림 [ ]글자
[언어훈련]
철자법 및 문해력:
[ ]전혀 못함
[ ]통글자, 통문장 형태로만 읽을 수 있음
[ ]통글자, 통문장 형태로만 만들고 읽을 수 있음
[ ]간단한 단어와 일부 문장만 만들고 읽을 수 있음
[ ]단어 및 문장을 만들고 읽을 수 있음
학 습 인 지 (반복적교육통한 기능학습가능여부):
[ ]전혀 불가능
[ ]친숙하고 반복되는 일상적 상황에서 일부 상징이나 기능 교육 가능함
[ ]치료실 또는 학교의 구조화된 상황에서 반복통한 학습 가능
[ ]다양한 상황에서 반복학습 가능함
[ ]학습 통하여 다양하게 응용하여 사용할 수 있음
AAC사용에 적합한 신 체 부 위:
[ ]눈 [ ]머리 [ ]왼팔 [ ]오른팔 [ ]손(왼손/오른손/양손)
[ ]손가락([ ]왼손 [ ]오른손 [ ]양손) [ ]왼발/다리 [ ]오른발/다리 [ ]기타( )
선택방법:
직접선택: [ ]터치 [ ]포인팅 [ ]마우스 [ ]눈 응시 [ ]기타( )
간접선택: [ ]스캐닝 ([ ]유 [ ]무) [ ]사용가능한 스위치([ ]유( ) [ ]무)
심 볼 유 형: [ ]사진 [ ]그림 [ ]글자판 [ ]단어 [ ]기타( )
기 타 필 요 사 항: [ ]단어예측 [ ]마운팅 [ ]키가드 [ ]기타( )
별 도 단 말 기: [ ]사용 [ ]미사용([ ]스마트기기사용 [ ]기타( ))
기타사항/평가자의견:
추 천 보 조 기 기:
향 후 계 획: [ ]시험적용 [ ]정보제공 [ ]대여 [ ]교육 및 훈련 [ ]개조 [ ]제작 [ ]재원확보 [ ]점검 [ ]세척 [ ]수리 [ ]재사용 [ ]기타
[(AM)자동차개조]
작성일 : . . . 작성자 :
등록번호 : 00-000
현 재 소 유 차 량: [ ]차종 ( )
[기본정보]
운 전 면 허 증: [ ]1종보통 [ ]2종보통 [ ]갱신예정 [ ]없음(취소) [ ]기타 ( )
운 전 경 력: [ ]장애 전 ( )년 [ ]장애 후 ( )년 [ ]없음
운 전 교 육: [ ]운전기능과정 [ ]도로주행과정 [ ]중도장애적응 [ ]기타( )
자 동 차: [ ]승용 [ ]승합 [ ]화물 [ ]구입예정 [ ]기타( )
[보조기기 필요 여부]
열 쇠 로 문 여 닫 기: [ ]필요 ( ) [ ]불필요
열쇠로 시동 ON/OFF: [ ]필요 ( ) [ ]불필요
타고내리기(좌석이동): [ ]필요 ( ) [ ]불필요
올 바 른 자 세 유 지: [ ]필요 ( ) [ ]불필요
안 전 벨 트 사 용 하 기: [ ]필요 ( ) [ ]불필요
핸 들 사 용: [ ]필요 ( ) [ ]불필요
기 어 사 용: [ ]필요 ( ) [ ]불필요
브 레 이 크 사 용: [ ]필요 ( ) [ ]불필요
주 차 브 레 이 크 사 용: [ ]필요 ( ) [ ]불필요
엑 셀 레 이 터 사 용: [ ]필요 ( ) [ ]불필요
차량 내부 각종스위치: [ ]필요 ( ) [ ]불필요
탑 재 (차량에 휠체어/스쿠터 등): [ ]필요 ( ) [ ]불필요
차 량 내 진 입 (휠 체 어 탑 승 상 태): [ ]필요 ( ) [ ]불필요
경 직 및 강 직: [ ]필요 ( ) [ ]불필요
기 타 사 항 / 평 가 자 의 견:
추 천 보 조 기 기:
향 후 계 획: [ ]시험적용 [ ]정보제공 [ ]대여 [ ]교육 및 훈련 [ ]개조 [ ]제작 [ ]재원확보 [ ]점검 [ ]세척 [ ]수리 [ ]재사용 [ ]기타
</file>

<file path="docs/client_secret_1077314230614-i4309irh0f5khian21djrpt21aoh08g7.apps.googleusercontent.com.json">
{"web":{"client_id":"1077314230614-i4309irh0f5khian21djrpt21aoh08g7.apps.googleusercontent.com","project_id":"gen-lang-client-0551149229","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs","client_secret":"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"}}
</file>

<file path="docs/counsilform.md">
[첨부 19] 상담 기록지 (필수양식)
등록번호 : 00-000
상담 기록지
상담일: 0000.00.00. / 상담자:
[대상자 정보]
이 름:
생년월일(나이)/성별: / 남, 여
연락처(e-mail): 본인) / 보호자)
주 소:
주 거 형 태: [ ]단독주택( 층) [ ]다가구주택( 층) [ ]아파트( 층) [ ]기타( )
엘리베이터 [ ]무 [ ]유
장애물( )
경 제 상 황: [ ]기초생활수급자 [ ]차상위 [ ]건강보험
연계가능재원:
[ ]보조기기교부사업 [ ]보장구 건강보험 [ ]보장구 의료급여 [ ]노인장기요양보험
[ ]정보통신보조기기 [ ]고용공단 보조공학기기 [ ]산업재해 재활보조기기지원 [ ]보철구지급사업
[ ]기타( [ ]자동차보험 [ ]민간급여( ) [ ]바우처지원)
장애유형/정도: 장애( [ ]심한 [ ]심하지 않은)
요 양 등 급:
장애발생원인:
장애 발생 시기:
[현재 장애 상태]
신체 (관절가동범위 및 근력 등 체크)
(좌측 L / 우측 R)
어깨관절(L) / (R)
위팔(L) / (R)
팔꿉관절(L) / (R)
아래팔(L) / (R)
손목(L) / (R)
손(L) / (R)
엉덩관절(L) / (R)
넓적다리(L) / (R)
무릎관절(L) / (R)
종아리(L) / (R)
발목(L) / (R)
발(L) / (R)
※제한부위 체크
인지/감각 기능
[ ]언어 [ ]인지 [ ]시각 [ ]청각 [ ]머리 [ ]목 [ ]체간 [ ]척수 손상
[상 담 내 용 및 이용자욕구]
(장애상태 상세, 직업, 가족력, 이력사항, 질병, 약물, 이용서비스 등)
[보유보조기기]
보조기기명(활용여부) / 수급경로(년도)
보조기기명(활용여부) / 수급경로(년도)
[주요 활동 장소]
[ ]집 [ ]학교 [ ]직장 [ ]지역사회 [ ]병원 [ ]기타( )
[활동 / 환경]
활동사항 (학습, 업무, ADL):
활동 시 자세: [ ]누운자세 [ ]앉은자세 [ ]선 자세 [ ]기타
활동 주지원자: [ ]가족 [ ]친구 [ ]간병인 [ ]활동보조인 [ ]기타( )
[환경 제한 사항]
</file>

<file path="docs/DB_SCHEMA_ANALYSIS.md">
# 📊 데이터베이스 스키마 분석 보고서

> **분석 일시**: 2025. 12. 06  
> **Supabase Project**: uyjbndiwyddjyjkdfuyi  
> **분석 방법**: Supabase MCP를 통한 실제 스키마 조회

---

## ✅ 실제 데이터베이스 상태 (Supabase MCP 확인 결과)

### 🎉 좋은 소식: 이미 개선되어 있습니다!

실제 데이터베이스는 `co-AT.sql` 파일보다 **훨씬 개선된 상태**입니다.

---

## 📋 테이블별 상세 비교

### 1. **profiles** 테이블

#### ✅ 실제 DB (개선됨)
- `clerk_user_id`: **UNIQUE 제약조건 추가됨** ✅
- `role`: CHECK 제약조건 (`'user' | 'staff' | 'manager'`)
- `updated_at`: **추가됨** ✅ (기본값: `now()`)
- `created_at`: 기본값 `now()` 설정됨

#### ❌ co-AT.sql (구버전)
- `clerk_user_id`: UNIQUE 없음
- `updated_at`: 없음

---

### 2. **clients** 테이블

#### ✅ 실제 DB (개선됨)
- `gender`: CHECK 제약조건 (`'남' | '여'`)
- `has_elevator`: 기본값 `false` 설정됨
- `updated_at`: **추가됨** ✅ (기본값: `now()`)
- `created_at`: 기본값 `now()` 설정됨

#### ❌ co-AT.sql (구버전)
- `gender`: CHECK 제약조건 없음
- `has_elevator`: 기본값 없음
- `updated_at`: 없음

---

### 3. **inventory** 테이블

#### ✅ 실제 DB (개선됨)
- `status`: CHECK 제약조건 (`'보관' | '대여중' | '수리중' | '소독중' | '폐기'`)
- `updated_at`: **추가됨** ✅ (기본값: `now()`)
- `created_at`: 기본값 `now()` 설정됨

#### ❌ co-AT.sql (구버전)
- `status`: CHECK 제약조건 없음
- `updated_at`: 없음

---

### 4. **applications** 테이블 ⭐ 중요

#### ✅ 실제 DB (완전히 개선됨!)
- `client_id`: **올바른 Foreign Key로 설정됨** ✅
- `id2` 컬럼: **제거됨** ✅ (이미 정리 완료)
- `status`: CHECK 제약조건 (`'접수' | '배정' | '진행' | '완료' | '반려'`)
- `updated_at`: **추가됨** ✅ (기본값: `now()`)
- `created_at`: 기본값 `now()` 설정됨

#### ❌ co-AT.sql (구버전)
- `client_id`와 `id2` 중복 존재
- `id2`가 실제 FK로 사용됨
- `updated_at`: 없음

---

### 5. **intake_records** 테이블 ⭐ 중요

#### ✅ 실제 DB (완전히 개선됨!)
- `application_id`: **올바른 Foreign Key로 설정됨** ✅
- `id2` 컬럼: **제거됨** ✅ (이미 정리 완료)
- `consult_date`: 기본값 `CURRENT_DATE` 설정됨
- `cognitive_sensory_check`: **ARRAY 타입으로 변경됨** ✅ (`text[]`)
- `updated_at`: **추가됨** ✅ (기본값: `now()`)
- `created_at`: 기본값 `now()` 설정됨

#### ❌ co-AT.sql (구버전)
- `application_id`와 `id2` 중복 존재
- `id2`가 실제 FK로 사용됨
- `cognitive_sensory_check`: `text` 타입
- `updated_at`: 없음

---

### 6. **process_logs** 테이블 ⭐ 중요

#### ✅ 실제 DB (완전히 개선됨!)
- `application_id`: **올바른 Foreign Key로 설정됨** ✅
- `staff_id`: **올바른 Foreign Key로 설정됨** ✅
- `id2`, `id3` 컬럼: **제거됨** ✅ (이미 정리 완료)
- `log_date`: 기본값 `CURRENT_DATE` 설정됨
- `updated_at`: **추가됨** ✅ (기본값: `now()`)
- `created_at`: 기본값 `now()` 설정됨

#### ❌ co-AT.sql (구버전)
- `application_id`, `staff_id`와 `id2`, `id3` 중복 존재
- `id2`, `id3`가 실제 FK로 사용됨
- `updated_at`: 없음

---

### 7. **domain_assessments** 테이블 ⭐ 중요

#### ✅ 실제 DB (완전히 개선됨!)
- `application_id`: **올바른 Foreign Key로 설정됨** ✅
- `evaluator_id`: **올바른 Foreign Key로 설정됨** ✅
- `id2`, `id3` 컬럼: **제거됨** ✅ (이미 정리 완료)
- `evaluation_date`: 기본값 `CURRENT_DATE` 설정됨
- `updated_at`: **추가됨** ✅ (기본값: `now()`)
- `created_at`: 기본값 `now()` 설정됨

#### ❌ co-AT.sql (구버전)
- `application_id`, `evaluator_id`와 `id2`, `id3` 중복 존재
- `id2`, `id3`가 실제 FK로 사용됨
- `updated_at`: 없음

---

## 📊 개선 사항 요약

### ✅ 이미 완료된 개선 사항

1. **Foreign Key 컬럼명 정리** ✅
   - `applications.id2` → `applications.client_id` ✅
   - `intake_records.id2` → `intake_records.application_id` ✅
   - `process_logs.id2` → `process_logs.application_id` ✅
   - `process_logs.id3` → `process_logs.staff_id` ✅
   - `domain_assessments.id2` → `domain_assessments.application_id` ✅
   - `domain_assessments.id3` → `domain_assessments.evaluator_id` ✅

2. **타임스탬프 필드 추가** ✅
   - 모든 테이블에 `updated_at` 필드 추가됨
   - `created_at`에 기본값 `now()` 설정됨

3. **데이터 무결성 강화** ✅
   - CHECK 제약조건 추가 (gender, role, status)
   - UNIQUE 제약조건 추가 (clerk_user_id)
   - 기본값 설정 개선

4. **타입 개선** ✅
   - `cognitive_sensory_check`: `text` → `text[]` (ARRAY)

---

## ⚠️ 아직 필요한 개선 사항

### 🔴 긴급 (TODO.md에 명시된 항목)

1. **applications 테이블 필드 추가**
   - [ ] `category` 필드: `'consult' | 'experience' | 'custom' | 'aftercare' | 'education'`
   - [ ] `sub_category` 필드: `'repair' | 'rental' | 'custom_make' | 'visit' | 'exhibition'` 등
   - [ ] `desired_date` 필드: `date` 타입
   - [ ] `assigned_staff_id` 필드: `uuid` (FK → profiles.id)

2. **inventory 테이블 필드 추가**
   - [ ] `is_rental_available` 필드: `boolean` (default `true`)
   - [ ] `purchase_date` 필드: `date`
   - [ ] `purchase_price` 필드: `numeric`
   - [ ] `manufacturer` 필드: `text`
   - [ ] `model` 필드: `text`
   - [ ] `qr_code` 필드: `text`

3. **새 테이블 생성**
   - [ ] `service_logs` 테이블 (SOAP 노트, 수리비, 이미지 저장용)
   - [ ] `schedules` 테이블 (일정 관리)
   - [ ] `notices` 테이블 (공지사항)
   - [ ] `rentals` 테이블 (대여 관리)

---

## 🔍 RLS (Row Level Security) 상태

**현재 상태**: 모든 테이블에서 RLS가 **비활성화**되어 있습니다.

```
rls_enabled: false (모든 테이블)
```

⚠️ **보안 주의**: 프로덕션 배포 전에 반드시 RLS 정책을 설정해야 합니다.

---

## 📝 권장 사항

### 1. co-AT.sql 파일 업데이트
현재 `co-AT.sql` 파일이 실제 데이터베이스와 불일치하므로, 실제 스키마를 기반으로 업데이트가 필요합니다.

### 2. 타입 생성
다음 명령어로 최신 타입을 생성하세요:
```bash
npm run gen:types
```

### 3. RLS 정책 설정
보안을 위해 RLS 정책을 작성하고 활성화해야 합니다.

---

## ✅ 결론

**실제 데이터베이스는 이미 대부분의 개선 사항이 완료된 상태입니다!**

- Foreign Key 컬럼명 정리: ✅ 완료
- 타임스탬프 필드 추가: ✅ 완료
- 데이터 무결성 강화: ✅ 완료

**남은 작업**: 
- 추가 필드 및 테이블 생성 (TODO.md Phase 1.3 참조)
- RLS 정책 설정

---

**마지막 업데이트**: 2025. 12. 06
</file>

<file path="docs/DIR.md">
📂 Project Co-AT: Directory Structure (DIR.md)
프로젝트: GWATC 통합 케어 플랫폼
원칙: 기능 중심(Feature-First) 설계 & 관심사 분리(Separation of Concerns)
설명: 유지보수와 협업을 위한 폴더 구조 및 파일 배치 가이드
1. ⚙️ Root Configuration (최상위 설정)
프로젝트의 환경 설정 및 린트, 빌드 설정을 담당합니다.
code
Text
co-at/
├── .env.local                  # [보안] 환경 변수 (API Keys, Secrets) - 절대 커밋 금지
├── .eslintrc.json              # Lint 설정
├── .gitignore                  # Git 제외 목록
├── .cursorrules                # Cursor AI 행동 지침
├── components.json             # shadcn/ui 설정 파일
├── middleware.ts               # [핵심] Next.js 미들웨어 (Clerk 인증 & 라우팅 보호)
├── next.config.mjs             # Next.js 빌드 설정
├── package.json                # 의존성 관리
├── postcss.config.mjs          # CSS 전처리
├── tailwind.config.ts          # Tailwind 테마 및 색상 설정
├── tsconfig.json               # TypeScript 설정
└── README.md                   # 프로젝트 설명서
2. 📱 App Directory (/app) - 라우팅 및 페이지
URL 경로와 직접 매핑되는 폴더입니다. Route Groups () 를 사용하여 권한별 레이아웃을 분리했습니다.
code
Text
app/
├── favicon.ico                 # 파비콘
├── globals.css                 # 전역 스타일 (Tailwind imports)
├── layout.tsx                  # [Root] 최상위 레이아웃 (Providers, Fonts)
│
├── (auth)/                     # [인증] 로그인 관련 (헤더/푸터 없음)
│   ├── sign-in/[[...sign-in]]/ # Clerk 로그인 페이지
│   │   └── page.tsx
│   └── sign-up/[[...sign-up]]/ # Clerk 회원가입 페이지
│       └── page.tsx
│
├── (public)/                   # [대민] 누구나 접근 가능
│   ├── layout.tsx              # Public Header/Footer 적용
│   ├── page.tsx                # [메인] 랜딩 페이지
│   ├── notices/                # 공지사항
│   │   ├── page.tsx            # 목록
│   │   └── [id]/page.tsx       # 상세
│   └── gallery/                # 보조기기 영상 갤러리
│       └── page.tsx
│
├── (portal)/                   # [유저] 로그인한 일반 사용자 전용
│   ├── layout.tsx              # Portal 전용 레이아웃 (Mobile Nav)
│   ├── apply/                  # 통합 서비스 신청 마법사
│   │   └── page.tsx
│   └── mypage/                 # 마이페이지 (타임라인)
│       └── page.tsx
│
├── (admin)/                    # [직원] 센터 직원 전용 (Side Nav)
│   ├── layout.tsx              # Admin Layout (Sidebar, Role Check)
│   ├── dashboard/              # 통합 대시보드
│   │   └── page.tsx
│   ├── clients/                # 대상자 CRM
│   │   ├── page.tsx            # 검색 및 리스트
│   │   └── [id]/page.tsx       # 상세 정보 및 탭 뷰
│   ├── inventory/              # 재고 관리
│   │   └── page.tsx
│   ├── schedule/               # 일정 캘린더
│   │   └── page.tsx
│   └── settings/               # 시스템 설정
│       └── page.tsx
│
└── api/                        # [Backend] Route Handlers
    ├── webhooks/               # 외부 연동
    │   └── clerk/route.ts      # Clerk 유저 생성 -> Supabase 동기화
    └── chat/                   # (Optional) AI 스트리밍용 API
        └── route.ts
3. 🧩 Components Directory (/components) - UI 블록
재사용성과 기능별 응집도를 고려하여 폴더를 구분합니다.
3.1. Primitives & Layout
code
Text
components/
├── ui/                         # [Atom] shadcn/ui 컴포넌트 (자동생성)
│   ├── button.tsx
│   ├── card.tsx
│   ├── input.tsx
│   ├── calendar.tsx
│   └── ...
│
├── common/                     # [Shared] 전역 공통 컴포넌트
│   ├── logo.tsx                # GATC 로고
│   ├── loading-spinner.tsx     # 로딩 UI
│   ├── status-badge.tsx        # 상태값 뱃지 (접수/완료 등)
│   └── file-uploader.tsx       # 이미지 업로드 Dropzone
│
└── layout/                     # [Structure] 레이아웃 컴포넌트
    ├── public-header.tsx       # 대민용 GNB
    ├── public-footer.tsx       # 대민용 푸터
    ├── admin-sidebar.tsx       # 관리자 사이드바
    └── mobile-bottom-nav.tsx   # 모바일 하단 탭
3.2. Features (핵심 도메인별 컴포넌트)
여기가 가장 중요합니다. 기능별로 컴포넌트를 모아두어 유지보수를 쉽게 합니다.
code
Text
components/features/
├── auth/                       # 인증 관련
│   └── user-sync-listener.tsx  # 로그인 시 DB 동기화 트리거
│
├── landing/                    # 랜딩 페이지 컴포넌트
│   ├── HomeHeroSection.tsx     # 메인 비주얼 및 슬로건
│   ├── HomeQuickMenuGrid.tsx  # 5대 사업 바로가기 그리드
│   ├── HomeNoticeTabs.tsx     # 공지사항/지원사업 탭
│   ├── HomeGallerySlider.tsx  # 보조기기 유튜브 영상 갤러리
│   └── HomePublicCalendar.tsx # 공개 캘린더 (견학/교육 일정)
│
├── application/                # 서비스 신청 관련
│   ├── wizard-step-nav.tsx     # 단계 표시기 (Step 1-2-3)
│   ├── category-grid.tsx       # 5대 사업 선택 그리드
│   ├── forms/                  # 신청 폼 모음
│   │   ├── repair-form.tsx     # 수리 신청 폼
│   │   └── rental-form.tsx     # 대여 신청 폼
│   └── success-modal.tsx       # 신청 완료 모달
│
├── dashboard/                  # 대시보드 위젯
│   ├── kpi-stats-card.tsx      # 실적 요약 카드
│   ├── today-schedule.tsx      # 오늘의 일정
│   └── recent-requests.tsx     # 신규 접수 목록
│
├── crm/                        # 대상자 관리
│   ├── client-table.tsx        # 대상자 목록 (검색/필터)
│   ├── client-profile.tsx      # 상세 프로필 카드
│   └── service-history.tsx     # 서비스 이용 이력 타임라인
│
├── inventory/                  # 재고 관리
│   ├── inventory-list.tsx      # 기기 목록
│   ├── status-toggle.tsx       # 대여/보관 상태 변경
│   └── qr-code-gen.tsx         # QR 코드 생성기
│
└── soap-note/                  # [AI] 상담 일지
    ├── audio-recorder.tsx      # 음성 녹음기
    ├── note-editor.tsx         # SOAP 텍스트 에디터
    └── ai-generate-button.tsx  # Gemini 호출 버튼
4. 🧠 Logic Layer (/lib, /actions, /hooks)
비즈니스 로직과 데이터 통신을 담당하는 계층입니다.
code
Text
lib/                            # [Utils] 설정 및 헬퍼 함수
├── supabase/
│   ├── client.ts               # Client Component용
│   └── server.ts               # Server Component용 (Cookie)
├── gemini/
│   └── client.ts               # Google AI Studio 설정
├── utils.ts                    # cn(), formatters (날짜, 통화)
└── validators.ts               # Zod 스키마 정의 (모든 폼 검증 로직)

actions/                        # [Server Actions] 백엔드 로직 ('use server')
├── auth-actions.ts             # 유저 권한 체크
├── application-actions.ts      # 신청서 접수 (Insert)
├── client-actions.ts           # 대상자 CRUD
├── inventory-actions.ts        # 재고 상태 변경
├── schedule-actions.ts         # 일정 등록
└── ai-actions.ts               # [핵심] Gemini API 호출 (SOAP 변환)

hooks/                          # [Custom Hooks] 클라이언트 로직 재사용
├── use-sidebar.ts              # 사이드바 상태 (Zustand)
├── use-wizard-store.ts         # 신청 마법사 상태 (Zustand)
├── use-current-user.ts         # 현재 로그인 유저 정보
└── use-inventory-filter.ts     # 재고 필터링 로직
5. 📦 Types & Assets (/types, /public)
code
Text
types/                          # [TypeScript] 전역 타입 정의
├── database.types.ts           # Supabase 자동 생성 타입 (Source of Truth)
├── index.ts                    # 공통 인터페이스 (Role, Menu)
└── soap.ts                     # SOAP 노트 JSON 구조체

public/                         # [Static Assets] 정적 파일
├── images/                     # 이미지 리소스
│   ├── hero-bg.jpg
│   └── logos/
└── icons/                      # 커스텀 SVG 아이콘
🗺️ 내비게이션 가이드 (Where to find?)
수정하고 싶은 기능이 있을 때, 어디를 봐야 할까요?
수정할 내용	찾아갈 경로
메뉴/헤더 디자인 수정	components/layout/
신청 폼 항목 추가/삭제	components/features/application/forms/ + lib/validators.ts
AI 상담 일지 프롬프트 수정	actions/ai-actions.ts
DB 테이블 타입 변경	npm run gen:types 실행 (자동 업데이트)
색상/테마 변경	app/globals.css 또는 tailwind.config.ts
권한/로그인 로직 수정	middleware.ts
</file>

<file path="docs/Mermaid.md">
📊 Project Co-AT: Visual Documentation (Mermaid.md)
프로젝트: GWATC 통합 케어 플랫폼 (Co-AT)
버전: 3.0 (Architecture Locked)
설명: 시스템 아키텍처, 데이터베이스 모델링, 핵심 로직 시각화
작성일: 2025. 12. 06.
1. 🏗️ 시스템 아키텍처 (System Architecture)
Next.js 15 App Router와 Vercel 인프라 위에서 Clerk(인증), Supabase(데이터), Gemini(AI)가 어떻게 상호작용하는지 보여줍니다.
code
Mermaid
graph TD
    %% 스타일 정의
    classDef frontend fill:#e1f5fe,stroke:#01579b,stroke-width:2px;
    classDef backend fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px;
    classDef ai fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px;
    classDef auth fill:#fff3e0,stroke:#e65100,stroke-width:2px;

    User([사용자 / 직원]) -->|HTTPS| Edge[Vercel Edge Network]
    
    subgraph Frontend_Layer [Next.js 15 App Router]
        Edge -->|Auth Check| Middleware
        Middleware -->|RSC Payload| Page[Server Component]
        Middleware -->|Interact| Client[Client Component]
        Client -->|Mutation| Action[Server Actions]
    end

    subgraph Auth_Service [Authentication]
        Clerk[Clerk Auth]
    end
    
    subgraph Backend_Layer [Supabase BaaS]
        DB[(PostgreSQL)]
        Realtime(Realtime Channel)
        Bucket(Storage: Images)
        Vector(pgvector: RAG)
    end

    subgraph AI_Service [Google Cloud]
        Gemini[Gemini 1.5 Flash]
    end

    %% 데이터 흐름
    Middleware -.->|Validate Session| Clerk
    Action -->|Direct SQL| DB
    Action -->|Upload File| Bucket
    Action -->|Generate Content| Gemini
    Gemini -->|JSON Output| Action
    DB -->|State Change| Realtime
    Realtime -.->|Sync| Client

    %% 클래스 적용
    class Edge,Middleware,Page,Client,Action frontend;
    class DB,Realtime,Bucket,Vector backend;
    class Gemini ai;
    class Clerk auth;
2. 🗄️ 데이터베이스 관계도 (ERD)
Clerk User ID를 중심으로 5대 핵심 사업 데이터가 어떻게 연결되는지 정의합니다.
code
Mermaid
erDiagram
    %% 사용자 프로필 (Clerk Mirror)
    PROFILES {
        uuid id PK "Supabase UUID"
        text clerk_user_id UK "CLERK USER ID (Link)"
        text role "user | staff | manager"
        text full_name
        text team "소속 팀"
    }

    %% 재고/자산 (Inventory)
    INVENTORY {
        uuid id PK
        text name "기기명"
        text asset_code "자산번호"
        text status "보관 | 대여중 | 수리중"
        boolean is_rental_available
    }

    %% 통합 신청서 (Center of 5 Business)
    APPLICATIONS {
        uuid id PK
        uuid applicant_id FK "신청자"
        text category "상담|체험|맞춤|사후|교육"
        text sub_category "대여|수리|견학..."
        text status "접수|배정|진행|완료"
        date desired_date
    }

    %% 서비스 로그 (Result Data)
    SERVICE_LOGS {
        uuid id PK
        uuid application_id FK
        uuid staff_id FK
        uuid inventory_id FK "관련 기기"
        jsonb soap_note "AI 상담 데이터"
        integer cost_total "수리/제작비"
        text[] images
    }

    %% 관계선
    PROFILES ||--o{ APPLICATIONS : "requests"
    PROFILES ||--o{ SERVICE_LOGS : "writes (Staff)"
    
    INVENTORY ||--o{ SERVICE_LOGS : "used in"
    
    APPLICATIONS ||--|| SERVICE_LOGS : "results in"
3. 🔄 서비스 신청 및 처리 생명주기 (Lifecycle)
5대 사업 신청서가 접수되어 완료되기까지의 상태 변화 로직입니다.
code
Mermaid
stateDiagram-v2
    [*] --> 접수됨: 온라인 신청 (User)
    
    state "검토 및 배정" as Review {
        접수됨 --> 배정완료: 담당자 지정
        접수됨 --> 반려: 부적격/재고없음
    }

    배정완료 --> 진행중: 방문/내방/서비스 시작

    state "서비스 수행 (5대 사업)" as Processing {
        진행중 --> AI일지작성: 상담/평가
        진행중 --> 재고출고: 대여 서비스
        진행중 --> 수리_제작: 사후관리/맞춤형
    }

    state "비즈니스 로직 체크" as Logic {
        수리_제작 --> 한도초과: 연 10만원/2회 초과 시
        한도초과 --> 수리_제작: 자부담 안내 후 진행
    }

    Processing --> 완료: 결과 보고서 작성
    완료 --> [*]
    반려 --> [*]
4. 🧠 AI SOAP 노트 생성 시퀀스 (AI Sequence)
현장 직원이 모바일로 상담 내용을 입력하고 AI가 정제하는 과정입니다.
code
Mermaid
sequenceDiagram
    autonumber
    actor Staff as 직원 (Mobile)
    participant UI as SoapNoteEditor
    participant Action as Server Action
    participant Gemini as Google Gemini
    participant DB as Supabase

    Staff->>UI: 1. 음성 녹음 또는 메모 입력
    Staff->>UI: 2. [AI 변환] 버튼 클릭
    
    UI->>Action: 3. `generateSoapNote(text)` 호출
    
    Action->>Action: System Prompt 결합 (JSON 강제)
    Action->>Gemini: 4. API Request (Prompt + Input)
    
    activate Gemini
    Gemini-->>Action: 5. Response: { S, O, A, P } JSON
    deactivate Gemini
    
    Action-->>UI: 6. Return Parsed Data
    
    UI->>UI: 7. 에디터에 내용 자동 채움
    Staff->>UI: 8. 내용 수정 및 [저장] 클릭
    
    UI->>Action: 9. `saveServiceLog(data)` 호출
    Action->>DB: 10. INSERT service_logs
    DB-->>Action: 11. Success
    Action-->>UI: 12. Toast "저장 완료"
5. 🗺️ 사이트맵 및 사용자 흐름 (User Flow)
로그인 여부와 권한(Role)에 따른 페이지 접근 구조입니다.
code
Mermaid
graph LR
    Entry((접속)) --> Auth{로그인?}
    
    %% Public Zone
    Auth -- No --> Landing[Public Landing]
    Landing --> ServiceInfo[5대 사업 안내]
    Landing --> Gallery[보조기기 영상]
    Landing --> Calendar[공개 캘린더 (견학/교육 일정)]
    Landing --> Login[Clerk 로그인]

    %% User Zone
    Auth -- Yes (User) --> Portal[마이페이지]
    Portal --> Wizard[통합 신청 마법사]
    Wizard --> SelectType{유형 선택}
    SelectType --> TypeA[상담/체험]
    SelectType --> TypeB[수리/대여]
    SelectType --> TypeC[교육/견학]
    Portal --> Timeline[진행상황 타임라인]

    %% Staff Zone
    Auth -- Yes (Staff) --> Admin[업무 시스템]
    Admin --> Dashboard[통합 대시보드]
    Admin --> CRM[대상자/신청 관리]
    Admin --> Inventory[재고/자산 관리]
    Admin --> AITools[AI 일지/규정검색]
</file>

<file path="docs/MRD.md">
📄 Co-AT: GWATC 통합 케어 플랫폼 MRD
Market Requirements Document (시장 요구사항 정의서)
프로젝트 정보	내용
프로젝트명	Co-AT (Collaboration for Assistive Technology)
적용 기관	강원특별자치도 보조기기센터 (GWATC)
문서 버전	v2.0 (Business Logic Aligned)
작성일	2025년 12월 06일
핵심 기술	Next.js 15, Clerk, Supabase, Gemini Flash
비전	"행정은 AI에게, 사람은 클라이언트에게"
1. 개요 (Executive Summary)
1.1. 프로젝트 배경
현재 GWATC는 5대 핵심 사업(상담, 체험, 맞춤형, 사후관리, 교육)을 수행하고 있으나, 대민 채널(홈페이지)과 내부 업무(엑셀/종이)가 단절되어 있습니다. 이로 인해 반복적인 행정 업무 가중, 재고 관리의 어려움, 대상자 이력 파악의 비효율이 발생하고 있습니다.
1.2. 목표 (Goal)
**'은행 창구 모델(O2O Platform)'**을 도입하여, 고객은 온라인으로 간편하게 5대 서비스를 신청하고, 직원은 AI의 보조를 받아 원스톱으로 업무를 처리하는 통합 업무 협업 플랫폼을 구축합니다.
2. 업무 범위 및 문제 정의 (Scope & Pain Points)
센터의 실제 업무 흐름에 기반한 문제점과 해결책입니다.
업무 영역 (5대 사업)	현재의 문제점 (Pain Points)	Co-AT 솔루션 (Solution)
1. 상담 (전화/내방/방문)	상담 내용을 수기로 메모 후 엑셀에 재입력 (이중 작업). 히스토리 파악 어려움.	AI STT & SOAP 노트: 현장 음성/메모를 AI가 전문 의무기록 형태로 자동 변환 및 DB 저장.
2. 체험 (전시/견학)	체험 만족도나 기록이 휘발됨. 견학 일정 조율 번거로움.	온라인 예약 & 체험 일지: 기기별 QR코드로 만족도 입력, 캘린더 연동 견학 예약.
3. 맞춤형 지원 (대여/제작/평가)	대여 가능 기기 재고 파악 어려움. 지원 한도(횟수) 수기 체크 실수 발생.	스마트 재고관리: 대여 승인 시 재고 자동 차감. 한도 체크 로직: 연 2회/10만원 초과 시 시스템 경고.
4. 사후관리 (수리/세척/재사용)	수리 전/후 사진 관리 복잡. 부품 비용 계산 및 예산 관리 번거로움.	전후 사진비교 리포트: 사진 업로드 시 결과보고서 자동 생성. 수리비 누적 자동 계산.
5. 교육 및 홍보	실적(인원, 횟수) 집계가 엑셀로 흩어져 있어 보고 시 취합 시간 소요.	실시간 대시보드: 교육/홍보 실적이 자동 집계되어 그래프로 시각화.
3. 타겟 사용자 및 니즈 (Target Audience)
3.1. 사용자 (User: 장애인, 노인, 보호자)
Needs: 복잡한 가입 절차 없이 내게 필요한 서비스(수리, 대여 등)를 신청하고, 진행 상황(접수-배정-완료)을 카톡처럼 확인하고 싶음.
Key Feature: Clerk 소셜 로그인 (카카오/구글), 직관적인 서비스 신청 마법사(Wizard).
3.2. 실무자 (Staff: 보조공학사, 작업치료사, 사회복지사)
Needs: 현장(출장)에서 모바일로 즉시 기록하고, 복귀 후 행정 업무 시간을 줄이고 싶음. 내 대상자의 과거 이력(작년에 뭐 받았는지)을 바로 보고 싶음.
Key Feature: 모바일 최적화 업무 페이지, AI 업무 비서, 통합 대상자 CRM.
3.3. 관리자 (Admin: 센터장, 팀장)
Needs: 전체 사업의 예산 집행 현황, 재고 현황, 팀원별 업무 로드를 한눈에 보고 싶음.
Key Feature: 통계 대시보드, 데이터 내보내기(Excel).
4. 기능적 요구사항 (Functional Requirements)
4.1. 공통 플랫폼 (Platform Core)
FR-01. 통합 계정 체계:
Clerk을 활용한 인증.
필수: clerk_user_id를 Supabase profiles 테이블의 Foreign Key로 사용하여 데이터 무결성 보장.
FR-02. 반응형 웹앱: PC(사무실)와 모바일/태블릿(현장) 환경 완벽 지원.
4.2. 대민 서비스 (Public Zone)
FR-03. 동적 랜딩 페이지:
최신 유튜브 영상 갤러리 (활동 홍보).
5대 사업 바로가기 퀵 메뉴.
재사용(기증) 기기 목록 슬라이드.
공개 캘린더: 견학 일정, 교육 일정 표시 및 예약 기능 (캘린더 연동 견학 예약).
FR-04. 서비스 신청 시스템:
카테고리 선택 (상담/수리/대여/맞춤제작/세척 등).
신청 사유 및 사진 첨부 기능.
본인 인증 및 개인정보 활용 동의 전자 서명.
FR-05. 마이페이지 (My Portal):
서비스 진행 단계 타임라인 시각화.
대여 중인 기기 반납일 디데이(D-Day) 표시.
4.3. 업무 시스템 (Staff Zone)
FR-06. 대상자 CRM (고객 관계 관리):
이름/생년월일 검색으로 5대 사업 전체 이력 조회.
상담-평가-적용-사후관리 흐름을 하나의 타임라인으로 통합.
FR-07. AI 스마트 일지 (Gemini Flash):
음성 녹음 -> 텍스트 변환(STT) -> SOAP 노트 자동 생성.
기존 상담 기록을 바탕으로 적합 기기 추천 (RAG).
FR-08. 재고 및 자산 관리 (Inventory):
QR코드 스캔을 통한 입/출고 처리.
상태 관리 (보관/대여/수리/소독/폐기) 및 이력 추적.
FR-09. 비즈니스 로직 제어:
수리비 10만원 한도 체크.
맞춤제작 연 2회 횟수 제한 체크.
개인정보 보유 기간(5년) 만료 시 알림.
5. 기술 전략 (Technical Strategy)
최신 기술을 사용하여 개발 생산성과 유지보수 편의성을 극대화합니다.
Next.js 15 (App Router):
Server Actions: 복잡한 API 구축 없이 프론트엔드에서 직접 DB 로직 제어.
Streaming: AI 응답 및 대시보드 데이터 로딩 시 사용자 경험 최적화.
Database (Supabase):
Relational DB: 대상자-신청서-일지-재고 간의 강력한 관계 설정.
Row Level Security (RLS): 직원과 일반 유저의 데이터 접근 권한을 철저히 분리.
AI (Gemini 1.5 Flash):
긴 문맥(Context) 처리가 가능하여 운영 지침서 전체를 이해하고 답변 가능.
저렴한 비용으로 STT 및 텍스트 요약 구현.
6. 성공 지표 (Success Metrics)
행정 효율화: 상담 1건당 서류 처리 시간 30분 → 5분 단축 (AI 도입).
재고 정확도: 기기 재고 불일치 0건 달성 (시스템 기반 대여/반납).
접근성: 온라인 신청 비율 50% 이상 달성 (전화 접수 업무 감소).
데이터 자산화: 연말 사업 보고서 작성 시간 3일 → 1시간 단축 (자동 통계).
7. 개발 로드맵 (Roadmap)
단계	기간	주요 과제	비고
Phase 1	2주	기반 구축 (Foundation)	Clerk 연동, DB 설계(5대 사업 반영), 랜딩 페이지 UI
Phase 2	3주	서비스 신청 & CRM (Core)	온라인 신청 폼, 직원용 대상자 관리, 업무별 접수 로직
Phase 3	3주	AI & 재고 (Intelligence)	AI 상담 일지, 재고 관리 시스템, 비즈니스 로직(한도 체크)
Phase 4	2주	통합 & 안정화 (Launch)	대시보드 통계, 모바일 최적화, 보안 점검, 배포
</file>

<file path="docs/PRD.md">
📝 Co-AT: Product Requirements Document (v3.0)
Refined with Unified Development Guidelines
프로젝트 정보 내용
프로젝트명 GWATC 통합 케어 플랫폼 (Co-AT)
버전 v3.0 (Boilerplate Applied)
작성일 2025년 12월 06일
기술 스택 Next.js 15, Clerk, Supabase, React Query, Zustand
스타일링 Tailwind CSS, Shadcn UI (Spacing-First)

1. 개요 (Overview)
   1.1. 목적
   GWATC의 5대 핵심 사업(상담, 체험, 맞춤형, 사후관리, 교육홍보)을 위한 O2O 통합 협업 플랫폼 구축.
   통합 개발 가이드라인을 준수하여 유지보수성, 확장성, 타입 안전성이 보장된 코드를 작성한다.
   1.2. 핵심 아키텍처 원칙
   SOLID & Declarative: 로직(Hook), 데이터 변환(Util), UI(Component)의 철저한 분리.
   Next.js 15 Native: App Router, Server Actions, await params 패턴 준수.
   Strict Typing: Database Schema부터 Zod Validation까지 End-to-End 타입 안전성 확보.
2. 기술 스택 및 라이브러리 (Tech Specification)
   가이드라인에 명시된 라이브러리를 확정하여 사용한다.
   분류 라이브러리 용도
   Framework Next.js 15 App Router, Server Components
   Auth Clerk 인증 및 세션 관리 (Middleware 연동)
   DB / Backend Supabase PostgreSQL, Realtime, Edge Functions
   Server State @tanstack/react-query 서버 데이터 캐싱 및 동기화
   Client State Zustand 전역 상태 (장바구니, 신청 마법사 단계 등)
   Form React Hook Form + Zod 폼 제어 및 스키마 검증
   Styling Tailwind CSS + clsx 유틸리티 스타일링 (Spacing-First 준수)
   UI Kit Shadcn UI 기본 UI 컴포넌트 (Button, Card, Dialog)
   Date date-fns 날짜 포맷팅 및 계산
3. 도메인별 컴포넌트 설계 (Component Architecture)
   네이밍 규칙: [Domain][Role][Variant] (PascalCase) 적용.
   3.1. Public Domain (대민 서비스)
   Landing Page:
   HomeHeroSection: 메인 비주얼 및 슬로건.
   HomeQuickMenuGrid: 5대 사업 바로가기 그리드 (gap-4 md:gap-6).
   HomeNoticeTabs: 공지사항/지원사업 탭 컴포넌트.
   HomePublicCalendar: 공개 캘린더 (견학 일정, 교육 일정 표시 및 예약).
   Service Application (신청):
   ServiceApplicationWizard: 신청 단계 관리 컨테이너.
   ServiceCategorySelector: 5대 사업 카테고리 선택 카드.
   ServiceRepairForm: 수리 신청 전용 폼 (react-hook-form).
   ServiceRentDatepicker: 대여 기간 선택 (date-fns 활용).
   3.2. Client Portal Domain (마이페이지)
   ClientTimelineList: 신청 이력 타임라인 리스트.
   ClientTimelineItem: 개별 이력 카드 (상태별 색상 분기 로직 포함).
   ClientRentStatus: 대여 중인 기기 반납 D-Day 표시.
   3.3. Staff Admin Domain (업무 시스템)
   Dashboard:
   AdminDashboardKpi: 오늘의 실적 요약 카드.
   AdminNewRequestList: 신규 접수 건 리스트.
   CRM (Client Relationship Management):
   ClientProfileCard: 대상자 기본 정보 표시.
   ClientHistoryTable: 서비스 이용 이력 테이블.
   AI Log:
   SoapNoteEditor: AI 결과 수정 및 저장 에디터.
   SoapAudioRecorder: 음성 녹음 컴포넌트.
4. 상세 기능 명세 (Functional Specifications)
   4.1. 인증 및 사용자 (Auth & User)
   Logic: useUserSync 훅을 통해 Clerk 로그인 시 Supabase profiles 테이블 동기화.
   Middleware: /admin/\* 라우트 접근 시 metadata.role 확인하여 리다이렉트.
   4.2. 서비스 신청 (Service Application)
   Validation (Zod):
   code
   TypeScript
   const serviceSchema = z.object({
   category: z.enum(['consult', 'repair', ...]),
   description: z.string().min(10, "10자 이상 입력해주세요"),
   images: z.array(z.string()).optional()
   });
   State: useServiceStore (Zustand)를 사용하여 Wizard 단계(Step) 상태 관리.
   4.3. 업무 시스템 (Staff Zone)
   AI SOAP Note:
   Action: Server Action generateSoapNote(text) 호출 -> Gemini API.
   UI: Streaming UI 패턴 적용 (로딩 중 Skeleton 표시).
   Inventory (재고):
   Query: useInventoryList (React Query)로 재고 상태 실시간 조회.
   Mutation: 대여 승인 시 useRentApprove 훅을 통해 inventory 상태 변경 트랜잭션 실행.
5. 데이터베이스 스키마 및 타입 (Database & Types)
   Strict Typing: DB 스키마와 1:1 매칭되는 TypeScript Interface 정의.
   code
   TypeScript
   // types/database.ts (Supabase Generated)
   export interface Database {
   public: {
   Tables: {
   profiles: {
   Row: {
   id: string;
   clerk_user_id: string;
   role: 'user' | 'staff' | 'manager';
   // ...
   }
   };
   applications: {
   Row: {
   id: string;
   category: 'consult' | 'repair' | 'rental' | 'custom' | 'edu';
   status: 'submitted' | 'assigned' | 'in_progress' | 'completed';
   // ...
   }
   };
   // ... inventory, logs tables
   }
   }
   }
6. UI/UX 및 스타일링 가이드 (Styling Policy)
   6.1. Spacing-First 정책 적용
   Container: div className="p-4 md:p-6" (외부 패딩)
   Stack: div className="flex flex-col gap-4" (내부 간격)
   Forbidden: m-4, mt-2 등 마진 사용 금지 (컴포넌트 독립성 보장).
   6.2. 디자인 시스템 토큰 (Tailwind Config)
   Colors:
   Primary: bg-blue-600 (GWATC Brand)
   Background: bg-slate-50 (Admin Base)
   Status: text-green-600 (완료), text-yellow-600 (접수)
   Typography:
   Heading: text-h2 font-bold
   Body: text-body-1 text-slate-700
   GNB, SNB, LNB, RNB, FNB, breadcrumbs 반영 극대화화
7. Next.js 15 구현 가이드 (Implementation Guide)
   7.1. 동적 라우트 처리 (await params)
   code
   TypeScript
   // app/(admin)/clients/[id]/page.tsx
   export default async function ClientDetailPage({
   params
   }: {
   params: Promise<{ id: string }>
   }) {
   const { id } = await params; // Next.js 15 필수
   const client = await getClientById(id);

return <ClientProfileCard client={client} />;
}
7.2. 이미지 최적화
next/image 필수 사용.
배경 이미지는 div 스타일 대신 <Image fill className="object-cover" /> 패턴 사용. 8. 개발 로드맵 (Sprints)
가이드라인의 "Phase 1: 설계 -> Phase 2: 구현" 프로세스 준수.
단계 기간 주요 작업 (Task)
Sprint 1 1주차 설계 및 기반 구축<br>- components/ui (Shadcn) 설치<br>- DB Schema 및 Type 정의<br>- CommonLayout 및 인증 설정
Sprint 2 2주차 Public Domain 구현<br>- Home 컴포넌트 개발 (QuickMenu, Tabs)<br>- ServiceApplication 폼 및 검증 로직 (Zod)
Sprint 3 3주차 Admin Domain 구현<br>- AdminDashboard, ClientCRM 개발<br>- 5대 사업별 상태 관리 로직 (useServiceMutation)
Sprint 4 4주차 AI 및 통합<br>- SoapNote AI 연동 (Server Actions)<br>- 반응형 QA 및 배포 9. 최종 체크리스트 (Definition of Done)

불필요한 추상화 제거: 단순 래퍼 컴포넌트 없이 Tailwind 클래스 직접 사용했는가?
Naming: 컴포넌트 이름이 [Domain][Role] 형식을 따르는가?
Spacing: Margin 대신 Padding과 Gap으로 레이아웃을 잡았는가?
Type Safety: any 타입 없이 Zod와 Interface로 엄격하게 관리되는가?
Next.js 15: 동적 파라미터에 await를 사용했는가?
</file>

<file path="docs/processform.md">
[첨부 19] 상담 기록지 (필수양식)
등록번호 : 00-000
상담 기록지
상담일: 0000.00.00. / 상담자:
[대상자 정보]
이 름:
생년월일(나이)/성별: / 남, 여
연락처(e-mail): 본인) / 보호자)
주 소:
주 거 형 태: [ ]단독주택( 층) [ ]다가구주택( 층) [ ]아파트( 층) [ ]기타( )
엘리베이터 [ ]무 [ ]유
장애물( )
경 제 상 황: [ ]기초생활수급자 [ ]차상위 [ ]건강보험
연계가능재원:
[ ]보조기기교부사업 [ ]보장구 건강보험 [ ]보장구 의료급여 [ ]노인장기요양보험
[ ]정보통신보조기기 [ ]고용공단 보조공학기기 [ ]산업재해 재활보조기기지원 [ ]보철구지급사업
[ ]기타( [ ]자동차보험 [ ]민간급여( ) [ ]바우처지원)
장애유형/정도: 장애( [ ]심한 [ ]심하지 않은)
요 양 등 급:
장애발생원인:
장애 발생 시기:
[현재 장애 상태]
신체 (관절가동범위 및 근력 등 체크)
(좌측 L / 우측 R)
어깨관절(L) / (R)
위팔(L) / (R)
팔꿉관절(L) / (R)
아래팔(L) / (R)
손목(L) / (R)
손(L) / (R)
엉덩관절(L) / (R)
넓적다리(L) / (R)
무릎관절(L) / (R)
종아리(L) / (R)
발목(L) / (R)
발(L) / (R)
※제한부위 체크
인지/감각 기능
[ ]언어 [ ]인지 [ ]시각 [ ]청각 [ ]머리 [ ]목 [ ]체간 [ ]척수 손상
[상 담 내 용 및 이용자욕구]
(장애상태 상세, 직업, 가족력, 이력사항, 질병, 약물, 이용서비스 등)
[보유보조기기]
보조기기명(활용여부) / 수급경로(년도)
보조기기명(활용여부) / 수급경로(년도)
[주요 활동 장소]
[ ]집 [ ]학교 [ ]직장 [ ]지역사회 [ ]병원 [ ]기타( )
[활동 / 환경]
활동사항 (학습, 업무, ADL):
활동 시 자세: [ ]누운자세 [ ]앉은자세 [ ]선 자세 [ ]기타
활동 주지원자: [ ]가족 [ ]친구 [ ]간병인 [ ]활동보조인 [ ]기타( )
[환경 제한 사항]
</file>

<file path="docs/Readme.md">
🧥 Co-AT (Collaboration for Assistive Technology)
![alt text](https://img.shields.io/badge/Next.js-15.0-black?style=for-the-badge&logo=next.js)

![alt text](https://img.shields.io/badge/Supabase-PostgreSQL-green?style=for-the-badge&logo=supabase)

![alt text](https://img.shields.io/badge/Auth-Clerk-6C47FF?style=for-the-badge&logo=clerk)

![alt text](https://img.shields.io/badge/AI-Gemini_1.5_Flash-blue?style=for-the-badge&logo=google)

![alt text](https://img.shields.io/badge/Deploy-Vercel-black?style=for-the-badge&logo=vercel)
"행정은 AI에게, 사람은 클라이언트에게"
강원특별자치도 보조기기센터(GWATC) 통합 업무 협업 플랫폼
📖 프로젝트 개요 (Overview)
Co-AT는 GWATC의 5대 핵심 사업(상담, 체험, 맞춤형, 사후관리, 교육홍보)을 디지털로 전환하는 O2O 통합 플랫폼입니다.
기존의 파편화된 업무 방식(엑셀, 수기, 카카오톡)을 혁신하여, 대민 서비스 접근성을 높이고 직원의 행정 업무 부담을 획기적으로 줄이는 것을 목표로 합니다.
🚀 핵심 목표
원스톱 서비스: 로그인 한 번으로 상담 신청부터 결과 조회, 이력 관리까지 통합.
AI 업무 자동화: Gemini AI를 활용한 상담 일지(SOAP Note) 자동 생성 및 규정 검색.
데이터 기반 운영: 모든 서비스 이력을 DB화하여 재고 관리 및 실적 통계 자동화.
✨ 주요 기능 (Key Features)
🌏 Public Zone (대민 서비스)
동적 랜딩 페이지: 최신 보조기기 유튜브 영상 갤러리 및 센터 소식.
공개 캘린더: 견학 일정, 교육 일정 표시 및 예약 기능.
통합 서비스 신청 (Wizard): 5대 사업(상담, 체험, 대여, 수리, 교육) 간편 신청.
마이페이지 (Portal): 서비스 진행 단계(접수-배정-방문-완료) 타임라인 조회.
🏢 Staff Zone (업무 시스템)
통합 대시보드: 신규 접수 알림, 오늘의 방문 일정, KPI 실적 현황판.
대상자 CRM: 이름/생년월일 기반 통합 검색, 전 생애주기 서비스 이력 관리.
AI 스마트 워크:
AI SOAP Note: 현장 음성/메모를 전문 의무기록 형태로 자동 변환.
RAG 챗봇: 운영 지침 문서를 학습한 AI가 규정 및 지원 한도 답변.
재고/자산 관리: QR코드 기반 입출고 관리, 대여/반납 상태 자동 추적.
🛠️ 기술 스택 (Tech Stack)
분류	기술	설명
Framework	Next.js 15	App Router, Server Actions, PPR (Partial Prerendering)
Language	TypeScript	Strict Typing & End-to-End Type Safety
Styling	Tailwind CSS	Shadcn UI, Spacing-First Design System
Auth	Clerk	소셜 로그인, 미들웨어 기반 권한 제어 (RBAC)
Backend	Supabase	PostgreSQL, Realtime, Storage, Edge Functions
AI Engine	Gemini 1.5 Flash	고성능 경량 LLM (via Google AI Studio)
State	Zustand / TanStack Query	전역 상태 및 서버 데이터 캐싱
Deploy	Vercel	CI/CD 자동 배포 파이프라인
⚙️ 시작하기 (Getting Started)
로컬 개발 환경을 세팅하는 방법입니다.
1. 사전 준비 (Prerequisites)
Node.js 18.17.0 이상
npm 또는 pnpm
2. 설치 및 실행 (Installation)
code
Bash
# 1. 레포지토리 클론
git clone https://github.com/[Organization]/co-at.git
cd co-at

# 2. 패키지 설치
npm install

# 3. 환경 변수 설정 (.env.local 생성)
cp .env.example .env.local
# (아래 '환경 변수 가이드' 참고하여 키 값 입력)

# 4. 타입 생성 (Supabase 연동 시 필수)
npm run gen:types

# 5. 개발 서버 실행
npm run dev
브라우저에서 http://localhost:3000으로 접속하여 확인합니다.
🔑 환경 변수 가이드 (.env.local)
프로젝트 실행을 위해 다음 API Key들이 필요합니다. 보안을 위해 절대 GitHub에 커밋하지 마세요.
code
Env
# Clerk Authentication
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...

# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://[PROJECT-ID].supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...
SUPABASE_PROJECT_REF=[PROJECT-ID] # 타입 생성용

# Google Gemini AI
GEMINI_API_KEY=AIzaSy...
📂 프로젝트 구조 (Directory Structure)
기능 중심(Feature-First) 설계와 Next.js 15 App Router 구조를 따릅니다.
(상세 내용은 docs/DIR.md 참조)
code
Text
app/
├── (public)/       # 대민용 페이지 (홈, 공지사항)
├── (auth)/         # 로그인/회원가입
├── (portal)/       # 일반 사용자 마이페이지
├── (admin)/        # 직원 전용 업무 시스템
├── api/            # Route Handlers
└── layout.tsx      # Root Layout
components/
├── ui/             # shadcn 공통 컴포넌트
├── common/         # 전역 공통 컴포넌트
└── features/       # 도메인별 컴포넌트 (soap-note, inventory...)
lib/                # 유틸리티 (supabase client, gemini)
actions/            # Server Actions (DB Mutation, AI Call)
types/              # TypeScript 정의 (database.types.ts)
📚 상세 문서 (Documentation)
이 프로젝트는 철저한 기획과 설계를 바탕으로 개발되었습니다. docs/ 폴더에서 상세 내용을 확인하세요.
MRD (시장 요구사항): 프로젝트 배경, 5대 핵심 사업 정의.
PRD (제품 상세 정의): 기능 명세, 비즈니스 로직, UI 시나리오.
TRD (기술 설계): 시스템 아키텍처, 타입 시스템, AI 구현 전략.
Mermaid (다이어그램): ERD, 시퀀스 다이어그램, 상태도 시각화.
DIR (디렉토리 구조): 파일 구조 및 네이밍 규칙 가이드.
🤝 개발 컨벤션 (Convention)
Branch: main (배포용) / feature/기능명 (개발용).
Commit: Conventional Commits 준수 (feat:, fix:, docs:).
Styling: Spacing-First 정책 준수. (Margin 사용 지양, Padding/Gap 활용).
Typing: any 사용 금지. Supabase Generated Types 적극 활용.
📜 라이선스 (License)
Copyright © 2025 GWATC (Gangwon Assistive Technology Center). All rights reserved.
This is an internal private project.
</file>

<file path="docs/TRD.md">
🛠️ Co-AT: Technical Requirements Document (v3.0)
Technical Implementation & Architecture Guidelines
프로젝트 정보	내용
프로젝트명	GWATC 통합 케어 플랫폼 (Co-AT)
버전	v3.0 (Strict Typing & Next.js 15)
작성일	2025년 12월 06일
기술 스택	Next.js 15, Clerk, Supabase, Gemini Flash
상태	확정 (Locked)
1. 시스템 아키텍처 (System Architecture)
1.1. High-Level Diagram
Next.js 15 App Router를 중심으로, 인증(Clerk)과 데이터(Supabase), AI(Gemini)가 유기적으로 연결된 Serverless 아키텍처입니다.
code
Mermaid
graph TD
    User[Client / Staff] -->|HTTPS| CDN[Vercel Edge]
    
    subgraph Frontend [Next.js 15 App Router]
        CDN --> Middleware[Middleware (Clerk Auth)]
        Middleware --> Layout[Root Layout]
        Layout --> Page[Page Component]
        Page -->|Server Actions| Action[Data Mutation]
        Page -->|RSC Fetch| Data[Data Fetching]
    end
    
    subgraph Backend [Supabase Services]
        Action -->|PostgREST| DB[(PostgreSQL)]
        Data -->|PostgREST| DB
        DB -->|Trigger| Edge[Edge Functions]
    end
    
    subgraph AI [Google Cloud]
        Action -.->|Generative AI| Gemini[Gemini 1.5 Flash]
    end
2. 데이터베이스 및 타입 시스템 (Database & Typing)
2.1. Type Generation Workflow (핵심)
Supabase의 스키마를 TypeScript 타입으로 자동 변환하여 End-to-End Type Safety를 보장합니다.
설정 파일 (package.json):
요청하신 명령어를 scripts 섹션에 포함하여, DB 스키마 변경 시마다 즉시 타입을 업데이트합니다.
code
JSON
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "gen:types": "npx -y supabase gen types typescript --project-id \"SUPABASE_PROJECT_REF\" --schema public > types/database.types.ts"
  }
}
(참고: .env에 SUPABASE_PROJECT_REF가 있어도 명령어 실행 시에는 직접 ID를 넣거나 환경변수를 로드하는 방식이 필요할 수 있습니다. 위 스크립트는 터미널 실행 기준입니다.)
2.2. 타입 정의 및 사용
생성된 database.types.ts를 기반으로 전역 타입을 확장합니다.
code
TypeScript
// types/db.ts
import { Database } from './database.types';

// Supabase Client에 제네릭 주입
export type SupabaseClient = SupabaseClient<Database>;

// 자주 쓰는 Row 타입 추출 (Helper)
export type DbRow<T extends keyof Database['public']['Tables']> = 
  Database['public']['Tables'][T]['Row'];

export type Profile = DbRow<'profiles'>;
export type Application = DbRow<'applications'>;
2.3. RLS (Row Level Security) 정책
Clerk User ID와 Supabase 데이터를 연결하는 보안 규칙입니다.
code
SQL
-- profiles 테이블 정책 예시
create policy "Users can view own profile" 
on profiles for select 
using ( clerk_user_id = auth.jwt() ->> 'sub' ); -- Clerk Token의 sub 클레임 활용
3. 프론트엔드 아키텍처 (Frontend Implementation)
통합 개발 가이드라인을 준수하는 컴포넌트 및 로직 설계입니다.
3.1. 디렉토리 구조 (Feature-First)
도메인 주도 설계(DDD)에 따라 관련 파일(컴포넌트, 훅, 유틸)을 기능별로 응집시킵니다.
code
Text
app/
components/
├── common/                  # 전역 공통 (Button, Logo)
├── layout/                  # 헤더, 푸터, 사이드바
└── features/
    ├── auth/                # 인증 관련
    ├── landing/             # 랜딩 페이지 (Hero, QuickMenu, Calendar)
    ├── application/         # 서비스 신청 (Wizard, Forms)
    ├── dashboard/           # 대시보드 (KPI, Charts)
    ├── crm/                 # 대상자 관리 (Table, Detail)
    └── soap/                # AI 일지 (Editor, Recorder)
lib/
├── supabase/                # 클라이언트 설정
├── gemini/                  # AI 설정
└── utils.ts                 # cn, formatters
actions/                     # Server Actions (DB, AI 호출)
├── auth-actions.ts         # 유저 권한 체크
├── application-actions.ts   # 신청서 접수 (Insert)
├── schedule-actions.ts      # 일정 등록 및 공개 일정 조회
├── client-actions.ts        # 대상자 CRUD
├── inventory-actions.ts     # 재고 상태 변경
└── ai-actions.ts            # [핵심] Gemini API 호출 (SOAP 변환)
types/                       # database.types.ts 위치
3.2. 컴포넌트 개발 원칙 (Rules)
불필요한 추상화 금지: 단순 div 래퍼나 스타일링만을 위한 컴포넌트 생성 금지.
Spacing-First: margin 사용을 지양하고, 부모의 padding과 gap으로 레이아웃 제어.
code
Tsx
// ✅ Good Pattern
<div className="flex flex-col gap-4 p-6">
  <Header />
  <Content />
</div>
Naming: [Domain][Role][Variant] (예: ServiceRepairForm, AdminDashboardKpi).
3.3. Next.js 15 특화 구현
Async Params: 동적 라우트 파라미터 접근 시 반드시 await 사용.
code
Tsx
export default async function Page({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params; 
  // ...
}
Server Actions: API Route 대신 Server Action을 사용하여 Form 처리 및 데이터 Mutation.
4. AI 기능 구현 (Gemini Integration)
4.1. Server Action 아키텍처
클라이언트에서 직접 AI를 호출하지 않고, 서버 사이드에서 처리하여 API Key를 보호합니다.
code
TypeScript
// actions/generate-soap.ts
'use server'

import { GoogleGenerativeAI } from "@google/generative-ai";

export async function generateSoapNote(text: string) {
  const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY!);
  const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

  const prompt = `
    Role: Assistive Technology Professional
    Task: Convert input to SOAP Note JSON
    Input: ${text}
    Output Format: { "S": "...", "O": "...", "A": "...", "P": "..." }
  `;

  const result = await model.generateContent(prompt);
  return JSON.parse(result.response.text());
}
5. 인프라 및 환경 설정 (Infrastructure)
5.1. 환경 변수 (.env.local)
code
Env
# Clerk
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...

# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://[PROJECT_ID].supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...
SUPABASE_PROJECT_REF=[PROJECT_ID] # gen:types 스크립트용

# Google AI
GEMINI_API_KEY=AIza...
5.2. 배포 파이프라인 (CI/CD)
Vercel: GitHub main 브랜치 Push 시 자동 배포.
Check: 배포 전 npm run lint 및 npm run build 통과 필수.
6. 개발 워크플로우 (Workflow)
가이드라인에 따른 Phase별 개발 순서입니다.
Phase 1: Setup & Typing
프로젝트 생성 (create-next-app).
Supabase Table 생성 (SQL 실행).
npm run gen:types 실행하여 Typescript Interface 확보.
Phase 2: Component & UI
shadcn/ui 초기화.
components/features 내 도메인별 컴포넌트 구현 (Tailwind Spacing 준수).
Phase 3: Logic & Integration
Zustand Store 생성 (신청 Wizard 상태 등).
Server Actions 작성 및 컴포넌트 연결.
AI 기능 연동.
✅ 최종 체크리스트 (Quality Assurance)
개발 완료 후 PR(Pull Request) 전 확인 사항입니다.

Type Safety: any 타입이 없는가? database.types.ts를 활용했는가?

Structure: DIR.md 구조를 준수했는가? (Feature-first)

Style: margin 대신 gap/padding을 사용했는가?

Next.js 15: await params 및 Server Actions를 올바르게 사용했는가?

DB Sync: Clerk 유저 생성 시 Supabase 프로필이 동기화되는가?
</file>

<file path="env.example">
# Supabase 설정
# Supabase Dashboard > Project Settings > API에서 확인 가능
NEXT_PUBLIC_SUPABASE_URL=https://uyjbndiwyddjyjkdfuyi.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key_here

# Clerk 설정 (인증 시스템)
# Clerk Dashboard > API Keys에서 확인 가능
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=your_clerk_publishable_key_here
CLERK_SECRET_KEY=your_clerk_secret_key_here

# Google AI (Gemini) 설정 (AI 기능용)
# Google AI Studio에서 API Key 발급
GOOGLE_AI_API_KEY=your_google_ai_api_key_here
</file>

<file path="lib/hooks/useDashboardStats.ts">
"use client"

import { useQuery } from "@tanstack/react-query"
import {
  getDashboardStats,
  getNewApplications,
  getTodaySchedules,
  type DashboardStats,
  type NewApplication,
  type TodaySchedule,
} from "@/actions/dashboard-actions"

export function useDashboardStats() {
  return useQuery<DashboardStats>({
    queryKey: ["dashboard", "stats"],
    queryFn: async () => {
      const result = await getDashboardStats()
      if (!result.success || !result.stats) {
        throw new Error(result.error || "대시보드 통계 조회에 실패했습니다")
      }
      return result.stats
    },
    refetchInterval: 60000, // 1분마다 자동 갱신
  })
}

export function useNewApplications(limit: number = 10) {
  return useQuery<NewApplication[]>({
    queryKey: ["dashboard", "new-applications", limit],
    queryFn: async () => {
      const result = await getNewApplications(limit)
      if (!result.success || !result.applications) {
        throw new Error(result.error || "신규 접수 조회에 실패했습니다")
      }
      return result.applications
    },
    refetchInterval: 60000, // 1분마다 자동 갱신
  })
}

export function useTodaySchedules() {
  return useQuery<TodaySchedule[]>({
    queryKey: ["dashboard", "today-schedules"],
    queryFn: async () => {
      const result = await getTodaySchedules()
      if (!result.success || !result.schedules) {
        throw new Error(result.error || "오늘의 일정 조회에 실패했습니다")
      }
      return result.schedules
    },
    refetchInterval: 60000, // 1분마다 자동 갱신
  })
}
</file>

<file path="lib/stores/application-store.ts">
import { create } from "zustand"
import { type ApplicationForm } from "@/lib/validators"

interface ApplicationState {
  // 현재 단계 (1: 카테고리 선택, 2: 폼 작성, 3: 확인)
  currentStep: number
  // 선택된 카테고리
  selectedCategory: string | null
  // 선택된 세부 카테고리
  selectedSubCategory: string | null
  // 폼 데이터
  formData: Partial<ApplicationForm> | null
  // 에러 메시지
  errors: Record<string, string>
  
  // Actions
  setCurrentStep: (step: number) => void
  setSelectedCategory: (category: string | null) => void
  setSelectedSubCategory: (subCategory: string | null) => void
  setFormData: (data: Partial<ApplicationForm>) => void
  setError: (field: string, error: string) => void
  clearErrors: () => void
  reset: () => void
}

export const useApplicationStore = create<ApplicationState>((set) => ({
  currentStep: 1,
  selectedCategory: null,
  selectedSubCategory: null,
  formData: null,
  errors: {},

  setCurrentStep: (step) => set({ currentStep: step }),
  
  setSelectedCategory: (category) =>
    set({ selectedCategory: category, selectedSubCategory: null }),
  
  setSelectedSubCategory: (subCategory) =>
    set({ selectedSubCategory: subCategory }),
  
  setFormData: (data) =>
    set((state) => ({
      formData: { ...state.formData, ...data },
    })),
  
  setError: (field, error) =>
    set((state) => ({
      errors: { ...state.errors, [field]: error },
    })),
  
  clearErrors: () => set({ errors: {} }),
  
  reset: () =>
    set({
      currentStep: 1,
      selectedCategory: null,
      selectedSubCategory: null,
      formData: null,
      errors: {},
    }),
}))
</file>

<file path="lib/supabase/client.ts">
/**
 * Supabase Client (Client Component용)
 * 브라우저에서 사용하는 Supabase 클라이언트
 */
import { createBrowserClient } from '@supabase/ssr'
import { Database } from '@/types/database.types'

export function createClient() {
  return createBrowserClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )
}
</file>

<file path="lib/utils.ts">
import { type ClassValue, clsx } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
</file>

<file path="lib/validators.ts">
import { z } from "zod"

// 서비스 카테고리 타입
export const serviceCategorySchema = z.enum([
  "consult",
  "experience",
  "custom",
  "aftercare",
  "education",
])

// 서비스 세부 카테고리 타입
export const serviceSubCategorySchema = z.enum([
  "repair",
  "rental",
  "custom_make",
  "visit",
  "exhibition",
  "cleaning",
  "reuse",
])

// 공통 신청 폼 스키마
export const baseApplicationSchema = z.object({
  category: serviceCategorySchema,
  sub_category: serviceSubCategorySchema.optional(),
  desired_date: z.date().optional(),
  description: z.string().min(10, "10자 이상 입력해주세요").max(5000),
  contact: z.string().min(10, "연락처를 정확히 입력해주세요"),
  address: z.string().optional(),
})

// 수리 신청 폼 스키마
export const repairApplicationSchema = baseApplicationSchema.extend({
  category: z.literal("aftercare"),
  sub_category: z.literal("repair"),
  device_name: z.string().min(1, "기기명을 입력해주세요"),
  device_model: z.string().optional(),
  issue_description: z.string().min(10, "문제 상황을 10자 이상 입력해주세요"),
  images: z.array(z.string().url()).optional(),
})

// 대여 신청 폼 스키마
export const rentalApplicationSchema = baseApplicationSchema.extend({
  category: z.enum(["experience", "custom"]),
  sub_category: z.literal("rental"),
  device_name: z.string().min(1, "대여를 원하는 기기명을 입력해주세요"),
  rental_start_date: z.date(),
  rental_end_date: z.date(),
  purpose: z.string().min(10, "대여 목적을 10자 이상 입력해주세요"),
}).refine(
  (data) => data.rental_end_date >= data.rental_start_date,
  {
    message: "종료일은 시작일 이후여야 합니다",
    path: ["rental_end_date"],
  }
)

// 상담 신청 폼 스키마
export const consultApplicationSchema = baseApplicationSchema.extend({
  category: z.literal("consult"),
  sub_category: z.enum(["visit", "exhibition"]).optional(),
  consult_type: z.enum(["phone", "visit", "center"]),
  preferred_time: z.string().optional(),
  consult_purpose: z.string().min(10, "상담 목적을 10자 이상 입력해주세요"),
})

// 맞춤제작 신청 폼 스키마
export const customApplicationSchema = baseApplicationSchema.extend({
  category: z.literal("custom"),
  sub_category: z.literal("custom_make"),
  device_name: z.string().min(1, "제작을 원하는 기기명을 입력해주세요"),
  specifications: z.string().min(10, "제작 사양을 10자 이상 입력해주세요"),
  measurements: z.string().optional(),
  images: z.array(z.string().url()).optional(),
})

// 타입 추출
export type ServiceCategory = z.infer<typeof serviceCategorySchema>
export type ServiceSubCategory = z.infer<typeof serviceSubCategorySchema>
export type BaseApplicationForm = z.infer<typeof baseApplicationSchema>
export type RepairApplicationForm = z.infer<typeof repairApplicationSchema>
export type RentalApplicationForm = z.infer<typeof rentalApplicationSchema>
export type ConsultApplicationForm = z.infer<typeof consultApplicationSchema>
export type CustomApplicationForm = z.infer<typeof customApplicationSchema>

// 통합 신청 폼 타입 (유니온)
export type ApplicationForm =
  | RepairApplicationForm
  | RentalApplicationForm
  | ConsultApplicationForm
  | CustomApplicationForm
</file>

<file path="migrations/002_add_applications_fields.sql">
-- applications 테이블 필드 추가
-- 실행일: 2025-01-XX
-- 설명: applications 테이블에 category, sub_category, desired_date, assigned_staff_id 필드 추가

ALTER TABLE applications
  ADD COLUMN IF NOT EXISTS category TEXT CHECK (category IN ('consult', 'experience', 'custom', 'aftercare', 'education')),
  ADD COLUMN IF NOT EXISTS sub_category TEXT,
  ADD COLUMN IF NOT EXISTS desired_date DATE,
  ADD COLUMN IF NOT EXISTS assigned_staff_id UUID REFERENCES profiles(id);

-- 인덱스 생성 (성능 최적화)
CREATE INDEX IF NOT EXISTS idx_applications_category ON applications(category);
CREATE INDEX IF NOT EXISTS idx_applications_assigned_staff_id ON applications(assigned_staff_id);

-- 마이그레이션 완료 로그
COMMENT ON COLUMN applications.category IS '서비스 카테고리: consult(상담), experience(체험), custom(맞춤형), aftercare(사후관리), education(교육홍보)';
COMMENT ON COLUMN applications.sub_category IS '서비스 세부 카테고리: repair(수리), rental(대여), custom_make(맞춤제작), visit(방문), exhibition(전시), cleaning(소독), reuse(재활용) 등';
COMMENT ON COLUMN applications.desired_date IS '희망 서비스 일자';
COMMENT ON COLUMN applications.assigned_staff_id IS '배정된 담당 직원 ID (profiles 테이블 참조)';
</file>

<file path="migrations/003_add_inventory_fields.sql">
-- inventory 테이블 필드 추가
-- 실행일: 2025-01-XX
-- 설명: inventory 테이블에 대여 가능 여부, 구입 정보, 제조사, 모델, QR 코드 필드 추가

ALTER TABLE inventory
  ADD COLUMN IF NOT EXISTS is_rental_available BOOLEAN DEFAULT true,
  ADD COLUMN IF NOT EXISTS purchase_date DATE,
  ADD COLUMN IF NOT EXISTS purchase_price NUMERIC,
  ADD COLUMN IF NOT EXISTS manufacturer TEXT,
  ADD COLUMN IF NOT EXISTS model TEXT,
  ADD COLUMN IF NOT EXISTS qr_code TEXT;

-- 인덱스 생성 (성능 최적화)
CREATE INDEX IF NOT EXISTS idx_inventory_is_rental_available ON inventory(is_rental_available);
CREATE INDEX IF NOT EXISTS idx_inventory_qr_code ON inventory(qr_code);
CREATE INDEX IF NOT EXISTS idx_inventory_manufacturer ON inventory(manufacturer);

-- 마이그레이션 완료 로그
COMMENT ON COLUMN inventory.is_rental_available IS '대여 가능 여부 (기본값: true)';
COMMENT ON COLUMN inventory.purchase_date IS '구입일';
COMMENT ON COLUMN inventory.purchase_price IS '구입가격';
COMMENT ON COLUMN inventory.manufacturer IS '제조사';
COMMENT ON COLUMN inventory.model IS '모델명';
COMMENT ON COLUMN inventory.qr_code IS 'QR 코드 값 (고유 식별자)';
</file>

<file path="migrations/004_create_service_logs.sql">
-- service_logs 테이블 생성
-- 실행일: 2025-01-XX
-- 설명: 실제 서비스 제공 시 상세 기록 저장 (수리, 제작, 대여, 교육 등)
-- 참고: 상담 기록지(첨부 19), 서비스 진행 기록지(첨부 20), 평가지(첨부 21) 양식 반영

CREATE TABLE IF NOT EXISTS service_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  application_id UUID NOT NULL REFERENCES applications(id) ON DELETE CASCADE,
  staff_id UUID REFERENCES profiles(id),
  inventory_id UUID REFERENCES inventory(id),
  
  -- 서비스 기본 정보
  service_date DATE DEFAULT CURRENT_DATE,
  service_type TEXT, -- 'repair' | 'custom_make' | 'rental' | 'education' | 'maintenance' | 'inspection' | 'cleaning' | 'reuse' | 'other'
  service_area TEXT, -- 서비스 영역 (상담 기록지, 평가지 참고)
  
  -- 지원 구분 (서비스 진행 기록지 참고)
  funding_source TEXT, -- 'public' | 'private' | 'center' | 'other'
  funding_detail TEXT, -- 상세 재원 정보 (보조기기교부사업, 보장구 등)
  
  -- 작업 내용
  work_type TEXT, -- 'consult_assessment' | 'trial' | 'info' | 'rental' | 'education' | 'modify_make' | 'funding' | 'maintenance' | 'close' | 'aftercare' | 'case_meeting'
  item_name TEXT, -- 품목명
  work_description TEXT, -- 작업 내용 설명
  work_result TEXT, -- 작업 결과
  
  -- 비용 정보 (수리/제작 시)
  cost_total NUMERIC, -- 총 비용
  cost_materials NUMERIC, -- 재료비
  cost_labor NUMERIC, -- 인건비
  cost_other NUMERIC, -- 기타 비용
  
  -- 이미지 (작업 전/후 사진)
  images_before TEXT[], -- 작업 전 사진 URL 배열
  images_after TEXT[], -- 작업 후 사진 URL 배열
  
  -- 비고 및 메모
  remarks TEXT, -- 비고
  notes TEXT, -- 추가 메모
  
  -- 타임스탬프
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- 인덱스 생성 (성능 최적화)
CREATE INDEX IF NOT EXISTS idx_service_logs_application_id ON service_logs(application_id);
CREATE INDEX IF NOT EXISTS idx_service_logs_staff_id ON service_logs(staff_id);
CREATE INDEX IF NOT EXISTS idx_service_logs_inventory_id ON service_logs(inventory_id);
CREATE INDEX IF NOT EXISTS idx_service_logs_service_date ON service_logs(service_date);
CREATE INDEX IF NOT EXISTS idx_service_logs_service_type ON service_logs(service_type);

-- updated_at 자동 업데이트 트리거 함수 (이미 존재할 수 있으므로 IF NOT EXISTS 사용 불가)
-- 필요시 별도로 생성

-- 테이블 및 컬럼 코멘트
COMMENT ON TABLE service_logs IS '서비스 제공 상세 기록 (수리, 제작, 대여, 교육 등)';
COMMENT ON COLUMN service_logs.service_type IS '서비스 유형: repair(수리), custom_make(맞춤제작), rental(대여), education(교육), maintenance(유지관리), inspection(점검), cleaning(소독), reuse(재사용), other(기타)';
COMMENT ON COLUMN service_logs.funding_source IS '지원 구분: public(공적급여), private(민간급여), center(센터지원), other(기타)';
COMMENT ON COLUMN service_logs.work_type IS '작업 유형: consult_assessment(상담·평가), trial(시험적용), info(정보제공), rental(대여), education(교육훈련), modify_make(개조제작), funding(재원확보), maintenance(유지관리), close(종결), aftercare(사후관리), case_meeting(사례회의)';
</file>

<file path="migrations/005_create_schedules.sql">
-- schedules 테이블 생성
-- 실행일: 2025-01-XX
-- 설명: 일정 관리 테이블 (방문, 상담, 평가, 배송, 픽업 등)

CREATE TABLE IF NOT EXISTS schedules (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  application_id UUID REFERENCES applications(id) ON DELETE SET NULL,
  staff_id UUID NOT NULL REFERENCES profiles(id),
  client_id UUID REFERENCES clients(id) ON DELETE SET NULL,
  
  -- 일정 정보
  schedule_type TEXT NOT NULL CHECK (schedule_type IN ('visit', 'consult', 'assessment', 'delivery', 'pickup')),
  scheduled_date DATE NOT NULL,
  scheduled_time TIME,
  address TEXT, -- 방문 주소
  
  -- 일정 메모 및 상태
  notes TEXT, -- 일정 메모
  status TEXT DEFAULT 'scheduled' CHECK (status IN ('scheduled', 'completed', 'cancelled')),
  
  -- 타임스탬프
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- 인덱스 생성 (성능 최적화)
CREATE INDEX IF NOT EXISTS idx_schedules_application_id ON schedules(application_id);
CREATE INDEX IF NOT EXISTS idx_schedules_staff_id ON schedules(staff_id);
CREATE INDEX IF NOT EXISTS idx_schedules_client_id ON schedules(client_id);
CREATE INDEX IF NOT EXISTS idx_schedules_scheduled_date ON schedules(scheduled_date);
CREATE INDEX IF NOT EXISTS idx_schedules_status ON schedules(status);
CREATE INDEX IF NOT EXISTS idx_schedules_schedule_type ON schedules(schedule_type);

-- 복합 인덱스 (일정 조회 최적화)
CREATE INDEX IF NOT EXISTS idx_schedules_date_status ON schedules(scheduled_date, status);
CREATE INDEX IF NOT EXISTS idx_schedules_staff_date ON schedules(staff_id, scheduled_date);

-- 테이블 및 컬럼 코멘트
COMMENT ON TABLE schedules IS '일정 관리 테이블 (방문, 상담, 평가, 배송, 픽업 등)';
COMMENT ON COLUMN schedules.schedule_type IS '일정 유형: visit(방문), consult(상담), assessment(평가), delivery(배송), pickup(픽업)';
COMMENT ON COLUMN schedules.status IS '일정 상태: scheduled(예정), completed(완료), cancelled(취소)';
</file>

<file path="migrations/007_create_rentals.sql">
-- rentals 테이블 생성
-- 실행일: 2025-01-XX
-- 설명: 대여 관리 테이블 (보조기기 대여 및 반납 관리)

CREATE TABLE IF NOT EXISTS rentals (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  
  -- 관련 정보
  application_id UUID NOT NULL REFERENCES applications(id) ON DELETE CASCADE,
  inventory_id UUID NOT NULL REFERENCES inventory(id),
  client_id UUID NOT NULL REFERENCES clients(id) ON DELETE CASCADE,
  
  -- 대여 기간
  rental_start_date DATE NOT NULL,
  rental_end_date DATE NOT NULL,
  return_date DATE, -- 실제 반납일
  
  -- 대여 관리
  extension_count INTEGER DEFAULT 0, -- 연장 횟수
  status TEXT DEFAULT 'rented' CHECK (status IN ('rented', 'returned', 'overdue', 'damaged')),
  
  -- 타임스탬프
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- 인덱스 생성 (성능 최적화)
CREATE INDEX IF NOT EXISTS idx_rentals_application_id ON rentals(application_id);
CREATE INDEX IF NOT EXISTS idx_rentals_inventory_id ON rentals(inventory_id);
CREATE INDEX IF NOT EXISTS idx_rentals_client_id ON rentals(client_id);
CREATE INDEX IF NOT EXISTS idx_rentals_status ON rentals(status);
CREATE INDEX IF NOT EXISTS idx_rentals_rental_end_date ON rentals(rental_end_date);
CREATE INDEX IF NOT EXISTS idx_rentals_return_date ON rentals(return_date);

-- 복합 인덱스 (대여 조회 최적화)
CREATE INDEX IF NOT EXISTS idx_rentals_status_end_date ON rentals(status, rental_end_date);
CREATE INDEX IF NOT EXISTS idx_rentals_client_status ON rentals(client_id, status);

-- 대여 기간 검증을 위한 CHECK 제약조건 (선택사항)
-- ALTER TABLE rentals ADD CONSTRAINT check_rental_dates 
--   CHECK (rental_end_date >= rental_start_date);

-- 테이블 및 컬럼 코멘트
COMMENT ON TABLE rentals IS '대여 관리 테이블 (보조기기 대여 및 반납 관리)';
COMMENT ON COLUMN rentals.status IS '대여 상태: rented(대여중), returned(반납완료), overdue(연체), damaged(손상)';
COMMENT ON COLUMN rentals.extension_count IS '대여 기간 연장 횟수';
COMMENT ON COLUMN rentals.return_date IS '실제 반납일 (반납 완료 시 기록)';
</file>

<file path="migrations/008_add_notice_attachments.sql">
-- notices 테이블에 첨부파일 필드 추가
-- 실행일: 2025-12-06
-- 설명: 공지사항에 이미지, PDF, 유튜브 링크 등 첨부파일 추가

ALTER TABLE notices 
ADD COLUMN IF NOT EXISTS attachments JSONB DEFAULT '[]'::jsonb;

-- attachments 필드 구조:
-- [
--   {
--     "type": "image" | "pdf" | "youtube",
--     "url": "https://...",
--     "name": "파일명",
--     "size": 12345 (bytes, 이미지/PDF만)
--   }
-- ]

COMMENT ON COLUMN notices.attachments IS '첨부파일 목록 (JSON 배열): 이미지, PDF, 유튜브 링크 등';
</file>

<file path="postcss.config.mjs">
/** @type {import('postcss-load-config').Config} */
const config = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};

export default config;
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": [
      "dom",
      "dom.iterable",
      "esnext"
    ],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": [
        "./*"
      ]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}
</file>

<file path="types/database.types.ts">
export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json | undefined }
  | Json[]

export type Database = {
  // Allows to automatically instantiate createClient with right options
  // instead of createClient<Database, { PostgrestVersion: 'XX' }>(URL, KEY)
  __InternalSupabase: {
    PostgrestVersion: "13.0.5"
  }
  public: {
    Tables: {
      applications: {
        Row: {
          assigned_staff_id: string | null
          category: string | null
          client_id: string
          created_at: string | null
          desired_date: string | null
          id: string
          service_year: number | null
          status: string | null
          sub_category: string | null
          updated_at: string | null
        }
        Insert: {
          assigned_staff_id?: string | null
          category?: string | null
          client_id: string
          created_at?: string | null
          desired_date?: string | null
          id?: string
          service_year?: number | null
          status?: string | null
          sub_category?: string | null
          updated_at?: string | null
        }
        Update: {
          assigned_staff_id?: string | null
          category?: string | null
          client_id?: string
          created_at?: string | null
          desired_date?: string | null
          id?: string
          service_year?: number | null
          status?: string | null
          sub_category?: string | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "applications_assigned_staff_id_fkey"
            columns: ["assigned_staff_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "applications_client_id_fkey"
            columns: ["client_id"]
            isOneToOne: false
            referencedRelation: "clients"
            referencedColumns: ["id"]
          },
        ]
      }
      clients: {
        Row: {
          address: string | null
          birth_date: string | null
          contact: string | null
          created_at: string | null
          disability_cause: string | null
          disability_grade: string | null
          disability_onset_date: string | null
          disability_type: string | null
          economic_status: string | null
          gender: string | null
          guardian_contact: string | null
          has_elevator: boolean | null
          housing_type: string | null
          id: string
          name: string
          obstacles: string | null
          registration_number: string | null
          updated_at: string | null
        }
        Insert: {
          address?: string | null
          birth_date?: string | null
          contact?: string | null
          created_at?: string | null
          disability_cause?: string | null
          disability_grade?: string | null
          disability_onset_date?: string | null
          disability_type?: string | null
          economic_status?: string | null
          gender?: string | null
          guardian_contact?: string | null
          has_elevator?: boolean | null
          housing_type?: string | null
          id?: string
          name: string
          obstacles?: string | null
          registration_number?: string | null
          updated_at?: string | null
        }
        Update: {
          address?: string | null
          birth_date?: string | null
          contact?: string | null
          created_at?: string | null
          disability_cause?: string | null
          disability_grade?: string | null
          disability_onset_date?: string | null
          disability_type?: string | null
          economic_status?: string | null
          gender?: string | null
          guardian_contact?: string | null
          has_elevator?: boolean | null
          housing_type?: string | null
          id?: string
          name?: string
          obstacles?: string | null
          registration_number?: string | null
          updated_at?: string | null
        }
        Relationships: []
      }
      domain_assessments: {
        Row: {
          application_id: string
          created_at: string | null
          domain_type: string
          evaluation_data: Json | null
          evaluation_date: string | null
          evaluator_id: string | null
          evaluator_opinion: string | null
          future_plan: string | null
          id: string
          measurements: Json | null
          recommended_device: string | null
          updated_at: string | null
        }
        Insert: {
          application_id: string
          created_at?: string | null
          domain_type: string
          evaluation_data?: Json | null
          evaluation_date?: string | null
          evaluator_id?: string | null
          evaluator_opinion?: string | null
          future_plan?: string | null
          id?: string
          measurements?: Json | null
          recommended_device?: string | null
          updated_at?: string | null
        }
        Update: {
          application_id?: string
          created_at?: string | null
          domain_type?: string
          evaluation_data?: Json | null
          evaluation_date?: string | null
          evaluator_id?: string | null
          evaluator_opinion?: string | null
          future_plan?: string | null
          id?: string
          measurements?: Json | null
          recommended_device?: string | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "domain_assessments_application_id_fkey"
            columns: ["application_id"]
            isOneToOne: false
            referencedRelation: "applications"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "domain_assessments_evaluator_id_fkey"
            columns: ["evaluator_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
      intake_records: {
        Row: {
          activity_posture: string | null
          application_id: string
          body_function_data: Json | null
          cognitive_sensory_check: string[] | null
          consult_date: string | null
          consultant_id: string | null
          consultation_content: string | null
          created_at: string | null
          current_devices: Json | null
          environment_limitations: string | null
          id: string
          main_activity_place: string | null
          main_supporter: string | null
          updated_at: string | null
        }
        Insert: {
          activity_posture?: string | null
          application_id: string
          body_function_data?: Json | null
          cognitive_sensory_check?: string[] | null
          consult_date?: string | null
          consultant_id?: string | null
          consultation_content?: string | null
          created_at?: string | null
          current_devices?: Json | null
          environment_limitations?: string | null
          id?: string
          main_activity_place?: string | null
          main_supporter?: string | null
          updated_at?: string | null
        }
        Update: {
          activity_posture?: string | null
          application_id?: string
          body_function_data?: Json | null
          cognitive_sensory_check?: string[] | null
          consult_date?: string | null
          consultant_id?: string | null
          consultation_content?: string | null
          created_at?: string | null
          current_devices?: Json | null
          environment_limitations?: string | null
          id?: string
          main_activity_place?: string | null
          main_supporter?: string | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "intake_records_application_id_fkey"
            columns: ["application_id"]
            isOneToOne: false
            referencedRelation: "applications"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "intake_records_consultant_id_fkey"
            columns: ["consultant_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
      inventory: {
        Row: {
          asset_code: string | null
          category: string | null
          created_at: string | null
          id: string
          is_rental_available: boolean | null
          manufacturer: string | null
          model: string | null
          name: string
          purchase_date: string | null
          purchase_price: number | null
          qr_code: string | null
          status: string | null
          updated_at: string | null
        }
        Insert: {
          asset_code?: string | null
          category?: string | null
          created_at?: string | null
          id?: string
          is_rental_available?: boolean | null
          manufacturer?: string | null
          model?: string | null
          name: string
          purchase_date?: string | null
          purchase_price?: number | null
          qr_code?: string | null
          status?: string | null
          updated_at?: string | null
        }
        Update: {
          asset_code?: string | null
          category?: string | null
          created_at?: string | null
          id?: string
          is_rental_available?: boolean | null
          manufacturer?: string | null
          model?: string | null
          name?: string
          purchase_date?: string | null
          purchase_price?: number | null
          qr_code?: string | null
          status?: string | null
          updated_at?: string | null
        }
        Relationships: []
      }
      notices: {
        Row: {
          category: string | null
          content: string
          created_at: string | null
          created_by: string | null
          id: string
          is_pinned: boolean | null
          title: string
          updated_at: string | null
        }
        Insert: {
          category?: string | null
          content: string
          created_at?: string | null
          created_by?: string | null
          id?: string
          is_pinned?: boolean | null
          title: string
          updated_at?: string | null
        }
        Update: {
          category?: string | null
          content?: string
          created_at?: string | null
          created_by?: string | null
          id?: string
          is_pinned?: boolean | null
          title?: string
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "notices_created_by_fkey"
            columns: ["created_by"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
      process_logs: {
        Row: {
          application_id: string
          content: string | null
          created_at: string | null
          funding_source: string | null
          id: string
          item_name: string | null
          log_date: string | null
          process_step: string | null
          remarks: string | null
          service_area: string | null
          staff_id: string | null
          updated_at: string | null
        }
        Insert: {
          application_id: string
          content?: string | null
          created_at?: string | null
          funding_source?: string | null
          id?: string
          item_name?: string | null
          log_date?: string | null
          process_step?: string | null
          remarks?: string | null
          service_area?: string | null
          staff_id?: string | null
          updated_at?: string | null
        }
        Update: {
          application_id?: string
          content?: string | null
          created_at?: string | null
          funding_source?: string | null
          id?: string
          item_name?: string | null
          log_date?: string | null
          process_step?: string | null
          remarks?: string | null
          service_area?: string | null
          staff_id?: string | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "process_logs_application_id_fkey"
            columns: ["application_id"]
            isOneToOne: false
            referencedRelation: "applications"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "process_logs_staff_id_fkey"
            columns: ["staff_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
      profiles: {
        Row: {
          clerk_user_id: string
          created_at: string | null
          email: string | null
          full_name: string | null
          id: string
          role: string | null
          team: string | null
          updated_at: string | null
        }
        Insert: {
          clerk_user_id: string
          created_at?: string | null
          email?: string | null
          full_name?: string | null
          id?: string
          role?: string | null
          team?: string | null
          updated_at?: string | null
        }
        Update: {
          clerk_user_id?: string
          created_at?: string | null
          email?: string | null
          full_name?: string | null
          id?: string
          role?: string | null
          team?: string | null
          updated_at?: string | null
        }
        Relationships: []
      }
      rentals: {
        Row: {
          application_id: string
          client_id: string
          created_at: string | null
          extension_count: number | null
          id: string
          inventory_id: string
          rental_end_date: string
          rental_start_date: string
          return_date: string | null
          status: string | null
          updated_at: string | null
        }
        Insert: {
          application_id: string
          client_id: string
          created_at?: string | null
          extension_count?: number | null
          id?: string
          inventory_id: string
          rental_end_date: string
          rental_start_date: string
          return_date?: string | null
          status?: string | null
          updated_at?: string | null
        }
        Update: {
          application_id?: string
          client_id?: string
          created_at?: string | null
          extension_count?: number | null
          id?: string
          inventory_id?: string
          rental_end_date?: string
          rental_start_date?: string
          return_date?: string | null
          status?: string | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "rentals_application_id_fkey"
            columns: ["application_id"]
            isOneToOne: false
            referencedRelation: "applications"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "rentals_client_id_fkey"
            columns: ["client_id"]
            isOneToOne: false
            referencedRelation: "clients"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "rentals_inventory_id_fkey"
            columns: ["inventory_id"]
            isOneToOne: false
            referencedRelation: "inventory"
            referencedColumns: ["id"]
          },
        ]
      }
      schedules: {
        Row: {
          address: string | null
          application_id: string | null
          client_id: string | null
          created_at: string | null
          id: string
          notes: string | null
          schedule_type: string
          scheduled_date: string
          scheduled_time: string | null
          staff_id: string
          status: string | null
          updated_at: string | null
        }
        Insert: {
          address?: string | null
          application_id?: string | null
          client_id?: string | null
          created_at?: string | null
          id?: string
          notes?: string | null
          schedule_type: string
          scheduled_date: string
          scheduled_time?: string | null
          staff_id: string
          status?: string | null
          updated_at?: string | null
        }
        Update: {
          address?: string | null
          application_id?: string | null
          client_id?: string | null
          created_at?: string | null
          id?: string
          notes?: string | null
          schedule_type?: string
          scheduled_date?: string
          scheduled_time?: string | null
          staff_id?: string
          status?: string | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "schedules_application_id_fkey"
            columns: ["application_id"]
            isOneToOne: false
            referencedRelation: "applications"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "schedules_client_id_fkey"
            columns: ["client_id"]
            isOneToOne: false
            referencedRelation: "clients"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "schedules_staff_id_fkey"
            columns: ["staff_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
      service_logs: {
        Row: {
          application_id: string
          cost_labor: number | null
          cost_materials: number | null
          cost_other: number | null
          cost_total: number | null
          created_at: string | null
          funding_detail: string | null
          funding_source: string | null
          id: string
          images_after: string[] | null
          images_before: string[] | null
          inventory_id: string | null
          item_name: string | null
          notes: string | null
          remarks: string | null
          service_area: string | null
          service_date: string | null
          service_type: string | null
          staff_id: string | null
          updated_at: string | null
          work_description: string | null
          work_result: string | null
          work_type: string | null
        }
        Insert: {
          application_id: string
          cost_labor?: number | null
          cost_materials?: number | null
          cost_other?: number | null
          cost_total?: number | null
          created_at?: string | null
          funding_detail?: string | null
          funding_source?: string | null
          id?: string
          images_after?: string[] | null
          images_before?: string[] | null
          inventory_id?: string | null
          item_name?: string | null
          notes?: string | null
          remarks?: string | null
          service_area?: string | null
          service_date?: string | null
          service_type?: string | null
          staff_id?: string | null
          updated_at?: string | null
          work_description?: string | null
          work_result?: string | null
          work_type?: string | null
        }
        Update: {
          application_id?: string
          cost_labor?: number | null
          cost_materials?: number | null
          cost_other?: number | null
          cost_total?: number | null
          created_at?: string | null
          funding_detail?: string | null
          funding_source?: string | null
          id?: string
          images_after?: string[] | null
          images_before?: string[] | null
          inventory_id?: string | null
          item_name?: string | null
          notes?: string | null
          remarks?: string | null
          service_area?: string | null
          service_date?: string | null
          service_type?: string | null
          staff_id?: string | null
          updated_at?: string | null
          work_description?: string | null
          work_result?: string | null
          work_type?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "service_logs_application_id_fkey"
            columns: ["application_id"]
            isOneToOne: false
            referencedRelation: "applications"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "service_logs_inventory_id_fkey"
            columns: ["inventory_id"]
            isOneToOne: false
            referencedRelation: "inventory"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "service_logs_staff_id_fkey"
            columns: ["staff_id"]
            isOneToOne: false
            referencedRelation: "profiles"
            referencedColumns: ["id"]
          },
        ]
      }
    }
    Views: {
      [_ in never]: never
    }
    Functions: {
      [_ in never]: never
    }
    Enums: {
      [_ in never]: never
    }
    CompositeTypes: {
      [_ in never]: never
    }
  }
}

type DatabaseWithoutInternals = Omit<Database, "__InternalSupabase">

type DefaultSchema = DatabaseWithoutInternals[Extract<keyof Database, "public">]

export type Tables<
  DefaultSchemaTableNameOrOptions extends
    | keyof (DefaultSchema["Tables"] & DefaultSchema["Views"])
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof (DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"] &
        DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Views"])
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? (DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"] &
      DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Views"])[TableName] extends {
      Row: infer R
    }
    ? R
    : never
  : DefaultSchemaTableNameOrOptions extends keyof (DefaultSchema["Tables"] &
        DefaultSchema["Views"])
    ? (DefaultSchema["Tables"] &
        DefaultSchema["Views"])[DefaultSchemaTableNameOrOptions] extends {
        Row: infer R
      }
      ? R
      : never
    : never

export type TablesInsert<
  DefaultSchemaTableNameOrOptions extends
    | keyof DefaultSchema["Tables"]
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Insert: infer I
    }
    ? I
    : never
  : DefaultSchemaTableNameOrOptions extends keyof DefaultSchema["Tables"]
    ? DefaultSchema["Tables"][DefaultSchemaTableNameOrOptions] extends {
        Insert: infer I
      }
      ? I
      : never
    : never

export type TablesUpdate<
  DefaultSchemaTableNameOrOptions extends
    | keyof DefaultSchema["Tables"]
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Update: infer U
    }
    ? U
    : never
  : DefaultSchemaTableNameOrOptions extends keyof DefaultSchema["Tables"]
    ? DefaultSchema["Tables"][DefaultSchemaTableNameOrOptions] extends {
        Update: infer U
      }
      ? U
      : never
    : never

export type Enums<
  DefaultSchemaEnumNameOrOptions extends
    | keyof DefaultSchema["Enums"]
    | { schema: keyof DatabaseWithoutInternals },
  EnumName extends DefaultSchemaEnumNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaEnumNameOrOptions["schema"]]["Enums"]
    : never = never,
> = DefaultSchemaEnumNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaEnumNameOrOptions["schema"]]["Enums"][EnumName]
  : DefaultSchemaEnumNameOrOptions extends keyof DefaultSchema["Enums"]
    ? DefaultSchema["Enums"][DefaultSchemaEnumNameOrOptions]
    : never

export type CompositeTypes<
  PublicCompositeTypeNameOrOptions extends
    | keyof DefaultSchema["CompositeTypes"]
    | { schema: keyof DatabaseWithoutInternals },
  CompositeTypeName extends PublicCompositeTypeNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"]
    : never = never,
> = PublicCompositeTypeNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"][CompositeTypeName]
  : PublicCompositeTypeNameOrOptions extends keyof DefaultSchema["CompositeTypes"]
    ? DefaultSchema["CompositeTypes"][PublicCompositeTypeNameOrOptions]
    : never

export const Constants = {
  public: {
    Enums: {},
  },
} as const
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js
.yarn/install-state.gz

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*

# local env files
.env*.local
.env

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

# cloned repo
/co-AT/
</file>

<file path="app/(admin)/create-profile/page.tsx">
"use client"

import { useState, useEffect } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { useRouter } from "next/navigation"

export default function CreateProfilePage() {
  const router = useRouter()
  const [loading, setLoading] = useState(false)
  const [result, setResult] = useState<any>(null)
  const [error, setError] = useState<string | null>(null)

  const handleCreateProfile = async () => {
    setLoading(true)
    setError(null)
    setResult(null)

    try {
      const response = await fetch("/api/profile/create", {
        method: "POST",
      })

      const data = await response.json()

      if (!response.ok) {
        setError(data.error || "프로필 생성에 실패했습니다")
        return
      }

      setResult(data)
      
      // 프로필 생성 성공 시 대시보드로 이동
      if (data.success) {
        setTimeout(() => {
          router.push("/admin/dashboard")
        }, 2000)
      }
    } catch (err) {
      setError("요청 중 오류가 발생했습니다: " + String(err))
    } finally {
      setLoading(false)
    }
  }

  const handleCheckProfile = async () => {
    setLoading(true)
    setError(null)
    setResult(null)

    try {
      const response = await fetch("/api/profile/create", {
        method: "GET",
      })

      const data = await response.json()

      if (!response.ok) {
        setError(data.error || "프로필 조회에 실패했습니다")
        return
      }

      setResult(data)
    } catch (err) {
      setError("요청 중 오류가 발생했습니다: " + String(err))
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="container mx-auto px-4 py-8 max-w-2xl">
      <Card>
        <CardHeader>
          <CardTitle>프로필 생성/확인</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="flex gap-4">
            <Button
              onClick={handleCheckProfile}
              disabled={loading}
              variant="outline"
            >
              프로필 확인
            </Button>
            <Button
              onClick={handleCreateProfile}
              disabled={loading}
            >
              프로필 생성 (Manager 권한)
            </Button>
          </div>

          {loading && (
            <p className="text-sm text-muted-foreground">처리 중...</p>
          )}

          {error && (
            <div className="p-4 bg-destructive/10 border border-destructive/20 rounded-md">
              <p className="text-sm font-medium text-destructive">오류</p>
              <p className="text-sm text-destructive/80">{error}</p>
            </div>
          )}

          {result && (
            <div className="p-4 bg-muted rounded-md space-y-2">
              <p className="text-sm font-medium">결과:</p>
              <pre className="text-xs bg-background p-3 rounded border overflow-auto">
                {JSON.stringify(result, null, 2)}
              </pre>
            </div>
          )}

          <div className="pt-4 border-t space-y-2 text-sm text-muted-foreground">
            <p><strong>사용 방법:</strong></p>
            <ol className="list-decimal list-inside space-y-1">
              <li>먼저 "프로필 확인" 버튼을 눌러 현재 상태를 확인하세요</li>
              <li>프로필이 없다면 "프로필 생성" 버튼을 눌러 생성하세요</li>
              <li>생성된 프로필의 role은 "manager"로 설정됩니다</li>
              <li>생성 후 공지사항 관리 페이지로 이동할 수 있습니다</li>
            </ol>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}
</file>

<file path="app/(admin)/layout.tsx">
import { AdminSidebar } from "@/components/layout/admin-sidebar"
import { AdminHeader } from "@/components/layout/admin-header"

export default function AdminLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div className="flex min-h-screen flex-col">
      <AdminHeader />
      <div className="flex flex-1">
        <AdminSidebar />
        <main className="flex-1 overflow-auto">{children}</main>
      </div>
    </div>
  )
}
</file>

<file path="app/(admin)/notices-management/page.tsx">
import { getAllNotices, deleteNotice } from "@/actions/notice-actions"
import { NoticeList } from "@/components/features/admin/notices/NoticeList"
import { NoticeCreateDialog } from "@/components/features/admin/notices/NoticeCreateDialog"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Plus } from "lucide-react"
import { hasAdminOrStaffPermission } from "@/lib/utils/permissions"
import { redirect } from "next/navigation"

export default async function AdminNoticesPage() {
  // 권한 확인
  const hasPermission = await hasAdminOrStaffPermission()
  if (!hasPermission) {
    console.log("[공지사항 관리] 권한 없음 - 홈으로 리다이렉트")
    redirect("/")
  }
  
  console.log("[공지사항 관리] 권한 확인 완료 - 페이지 렌더링")

  // 공지사항 목록 조회
  const result = await getAllNotices()
  const notices = result.success ? result.notices || [] : []

  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <div className="mb-8">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-responsive-xl font-bold text-foreground mb-2">
              새 글 관리
            </h1>
            <p className="text-muted-foreground">
              게시글을 작성, 수정, 삭제할 수 있습니다
            </p>
          </div>
          <NoticeCreateDialog>
            <Button>
              <Plus className="mr-2 h-4 w-4" />
              새 글 작성
            </Button>
          </NoticeCreateDialog>
        </div>
      </div>

      <Card>
        <CardHeader>
          <CardTitle>공지사항 목록</CardTitle>
        </CardHeader>
        <CardContent>
          <NoticeList initialNotices={notices} />
        </CardContent>
      </Card>
    </div>
  )
}
</file>

<file path="app/(portal)/layout.tsx">
import { MobileBottomNav } from "@/components/layout/mobile-bottom-nav"
import { PortalHeader } from "@/components/layout/portal-header"

export default function PortalLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div className="flex min-h-screen flex-col pb-16 md:pb-0">
      <PortalHeader />
      <main className="flex-1">{children}</main>
      <MobileBottomNav />
    </div>
  )
}
</file>

<file path="app/(public)/notices/[id]/page.tsx">
import { getNoticeById } from "@/actions/notice-actions"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"
import { format } from "date-fns"
import { ko } from "date-fns/locale"
import Link from "next/link"
import { ArrowLeft, Pin, Calendar, Share2 } from "lucide-react"
import { notFound } from "next/navigation"
import { NoticeShareButton } from "@/components/features/notices/NoticeShareButton"
import { NoticeAttachments } from "@/components/features/notices/NoticeAttachments"

interface NoticeDetailPageProps {
  params: Promise<{ id: string }>
}

export default async function NoticeDetailPage({ params }: NoticeDetailPageProps) {
  const { id } = await params
  const notice = await getNoticeById(id)

  if (!notice) {
    notFound()
  }

  const categoryLabel =
    notice.category === "notice"
      ? "공지사항"
      : notice.category === "activity"
      ? "활동 소식"
      : notice.category === "support"
      ? "지원사업"
      : notice.category === "case"
      ? "서비스 사례"
      : "공지사항"

  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <div className="max-w-4xl mx-auto">
        {/* 뒤로가기 버튼 및 공유 버튼 */}
        <div className="mb-6 flex items-center justify-between">
          <Button variant="ghost" asChild>
            <Link href="/notices">
              <ArrowLeft className="mr-2 h-4 w-4" />
              목록으로
            </Link>
          </Button>
          <NoticeShareButton noticeId={notice.id} noticeTitle={notice.title} />
        </div>

        {/* 공지사항 상세 */}
        <Card>
          <CardHeader>
            <div className="flex items-start justify-between gap-4 mb-4">
              <div className="flex items-center gap-2 flex-wrap">
                {notice.is_pinned && (
                  <Badge variant="default" className="flex items-center gap-1">
                    <Pin className="h-3 w-3" />
                    고정
                  </Badge>
                )}
                <Badge variant="outline">{categoryLabel}</Badge>
              </div>
              <div className="flex items-center gap-1 text-sm text-muted-foreground whitespace-nowrap">
                <Calendar className="h-4 w-4" />
                {format(new Date(notice.created_at), "yyyy년 MM월 dd일", {
                  locale: ko,
                })}
              </div>
            </div>
            <CardTitle className="text-xl sm:text-2xl text-foreground">
              {notice.title}
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div
              className="text-sm sm:text-base text-foreground whitespace-pre-wrap break-words [&_h1]:text-xl [&_h1]:font-bold [&_h1]:mb-4 [&_h1]:mt-6 [&_h2]:text-lg [&_h2]:font-semibold [&_h2]:mb-3 [&_h2]:mt-5 [&_h3]:text-base [&_h3]:font-semibold [&_h3]:mb-2 [&_h3]:mt-4 [&_p]:mb-4 [&_p]:leading-relaxed [&_ul]:list-disc [&_ul]:ml-6 [&_ul]:mb-4 [&_ol]:list-decimal [&_ol]:ml-6 [&_ol]:mb-4 [&_li]:mb-2 [&_a]:text-primary [&_a]:underline [&_strong]:font-semibold [&_code]:bg-muted [&_code]:px-1 [&_code]:py-0.5 [&_code]:rounded [&_code]:text-sm"
              dangerouslySetInnerHTML={{ __html: notice.content }}
            />
            {notice.attachments && notice.attachments.length > 0 && (
              <NoticeAttachments attachments={notice.attachments} />
            )}
          </CardContent>
        </Card>

        {/* 하단 네비게이션 */}
        <div className="mt-6 flex justify-center">
          <Button variant="outline" asChild>
            <Link href="/notices">
              <ArrowLeft className="mr-2 h-4 w-4" />
              목록으로 돌아가기
            </Link>
          </Button>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/(public)/notices/page.tsx">
import { getRecentNotices, getNoticesByCategory } from "@/actions/notice-actions"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"
import { format } from "date-fns"
import { ko } from "date-fns/locale"
import Link from "next/link"
import { Pin, Calendar } from "lucide-react"

interface NoticesPageProps {
  searchParams: Promise<{ category?: string }>
}

export default async function NoticesPage({ searchParams }: NoticesPageProps) {
  const params = await searchParams
  const defaultTab = params.category === "support" 
    ? "support" 
    : params.category === "gallery" 
    ? "gallery" 
    : params.category === "cases" 
    ? "cases" 
    : "all"
  // 모든 카테고리의 공지사항 조회
  const [allNotices, supportNotices] = await Promise.all([
    getRecentNotices(50), // 전체 공지사항
    getNoticesByCategory("support", 50), // 지원사업
  ])

  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <div className="mb-8">
        <h1 className="text-responsive-xl font-bold text-foreground mb-2">
          공지사항
        </h1>
        <p className="text-muted-foreground">
          센터의 공지사항과 지원사업 정보를 확인하실 수 있습니다
        </p>
      </div>

      <Tabs defaultValue={defaultTab} className="w-full">
        <TabsList className="grid w-full grid-cols-4 mb-6">
          <TabsTrigger value="all" className="text-sm sm:text-base">
            공지사항
          </TabsTrigger>
          <TabsTrigger value="support" className="text-sm sm:text-base">
            지원사업
          </TabsTrigger>
          <TabsTrigger value="gallery" className="text-sm sm:text-base">
            활동갤러리
          </TabsTrigger>
          <TabsTrigger value="cases" className="text-sm sm:text-base">
            보조기기 서비스 사례
          </TabsTrigger>
        </TabsList>

        {/* 전체 공지사항 */}
        <TabsContent value="all" className="space-y-4 mt-0">
          {allNotices.length === 0 ? (
            <Card>
              <CardContent className="p-8 text-center">
                <p className="text-muted-foreground">등록된 공지사항이 없습니다</p>
              </CardContent>
            </Card>
          ) : (
            allNotices.map((notice) => (
              <Link key={notice.id} href={`/notices/${notice.id}`}>
                <Card className="hover:shadow-md transition-shadow cursor-pointer">
                  <CardHeader className="pb-3">
                    <div className="flex items-start justify-between gap-4">
                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2 mb-2">
                          {notice.is_pinned && (
                            <Badge variant="default" className="flex items-center gap-1">
                              <Pin className="h-3 w-3" />
                              고정
                            </Badge>
                          )}
                          {notice.category && (
                            <Badge variant="outline" className="text-xs">
                              {notice.category === "notice"
                                ? "공지사항"
                                : notice.category === "activity"
                                ? "활동 소식"
                                : notice.category === "support"
                                ? "지원사업"
                                : notice.category === "case"
                                ? "서비스 사례"
                                : "공지사항"}
                            </Badge>
                          )}
                        </div>
                        <CardTitle className="text-base sm:text-lg text-foreground line-clamp-2">
                          {notice.title}
                        </CardTitle>
                      </div>
                      <div className="flex items-center gap-1 text-xs sm:text-sm text-muted-foreground whitespace-nowrap">
                        <Calendar className="h-4 w-4" />
                        {format(new Date(notice.created_at), "yyyy.MM.dd", {
                          locale: ko,
                        })}
                      </div>
                    </div>
                  </CardHeader>
                  <CardContent>
                    <p className="text-sm sm:text-base text-muted-foreground line-clamp-3">
                      {notice.content}
                    </p>
                  </CardContent>
                </Card>
              </Link>
            ))
          )}
        </TabsContent>

        {/* 지원사업 */}
        <TabsContent value="support" className="space-y-4 mt-0">
          {supportNotices.length === 0 ? (
            <Card>
              <CardContent className="p-8 text-center">
                <p className="text-muted-foreground">등록된 지원사업 공지가 없습니다</p>
              </CardContent>
            </Card>
          ) : (
            supportNotices.map((notice) => (
              <Link key={notice.id} href={`/notices/${notice.id}`}>
                <Card className="hover:shadow-md transition-shadow cursor-pointer">
                  <CardHeader className="pb-3">
                    <div className="flex items-start justify-between gap-4">
                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2 mb-2">
                          {notice.is_pinned && (
                            <Badge variant="default" className="flex items-center gap-1">
                              <Pin className="h-3 w-3" />
                              고정
                            </Badge>
                          )}
                          <Badge variant="outline" className="text-xs">
                            지원사업
                          </Badge>
                        </div>
                        <CardTitle className="text-base sm:text-lg text-foreground line-clamp-2">
                          {notice.title}
                        </CardTitle>
                      </div>
                      <div className="flex items-center gap-1 text-xs sm:text-sm text-muted-foreground whitespace-nowrap">
                        <Calendar className="h-4 w-4" />
                        {format(new Date(notice.created_at), "yyyy.MM.dd", {
                          locale: ko,
                        })}
                      </div>
                    </div>
                  </CardHeader>
                  <CardContent>
                    <p className="text-sm sm:text-base text-muted-foreground line-clamp-3">
                      {notice.content}
                    </p>
                  </CardContent>
                </Card>
              </Link>
            ))
          )}
        </TabsContent>

        {/* 활동갤러리 */}
        <TabsContent value="gallery" className="space-y-4 mt-0">
          <Card>
            <CardContent className="p-8 text-center">
              <p className="text-muted-foreground mb-4">
                활동갤러리에서 센터의 다양한 활동 사진을 확인하실 수 있습니다.
              </p>
              <Button asChild>
                <Link href="/community/gallery">
                  활동갤러리 보기
                </Link>
              </Button>
            </CardContent>
          </Card>
        </TabsContent>

        {/* 보조기기 서비스 사례 */}
        <TabsContent value="cases" className="space-y-4 mt-0">
          <Card>
            <CardContent className="p-8 text-center">
              <p className="text-muted-foreground mb-4">
                보조기기 서비스 사례에서 실제 서비스 사례를 확인하실 수 있습니다.
              </p>
              <Button asChild>
                <Link href="/community/cases">
                  서비스 사례 보기
                </Link>
              </Button>
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>
    </div>
  )
}
</file>

<file path="app/api/profile/create/route.ts">
import { auth, currentUser } from "@clerk/nextjs/server"
import { createClient } from "@/lib/supabase/server"
import { NextResponse } from "next/server"

/**
 * 현재 로그인한 사용자의 프로필을 수동으로 생성하는 API
 * 테스트/개발용으로만 사용하세요
 */
export async function POST() {
  try {
    const { userId } = await auth()
    
    if (!userId) {
      return NextResponse.json(
        { error: "로그인이 필요합니다" },
        { status: 401 }
      )
    }

    // Clerk에서 사용자 정보 가져오기
    const user = await currentUser()
    
    if (!user) {
      return NextResponse.json(
        { error: "사용자 정보를 가져올 수 없습니다" },
        { status: 400 }
      )
    }

    const supabase = await createClient()

    // 이미 프로필이 있는지 확인
    const { data: existingProfile } = await supabase
      .from("profiles")
      .select("id, role")
      .eq("clerk_user_id", userId)
      .single()

    if (existingProfile) {
      return NextResponse.json({
        success: true,
        message: "프로필이 이미 존재합니다",
        profile: existingProfile,
        clerkUserId: userId,
      })
    }

    // 프로필 생성
    const fullName = user.firstName && user.lastName
      ? `${user.firstName} ${user.lastName}`
      : user.firstName || user.lastName || null
    
    const email = user.emailAddresses?.[0]?.emailAddress || null

    const { data: newProfile, error } = await supabase
      .from("profiles")
      .insert({
        clerk_user_id: userId,
        email,
        full_name: fullName,
        role: "manager", // 테스트용으로 manager로 설정
      })
      .select()
      .single()

    if (error) {
      console.error("프로필 생성 실패:", error)
      return NextResponse.json(
        { error: "프로필 생성에 실패했습니다", details: error.message },
        { status: 500 }
      )
    }

    console.log("프로필 생성 성공:", newProfile)

    return NextResponse.json({
      success: true,
      message: "프로필이 생성되었습니다",
      profile: newProfile,
      clerkUserId: userId,
    })
  } catch (error) {
    console.error("프로필 생성 중 오류:", error)
    return NextResponse.json(
      { error: "예상치 못한 오류가 발생했습니다", details: String(error) },
      { status: 500 }
    )
  }
}

/**
 * 현재 사용자의 Clerk ID와 프로필 상태 확인
 */
export async function GET() {
  try {
    const { userId } = await auth()
    
    if (!userId) {
      return NextResponse.json(
        { error: "로그인이 필요합니다" },
        { status: 401 }
      )
    }

    const user = await currentUser()
    const supabase = await createClient()

    const { data: profile, error } = await supabase
      .from("profiles")
      .select("*")
      .eq("clerk_user_id", userId)
      .single()

    return NextResponse.json({
      clerkUserId: userId,
      clerkUser: {
        id: user?.id,
        email: user?.emailAddresses?.[0]?.emailAddress,
        firstName: user?.firstName,
        lastName: user?.lastName,
      },
      profile: profile || null,
      profileExists: !!profile,
      error: error?.message || null,
    })
  } catch (error) {
    console.error("프로필 조회 중 오류:", error)
    return NextResponse.json(
      { error: "예상치 못한 오류가 발생했습니다", details: String(error) },
      { status: 500 }
    )
  }
}
</file>

<file path="components/common/file-uploader.tsx">
"use client"

import { useRef, useState } from "react"
import { Button } from "@/components/ui/button"
import { Upload } from "lucide-react"
import { cn } from "@/lib/utils"

interface FileUploaderProps {
  onUpload?: (files: File[]) => void
  accept?: string
  multiple?: boolean
  maxSize?: number // bytes
  className?: string
}

export function FileUploader({
  onUpload,
  accept = "image/*",
  multiple = false,
  maxSize = 5 * 1024 * 1024, // 5MB 기본값
  className,
}: FileUploaderProps) {
  const [isDragging, setIsDragging] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const fileInputRef = useRef<HTMLInputElement>(null)

  const handleFileSelect = (files: FileList | null) => {
    if (!files || files.length === 0) return

    const fileArray = Array.from(files)
    const validFiles: File[] = []
    const errors: string[] = []

    fileArray.forEach((file) => {
      if (file.size > maxSize) {
        errors.push(`${file.name}: 파일 크기가 ${maxSize / 1024 / 1024}MB를 초과합니다.`)
        return
      }
      validFiles.push(file)
    })

    if (errors.length > 0) {
      setError(errors.join("\n"))
    } else {
      setError(null)
      onUpload?.(validFiles)
    }
  }

  const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {
    e.preventDefault()
    setIsDragging(false)
    handleFileSelect(e.dataTransfer.files)
  }

  const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {
    e.preventDefault()
    setIsDragging(true)
  }

  const handleDragLeave = () => {
    setIsDragging(false)
  }

  return (
    <div className={cn("w-full", className)}>
      <div
        onDrop={handleDrop}
        onDragOver={handleDragOver}
        onDragLeave={handleDragLeave}
        className={cn(
          "flex flex-col items-center justify-center gap-4 rounded-lg border-2 border-dashed p-6 sm:p-8 transition-colors",
          isDragging ? "border-primary bg-primary/5 dark:bg-primary/10" : "border-muted bg-muted/50 dark:bg-muted/30"
        )}
      >
        <Upload className="h-8 w-8 sm:h-10 sm:w-10 text-muted-foreground" />
        <div className="text-center">
          <p className="text-xs sm:text-sm font-medium text-foreground">
            파일을 드래그하거나 클릭하여 업로드
          </p>
          <p className="text-xs text-muted-foreground mt-1">
            {accept} (최대 {maxSize / 1024 / 1024}MB)
          </p>
        </div>
        <Button
          type="button"
          variant="outline"
          onClick={() => fileInputRef.current?.click()}
        >
          파일 선택
        </Button>
        <input
          ref={fileInputRef}
          type="file"
          accept={accept}
          multiple={multiple}
          onChange={(e) => handleFileSelect(e.target.files)}
          className="hidden"
        />
      </div>
      {error && (
        <p className="mt-2 text-sm text-destructive">{error}</p>
      )}
    </div>
  )
}
</file>

<file path="components/common/logo.tsx">
export function Logo() {
  return (
    <div className="flex items-center gap-2">
      <div className="flex h-7 w-7 sm:h-8 sm:w-8 items-center justify-center rounded bg-primary text-primary-foreground">
        <span className="text-xs sm:text-sm font-bold">GW</span>
      </div>
      <span className="text-base sm:text-lg font-semibold text-foreground">GWATC</span>
    </div>
  )
}
</file>

<file path="components/common/status-badge.tsx">
import { cn } from "@/lib/utils"

type ApplicationStatus = "접수" | "배정" | "진행" | "완료" | "반려"

interface StatusBadgeProps {
  status: ApplicationStatus
  className?: string
}

const statusConfig: Record<ApplicationStatus, { label: string; className: string }> = {
  접수: {
    label: "접수",
    className: "bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-900/50",
  },
  배정: {
    label: "배정",
    className: "bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300 hover:bg-yellow-200 dark:hover:bg-yellow-900/50",
  },
  진행: {
    label: "진행",
    className: "bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300 hover:bg-purple-200 dark:hover:bg-purple-900/50",
  },
  완료: {
    label: "완료",
    className: "bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-900/50",
  },
  반려: {
    label: "반려",
    className: "bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-900/50",
  },
}

export function StatusBadge({ status, className }: StatusBadgeProps) {
  const config = statusConfig[status]

  return (
    <span
      className={cn(
        "inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium transition-colors",
        config.className,
        className
      )}
    >
      {config.label}
    </span>
  )
}
</file>

<file path="components/features/admin/notices/NoticeCreateDialog.tsx">
"use client"

import { useState } from "react"
import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import { z } from "zod"
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Textarea } from "@/components/ui/textarea"
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select"
import { Checkbox } from "@/components/ui/checkbox"
import { createNotice } from "@/actions/notice-actions"
import { useRouter } from "next/navigation"
import { NoticeAttachmentManager, type Attachment } from "./NoticeAttachmentManager"

const noticeSchema = z.object({
  title: z.string().min(1, "제목을 입력해주세요").max(200, "제목은 200자 이하여야 합니다"),
  content: z.string().min(1, "내용을 입력해주세요"),
  category: z.enum(["notice", "activity", "support", "case"]).nullable(),
  is_pinned: z.boolean().default(false),
})

type NoticeFormData = z.infer<typeof noticeSchema>

interface NoticeCreateDialogProps {
  children: React.ReactNode
}

export function NoticeCreateDialog({ children }: NoticeCreateDialogProps) {
  const router = useRouter()
  const [open, setOpen] = useState(false)
  const [isSubmitting, setIsSubmitting] = useState(false)
  const [attachments, setAttachments] = useState<Attachment[]>([])

  const {
    register,
    handleSubmit,
    formState: { errors },
    setValue,
    watch,
    reset,
  } = useForm<NoticeFormData>({
    resolver: zodResolver(noticeSchema),
    defaultValues: {
      category: null,
      is_pinned: false,
    },
  })

  const category = watch("category")
  const isPinned = watch("is_pinned")

  const onSubmit = async (data: NoticeFormData) => {
    setIsSubmitting(true)
    try {
      const result = await createNotice({
        title: data.title,
        content: data.content,
        category: data.category,
        is_pinned: data.is_pinned,
        attachments: attachments.length > 0 ? attachments : undefined,
      })

      if (result.success) {
        reset()
        setAttachments([])
        setOpen(false)
        router.refresh()
      } else {
        alert(result.error || "공지사항 생성에 실패했습니다")
      }
    } catch (error) {
      console.error("Error creating notice:", error)
      alert("예상치 못한 오류가 발생했습니다")
    } finally {
      setIsSubmitting(false)
    }
  }

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>{children}</DialogTrigger>
      <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle>새 글 작성</DialogTitle>
          <DialogDescription>
            공지사항을 작성하여 사용자들에게 알려주세요
          </DialogDescription>
        </DialogHeader>
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          <div className="space-y-2">
            <Label htmlFor="title">제목 *</Label>
            <Input
              id="title"
              {...register("title")}
              placeholder="공지사항 제목을 입력하세요"
              aria-invalid={errors.title ? "true" : "false"}
              aria-describedby={errors.title ? "title-error" : undefined}
            />
            {errors.title && (
              <p id="title-error" className="text-sm text-destructive" role="alert">
                {errors.title.message}
              </p>
            )}
          </div>

          <div className="space-y-2">
            <Label htmlFor="category">카테고리</Label>
            <Select
              value={category || ""}
              onValueChange={(value) =>
                setValue("category", value === "null" ? null : (value as "notice" | "activity" | "support" | "case"))
              }
            >
              <SelectTrigger id="category">
                <SelectValue placeholder="카테고리 선택 (선택사항)" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="notice">공지사항</SelectItem>
                <SelectItem value="activity">활동 소식</SelectItem>
                <SelectItem value="support">지원사업</SelectItem>
                <SelectItem value="case">서비스 사례</SelectItem>
              </SelectContent>
            </Select>
          </div>

          <div className="space-y-2">
            <Label htmlFor="content">내용 *</Label>
            <Textarea
              id="content"
              {...register("content")}
              placeholder="공지사항 내용을 입력하세요"
              rows={10}
              className="font-mono text-sm"
              aria-invalid={errors.content ? "true" : "false"}
              aria-describedby={errors.content ? "content-error" : undefined}
            />
            {errors.content && (
              <p id="content-error" className="text-sm text-destructive" role="alert">
                {errors.content.message}
              </p>
            )}
            <p className="text-xs text-muted-foreground">
              HTML 태그를 사용할 수 있습니다
            </p>
          </div>

          <NoticeAttachmentManager
            attachments={attachments}
            onChange={setAttachments}
          />

          <div className="flex items-center space-x-2">
            <Checkbox
              id="is_pinned"
              checked={isPinned}
              onCheckedChange={(checked) => setValue("is_pinned", checked === true)}
            />
            <Label
              htmlFor="is_pinned"
              className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer"
            >
              공지사항 고정
            </Label>
          </div>

          <DialogFooter>
            <Button
              type="button"
              variant="outline"
              onClick={() => {
                reset()
                setOpen(false)
              }}
              disabled={isSubmitting}
            >
              취소
            </Button>
            <Button type="submit" disabled={isSubmitting}>
              {isSubmitting ? "작성 중..." : "작성"}
            </Button>
          </DialogFooter>
        </form>
      </DialogContent>
    </Dialog>
  )
}
</file>

<file path="components/features/admin/notices/NoticeEditDialog.tsx">
"use client"

import { useState, useEffect } from "react"
import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import { z } from "zod"
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Textarea } from "@/components/ui/textarea"
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select"
import { Checkbox } from "@/components/ui/checkbox"
import { updateNotice, type Notice } from "@/actions/notice-actions"
import { useRouter } from "next/navigation"
import { NoticeAttachmentManager, type Attachment } from "./NoticeAttachmentManager"

const noticeSchema = z.object({
  title: z.string().min(1, "제목을 입력해주세요").max(200, "제목은 200자 이하여야 합니다"),
  content: z.string().min(1, "내용을 입력해주세요"),
  category: z.enum(["notice", "activity", "support", "case"]).nullable(),
  is_pinned: z.boolean().default(false),
})

type NoticeFormData = z.infer<typeof noticeSchema>

interface NoticeEditDialogProps {
  notice: Notice
  children: React.ReactNode
  onSuccess?: () => void
}

export function NoticeEditDialog({
  notice,
  children,
  onSuccess,
}: NoticeEditDialogProps) {
  const router = useRouter()
  const [open, setOpen] = useState(false)
  const [isSubmitting, setIsSubmitting] = useState(false)
  const [attachments, setAttachments] = useState<Attachment[]>(notice.attachments || [])

  const {
    register,
    handleSubmit,
    formState: { errors },
    setValue,
    watch,
    reset,
  } = useForm<NoticeFormData>({
    resolver: zodResolver(noticeSchema),
    defaultValues: {
      title: notice.title,
      content: notice.content,
      category: notice.category,
      is_pinned: notice.is_pinned,
    },
  })

  useEffect(() => {
    if (open) {
      reset({
        title: notice.title,
        content: notice.content,
        category: notice.category,
        is_pinned: notice.is_pinned,
      })
    }
  }, [open, notice, reset])

  const category = watch("category")
  const isPinned = watch("is_pinned")

  const onSubmit = async (data: NoticeFormData) => {
    setIsSubmitting(true)
    try {
      const result = await updateNotice({
        id: notice.id,
        title: data.title,
        content: data.content,
        category: data.category,
        is_pinned: data.is_pinned,
        attachments: attachments.length > 0 ? attachments : undefined,
      })

      if (result.success) {
        setOpen(false)
        onSuccess?.()
        router.refresh()
      } else {
        alert(result.error || "공지사항 수정에 실패했습니다")
      }
    } catch (error) {
      console.error("Error updating notice:", error)
      alert("예상치 못한 오류가 발생했습니다")
    } finally {
      setIsSubmitting(false)
    }
  }

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>{children}</DialogTrigger>
      <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle>공지사항 수정</DialogTitle>
          <DialogDescription>
            공지사항 내용을 수정할 수 있습니다
          </DialogDescription>
        </DialogHeader>
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          <div className="space-y-2">
            <Label htmlFor="edit-title">제목 *</Label>
            <Input
              id="edit-title"
              {...register("title")}
              placeholder="공지사항 제목을 입력하세요"
              aria-invalid={errors.title ? "true" : "false"}
            />
            {errors.title && (
              <p className="text-sm text-destructive" role="alert">
                {errors.title.message}
              </p>
            )}
          </div>

          <div className="space-y-2">
            <Label htmlFor="edit-category">카테고리</Label>
            <Select
              value={category || ""}
              onValueChange={(value) =>
                setValue("category", value === "null" ? null : (value as "notice" | "activity" | "support" | "case"))
              }
            >
              <SelectTrigger id="edit-category">
                <SelectValue placeholder="카테고리 선택 (선택사항)" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="notice">공지사항</SelectItem>
                <SelectItem value="activity">활동 소식</SelectItem>
                <SelectItem value="support">지원사업</SelectItem>
                <SelectItem value="case">서비스 사례</SelectItem>
              </SelectContent>
            </Select>
          </div>

          <div className="space-y-2">
            <Label htmlFor="edit-content">내용 *</Label>
            <Textarea
              id="edit-content"
              {...register("content")}
              placeholder="공지사항 내용을 입력하세요"
              rows={10}
              className="font-mono text-sm"
              aria-invalid={errors.content ? "true" : "false"}
            />
            {errors.content && (
              <p className="text-sm text-destructive" role="alert">
                {errors.content.message}
              </p>
            )}
            <p className="text-xs text-muted-foreground">
              HTML 태그를 사용할 수 있습니다
            </p>
          </div>

          <NoticeAttachmentManager
            attachments={attachments}
            onChange={setAttachments}
          />

          <div className="flex items-center space-x-2">
            <Checkbox
              id="edit-is_pinned"
              checked={isPinned}
              onCheckedChange={(checked) => setValue("is_pinned", checked === true)}
            />
            <Label
              htmlFor="edit-is_pinned"
              className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer"
            >
              공지사항 고정
            </Label>
          </div>

          <DialogFooter>
            <Button
              type="button"
              variant="outline"
              onClick={() => setOpen(false)}
              disabled={isSubmitting}
            >
              취소
            </Button>
            <Button type="submit" disabled={isSubmitting}>
              {isSubmitting ? "수정 중..." : "수정"}
            </Button>
          </DialogFooter>
        </form>
      </DialogContent>
    </Dialog>
  )
}
</file>

<file path="components/features/admin/notices/NoticeList.tsx">
"use client"

import { useState } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog"
import { format } from "date-fns"
import { ko } from "date-fns/locale"
import type { Notice } from "@/actions/notice-actions"
import { deleteNotice } from "@/actions/notice-actions"
import { useRouter } from "next/navigation"
import { Pin, Calendar, Edit, Trash2, AlertTriangle } from "lucide-react"
import { NoticeEditDialog } from "./NoticeEditDialog"

interface NoticeListProps {
  initialNotices: Notice[]
}

export function NoticeList({ initialNotices }: NoticeListProps) {
  const router = useRouter()
  const [notices, setNotices] = useState(initialNotices)
  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false)
  const [noticeToDelete, setNoticeToDelete] = useState<Notice | null>(null)
  const [isDeleting, setIsDeleting] = useState(false)

  const handleDeleteClick = (notice: Notice) => {
    setNoticeToDelete(notice)
    setDeleteDialogOpen(true)
  }

  const handleDeleteConfirm = async () => {
    if (!noticeToDelete) return

    setIsDeleting(true)
    const result = await deleteNotice(noticeToDelete.id)

    if (result.success) {
      setNotices(notices.filter((n) => n.id !== noticeToDelete.id))
      setDeleteDialogOpen(false)
      setNoticeToDelete(null)
      router.refresh()
    } else {
      alert(result.error || "삭제에 실패했습니다")
    }

    setIsDeleting(false)
  }

  const handleUpdateSuccess = () => {
    router.refresh()
  }

  if (notices.length === 0) {
    return (
      <div className="text-center py-8">
        <p className="text-muted-foreground">등록된 공지사항이 없습니다</p>
      </div>
    )
  }

  return (
    <>
      <div className="space-y-4">
        {notices.map((notice) => {
          const categoryLabel =
            notice.category === "notice"
              ? "공지사항"
              : notice.category === "activity"
              ? "활동 소식"
              : notice.category === "support"
              ? "지원사업"
              : notice.category === "case"
              ? "서비스 사례"
              : "공지사항"

          return (
            <Card key={notice.id} className="hover:shadow-md transition-shadow">
              <CardHeader className="pb-3">
                <div className="flex items-start justify-between gap-4">
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-2 flex-wrap">
                      {notice.is_pinned && (
                        <Badge variant="default" className="flex items-center gap-1">
                          <Pin className="h-3 w-3" />
                          고정
                        </Badge>
                      )}
                      <Badge variant="outline" className="text-xs">
                        {categoryLabel}
                      </Badge>
                    </div>
                    <CardTitle className="text-base sm:text-lg text-foreground line-clamp-2">
                      {notice.title}
                    </CardTitle>
                  </div>
                  <div className="flex items-center gap-1 text-xs sm:text-sm text-muted-foreground whitespace-nowrap">
                    <Calendar className="h-4 w-4" />
                    {format(new Date(notice.created_at), "yyyy.MM.dd", {
                      locale: ko,
                    })}
                  </div>
                </div>
              </CardHeader>
              <CardContent>
                <p className="text-sm sm:text-base text-muted-foreground line-clamp-3 mb-4">
                  {notice.content}
                </p>
                <div className="flex items-center gap-2">
                  <NoticeEditDialog notice={notice} onSuccess={handleUpdateSuccess}>
                    <Button variant="outline" size="sm">
                      <Edit className="mr-2 h-4 w-4" />
                      수정
                    </Button>
                  </NoticeEditDialog>
                  <Button
                    variant="destructive"
                    size="sm"
                    onClick={() => handleDeleteClick(notice)}
                  >
                    <Trash2 className="mr-2 h-4 w-4" />
                    삭제
                  </Button>
                  <Button
                    variant="ghost"
                    size="sm"
                    asChild
                    className="ml-auto"
                  >
                    <a href={`/notices/${notice.id}`} target="_blank" rel="noopener noreferrer">
                      보기
                    </a>
                  </Button>
                </div>
              </CardContent>
            </Card>
          )
        })}
      </div>

      {/* 삭제 확인 다이얼로그 */}
      <Dialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <AlertTriangle className="h-5 w-5 text-destructive" />
              공지사항 삭제
            </DialogTitle>
            <DialogDescription>
              정말로 이 공지사항을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.
              <br />
              <strong className="text-foreground mt-2 block">
                {noticeToDelete?.title}
              </strong>
            </DialogDescription>
          </DialogHeader>
          <DialogFooter>
            <Button
              variant="outline"
              onClick={() => {
                setDeleteDialogOpen(false)
                setNoticeToDelete(null)
              }}
              disabled={isDeleting}
            >
              취소
            </Button>
            <Button
              variant="destructive"
              onClick={handleDeleteConfirm}
              disabled={isDeleting}
            >
              {isDeleting ? "삭제 중..." : "삭제"}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </>
  )
}
</file>

<file path="components/features/landing/HomeCommunityNews.tsx">
"use client"

import { Card, CardContent } from "@/components/ui/card"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { getRecentNotices, getNoticesByCategory, type Notice } from "@/actions/notice-actions"
import { format } from "date-fns"
import { ko } from "date-fns/locale"
import Link from "next/link"
import { Plus } from "lucide-react"
import { Button } from "@/components/ui/button"
import { useState } from "react"

interface HomeCommunityNewsProps {
  initialNotices: Notice[]
  initialSupportNotices: Notice[]
}

export function HomeCommunityNews({
  initialNotices,
  initialSupportNotices,
}: HomeCommunityNewsProps) {
  const [notices, setNotices] = useState(initialNotices)
  const [supportNotices, setSupportNotices] = useState(initialSupportNotices)

  return (
    <Card>
      <CardContent className="p-4 sm:p-6">
        <Tabs defaultValue="notice" className="w-full">
          <TabsList className="grid w-full grid-cols-4 mb-4">
            <TabsTrigger value="notice" className="text-xs sm:text-sm">
              공지사항
            </TabsTrigger>
            <TabsTrigger value="support" className="text-xs sm:text-sm">
              지원사업
            </TabsTrigger>
            <TabsTrigger value="gallery" className="text-xs sm:text-sm">
              활동 소식
            </TabsTrigger>
            <TabsTrigger value="cases" className="text-xs sm:text-sm">
              서비스 사례
            </TabsTrigger>
          </TabsList>

          {/* 공지사항 탭 */}
          <TabsContent value="notice" className="space-y-3 mt-0">
            {notices.length === 0 ? (
              <p className="text-sm text-muted-foreground text-center py-4">
                등록된 공지사항이 없습니다.
              </p>
            ) : (
              <>
                {notices.slice(0, 3).map((notice) => (
                  <Link key={notice.id} href={`/notices/${notice.id}`}>
                    <div className="p-2 rounded-md border hover:bg-accent transition-colors cursor-pointer">
                      <div className="flex items-start justify-between gap-2">
                        <div className="flex-1 min-w-0">
                          <p className="text-xs font-medium text-foreground line-clamp-1">
                            {notice.is_pinned && (
                              <span className="inline-block mr-1 text-primary">📌</span>
                            )}
                            {notice.title}
                          </p>
                        </div>
                        <span className="text-xs text-muted-foreground whitespace-nowrap">
                          {format(new Date(notice.created_at), "MM.dd", { locale: ko })}
                        </span>
                      </div>
                    </div>
                  </Link>
                ))}
              </>
            )}
            <div className="pt-2">
              <Button asChild variant="outline" size="sm" className="w-full">
                <Link href="/notices">
                  <Plus className="mr-2 h-4 w-4" />
                  더보기
                </Link>
              </Button>
            </div>
          </TabsContent>

          {/* 지원사업 탭 */}
          <TabsContent value="support" className="space-y-3 mt-0">
            {supportNotices.length === 0 ? (
              <p className="text-sm text-muted-foreground text-center py-4">
                등록된 지원사업 공지사항이 없습니다.
              </p>
            ) : (
              <>
                {supportNotices.slice(0, 3).map((notice) => (
                  <Link key={notice.id} href={`/notices/${notice.id}`}>
                    <div className="p-2 rounded-md border hover:bg-accent transition-colors cursor-pointer">
                      <div className="flex items-start justify-between gap-2">
                        <div className="flex-1 min-w-0">
                          <p className="text-xs font-medium text-foreground line-clamp-1">
                            {notice.is_pinned && (
                              <span className="inline-block mr-1 text-primary">📌</span>
                            )}
                            {notice.title}
                          </p>
                        </div>
                        <span className="text-xs text-muted-foreground whitespace-nowrap">
                          {format(new Date(notice.created_at), "MM.dd", { locale: ko })}
                        </span>
                      </div>
                    </div>
                  </Link>
                ))}
              </>
            )}
            <div className="pt-2">
              <Button asChild variant="outline" size="sm" className="w-full">
                <Link href="/notices?category=support">
                  <Plus className="mr-2 h-4 w-4" />
                  더보기
                </Link>
              </Button>
            </div>
          </TabsContent>

          {/* 활동 소식 탭 */}
          <TabsContent value="gallery" className="space-y-3 mt-0">
            <p className="text-sm text-muted-foreground text-center py-4">
              활동 소식이 곧 업데이트됩니다.
            </p>
            <div className="pt-2">
              <Button asChild variant="outline" size="sm" className="w-full">
                <Link href="/community/gallery">
                  <Plus className="mr-2 h-4 w-4" />
                  더보기
                </Link>
              </Button>
            </div>
          </TabsContent>

          {/* 서비스 사례 탭 */}
          <TabsContent value="cases" className="space-y-3 mt-0">
            <p className="text-sm text-muted-foreground text-center py-4">
              서비스 사례가 곧 업데이트됩니다.
            </p>
            <div className="pt-2">
              <Button asChild variant="outline" size="sm" className="w-full">
                <Link href="/community/cases">
                  <Plus className="mr-2 h-4 w-4" />
                  더보기
                </Link>
              </Button>
            </div>
          </TabsContent>
        </Tabs>
      </CardContent>
    </Card>
  )
}
</file>

<file path="components/features/landing/HomeGallerySlider.tsx">
"use client"

import { useState } from "react"
import { Card, CardContent } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { ChevronLeft, ChevronRight, ExternalLink } from "lucide-react"
import { cn } from "@/lib/utils"

interface YouTubeVideo {
  id: string
  title: string
  thumbnail: string
  url: string
}

// 예시 YouTube 영상 데이터 (실제로는 Supabase나 외부 API에서 가져올 수 있음)
const defaultVideos: YouTubeVideo[] = [
  {
    id: "1",
    title: "보조기기센터 소개",
    thumbnail: "https://img.youtube.com/vi/dQw4w9WgXcQ/maxresdefault.jpg",
    url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
  },
  {
    id: "2",
    title: "보조기기 체험 프로그램",
    thumbnail: "https://img.youtube.com/vi/dQw4w9WgXcQ/maxresdefault.jpg",
    url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
  },
  {
    id: "3",
    title: "맞춤형 보조기기 제작",
    thumbnail: "https://img.youtube.com/vi/dQw4w9WgXcQ/maxresdefault.jpg",
    url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
  },
]

interface HomeGallerySliderProps {
  videos?: YouTubeVideo[]
}

export function HomeGallerySlider({ videos = defaultVideos }: HomeGallerySliderProps) {
  const [currentIndex, setCurrentIndex] = useState(0)

  const nextSlide = () => {
    setCurrentIndex((prev) => (prev + 1) % videos.length)
  }

  const prevSlide = () => {
    setCurrentIndex((prev) => (prev - 1 + videos.length) % videos.length)
  }

  const goToSlide = (index: number) => {
    setCurrentIndex(index)
  }

  if (videos.length === 0) {
    return null
  }

  return (
    <section id="gallery" className="py-12 sm:py-16 md:py-24 bg-background scroll-mt-16">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8">
        <h2 className="text-responsive-xl font-bold text-center text-foreground mb-8 sm:mb-12">
          보조기기 영상 갤러리
        </h2>
        <div className="relative max-w-4xl mx-auto">
          {/* 슬라이더 컨테이너 */}
          <div className="relative overflow-hidden rounded-lg">
            <div
              className="flex transition-transform duration-500 ease-in-out"
              style={{ transform: `translateX(-${currentIndex * 100}%)` }}
            >
              {videos.map((video) => (
                <div key={video.id} className="min-w-full">
                  <Card className="border-0 shadow-lg">
                    <CardContent className="p-0">
                      <div className="relative aspect-video bg-muted">
                        <img
                          src={video.thumbnail}
                          alt={video.title}
                          className="w-full h-full object-cover"
                        />
                        <div className="absolute inset-0 bg-black/20 flex items-center justify-center">
                          <Button
                            asChild
                            size="lg"
                            className="bg-red-600 hover:bg-red-700 text-white"
                          >
                            <a
                              href={video.url}
                              target="_blank"
                              rel="noopener noreferrer"
                              className="flex items-center gap-2"
                            >
                              <ExternalLink className="h-5 w-5" />
                              YouTube에서 보기
                            </a>
                          </Button>
                        </div>
                      </div>
                      <div className="p-4 sm:p-6">
                        <h3 className="text-lg sm:text-xl font-semibold text-foreground">
                          {video.title}
                        </h3>
                      </div>
                    </CardContent>
                  </Card>
                </div>
              ))}
            </div>
          </div>

          {/* 네비게이션 버튼 */}
          {videos.length > 1 && (
            <>
              <Button
                variant="outline"
                size="icon"
                className="absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 z-10 bg-background/80 backdrop-blur-sm"
                onClick={prevSlide}
                aria-label="이전 영상"
              >
                <ChevronLeft className="h-4 w-4" />
              </Button>
              <Button
                variant="outline"
                size="icon"
                className="absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 z-10 bg-background/80 backdrop-blur-sm"
                onClick={nextSlide}
                aria-label="다음 영상"
              >
                <ChevronRight className="h-4 w-4" />
              </Button>
            </>
          )}

          {/* 인디케이터 */}
          {videos.length > 1 && (
            <div className="flex justify-center gap-2 mt-4 sm:mt-6">
              {videos.map((_, index) => (
                <button
                  key={index}
                  onClick={() => goToSlide(index)}
                  className={cn(
                    "h-2 rounded-full transition-all",
                    index === currentIndex
                      ? "w-8 bg-primary"
                      : "w-2 bg-muted-foreground/30 hover:bg-muted-foreground/50"
                  )}
                  aria-label={`${index + 1}번째 영상으로 이동`}
                />
              ))}
            </div>
          )}
        </div>
      </div>
    </section>
  )
}
</file>

<file path="components/features/landing/HomeHeroSection.tsx">
import Image from "next/image"
import Link from "next/link"
import { Button } from "@/components/ui/button"
import { ArrowRight } from "lucide-react"

export function HomeHeroSection() {
  return (
    <section id="hero" className="relative flex min-h-[70vh] sm:min-h-[80vh] items-center justify-center overflow-hidden">
      {/* Background Image */}
      <div className="absolute inset-0 z-0">
        <Image
          src="https://images.unsplash.com/photo-1709127347874-3f4674be5bc8?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w4MTYyMzB8MHwxfHNlYXJjaHw0fHxhc3Npc3RpdmUlMjB0ZWNobm9sb2d5JTIwY2FyZSUyMHN1cHBvcnR8ZW58MHwwfHx8MTc2NTAzNjU1Mnww&ixlib=rb-4.1.0&q=80&w=1920"
          alt="보조기기센터 케어 지원"
          fill
          className="object-cover"
          priority
          quality={90}
        />
        {/* Dark Overlay for better text readability */}
        <div className="absolute inset-0 bg-gradient-to-b from-black/60 via-black/50 to-black/70" />
      </div>

      {/* Hero Content */}
      <div className="relative z-10 mx-auto max-w-4xl px-4 sm:px-6 lg:px-8 text-center">
        <h1 className="text-responsive-xl font-bold text-white drop-shadow-lg mb-4 sm:mb-6">
          Co-AT
        </h1>
        <p className="text-responsive-lg text-white/95 drop-shadow-md mb-2 sm:mb-4">
          GWATC 통합 케어 플랫폼
        </p>
        <p className="text-responsive text-white/90 drop-shadow-sm mb-6 sm:mb-8 max-w-2xl mx-auto">
          행정은 AI에게, 사람은 클라이언트에게
        </p>
        <div className="flex flex-col sm:flex-row gap-4 justify-center items-center">
          <Button asChild size="lg" className="text-base sm:text-lg px-6 sm:px-8">
            <Link href="/portal/mypage">
              서비스 이용하기
              <ArrowRight className="ml-2 h-4 w-4" />
            </Link>
          </Button>
          <Button
            asChild
            variant="outline"
            size="lg"
            className="text-base sm:text-lg px-6 sm:px-8 bg-white/10 backdrop-blur-sm border-white/20 text-white hover:bg-white/20"
          >
            <Link href="/notices">공지사항 보기</Link>
          </Button>
        </div>
      </div>
    </section>
  )
}
</file>

<file path="components/features/landing/HomeNoticeTabs.tsx">
"use client"

import { useState } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { getRecentNotices, getNoticesByCategory, type Notice } from "@/actions/notice-actions"
import { format } from "date-fns"
import { ko } from "date-fns/locale"
import Link from "next/link"
import { ArrowRight } from "lucide-react"
import { Button } from "@/components/ui/button"

interface HomeNoticeTabsProps {
  initialNotices: Notice[]
  initialSupportNotices: Notice[]
}

export function HomeNoticeTabs({
  initialNotices,
  initialSupportNotices,
}: HomeNoticeTabsProps) {
  const [notices, setNotices] = useState(initialNotices)
  const [supportNotices, setSupportNotices] = useState(initialSupportNotices)

  return (
    <section id="notices" className="py-12 sm:py-16 md:py-24 bg-muted/30 scroll-mt-16">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8">
        <h2 className="text-responsive-xl font-bold text-center text-foreground mb-8 sm:mb-12">
          공지사항 및 지원사업
        </h2>
        <Tabs defaultValue="notice" className="w-full">
          <TabsList className="grid w-full grid-cols-2 mb-6 sm:mb-8">
            <TabsTrigger value="notice" className="text-sm sm:text-base">
              공지사항
            </TabsTrigger>
            <TabsTrigger value="support" className="text-sm sm:text-base">
              지원사업
            </TabsTrigger>
          </TabsList>
          <TabsContent value="notice" className="space-y-4">
            {notices.length === 0 ? (
              <Card>
                <CardContent className="p-6 sm:p-8 text-center text-muted-foreground">
                  등록된 공지사항이 없습니다.
                </CardContent>
              </Card>
            ) : (
              <>
                {notices.map((notice) => (
                  <Link key={notice.id} href={`/notices/${notice.id}`}>
                    <Card className="hover:shadow-md transition-shadow cursor-pointer">
                      <CardHeader className="pb-3">
                        <div className="flex items-start justify-between gap-4">
                          <CardTitle className="text-base sm:text-lg text-foreground line-clamp-2">
                            {notice.is_pinned && (
                              <span className="inline-block mr-2 text-primary">📌</span>
                            )}
                            {notice.title}
                          </CardTitle>
                          <span className="text-xs sm:text-sm text-muted-foreground whitespace-nowrap">
                            {format(new Date(notice.created_at), "yyyy.MM.dd", {
                              locale: ko,
                            })}
                          </span>
                        </div>
                      </CardHeader>
                      <CardContent>
                        <p className="text-sm sm:text-base text-muted-foreground line-clamp-2">
                          {notice.content}
                        </p>
                      </CardContent>
                    </Card>
                  </Link>
                ))}
                <div className="flex justify-center pt-4">
                  <Button asChild variant="outline">
                    <Link href="/notices">
                      전체 보기
                      <ArrowRight className="ml-2 h-4 w-4" />
                    </Link>
                  </Button>
                </div>
              </>
            )}
          </TabsContent>
          <TabsContent value="support" className="space-y-4">
            {supportNotices.length === 0 ? (
              <Card>
                <CardContent className="p-6 sm:p-8 text-center text-muted-foreground">
                  등록된 지원사업이 없습니다.
                </CardContent>
              </Card>
            ) : (
              <>
                {supportNotices.map((notice) => (
                  <Link key={notice.id} href={`/notices/${notice.id}`}>
                    <Card className="hover:shadow-md transition-shadow cursor-pointer">
                      <CardHeader className="pb-3">
                        <div className="flex items-start justify-between gap-4">
                          <CardTitle className="text-base sm:text-lg text-foreground line-clamp-2">
                            {notice.is_pinned && (
                              <span className="inline-block mr-2 text-primary">📌</span>
                            )}
                            {notice.title}
                          </CardTitle>
                          <span className="text-xs sm:text-sm text-muted-foreground whitespace-nowrap">
                            {format(new Date(notice.created_at), "yyyy.MM.dd", {
                              locale: ko,
                            })}
                          </span>
                        </div>
                      </CardHeader>
                      <CardContent>
                        <p className="text-sm sm:text-base text-muted-foreground line-clamp-2">
                          {notice.content}
                        </p>
                      </CardContent>
                    </Card>
                  </Link>
                ))}
                <div className="flex justify-center pt-4">
                  <Button asChild variant="outline">
                    <Link href="/notices?category=support">
                      전체 보기
                      <ArrowRight className="ml-2 h-4 w-4" />
                    </Link>
                  </Button>
                </div>
              </>
            )}
          </TabsContent>
        </Tabs>
      </div>
    </section>
  )
}
</file>

<file path="components/features/landing/HomePublicCalendar.tsx">
"use client"

import { useState, useEffect } from "react"
import { Calendar } from "@/components/ui/calendar"
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from "@/components/ui/dialog"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { getPublicSchedules, getPublicSchedulesByDate, type PublicSchedule } from "@/actions/schedule-actions"
import { format } from "date-fns"
import { ko } from "date-fns/locale"
import { useAuth } from "@clerk/nextjs"
import { Calendar as CalendarIcon, MapPin, Clock, BookOpen } from "lucide-react"
import { cn } from "@/lib/utils"

interface HomePublicCalendarProps {
  initialSchedules?: PublicSchedule[]
}

export function HomePublicCalendar({ initialSchedules = [] }: HomePublicCalendarProps) {
  const [selectedDate, setSelectedDate] = useState<Date | undefined>(new Date())
  const [schedules, setSchedules] = useState<PublicSchedule[]>(initialSchedules)
  const [selectedSchedules, setSelectedSchedules] = useState<PublicSchedule[]>([])
  const [isDialogOpen, setIsDialogOpen] = useState(false)
  const [isBookingDialogOpen, setIsBookingDialogOpen] = useState(false)
  const [bookingSchedule, setBookingSchedule] = useState<PublicSchedule | null>(null)
  const { userId } = useAuth()
  const isSignedIn = !!userId

  // 날짜 선택 시 해당 날짜의 일정 조회
  useEffect(() => {
    if (selectedDate) {
      getPublicSchedulesByDate(selectedDate).then(setSelectedSchedules)
    }
  }, [selectedDate])

  // 날짜에 일정이 있는지 확인하는 함수
  const hasSchedule = (date: Date): boolean => {
    const dateStr = format(date, "yyyy-MM-dd")
    return schedules.some((schedule) => schedule.scheduled_date === dateStr)
  }

  // 날짜 클릭 핸들러
  const handleDateSelect = (date: Date | undefined) => {
    if (!date) return
    setSelectedDate(date)
    const dateStr = format(date, "yyyy-MM-dd")
    const daySchedules = schedules.filter(
      (schedule) => schedule.scheduled_date === dateStr
    )
    setSelectedSchedules(daySchedules)
    if (daySchedules.length > 0) {
      setIsDialogOpen(true)
    }
  }

  // 예약 버튼 클릭 핸들러
  const handleBookingClick = (schedule: PublicSchedule) => {
    if (!isSignedIn) {
      // 로그인 페이지로 리다이렉트
      window.location.href = "/sign-in?redirect_url=/"
      return
    }
    setBookingSchedule(schedule)
    setIsBookingDialogOpen(true)
  }

  // 예약 확인 핸들러 (나중에 createApplication 호출)
  const handleConfirmBooking = async () => {
    if (!bookingSchedule) return
    // TODO: createApplication() 호출
    console.log("예약 확인:", bookingSchedule)
    setIsBookingDialogOpen(false)
    // 성공 메시지 표시
  }

  return (
    <section id="calendar" className="py-12 sm:py-16 md:py-24 bg-muted/30 scroll-mt-16">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8">
        <h2 className="text-responsive-xl font-bold text-center text-foreground mb-8 sm:mb-12">
          공개 일정 캘린더
        </h2>
        <div className="max-w-4xl mx-auto">
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <CalendarIcon className="h-5 w-5" />
                견학 및 교육 일정
              </CardTitle>
            </CardHeader>
            <CardContent className="p-4 sm:p-6">
              <div className="flex flex-col lg:flex-row gap-6 sm:gap-8">
                {/* 캘린더 */}
                <div className="flex-1">
                  <Calendar
                    mode="single"
                    selected={selectedDate}
                    onSelect={handleDateSelect}
                    modifiers={{
                      hasSchedule: (date) => hasSchedule(date),
                    }}
                    modifiersClassNames={{
                      hasSchedule: "bg-primary/10 text-primary font-semibold",
                    }}
                    className="rounded-md border"
                    classNames={{
                      day_selected: "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground",
                    }}
                  />
                </div>

                {/* 선택된 날짜의 일정 목록 */}
                {selectedDate && (
                  <div className="flex-1 space-y-4">
                    <h3 className="text-lg font-semibold text-foreground">
                      {format(selectedDate, "yyyy년 MM월 dd일", { locale: ko })} 일정
                    </h3>
                    {selectedSchedules.length === 0 ? (
                      <p className="text-sm text-muted-foreground">
                        선택한 날짜에 일정이 없습니다.
                      </p>
                    ) : (
                      <div className="space-y-3">
                        {selectedSchedules.map((schedule) => (
                          <Card
                            key={schedule.id}
                            className="hover:shadow-md transition-shadow cursor-pointer"
                            onClick={() => handleDateSelect(selectedDate)}
                          >
                            <CardContent className="p-4">
                              <div className="flex items-start justify-between gap-4">
                                <div className="flex-1">
                                  <div className="flex items-center gap-2 mb-2">
                                    <Badge
                                      variant={
                                        schedule.schedule_type === "exhibition"
                                          ? "default"
                                          : "secondary"
                                      }
                                    >
                                      {schedule.schedule_type === "exhibition"
                                        ? "견학"
                                        : "교육"}
                                    </Badge>
                                  </div>
                                  {schedule.scheduled_time && (
                                    <div className="flex items-center gap-2 text-sm text-muted-foreground mb-1">
                                      <Clock className="h-4 w-4" />
                                      {schedule.scheduled_time}
                                    </div>
                                  )}
                                  {schedule.address && (
                                    <div className="flex items-center gap-2 text-sm text-muted-foreground">
                                      <MapPin className="h-4 w-4" />
                                      {schedule.address}
                                    </div>
                                  )}
                                </div>
                                <Button
                                  size="sm"
                                  onClick={(e) => {
                                    e.stopPropagation()
                                    handleBookingClick(schedule)
                                  }}
                                >
                                  예약
                                </Button>
                              </div>
                            </CardContent>
                          </Card>
                        ))}
                      </div>
                    )}
                  </div>
                )}
              </div>
            </CardContent>
          </Card>
        </div>
      </div>

      {/* 일정 상세 정보 모달 */}
      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
        <DialogContent className="max-w-md">
          <DialogHeader>
            <DialogTitle>일정 상세 정보</DialogTitle>
            <DialogDescription>
              {selectedDate &&
                format(selectedDate, "yyyy년 MM월 dd일", { locale: ko })}
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4">
            {selectedSchedules.map((schedule) => (
              <div key={schedule.id} className="space-y-2">
                <div className="flex items-center gap-2">
                  <Badge
                    variant={
                      schedule.schedule_type === "exhibition"
                        ? "default"
                        : "secondary"
                    }
                  >
                    {schedule.schedule_type === "exhibition" ? "견학" : "교육"}
                  </Badge>
                </div>
                {schedule.scheduled_time && (
                  <div className="flex items-center gap-2 text-sm">
                    <Clock className="h-4 w-4 text-muted-foreground" />
                    <span className="text-foreground">{schedule.scheduled_time}</span>
                  </div>
                )}
                {schedule.address && (
                  <div className="flex items-center gap-2 text-sm">
                    <MapPin className="h-4 w-4 text-muted-foreground" />
                    <span className="text-foreground">{schedule.address}</span>
                  </div>
                )}
                {schedule.notes && (
                  <div className="flex items-start gap-2 text-sm">
                    <BookOpen className="h-4 w-4 text-muted-foreground mt-0.5" />
                    <p className="text-foreground">{schedule.notes}</p>
                  </div>
                )}
                <Button
                  className="w-full mt-4"
                  onClick={() => {
                    setIsDialogOpen(false)
                    handleBookingClick(schedule)
                  }}
                >
                  예약하기
                </Button>
              </div>
            ))}
          </div>
        </DialogContent>
      </Dialog>

      {/* 예약 확인 모달 */}
      <Dialog open={isBookingDialogOpen} onOpenChange={setIsBookingDialogOpen}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>견학 예약 확인</DialogTitle>
            <DialogDescription>
              아래 일정으로 견학을 예약하시겠습니까?
            </DialogDescription>
          </DialogHeader>
          {bookingSchedule && (
            <div className="space-y-4">
              <div>
                <p className="text-sm font-medium text-foreground mb-1">일정 유형</p>
                <Badge>
                  {bookingSchedule.schedule_type === "exhibition" ? "견학" : "교육"}
                </Badge>
              </div>
              <div>
                <p className="text-sm font-medium text-foreground mb-1">날짜</p>
                <p className="text-sm text-muted-foreground">
                  {format(
                    new Date(bookingSchedule.scheduled_date),
                    "yyyy년 MM월 dd일",
                    { locale: ko }
                  )}
                </p>
              </div>
              {bookingSchedule.scheduled_time && (
                <div>
                  <p className="text-sm font-medium text-foreground mb-1">시간</p>
                  <p className="text-sm text-muted-foreground">
                    {bookingSchedule.scheduled_time}
                  </p>
                </div>
              )}
              {bookingSchedule.address && (
                <div>
                  <p className="text-sm font-medium text-foreground mb-1">장소</p>
                  <p className="text-sm text-muted-foreground">
                    {bookingSchedule.address}
                  </p>
                </div>
              )}
            </div>
          )}
          <DialogFooter>
            <Button variant="outline" onClick={() => setIsBookingDialogOpen(false)}>
              취소
            </Button>
            <Button onClick={handleConfirmBooking}>예약 확인</Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </section>
  )
}
</file>

<file path="components/features/landing/HomeQuickMenuGrid.tsx">
import Link from "next/link"
import { Card, CardContent } from "@/components/ui/card"
import {
  MessageSquare,
  Eye,
  Wrench,
  Package,
  GraduationCap,
} from "lucide-react"
import { cn } from "@/lib/utils"

const serviceCategories = [
  {
    id: "consult",
    label: "상담",
    description: "보조기기 상담 및 평가",
    icon: MessageSquare,
    href: "/portal/apply?category=consult",
    color: "bg-blue-500",
  },
  {
    id: "experience",
    label: "체험",
    description: "보조기기 체험 및 견학",
    icon: Eye,
    href: "/portal/apply?category=experience",
    color: "bg-purple-500",
  },
  {
    id: "custom",
    label: "맞춤형",
    description: "맞춤 제작 및 대여",
    icon: Wrench,
    href: "/portal/apply?category=custom",
    color: "bg-green-500",
  },
  {
    id: "aftercare",
    label: "사후관리",
    description: "수리 및 세척 서비스",
    icon: Package,
    href: "/portal/apply?category=aftercare",
    color: "bg-orange-500",
  },
  {
    id: "education",
    label: "교육홍보",
    description: "교육 프로그램 신청",
    icon: GraduationCap,
    href: "/portal/apply?category=education",
    color: "bg-pink-500",
  },
]

export function HomeQuickMenuGrid() {
  return (
    <section id="services" className="py-12 sm:py-16 md:py-24 bg-background scroll-mt-16">
      <div className="container mx-auto px-4 sm:px-6 lg:px-8">
        <h2 className="text-responsive-xl font-bold text-center text-foreground mb-8 sm:mb-12">
          5대 핵심 사업
        </h2>
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 md:gap-6">
          {serviceCategories.map((service) => {
            const Icon = service.icon
            return (
              <Link key={service.id} href={service.href}>
                <Card className="h-full hover:shadow-lg transition-shadow cursor-pointer group">
                  <CardContent className="p-6 sm:p-8 flex flex-col items-center text-center gap-4">
                    <div
                      className={cn(
                        "w-16 h-16 rounded-full flex items-center justify-center text-white group-hover:scale-110 transition-transform",
                        service.color
                      )}
                    >
                      <Icon className="h-8 w-8" />
                    </div>
                    <div>
                      <h3 className="text-lg sm:text-xl font-semibold text-foreground mb-2">
                        {service.label}
                      </h3>
                      <p className="text-sm sm:text-base text-muted-foreground">
                        {service.description}
                      </p>
                    </div>
                  </CardContent>
                </Card>
              </Link>
            )
          })}
        </div>
      </div>
    </section>
  )
}
</file>

<file path="components/layout/admin-header.tsx">
"use client"

import { Logo } from "@/components/common/logo"
import { UserButton, useUser } from "@clerk/nextjs"
import { Button } from "@/components/ui/button"
import Link from "next/link"
import { Home, LogOut } from "lucide-react"
import { useRouter } from "next/navigation"
import { useState } from "react"

export function AdminHeader() {
  const router = useRouter()
  const { user } = useUser()
  const [isLoggingOut, setIsLoggingOut] = useState(false)

  const handleAdminLogout = async () => {
    setIsLoggingOut(true)
    try {
      // 관리자 세션 쿠키 삭제
      await fetch('/api/admin/session', {
        method: 'DELETE',
      })
      
      // 홈으로 이동
      router.push('/')
    } catch (error) {
      console.error('관리자 로그아웃 실패:', error)
      // 에러가 발생해도 홈으로 이동
      router.push('/')
    } finally {
      setIsLoggingOut(false)
    }
  }

  return (
    <header className="sticky top-0 z-40 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <div className="container flex h-14 sm:h-16 items-center justify-between px-4 sm:px-6">
        <div className="flex items-center gap-4">
          <Link href="/admin/dashboard" className="flex items-center">
            <Logo />
          </Link>
        </div>
        <nav className="flex items-center gap-2 sm:gap-4">
          <Button asChild variant="ghost" size="sm" className="text-xs sm:text-sm">
            <Link href="/">
              <Home className="h-4 w-4 mr-2" />
              홈으로
            </Link>
          </Button>
          <Button
            variant="ghost"
            size="sm"
            onClick={handleAdminLogout}
            disabled={isLoggingOut}
            className="text-xs sm:text-sm"
          >
            <LogOut className="h-4 w-4 mr-2" />
            관리자 로그아웃
          </Button>
          <UserButton afterSignOutUrl="/" />
        </nav>
      </div>
    </header>
  )
}
</file>

<file path="components/layout/public-footer.tsx">
import { Logo } from "@/components/common/logo"

export function PublicFooter() {
  return (
    <footer className="border-t bg-muted/50">
      <div className="container px-4 sm:px-6 py-6 sm:py-8">
        <div className="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
          <div className="flex flex-col gap-2">
            <Logo />
            <p className="text-xs sm:text-sm text-muted-foreground">
              강원특별자치도 보조기기센터
            </p>
          </div>
          <div className="text-xs sm:text-sm text-muted-foreground">
            <p>© 2025 GWATC. All rights reserved.</p>
          </div>
        </div>
      </div>
    </footer>
  )
}
</file>

<file path="lib/supabase/server.ts">
/**
 * Supabase Server Client (Server Component용)
 * 서버 사이드에서 사용하는 Supabase 클라이언트 (Cookie 기반 인증)
 * Next.js 16 호환
 */
import { createServerClient } from "@supabase/ssr";
import { cookies } from "next/headers";
import { Database } from "@/types/database.types";

export async function createClient() {
  // Next.js 16에서는 cookies()를 await해야 함
  const cookieStore = await cookies();

  return createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          // Next.js 16 호환: cookieStore.getAll()의 반환값을 배열로 변환
          // ReadonlyRequestCookies.getAll()은 ReadonlyRequestCookie[]를 반환하므로
          // 일반 객체 배열로 변환하여 Supabase SSR과 호환되도록 함
          try {
            const allCookies = cookieStore.getAll();
            // ReadonlyRequestCookie 객체를 일반 객체로 변환
            return Array.from(allCookies).map((cookie) => ({
              name: cookie.name,
              value: cookie.value,
            }));
          } catch (error) {
            console.error("Cookie getAll failed:", error);
            return [];
          }
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) => {
              cookieStore.set(name, value, options);
            });
          } catch (error) {
            // The `setAll` method was called from a Server Component.
            // This can be ignored if you have middleware refreshing
            // user sessions.
            console.warn("Cookie setAll failed:", error);
          }
        },
      },
    }
  );
}
</file>

<file path="lib/utils/permissions.ts">
"use server"

import { auth } from "@clerk/nextjs/server"
import { createClient } from "@/lib/supabase/server"

export type UserRole = "user" | "staff" | "manager"

/**
 * 현재 사용자의 역할 조회
 */
export async function getCurrentUserRole(): Promise<UserRole | null> {
  try {
    const { userId } = await auth()

    if (!userId) {
      console.log("[권한 확인] 사용자 ID 없음")
      return null
    }

    const supabase = await createClient()

    const { data: profile, error } = await supabase
      .from("profiles")
      .select("role")
      .eq("clerk_user_id", userId)
      .single()

    if (error || !profile) {
      console.log("[권한 확인] 프로필 조회 실패:", error?.message || "프로필 없음")
      return null
    }

    const role = (profile.role as UserRole) || "user"
    console.log("[권한 확인] 사용자 역할:", role, "userId:", userId)
    return role
  } catch (error) {
    console.error("[권한 확인] 오류:", error)
    return null
  }
}

/**
 * 관리자 또는 직원 권한 확인 (manager 또는 staff)
 */
export async function hasAdminOrStaffPermission(): Promise<boolean> {
  const role = await getCurrentUserRole()
  return role === "manager" || role === "staff"
}

/**
 * 관리자 권한 확인 (manager만)
 */
export async function hasManagerPermission(): Promise<boolean> {
  const role = await getCurrentUserRole()
  return role === "manager"
}

/**
 * 현재 사용자의 프로필 ID 조회
 */
export async function getCurrentUserProfileId(): Promise<string | null> {
  try {
    const { userId } = await auth()

    if (!userId) {
      return null
    }

    const supabase = await createClient()

    const { data: profile, error } = await supabase
      .from("profiles")
      .select("id")
      .eq("clerk_user_id", userId)
      .single()

    if (error || !profile) {
      return null
    }

    return profile.id
  } catch (error) {
    console.error("Error getting user profile ID:", error)
    return null
  }
}
</file>

<file path="migrations/006_create_notices.sql">
-- notices 테이블 생성
-- 실행일: 2025-01-XX
-- 설명: 공지사항 테이블 (공지, 지원사업, 이벤트 등)

CREATE TABLE IF NOT EXISTS notices (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  
  -- 공지사항 내용
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  category TEXT CHECK (category IN ('notice', 'support', 'event')),
  
  -- 공지사항 설정
  is_pinned BOOLEAN DEFAULT false,
  
  -- 작성자 정보
  created_by UUID REFERENCES profiles(id) ON DELETE SET NULL,
  
  -- 타임스탬프
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ
);

-- 인덱스 생성 (성능 최적화)
CREATE INDEX IF NOT EXISTS idx_notices_category ON notices(category);
CREATE INDEX IF NOT EXISTS idx_notices_is_pinned ON notices(is_pinned);
CREATE INDEX IF NOT EXISTS idx_notices_created_at ON notices(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_notices_created_by ON notices(created_by);

-- 복합 인덱스 (공지사항 목록 조회 최적화)
CREATE INDEX IF NOT EXISTS idx_notices_pinned_created ON notices(is_pinned DESC, created_at DESC);
CREATE INDEX IF NOT EXISTS idx_notices_category_created ON notices(category, created_at DESC);

-- updated_at 자동 업데이트를 위한 트리거 함수 (필요시 별도 생성)
-- CREATE OR REPLACE FUNCTION update_updated_at_column()
-- RETURNS TRIGGER AS $$
-- BEGIN
--   NEW.updated_at = now();
--   RETURN NEW;
-- END;
-- $$ language 'plpgsql';
--
-- CREATE TRIGGER update_notices_updated_at BEFORE UPDATE ON notices
--   FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- 테이블 및 컬럼 코멘트
COMMENT ON TABLE notices IS '공지사항 테이블 (공지, 활동 소식, 지원사업, 서비스 사례 등)';
COMMENT ON COLUMN notices.category IS '공지사항 카테고리: notice(공지), event(활동 소식), support(지원사업), case(서비스 사례)';
COMMENT ON COLUMN notices.is_pinned IS '상단 고정 여부 (true일 경우 목록 상단에 고정 표시)';
</file>

<file path="next.config.mjs">
/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'images.unsplash.com',
        port: '',
        pathname: '/**',
      },
    ],
  },
};

export default nextConfig;
</file>

<file path="app/(portal)/mypage/page.tsx">
import { ClientTimelineList } from "@/components/features/portal/ClientTimelineList"
import { ClientRentStatus } from "@/components/features/portal/ClientRentStatus"
import { getMyApplications, getMyRentals } from "@/actions/portal-actions"
import { auth } from "@clerk/nextjs/server"
import { redirect } from "next/navigation"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import Link from "next/link"
import { Plus } from "lucide-react"

export default async function MyPage() {
  const { userId } = await auth()

  if (!userId) {
    redirect("/sign-in")
  }

  // 데이터 페칭
  const [historyResult, rentalsResult] = await Promise.all([
    getMyServiceHistory(),
    getMyRentals(),
  ])

  const history = historyResult.success ? historyResult.history || [] : []
  const rentals = rentalsResult.success ? rentalsResult.rentals || [] : []

  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <div className="mb-8">
        <h1 className="text-responsive-xl font-bold text-foreground mb-2">
          마이페이지
        </h1>
        <p className="text-muted-foreground">
          서비스 신청 이력과 대여 중인 기기를 확인할 수 있습니다
        </p>
      </div>

      <div className="grid gap-6 lg:grid-cols-3">
        {/* 좌측: 대여 중인 기기 */}
        <div className="lg:col-span-1">
          <ClientRentStatus rentals={rentals} />
        </div>

        {/* 우측: 신청 이력 */}
        <div className="lg:col-span-2">
          <Card>
            <CardHeader>
              <div className="flex items-center justify-between">
                <CardTitle>서비스 신청 이력</CardTitle>
                <Button asChild size="sm">
                  <Link href="/portal/apply">
                    <Plus className="mr-2 h-4 w-4" />
                    새 신청
                  </Link>
                </Button>
              </div>
            </CardHeader>
            <CardContent>
              <ClientTimelineList history={history} />
            </CardContent>
          </Card>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="components/layout/mobile-bottom-nav.tsx">
"use client"

import Link from "next/link"
import { usePathname } from "next/navigation"
import { cn } from "@/lib/utils"
import { Home, FileText, User } from "lucide-react"

const navItems = [
  { href: "/portal/mypage", label: "홈", icon: Home },
  { href: "/portal/apply", label: "신청", icon: FileText },
  { href: "/portal/mypage", label: "마이페이지", icon: User },
]

export function MobileBottomNav() {
  const pathname = usePathname()

  return (
    <nav className="fixed bottom-0 left-0 right-0 z-50 border-t bg-background md:hidden">
      <div className="flex items-center justify-around safe-area-bottom">
        {navItems.map((item) => {
          const Icon = item.icon
          const isActive = pathname === item.href || pathname?.startsWith(item.href + "/")

          return (
            <Link
              key={item.href}
              href={item.href}
              className={cn(
                "flex flex-col items-center gap-1 px-2 sm:px-4 py-2 text-[10px] sm:text-xs transition-colors min-w-0 flex-1",
                isActive
                  ? "text-primary"
                  : "text-muted-foreground"
              )}
            >
              <Icon className="h-5 w-5 sm:h-6 sm:w-6" />
              <span className="truncate w-full text-center">{item.label}</span>
            </Link>
          )
        })}
      </div>
    </nav>
  )
}
</file>

<file path="middleware.ts">
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'
import { NextResponse } from 'next/server'

// 보호가 필요한 경로 정의
const isProtectedRoute = createRouteMatcher([
  '/portal(.*)',
  '/admin(.*)',
])

// 공개 경로 (인증 없이 접근 가능)
const isPublicRoute = createRouteMatcher([
  '/',
  '/sign-in(.*)',
  '/sign-up(.*)',
  '/notices(.*)',
])

export default clerkMiddleware(async (auth, req) => {
  const { userId, sessionClaims } = await auth()
  const url = req.nextUrl.clone()

  // 보호된 경로 접근 시 인증 확인
  if (isProtectedRoute(req) && !userId) {
    const signInUrl = new URL('/sign-in', req.url)
    signInUrl.searchParams.set('redirect_url', req.url)
    return NextResponse.redirect(signInUrl)
  }

  // 관리자 경로 접근 시 관리자 세션 확인
  const adminPaths = ['/admin', '/notices-management', '/dashboard']
  const isAdminPath = adminPaths.some(path => url.pathname.startsWith(path))
  const isCreateProfilePath = url.pathname === '/create-profile' || url.pathname === '/admin/create-profile'
  const isAdminRootPath = url.pathname === '/admin' // 관리자 로그인 페이지
  const isAdminSessionApi = url.pathname === '/api/admin/session'
  
  // 관리자 경로 접근 시 (로그인 페이지와 API 제외)
  if (isAdminPath && !isCreateProfilePath && !isAdminRootPath && !isAdminSessionApi) {
    // 관리자 세션 쿠키 확인
    const adminSession = req.cookies.get('admin_session')?.value
    
    if (!adminSession) {
      // 관리자 세션이 없으면 관리자 로그인 페이지로 리다이렉트
      const adminSignInUrl = new URL('/admin', req.url)
      adminSignInUrl.searchParams.set('redirect_url', req.url)
      return NextResponse.redirect(adminSignInUrl)
    }
    
    // 관리자 세션이 있지만 로그인하지 않은 경우
    if (!userId) {
      const adminSignInUrl = new URL('/admin', req.url)
      adminSignInUrl.searchParams.set('redirect_url', req.url)
      return NextResponse.redirect(adminSignInUrl)
    }
  }

  return NextResponse.next()
})

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}
</file>

<file path="tailwind.config.ts">
import type { Config } from "tailwindcss";

const config: Config = {
  darkMode: ["class"],
  content: [
    "./pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {
      colors: {
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      fontFamily: {
        sans: [
          'Pretendard',
          '-apple-system',
          'BlinkMacSystemFont',
          'system-ui',
          'Roboto',
          'Helvetica Neue',
          'Segoe UI',
          'Apple SD Gothic Neo',
          'Noto Sans KR',
          'Malgun Gothic',
          'sans-serif',
        ],
      },
      fontSize: {
        // 반응형 폰트 크기 (모바일 우선)
        'xs': ['0.75rem', { lineHeight: '1rem' }],
        'sm': ['0.875rem', { lineHeight: '1.25rem' }],
        'base': ['1rem', { lineHeight: '1.5rem' }],
        'lg': ['1.125rem', { lineHeight: '1.75rem' }],
        'xl': ['1.25rem', { lineHeight: '1.75rem' }],
        '2xl': ['1.5rem', { lineHeight: '2rem' }],
        '3xl': ['1.875rem', { lineHeight: '2.25rem' }],
        '4xl': ['2.25rem', { lineHeight: '2.5rem' }],
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
};
export default config;
</file>

<file path="actions/notice-actions.ts">
"use server"

import { createClient } from "@/lib/supabase/server"
import { hasAdminOrStaffPermission, getCurrentUserProfileId } from "@/lib/utils/permissions"
import { revalidatePath } from "next/cache"

export interface Attachment {
  type: "image" | "pdf" | "youtube"
  url: string
  name: string
  size?: number
}

export interface Notice {
  id: string
  title: string
  content: string
  category: "notice" | "activity" | "support" | "case" | null
  is_pinned: boolean
  attachments?: Attachment[]
  created_at: string
  created_by: string | null
}

export interface CreateNoticeInput {
  title: string
  content: string
  category?: "notice" | "activity" | "support" | "case" | null
  is_pinned?: boolean
  attachments?: Attachment[]
}

export interface UpdateNoticeInput {
  id: string
  title?: string
  content?: string
  category?: "notice" | "activity" | "support" | "case" | null
  is_pinned?: boolean
  attachments?: Attachment[]
}

/**
 * 최신 공지사항 조회 (고정 공지 + 최신 공지)
 */
export async function getRecentNotices(limit: number = 5): Promise<Notice[]> {
  const supabase = await createClient()

  // 고정 공지사항 조회
  const { data: pinned, error: pinnedError } = await supabase
    .from("notices")
    .select("id, title, content, category, is_pinned, created_at, created_by")
    .eq("is_pinned", true)
    .order("created_at", { ascending: false })
    .limit(limit)

  if (pinnedError) {
    console.error("고정 공지사항 조회 실패:", pinnedError)
  }

  // 최신 공지사항 조회 (고정 제외)
  const { data: recent, error: recentError } = await supabase
    .from("notices")
    .select("id, title, content, category, is_pinned, created_at, created_by")
    .eq("is_pinned", false)
    .order("created_at", { ascending: false })
    .limit(limit)

  if (recentError) {
    console.error("최신 공지사항 조회 실패:", recentError)
  }

  // 고정 공지 + 최신 공지 합치기
  const allNotices = [...(pinned || []), ...(recent || [])]

  // attachments 필드가 있는 경우 추가로 조회
  const noticesWithAttachments = await Promise.all(
    allNotices.slice(0, limit).map(async (notice) => {
      try {
        const { data: noticeData } = await supabase
          .from("notices")
          .select("attachments")
          .eq("id", notice.id)
          .single()
        
        return {
          ...notice,
          attachments: noticeData?.attachments
            ? (typeof noticeData.attachments === "string"
                ? JSON.parse(noticeData.attachments)
                : noticeData.attachments)
            : undefined,
        }
      } catch {
        // attachments 컬럼이 없거나 파싱 실패 시 무시
        return {
          ...notice,
          attachments: undefined,
        }
      }
    })
  )

  return noticesWithAttachments
}

/**
 * 카테고리별 공지사항 조회
 */
export async function getNoticesByCategory(
  category: "notice" | "activity" | "support" | "case",
  limit: number = 10
): Promise<Notice[]> {
  const supabase = await createClient()

  const { data, error } = await supabase
    .from("notices")
    .select("id, title, content, category, is_pinned, created_at, created_by")
    .eq("category", category)
    .order("is_pinned", { ascending: false })
    .order("created_at", { ascending: false })
    .limit(limit)

  if (error) {
    console.error("카테고리별 공지사항 조회 실패:", error)
    return []
  }

  // attachments 필드가 있는 경우 추가로 조회
  const noticesWithAttachments = await Promise.all(
    (data || []).map(async (notice) => {
      try {
        const { data: noticeData } = await supabase
          .from("notices")
          .select("attachments")
          .eq("id", notice.id)
          .single()
        
        return {
          ...notice,
          attachments: noticeData?.attachments
            ? (typeof noticeData.attachments === "string"
                ? JSON.parse(noticeData.attachments)
                : noticeData.attachments)
            : undefined,
        }
      } catch {
        // attachments 컬럼이 없거나 파싱 실패 시 무시
        return {
          ...notice,
          attachments: undefined,
        }
      }
    })
  )

  return noticesWithAttachments
}

/**
 * 공지사항 상세 조회
 */
export async function getNoticeById(id: string): Promise<Notice | null> {
  const supabase = await createClient()

  const { data, error } = await supabase
    .from("notices")
    .select("id, title, content, category, is_pinned, created_at, created_by")
    .eq("id", id)
    .single()

  if (error) {
    console.error("공지사항 조회 실패:", error)
    return null
  }

  // attachments 필드가 있는 경우 추가로 조회
  try {
    const { data: noticeData } = await supabase
      .from("notices")
      .select("attachments")
      .eq("id", id)
      .single()
    
    return {
      ...data,
      attachments: noticeData?.attachments
        ? (typeof noticeData.attachments === "string"
            ? JSON.parse(noticeData.attachments)
            : noticeData.attachments)
        : undefined,
    }
  } catch {
    // attachments 컬럼이 없거나 파싱 실패 시 무시
    return {
      ...data,
      attachments: undefined,
    }
  }
}

/**
 * 공지사항 생성 (관리자/직원만)
 */
export async function createNotice(
  input: CreateNoticeInput
): Promise<{ success: boolean; noticeId?: string; error?: string }> {
  try {
    const hasPermission = await hasAdminOrStaffPermission()
    if (!hasPermission) {
      return { success: false, error: "권한이 없습니다" }
    }

    const profileId = await getCurrentUserProfileId()
    if (!profileId) {
      return { success: false, error: "사용자 정보를 찾을 수 없습니다" }
    }

    const supabase = await createClient()

    // attachments 컬럼이 있는지 확인하고 선택적으로 저장
    const insertData: any = {
      title: input.title,
      content: input.content,
      category: input.category || null,
      is_pinned: input.is_pinned || false,
      created_by: profileId,
    }

    // attachments 컬럼이 있는 경우에만 추가
    if (input.attachments && input.attachments.length > 0) {
      try {
        insertData.attachments = JSON.stringify(input.attachments)
      } catch {
        // JSON 변환 실패 시 무시
      }
    }

    const { data, error } = await supabase
      .from("notices")
      .insert(insertData)
      .select("id")
      .single()

    if (error) {
      console.error("공지사항 생성 실패:", error)
      return { success: false, error: "공지사항 생성에 실패했습니다" }
    }

    revalidatePath("/notices")
    revalidatePath("/admin/notices-management")

    return { success: true, noticeId: data.id }
  } catch (error) {
    console.error("Unexpected error in createNotice:", error)
    return { success: false, error: "예상치 못한 오류가 발생했습니다" }
  }
}

/**
 * 공지사항 수정 (관리자/직원만)
 */
export async function updateNotice(
  input: UpdateNoticeInput
): Promise<{ success: boolean; error?: string }> {
  try {
    const hasPermission = await hasAdminOrStaffPermission()
    if (!hasPermission) {
      return { success: false, error: "권한이 없습니다" }
    }

    const supabase = await createClient()

    const updateData: {
      title?: string
      content?: string
      category?: string | null
      is_pinned?: boolean
      attachments?: string | null
      updated_at?: string
    } = {
      updated_at: new Date().toISOString(),
    }

    if (input.title !== undefined) updateData.title = input.title
    if (input.content !== undefined) updateData.content = input.content
    if (input.category !== undefined) updateData.category = input.category
    if (input.is_pinned !== undefined) updateData.is_pinned = input.is_pinned
    if (input.attachments !== undefined) {
      updateData.attachments = input.attachments.length > 0
        ? JSON.stringify(input.attachments)
        : null
    }

    const { error } = await supabase
      .from("notices")
      .update(updateData)
      .eq("id", input.id)

    if (error) {
      console.error("공지사항 수정 실패:", error)
      return { success: false, error: "공지사항 수정에 실패했습니다" }
    }

    revalidatePath("/notices")
    revalidatePath(`/notices/${input.id}`)
    revalidatePath("/admin/notices")

    return { success: true }
  } catch (error) {
    console.error("Unexpected error in updateNotice:", error)
    return { success: false, error: "예상치 못한 오류가 발생했습니다" }
  }
}

/**
 * 공지사항 삭제 (관리자/직원만)
 */
export async function deleteNotice(
  id: string
): Promise<{ success: boolean; error?: string }> {
  try {
    const hasPermission = await hasAdminOrStaffPermission()
    if (!hasPermission) {
      return { success: false, error: "권한이 없습니다" }
    }

    const supabase = await createClient()

    const { error } = await supabase.from("notices").delete().eq("id", id)

    if (error) {
      console.error("공지사항 삭제 실패:", error)
      return { success: false, error: "공지사항 삭제에 실패했습니다" }
    }

    revalidatePath("/notices")
    revalidatePath("/admin/notices-management")

    return { success: true }
  } catch (error) {
    console.error("Unexpected error in deleteNotice:", error)
    return { success: false, error: "예상치 못한 오류가 발생했습니다" }
  }
}

/**
 * 모든 공지사항 조회 (관리자/직원용)
 */
export async function getAllNotices(): Promise<{
  success: boolean
  notices?: Notice[]
  error?: string
}> {
  try {
    const hasPermission = await hasAdminOrStaffPermission()
    if (!hasPermission) {
      return { success: false, error: "권한이 없습니다" }
    }

    const supabase = await createClient()

    // attachments 컬럼이 있는지 확인하고 선택적으로 조회
    const { data, error } = await supabase
      .from("notices")
      .select("id, title, content, category, is_pinned, created_at, created_by")
      .order("is_pinned", { ascending: false })
      .order("created_at", { ascending: false })

    if (error) {
      console.error("공지사항 조회 실패:", error)
      return { success: false, error: "공지사항 조회에 실패했습니다" }
    }

    // attachments 필드가 있는 경우 추가로 조회
    const noticesWithAttachments = await Promise.all(
      (data || []).map(async (notice) => {
        try {
          const { data: noticeData } = await supabase
            .from("notices")
            .select("attachments")
            .eq("id", notice.id)
            .single()
          
          return {
            ...notice,
            attachments: noticeData?.attachments
              ? (typeof noticeData.attachments === "string"
                  ? JSON.parse(noticeData.attachments)
                  : noticeData.attachments)
              : undefined,
          }
        } catch {
          // attachments 컬럼이 없거나 파싱 실패 시 무시
          return {
            ...notice,
            attachments: undefined,
          }
        }
      })
    )

    return { success: true, notices: noticesWithAttachments }
  } catch (error) {
    console.error("Unexpected error in getAllNotices:", error)
    return { success: false, error: "예상치 못한 오류가 발생했습니다" }
  }
}
</file>

<file path="app/(admin)/dashboard/page.tsx">
import { hasAdminOrStaffPermission } from "@/lib/utils/permissions"
import { redirect } from "next/navigation"
import { AdminDashboardContent } from "@/components/features/dashboard/AdminDashboardContent"

export default async function AdminDashboardPage() {
  // 개발 환경에서는 권한 체크를 완전히 우회하여 페이지 렌더링
  // 프로덕션 환경에서만 권한 체크 수행
  const isDevelopment = process.env.NODE_ENV !== "production"
  
  if (!isDevelopment) {
    try {
      const hasPermission = await hasAdminOrStaffPermission()
      if (!hasPermission) {
        console.log("[대시보드] 권한 없음 - 홈으로 리다이렉트")
        redirect("/")
      }
      console.log("[대시보드] 권한 확인 완료 - 페이지 렌더링")
    } catch (error) {
      console.error("[대시보드] 권한 확인 중 오류:", error)
      redirect("/")
    }
  }
  // 개발 환경: 권한 체크를 완전히 우회하고 바로 페이지 렌더링

  return (
    <div className="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <div className="mb-8">
        <h1 className="text-responsive-xl font-bold text-foreground mb-2">
          통합 대시보드
        </h1>
        <p className="text-muted-foreground">
          오늘의 실적과 신규 접수 건을 확인하실 수 있습니다
        </p>
      </div>

      <AdminDashboardContent />
    </div>
  )
}
</file>

<file path="app/(public)/page.tsx">
import { HomeHeroSection } from "@/components/features/landing/HomeHeroSection"
import { HomeCommunityNews } from "@/components/features/landing/HomeCommunityNews"
import { HomeCalendarCompact } from "@/components/features/landing/HomeCalendarCompact"
import { getRecentNotices, getNoticesByCategory } from "@/actions/notice-actions"
import { getPublicSchedules } from "@/actions/schedule-actions"

export default async function Home() {
  // Server Component에서 데이터 페칭
  const now = new Date()
  const [notices, supportNotices, schedules] = await Promise.all([
    getRecentNotices(5),
    getNoticesByCategory("support", 5),
    getPublicSchedules(now.getFullYear(), now.getMonth() + 1),
  ])

  return (
    <div className="flex min-h-screen flex-col">
      <HomeHeroSection />
      <section className="py-8 sm:py-12 bg-background">
        <div className="container mx-auto px-4 sm:px-6 lg:px-8">
          <div className="grid gap-6 lg:grid-cols-2">
            {/* 좌측: 공지사항, 활동 소식, 서비스 사례 */}
            <div className="lg:max-w-md">
              <HomeCommunityNews
                initialNotices={notices}
                initialSupportNotices={supportNotices}
              />
            </div>
            {/* 우측: 캘린더 */}
            <div className="lg:flex-1">
              <HomeCalendarCompact initialSchedules={schedules} />
            </div>
          </div>
        </div>
      </section>
    </div>
  )
}
</file>

<file path="app/globals.css">
/* Pretendard 폰트 CDN - @import는 반드시 최상단에 위치해야 함 */
@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css');

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 222.2 47.4% 11.2%;
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 222.2 84% 4.9%;
    --radius: 0.5rem;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 210 40% 98%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 212.7 26.8% 83.9%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground font-sans;
    font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif;
    /* 반응형 텍스트 깨짐 방지 */
    word-break: keep-all;
    overflow-wrap: break-word;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }
  
  /* 반응형 텍스트 유틸리티 */
  .text-responsive {
    @apply text-sm sm:text-base md:text-lg;
  }
  
  .text-responsive-lg {
    @apply text-base sm:text-lg md:text-xl lg:text-2xl;
  }
  
  .text-responsive-xl {
    @apply text-lg sm:text-xl md:text-2xl lg:text-3xl;
  }
  
  /* 가독성 개선 - 다크 모드 대비 강화 */
  .text-readable {
    @apply text-foreground;
  }
  
  .bg-readable {
    @apply bg-background;
  }
  
  /* 스무스 스크롤 */
  html {
    scroll-behavior: smooth;
  }
  
  /* 아코디언 애니메이션 */
  @keyframes accordion-down {
    from {
      height: 0;
    }
    to {
      height: var(--radix-accordion-content-height);
    }
  }
  
  @keyframes accordion-up {
    from {
      height: var(--radix-accordion-content-height);
    }
    to {
      height: 0;
    }
  }
  
  .animate-accordion-down {
    animation: accordion-down 0.2s ease-out;
  }
  
  .animate-accordion-up {
    animation: accordion-up 0.2s ease-out;
  }
  
  /* 고대비 모드 */
  .high-contrast {
    --background: 0 0% 0%;
    --foreground: 0 0% 100%;
    --card: 0 0% 0%;
    --card-foreground: 0 0% 100%;
    --popover: 0 0% 0%;
    --popover-foreground: 0 0% 100%;
    --primary: 0 0% 100%;
    --primary-foreground: 0 0% 0%;
    --secondary: 0 0% 20%;
    --secondary-foreground: 0 0% 100%;
    --muted: 0 0% 20%;
    --muted-foreground: 0 0% 100%;
    --accent: 0 0% 20%;
    --accent-foreground: 0 0% 100%;
    --destructive: 0 100% 50%;
    --destructive-foreground: 0 0% 100%;
    --border: 0 0% 50%;
    --input: 0 0% 20%;
    --ring: 0 0% 100%;
  }
  
  /* 키보드 포커스 강화 */
  *:focus-visible {
    outline: 3px solid hsl(var(--primary));
    outline-offset: 2px;
  }
  
  /* 스크린 리더 전용 텍스트 */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }
}
</file>

<file path="app/layout.tsx">
import type { Metadata } from "next";
import { ClerkProvider } from "@/components/providers/clerk-provider";
import { QueryProvider } from "@/components/providers/query-provider";
import { AccessibilityToolbar } from "@/components/accessibility/accessibility-toolbar";
import { KeyboardNavigator } from "@/components/accessibility/keyboard-navigator";
import "./globals.css";

export const metadata: Metadata = {
  title: "Co-AT | GWATC 통합 케어 플랫폼",
  description: "강원특별자치도 보조기기센터 통합 업무 협업 플랫폼",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <ClerkProvider>
      <QueryProvider>
        <html lang="ko">
          <body>
            {children}
            <AccessibilityToolbar />
            <KeyboardNavigator />
          </body>
        </html>
      </QueryProvider>
    </ClerkProvider>
  );
}
</file>

<file path="components/layout/admin-sidebar.tsx">
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import { cn } from "@/lib/utils";
import {
  LayoutDashboard,
  Users,
  Package,
  Calendar,
  Settings,
  FileText,
  Sparkles,
} from "lucide-react";

const menuItems = [
  { href: "/admin/dashboard", label: "대시보드", icon: LayoutDashboard },
  { href: "/admin/notices-management", label: "새 글 관리", icon: FileText },
  { href: "/admin/clients", label: "대상자 관리", icon: Users },
  { href: "/admin/inventory", label: "재고 관리", icon: Package },
  { href: "/admin/schedule", label: "일정 관리", icon: Calendar },
  { href: "/admin/settings", label: "설정", icon: Settings },
];

export function AdminSidebar() {
  const pathname = usePathname();

  return (
    <aside className="hidden w-64 border-r bg-gradient-to-b from-background to-muted/20 md:block">
      <div className="flex h-16 items-center gap-2 border-b px-6 bg-gradient-to-r from-primary/5 to-transparent">
        <div className="flex items-center gap-2">
          <div className="flex h-8 w-8 items-center justify-center rounded-lg bg-primary/10">
            <Sparkles className="h-4 w-4 text-primary" />
          </div>
          <div className="flex flex-col">
            <span className="text-xs font-semibold text-foreground">관리자</span>
            <span className="text-[10px] text-muted-foreground">Admin Panel</span>
          </div>
        </div>
      </div>
      <nav className="flex flex-col gap-1 p-3 sm:p-4">
        {menuItems.map((item) => {
          const Icon = item.icon;
          const isActive =
            pathname === item.href || pathname?.startsWith(item.href + "/");

          return (
            <Link
              key={item.href}
              href={item.href}
              className={cn(
                "group flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium transition-all duration-200",
                isActive
                  ? "bg-primary text-primary-foreground shadow-sm"
                  : "text-muted-foreground hover:bg-accent hover:text-accent-foreground hover:translate-x-1"
              )}
            >
              <Icon className={cn(
                "h-4 w-4 transition-transform duration-200",
                isActive ? "scale-110" : "group-hover:scale-110"
              )} />
              <span className="truncate">{item.label}</span>
              {isActive && (
                <div className="ml-auto h-1.5 w-1.5 rounded-full bg-primary-foreground/50" />
              )}
            </Link>
          );
        })}
      </nav>
    </aside>
  );
}
</file>

<file path="components/layout/public-header.tsx">
"use client"

import { useState } from "react"
import { Logo } from "@/components/common/logo"
import { Button } from "@/components/ui/button"
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu"
import { SignInButton, UserButton, useUser } from "@clerk/nextjs"
import Link from "next/link"
import { usePathname } from "next/navigation"
import { cn } from "@/lib/utils"

const headerMenuItems = [
  {
    id: "services",
    label: "주요사업",
    href: "/services",
    hasDropdown: true,
    subItems: [
      { label: "상담 및 정보제공", href: "/services/consultation" },
      { label: "맞춤형 지원", href: "/services/custom-support" },
      { label: "사후관리", href: "/services/aftercare" },
      { label: "교육/홍보", href: "/services/education-promotion" },
    ],
  },
  {
    id: "community",
    label: "커뮤니티",
    href: "/community",
    hasDropdown: true,
    subItems: [
      { label: "공지사항", href: "/notices" },
      { label: "지원사업", href: "/notices?category=support" },
      { label: "활동갤러리", href: "/community/gallery" },
      { label: "보조기기 서비스 사례", href: "/community/cases" },
    ],
  },
  {
    id: "info",
    label: "보조기기 정보",
    href: "/info",
    hasDropdown: true,
    subItems: [
      { label: "보유 보조기기", href: "/info/devices" },
      { label: "재사용 보조기기", href: "/info/reusable-devices" },
      { label: "나에게 맞는 보조기기", href: "/info/recommendation" },
      { label: "보조기기 수리센터 안내", href: "/info/repair-center" },
      { label: "정부지원사업안내", href: "/info/government-support" },
      { label: "자료실", href: "/info/resources" },
    ],
  },
  {
    id: "apply",
    label: "서비스 신청",
    href: "/apply",
    hasDropdown: true,
    subItems: [
      { label: "서비스 이용 안내", href: "/apply/guide" },
      { label: "온라인 신청", href: "/portal/apply" },
    ],
  },
  {
    id: "about",
    label: "센터소개",
    href: "/about",
    hasDropdown: true,
    subItems: [
      { label: "인사말", href: "/about/greeting" },
      { label: "조직도", href: "/about/organization" },
      { label: "연혁", href: "/about/history" },
      { label: "찾아오시는 길", href: "/about/location" },
    ],
  },
]

export function PublicHeader() {
  const pathname = usePathname()
  const { isSignedIn } = useUser()
  const [openDropdown, setOpenDropdown] = useState<string | null>(null)

  return (
    <header className="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <div className="container flex h-14 sm:h-16 items-center justify-between px-4 sm:px-6">
        <Link href="/" className="flex items-center">
          <Logo />
        </Link>
        <nav className="hidden md:flex items-center gap-1 sm:gap-2 lg:gap-4">
          {headerMenuItems.map((item) => {
            const isActive = pathname.startsWith(item.href)

            if (item.hasDropdown && item.subItems) {
              return (
                <DropdownMenu
                  key={item.id}
                  open={openDropdown === item.id}
                  onOpenChange={(open) => setOpenDropdown(open ? item.id : null)}
                >
                  <DropdownMenuTrigger asChild>
                    <button
                      onMouseEnter={() => setOpenDropdown(item.id)}
                      onMouseLeave={() => setOpenDropdown(null)}
                      className={cn(
                        "px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium transition-colors whitespace-nowrap relative",
                        isActive
                          ? "text-primary"
                          : "text-foreground hover:text-primary"
                      )}
                      aria-label={`${item.label} 메뉴`}
                      aria-expanded={openDropdown === item.id}
                      aria-haspopup="true"
                    >
                      {item.label}
                      {isActive && (
                        <span className="absolute bottom-0 left-0 right-0 h-0.5 bg-primary" />
                      )}
                    </button>
                  </DropdownMenuTrigger>
                  <DropdownMenuContent
                    align="start"
                    className="w-56"
                    onMouseEnter={() => setOpenDropdown(item.id)}
                    onMouseLeave={() => setOpenDropdown(null)}
                  >
                    {item.subItems.map((subItem) => (
                      <DropdownMenuItem key={subItem.href} asChild>
                        <Link
                          href={subItem.href}
                          className="cursor-pointer"
                        >
                          {subItem.label}
                        </Link>
                      </DropdownMenuItem>
                    ))}
                  </DropdownMenuContent>
                </DropdownMenu>
              )
            }

            return (
              <Link
                key={item.id}
                href={item.href}
                className={cn(
                  "px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium transition-colors whitespace-nowrap relative",
                  isActive
                    ? "text-primary"
                    : "text-muted-foreground hover:text-foreground"
                )}
              >
                {item.label}
                {isActive && (
                  <span className="absolute bottom-0 left-0 right-0 h-0.5 bg-primary" />
                )}
              </Link>
            )
          })}
        </nav>
        <div className="flex items-center gap-2 sm:gap-4">
          {!isSignedIn ? (
            <SignInButton mode="modal">
              <Button variant="ghost" size="sm" className="text-xs sm:text-sm">
                로그인
              </Button>
            </SignInButton>
          ) : null}
          <UserButton afterSignOutUrl="/" />
        </div>
      </div>
    </header>
  )
}
</file>

<file path="package.json">
{
  "name": "co-at",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint .",
    "gen:types": "npx -y supabase gen types typescript --project-id uyjbndiwyddjyjkdfuyi --schema public > types/database.types.ts"
  },
  "dependencies": {
    "@clerk/nextjs": "^6.36.3",
    "@hookform/resolvers": "^5.2.2",
    "@radix-ui/react-accordion": "^1.2.12",
    "@radix-ui/react-checkbox": "^1.3.3",
    "@radix-ui/react-dialog": "^1.1.1",
    "@radix-ui/react-dropdown-menu": "^2.1.16",
    "@radix-ui/react-hover-card": "^1.1.15",
    "@radix-ui/react-label": "^2.1.8",
    "@radix-ui/react-popover": "^1.1.15",
    "@radix-ui/react-radio-group": "^1.3.8",
    "@radix-ui/react-select": "^2.2.6",
    "@radix-ui/react-slot": "^1.1.0",
    "@radix-ui/react-tabs": "^1.1.13",
    "@supabase/ssr": "^0.5.2",
    "@tanstack/react-query": "^5.90.12",
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.1.0",
    "date-fns": "^3.0.0",
    "lucide-react": "^0.344.0",
    "next": "^16.0.0",
    "react": "^19.0.0",
    "react-day-picker": "^8.10.0",
    "react-dom": "^19.0.0",
    "react-hook-form": "^7.68.0",
    "tailwind-merge": "^2.2.1",
    "tailwindcss-animate": "^1.0.7",
    "zod": "^4.1.13",
    "zustand": "^5.0.9"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3.3.3",
    "@eslint/js": "^9.39.2",
    "@next/eslint-plugin-next": "^16.0.10",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "@typescript-eslint/eslint-plugin": "^8.50.0",
    "@typescript-eslint/parser": "^8.50.0",
    "autoprefixer": "^10.0.1",
    "eslint": "^9",
    "eslint-config-next": "^16.0.0",
    "eslint-plugin-react": "^7.37.5",
    "eslint-plugin-react-hooks": "^7.0.1",
    "globals": "^16.5.0",
    "postcss": "^8",
    "tailwindcss": "^3.4.1",
    "typescript": "^5"
  }
}
</file>

<file path="docs/TODO.md">
# 📋 Co-AT 프로젝트 개발 TODO

> **프로젝트**: GWATC 통합 케어 플랫폼 (Co-AT)  
> **비전**: "행정은 AI에게, 사람은 클라이언트에게"  
> **기술 스택**: Next.js 15, Clerk, Supabase, Gemini Flash  
> **작성일**: 2025. 12. 06

---

## ♿ 접근성 (Accessibility) 가이드

### 접근성 원칙

본 프로젝트는 **WCAG 2.1 AA 수준**의 접근성을 목표로 합니다. 모든 사용자가 동등하게 서비스를 이용할 수 있도록 다음 원칙을 준수합니다:

1. **인지 가능성 (Perceivable)**: 모든 정보와 UI 요소를 사용자가 인지할 수 있어야 함
2. **조작 가능성 (Operable)**: 모든 기능을 키보드만으로도 사용할 수 있어야 함
3. **이해 가능성 (Understandable)**: 정보와 UI 조작 방법이 명확해야 함
4. **견고성 (Robust)**: 다양한 보조 기술과 호환되어야 함

### 구현된 접근성 기능

#### 1. 시각 장애인 지원 기능

**화면 확대/축소**

- 범위: 50% ~ 200% (기본 100%)
- 단축키: `Alt + +` (확대), `Alt + -` (축소), `Alt + 0` (리셋)
- 설정 저장: 로컬 스토리지에 저장되어 페이지 새로고침 후에도 유지
- 컴포넌트: `components/accessibility/accessibility-toolbar.tsx`

**고대비 모드**

- 단축키: `Alt + H`
- 기능: 배경과 텍스트의 대비를 극대화하여 가독성 향상
- 설정 저장: 로컬 스토리지에 저장
- CSS: `app/globals.css`의 `.high-contrast` 클래스

**음성 출력 (TTS)**

- 단축키: `Alt + S`
- 기능: 페이지 전체 텍스트를 음성으로 읽어줌
- 언어: 한국어 (ko-KR)
- 속도: 0.9배속 (조정 가능)
- 기술: Web Speech API (`window.speechSynthesis`)

#### 2. 지체 장애인 지원 기능

**키보드 스캔 모드**

- 단축키: `Alt + K` (활성화/비활성화)
- 기능: Tab 키로 모든 포커스 가능한 요소를 순차적으로 탐색
- 탐색: `Tab` (다음), `Shift + Tab` (이전), `Esc` (종료)
- 자동 스크롤: 포커스된 요소가 화면 중앙에 오도록 자동 스크롤
- 컴포넌트: `components/accessibility/keyboard-navigator.tsx`

**키보드 네비게이션**

- 모든 인터랙티브 요소는 키보드로 접근 가능
- 포커스 표시 강화: 3px 두께의 primary 색상 outline
- 논리적 탭 순서: 시각적 순서와 동일하게 구성
- CSS: `app/globals.css`의 `*:focus-visible` 스타일

#### 3. 접근성 툴바

- 위치: 화면 우측 하단 고정
- 열기/닫기: `Alt + A` 또는 버튼 클릭
- 기능: 화면 확대/축소, 고대비 모드, 음성 출력을 한 곳에서 제어
- 컴포넌트: `components/accessibility/accessibility-toolbar.tsx`

### 개발 가이드라인

#### HTML 시맨틱 태그 사용

```tsx
// ✅ 좋은 예
<nav aria-label="주요 메뉴">
  <ul>
    <li><a href="/services">주요사업</a></li>
  </ul>
</nav>

// ❌ 나쁜 예
<div onClick={...}>주요사업</div>
```

#### ARIA 레이블 추가

```tsx
// ✅ 좋은 예
<button aria-label="메뉴 열기">
  <MenuIcon />
</button>

// ✅ 아이콘만 있는 버튼은 반드시 aria-label 필요
<button aria-label="검색">
  <SearchIcon />
</button>
```

#### 이미지 alt 텍스트

```tsx
// ✅ 좋은 예
<img src="..." alt="보조기기센터 건물 외관" />

// ❌ 장식용 이미지는 빈 alt
<img src="..." alt="" role="presentation" />
```

#### 폼 접근성

```tsx
// ✅ 좋은 예
<label htmlFor="name">이름</label>
<input id="name" aria-describedby="name-error" />
{error && <span id="name-error" role="alert">{error}</span>}
```

#### 키보드 이벤트 처리

```tsx
// ✅ 좋은 예
<button
  onClick={handleClick}
  onKeyDown={(e) => {
    if (e.key === "Enter" || e.key === " ") {
      e.preventDefault();
      handleClick();
    }
  }}
>
  클릭
</button>
```

#### 색상 대비

- 일반 텍스트: 최소 4.5:1 대비율
- 큰 텍스트 (18pt 이상): 최소 3:1 대비율
- 인터랙티브 요소: 최소 3:1 대비율

#### 포커스 관리

```tsx
// ✅ 포커스 트랩 (모달 등)
useEffect(() => {
  const firstFocusable = modalRef.current?.querySelector(
    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
  ) as HTMLElement;
  firstFocusable?.focus();
}, []);
```

### 테스트 체크리스트

#### 키보드 테스트

- [ ] Tab 키로 모든 인터랙티브 요소 접근 가능
- [ ] Shift + Tab으로 역방향 탐색 가능
- [ ] Enter/Space로 버튼 클릭 가능
- [ ] Esc로 모달/드롭다운 닫기 가능
- [ ] 화살표 키로 메뉴/리스트 탐색 가능

#### 스크린 리더 테스트

- [ ] NVDA (Windows) 또는 VoiceOver (Mac)로 테스트
- [ ] 모든 이미지에 적절한 alt 텍스트
- [ ] 폼 요소에 레이블 연결
- [ ] 에러 메시지가 스크린 리더로 읽힘
- [ ] 페이지 구조가 논리적으로 읽힘

#### 시각 테스트

- [ ] 고대비 모드에서 모든 요소가 명확히 보임
- [ ] 화면 확대 200%에서도 모든 기능 사용 가능
- [ ] 색상만으로 정보를 전달하지 않음 (아이콘/텍스트 병행)

### 참고 자료

- [WCAG 2.1 가이드라인](https://www.w3.org/WAI/WCAG21/quickref/)
- [WebAIM 접근성 체크리스트](https://webaim.org/standards/wcag/checklist)
- [MDN 접근성 가이드](https://developer.mozilla.org/ko/docs/Web/Accessibility)
- [한국형 웹 콘텐츠 접근성 지침 2.1](https://www.wah.or.kr/)

---

## 📊 문서 분석 요약

### 1. 프로젝트 핵심 목표

- **5대 핵심 사업 디지털화**: 상담, 체험, 맞춤형, 사후관리, 교육홍보
- **O2O 플랫폼**: 온라인 신청 → 오프라인 서비스 → 온라인 결과 관리
- **AI 업무 자동화**: Gemini를 활용한 상담기록 자동 생성, 상담 챗봇 자동 응대대
- **데이터 기반 운영**: 재고 관리, 실적 통계, 대상자 이력 통합 관리

### 2. 데이터베이스 스키마 분석 (co-AT.sql 기준)

#### 🔗 Supabase MCP 연동 정보

- **MCP 서버**: `supabase-co-AT`
- **Project Ref**: `uyjbndiwyddjyjkdfuyi`
- **접근 토큰**: `sbp_31e2d9d8e62851f8b5b15e9fe62e11e42acacdec`
- **모드**: Read-only (스키마 조회용)
- **타입 생성 명령어**: `npm run gen:types` (project-ref 사용)

#### ✅ 현재 구현된 테이블 (7개)

1. **profiles** - 직원/사용자 프로필 (Clerk 연동)

   - `id` (PK, UUID)
   - `clerk_user_id` (UK, text): ✅ UNIQUE 제약조건 설정됨
   - `email` (text, nullable)
   - `full_name` (text, nullable)
   - `role` (text, default 'staff', CHECK): ✅ user | staff | manager
   - `team` (text, nullable): 소속 팀
   - `created_at` (timestamptz, default now())
   - `updated_at` (timestamptz, default now()): ✅ 추가됨

2. **clients** - 대상자 정보

   - `id` (PK, UUID)
   - `name` (text, NOT NULL)
   - `registration_number` (text, nullable): 등록번호
   - `birth_date` (date, nullable)
   - `gender` (text, nullable, CHECK): ✅ '남' | '여'
   - `contact` (text, nullable): 본인 연락처
   - `guardian_contact` (text, nullable): 보호자 연락처
   - `address` (text, nullable)
   - `housing_type` (text, nullable): 주거형태
   - `has_elevator` (boolean, default false): ✅ 기본값 설정됨
   - `obstacles` (text, nullable): 장애물
   - `economic_status` (text, nullable): 경제상황
   - `disability_type` (text, nullable): 장애유형
   - `disability_grade` (text, nullable): 장애정도
   - `disability_cause` (text, nullable): 장애발생원인
   - `disability_onset_date` (date, nullable): 장애발생시기
   - `created_at` (timestamptz, default now())
   - `updated_at` (timestamptz, default now()): ✅ 추가됨

3. **inventory** - 재고/자산 관리

   - `id` (PK, UUID)
   - `name` (text, NOT NULL): 기기명
   - `asset_code` (text, nullable): 자산번호
   - `category` (text, nullable): 기기 카테고리
   - `status` (text, default '보관', CHECK): ✅ 보관 | 대여중 | 수리중 | 소독중 | 폐기
   - `created_at` (timestamptz, default now())
   - `updated_at` (timestamptz, default now()): ✅ 추가됨

4. **applications** - 통합 신청서 (5대 사업 중심)

   - `id` (PK, UUID)
   - `client_id` (uuid, NOT NULL, FK → clients.id): ✅ 올바르게 설정됨
   - `status` (text, default '접수', CHECK): 접수 | 배정 | 진행 | 완료 | 반려
   - `service_year` (integer, nullable): 서비스 연도
   - `created_at` (timestamptz, default now())
   - `updated_at` (timestamptz, default now()): ✅ 추가됨

5. **intake_records** - 상담 기록지 (첨부 19)

   - `id` (PK, UUID)
   - `application_id` (uuid, NOT NULL, FK → applications.id): ✅ 올바르게 설정됨
   - `consultant_id` (uuid, nullable, FK → profiles.id): 상담자
   - `consult_date` (date, default CURRENT_DATE): 상담일
   - `body_function_data` (jsonb, nullable): 신체 기능 체크 (관절가동범위 등)
   - `cognitive_sensory_check` (text[], nullable): ✅ ARRAY 타입으로 개선됨
   - `consultation_content` (text, nullable): 상담 내용 및 이용자욕구
   - `current_devices` (jsonb, nullable): 보유 보조기기 목록
   - `main_activity_place` (text, nullable): 주요 활동 장소
   - `activity_posture` (text, nullable): 활동 시 자세
   - `main_supporter` (text, nullable): 활동 주지원자
   - `environment_limitations` (text, nullable): 환경 제한 사항
   - `created_at` (timestamptz, default now())
   - `updated_at` (timestamptz, default now()): ✅ 추가됨

6. **process_logs** - 서비스 진행 기록지 (첨부 20)

   - `id` (PK, UUID)
   - `application_id` (uuid, NOT NULL, FK → applications.id): ✅ 올바르게 설정됨
   - `staff_id` (uuid, nullable, FK → profiles.id): ✅ 올바르게 설정됨
   - `log_date` (date, default CURRENT_DATE): 기록일
   - `service_area` (text, nullable): 서비스 영역
   - `funding_source` (text, nullable): 지원 구분 (공적급여 | 민간급여 | 센터지원)
   - `process_step` (text, nullable): 과정 (상담·평가 | 시험적용 | 대여 | 제작 등)
   - `item_name` (text, nullable): 품목명
   - `content` (text, nullable): 내용
   - `remarks` (text, nullable): 비고
   - `created_at` (timestamptz, default now())
   - `updated_at` (timestamptz, default now()): ✅ 추가됨

7. **domain_assessments** - 보조기기 서비스 평가지 (첨부 21)
   - `id` (PK, UUID)
   - `application_id` (uuid, NOT NULL, FK → applications.id): ✅ 올바르게 설정됨
   - `evaluator_id` (uuid, nullable, FK → profiles.id): ✅ 올바르게 설정됨
   - `evaluation_date` (date, default CURRENT_DATE): 평가일
   - `domain_type` (text, NOT NULL): WC(휠체어) | ADL | S(감각) | SP(자세) | EC(환경개조) | CA(컴퓨터) | L(레저) | AAC | AM(자동차)
   - `evaluation_data` (jsonb, nullable): 영역별 평가 데이터
   - `measurements` (jsonb, nullable): 신체 치수 측정 데이터
   - `evaluator_opinion` (text, nullable): 평가자의견
   - `recommended_device` (text, nullable): 추천 보조기기
   - `future_plan` (text, nullable): 향후 계획
   - `created_at` (timestamptz, default now())
   - `updated_at` (timestamptz, default now()): ✅ 추가됨

#### ⚠️ 스키마 개선 필요사항 (우선순위)

**✅ 이미 완료된 개선 사항** (Supabase MCP 확인 결과)

1. **Foreign Key 컬럼명 정리** ✅

   - ✅ `applications.client_id` - 올바르게 설정됨 (`id2` 제거됨)
   - ✅ `intake_records.application_id` - 올바르게 설정됨 (`id2` 제거됨)
   - ✅ `process_logs.application_id` - 올바르게 설정됨 (`id2` 제거됨)
   - ✅ `process_logs.staff_id` - 올바르게 설정됨 (`id3` 제거됨)
   - ✅ `domain_assessments.application_id` - 올바르게 설정됨 (`id2` 제거됨)
   - ✅ `domain_assessments.evaluator_id` - 올바르게 설정됨 (`id3` 제거됨)

2. **타임스탬프 필드** ✅

   - ✅ 모든 테이블에 `updated_at` 필드 추가됨
   - ✅ `created_at` 기본값 `now()` 설정됨

3. **데이터 무결성 강화** ✅

   - ✅ `profiles.clerk_user_id` UNIQUE 제약조건 추가
   - ✅ `profiles.role` CHECK 제약조건 (`'user' | 'staff' | 'manager'`)
   - ✅ `clients.gender` CHECK 제약조건 (`'남' | '여'`)
   - ✅ `inventory.status` CHECK 제약조건 (`'보관' | '대여중' | '수리중' | '소독중' | '폐기'`)
   - ✅ `applications.status` CHECK 제약조건 (`'접수' | '배정' | '진행' | '완료' | '반려'`)

4. **타입 개선** ✅
   - ✅ `intake_records.cognitive_sensory_check`: `text` → `text[]` (ARRAY)

**🔴 긴급 (아직 필요한 개선 사항)**

2. **applications 테이블 필드 추가** ✅

   - [x] `category` 필드 추가: `text` 타입, `'consult' | 'experience' | 'custom' | 'aftercare' | 'education'` ✅
   - [x] `sub_category` 필드 추가: `text` 타입, `'repair' | 'rental' | 'custom_make' | 'visit' | 'exhibition' | 'cleaning' | 'reuse'` 등 ✅
   - [x] `desired_date` 필드 추가: `date` 타입 (희망 서비스 일자) ✅
   - [x] `assigned_staff_id` 필드 추가: `uuid` 타입, FK → profiles.id (배정된 담당자) ✅

   > 📝 **마이그레이션 파일**: `migrations/002_add_applications_fields.sql` 생성 완료  
   > ⚠️ **실행 필요**: Supabase Dashboard SQL Editor에서 마이그레이션 실행 후 `npm run gen:types` 실행

3. **inventory 테이블 필드 추가** ✅

   - [x] `is_rental_available` 필드 추가: `boolean` 타입, default `true` (대여 가능 여부) ✅
   - [x] `purchase_date` 필드 추가: `date` 타입 (구입일) ✅
   - [x] `purchase_price` 필드 추가: `numeric` 타입 (구입가격) ✅
   - [x] `manufacturer` 필드 추가: `text` 타입 (제조사) ✅
   - [x] `model` 필드 추가: `text` 타입 (모델명) ✅
   - [x] `qr_code` 필드 추가: `text` 타입 (QR 코드 값) ✅

   > 📝 **마이그레이션 파일**: `migrations/003_add_inventory_fields.sql` 생성 완료  
   > ⚠️ **실행 필요**: Supabase Dashboard SQL Editor에서 마이그레이션 실행 후 `npm run gen:types` 실행

**🟡 중요 (Phase 1 완료 전)**

4. **service_logs 테이블 생성** ✅ (서비스 제공 상세 기록 - 상담 기록지, 서비스 진행 기록지, 평가지 양식 반영)

   - [x] `id` (PK, UUID) ✅
   - [x] `application_id` (FK → applications.id, NOT NULL) ✅
   - [x] `staff_id` (FK → profiles.id, nullable) ✅
   - [x] `inventory_id` (FK → inventory.id, nullable): 관련 기기 ✅
   - [x] `service_date` (date, default CURRENT_DATE): 서비스 제공 일자 ✅
   - [x] `service_type` (text, nullable): 서비스 유형 (repair, custom_make, rental, education 등) ✅
   - [x] `service_area` (text, nullable): 서비스 영역 ✅
   - [x] `funding_source` (text, nullable): 지원 구분 (public, private, center, other) ✅
   - [x] `funding_detail` (text, nullable): 상세 재원 정보 ✅
   - [x] `work_type` (text, nullable): 작업 유형 (상담·평가, 시험적용, 대여, 제작 등) ✅
   - [x] `item_name` (text, nullable): 품목명 ✅
   - [x] `work_description` (text, nullable): 작업 내용 설명 ✅
   - [x] `work_result` (text, nullable): 작업 결과 ✅
   - [x] `cost_total` (numeric, nullable): 수리/제작비 총액 ✅
   - [x] `cost_materials` (numeric, nullable): 재료비 ✅
   - [x] `cost_labor` (numeric, nullable): 인건비 ✅
   - [x] `cost_other` (numeric, nullable): 기타 비용 ✅
   - [x] `images_before` (text[], nullable): 작업 전 사진 URL 배열 ✅
   - [x] `images_after` (text[], nullable): 작업 후 사진 URL 배열 ✅
   - [x] `remarks` (text, nullable): 비고 ✅
   - [x] `notes` (text, nullable): 추가 메모 ✅
   - [x] `created_at` (timestamptz, default now()) ✅
   - [x] `updated_at` (timestamptz, default now()) ✅

   > 📝 **마이그레이션 파일**: `migrations/004_create_service_logs.sql` 생성 완료  
   > ⚠️ **실행 필요**: Supabase Dashboard SQL Editor에서 마이그레이션 실행 후 `npm run gen:types` 실행  
   > 📋 **참고**: 상담 기록지(첨부 19), 서비스 진행 기록지(첨부 20), 평가지(첨부 21) 양식 기반으로 설계됨

5. **schedules 테이블 생성** ✅ (일정 관리)

   - [x] `id` (PK, UUID) ✅
   - [x] `application_id` (FK → applications.id, nullable) ✅
   - [x] `staff_id` (FK → profiles.id, NOT NULL) ✅
   - [x] `client_id` (FK → clients.id, nullable) ✅
   - [x] `schedule_type` (text, NOT NULL): 'visit' | 'consult' | 'assessment' | 'delivery' | 'pickup' ✅
   - [x] `scheduled_date` (date, NOT NULL) ✅
   - [x] `scheduled_time` (time, nullable) ✅
   - [x] `address` (text, nullable): 방문 주소 ✅
   - [x] `notes` (text, nullable): 일정 메모 ✅
   - [x] `status` (text, default 'scheduled'): 'scheduled' | 'completed' | 'cancelled' ✅
   - [x] `created_at` (timestamptz, default now()) ✅
   - [x] `updated_at` (timestamptz, default now()) ✅

   > 📝 **마이그레이션 파일**: `migrations/005_create_schedules.sql` 생성 완료  
   > ⚠️ **실행 필요**: Supabase Dashboard SQL Editor에서 마이그레이션 실행 후 `npm run gen:types` 실행

**🟢 개선 (Phase 2 이후)**

6. **notices 테이블 생성** ✅ (공지사항)

   - [x] `id` (PK, UUID) ✅
   - [x] `title` (text, NOT NULL) ✅
   - [x] `content` (text, NOT NULL) ✅
   - [x] `category` (text, nullable): 'notice' | 'support' | 'event' ✅
   - [x] `is_pinned` (boolean, default false) ✅
   - [x] `created_by` (FK → profiles.id, nullable) ✅
   - [x] `created_at` (timestamptz, default now()) ✅
   - [x] `updated_at` (timestamptz, nullable) ✅

   > 📝 **마이그레이션 파일**: `migrations/006_create_notices.sql` 생성 완료  
   > ⚠️ **실행 필요**: Supabase Dashboard SQL Editor에서 마이그레이션 실행 후 `npm run gen:types` 실행

7. **rentals 테이블 생성** ✅ (대여 관리)

   - [x] `id` (PK, UUID) ✅
   - [x] `application_id` (FK → applications.id, NOT NULL) ✅
   - [x] `inventory_id` (FK → inventory.id, NOT NULL) ✅
   - [x] `client_id` (FK → clients.id, NOT NULL) ✅
   - [x] `rental_start_date` (date, NOT NULL) ✅
   - [x] `rental_end_date` (date, NOT NULL) ✅
   - [x] `return_date` (date, nullable): 실제 반납일 ✅
   - [x] `extension_count` (integer, default 0): 연장 횟수 ✅
   - [x] `status` (text, default 'rented'): 'rented' | 'returned' | 'overdue' | 'damaged' ✅
   - [x] `created_at` (timestamptz, default now()) ✅
   - [x] `updated_at` (timestamptz, default now()) ✅

   > 📝 **마이그레이션 파일**: `migrations/007_create_rentals.sql` 생성 완료  
   > ⚠️ **실행 필요**: Supabase Dashboard SQL Editor에서 마이그레이션 실행 후 `npm run gen:types` 실행

---

## 🚀 Phase 1: 기반 구축 (Foundation) - 2주

### 1.1 프로젝트 초기 설정 ✅

- [x] Next.js 15 프로젝트 생성 (`create-next-app`) ✅
- [x] TypeScript 설정 (strict mode) ✅
- [x] Tailwind CSS + PostCSS 설정 ✅
- [x] ESLint 설정 ✅
- [x] `.env.local` 템플릿 생성 (`env.example` 파일 생성 완료) ✅
- [x] `.gitignore` 설정 (`.env.local` 제외) ✅

### 1.2 인증 시스템 (Clerk) ✅

- [x] Clerk 계정 생성 및 프로젝트 설정 ✅ (사용자 확인 완료)
- [x] Clerk SDK 설치 및 설정 ✅ (`@clerk/nextjs` 설치, ClerkProvider 설정)
- [x] `middleware.ts` 작성 (인증 체크, 라우팅 보호) ✅
- [x] Route Groups 설정: `(auth)`, `(public)`, `(portal)`, `(admin)` ✅
- [x] Clerk Webhook 설정 (`/api/webhooks/clerk/route.ts`) ✅
  - [x] 유저 생성 시 Supabase `profiles` 테이블 동기화 ✅
  - [x] 유저 삭제 시 정리 로직 ✅

### 1.3 데이터베이스 설정 (Supabase) ✅

- [x] Supabase 프로젝트 확인 ✅
  - [x] Project Ref: `uyjbndiwyddjyjkdfuyi` ✅
  - [x] MCP 서버 연결 확인 (`supabase-co-AT`) ✅
  - [x] Supabase Dashboard에서 스키마 확인 ✅ (사용자 확인 필요)
- [x] 마이그레이션 스크립트 생성 및 실행 ✅
  - [x] 마이그레이션 파일 생성 완료 (`migrations/002~007`) ✅
  - [x] Supabase Dashboard SQL Editor에서 마이그레이션 실행 완료 ✅
- [x] RLS (Row Level Security) 정책 작성 ✅
  - [x] 사용자 규칙에 따라 RLS 사용하지 않음 (스킵) ✅
- [x] 타입 생성 스크립트 설정 및 실행 ✅
  - [x] `package.json`에 스크립트 추가 완료 ✅
  - [x] `types/database.types.ts` 파일 생성 완료 ✅
  - [x] 마이그레이션 실행 후 `npm run gen:types` 실행 완료 ✅
- [x] `lib/supabase/client.ts` 작성 (Client Component용) ✅
- [x] `lib/supabase/server.ts` 작성 (Server Component용, Cookie 기반) ✅

### 1.4 UI 기반 설정 ✅

- [x] shadcn/ui 초기화 (`npx shadcn-ui@latest init`) ✅
- [x] 기본 컴포넌트 설치: Button, Card, Input, Dialog, Calendar ✅
- [x] `app/globals.css` 설정 (Pretendard 폰트 CDN 추가) ✅
  - [x] Pretendard 폰트 적용 완료 ✅
  - [x] 다크 모드 가독성 개선 (배경 어두울 때 글자 밝게) ✅
  - [x] 반응형 텍스트 유틸리티 추가 (글자 깨짐 방지) ✅
- [x] Tailwind Config 설정 (색상 토큰, Spacing-First 준수) ✅
  - [x] Pretendard 폰트 패밀리 설정 ✅
  - [x] 반응형 폰트 크기 설정 ✅
- [x] `lib/utils.ts` 작성 (`cn()` 함수) ✅

### 1.5 레이아웃 컴포넌트 ✅

- [x] `app/layout.tsx` (Root Layout, Providers) ✅
- [x] `components/layout/public-header.tsx` (대민용 GNB) ✅
- [x] `components/layout/public-footer.tsx` ✅
- [x] `components/layout/admin-sidebar.tsx` (직원용 사이드바) ✅
- [x] `components/layout/admin-header.tsx` (관리자 헤더) ✅
- [x] `components/layout/portal-header.tsx` (포털 헤더) ✅
- [x] `components/layout/mobile-bottom-nav.tsx` (모바일 하단 탭) ✅

### 1.6 공통 컴포넌트 ✅

- [x] `components/common/logo.tsx` (GWATC 로고) ✅
- [x] `components/common/loading-spinner.tsx` ✅
- [x] `components/common/status-badge.tsx` (접수/완료 등 상태 뱃지) ✅
  - [x] 다크 모드 대비 개선 완료 ✅
- [x] `components/common/file-uploader.tsx` (이미지 업로드) ✅
  - [x] 반응형 디자인 개선 완료 ✅
  - [x] 다크 모드 대비 개선 완료 ✅

---

## 🎯 Phase 2: Public Zone (대민 서비스) - 2주

### 2.1 랜딩 페이지 ✅

- [x] `app/(public)/page.tsx` 작성 ✅
- [x] `components/features/landing/HomeHeroSection.tsx` ✅
  - [x] 메인 비주얼 및 슬로건 ✅
- [x] `components/features/landing/HomeQuickMenuGrid.tsx` ✅
  - [x] 5대 사업 바로가기 카드 (gap-4 md:gap-6) ✅
- [x] `components/features/landing/HomeNoticeTabs.tsx` ✅
  - [x] 공지사항/지원사업 탭 ✅
- [x] `components/features/landing/HomeGallerySlider.tsx` ✅
  - [x] 보조기기 유튜브 영상 갤러리 ✅
- [x] `components/features/landing/HomePublicCalendar.tsx` ✅
  - [x] 공개 캘린더 컴포넌트 (월간 뷰, shadcn/ui Calendar 활용) ✅
  - [x] 견학 일정, 교육 일정 등 대민 공개 일정 표시 ✅
  - [x] 일정 클릭 시 상세 정보 모달 표시 (일정 타입, 시간, 장소, 설명) ✅
  - [x] 견학 예약 기능 (로그인 사용자만 예약 가능, `createApplication()` 호출 준비) ✅
- [x] `actions/schedule-actions.ts` 작성 ✅
  - [x] `getPublicSchedules()` Server Action - 공개 일정 조회 ✅
  - [x] date-fns 라이브러리 활용 (날짜 포맷팅 및 계산) ✅
- [x] `actions/notice-actions.ts` 작성 ✅
  - [x] `getRecentNotices()`, `getNoticesByCategory()`, `getNoticeById()` Server Actions ✅

### 2.2 서비스 신청 시스템 ✅

- [x] `app/(portal)/apply/page.tsx` 작성 ✅
- [x] `components/features/application/ServiceApplicationWizard.tsx` ✅
  - [x] 단계 관리 컨테이너 (Zustand Store 연동) ✅
- [x] `components/features/application/ServiceCategorySelector.tsx` ✅
  - [x] 5대 사업 카테고리 선택 그리드 ✅
- [x] `components/features/application/wizard-step-nav.tsx` ✅
  - [x] 단계 표시기 (Step 1-2-3) ✅
- [x] `components/features/application/forms/` 폼 컴포넌트 ✅
  - [x] `ServiceRepairForm.tsx` (수리 신청) ✅
  - [x] `ServiceRentalForm.tsx` (대여 신청) ✅
  - [x] `ServiceConsultForm.tsx` (상담 신청) ✅
  - [x] `ServiceCustomForm.tsx` (맞춤제작 신청) ✅
- [x] `lib/validators.ts` 작성 ✅
  - [x] Zod 스키마 정의 (모든 신청 폼 검증) ✅
- [x] `actions/application-actions.ts` 작성 ✅
  - [x] `createApplication()` Server Action ✅
- [x] `components/features/application/success-modal.tsx` ✅
  - [x] 신청 완료 모달 ✅
- [x] `lib/stores/application-store.ts` 작성 ✅
  - [x] Zustand Store로 신청 상태 관리 ✅

### 2.3 마이페이지 (Portal) ✅

- [x] `app/(portal)/mypage/page.tsx` 작성 ✅
- [x] `components/features/portal/ClientTimelineList.tsx` ✅
  - [x] 신청 이력 타임라인 리스트 ✅
- [x] `components/features/portal/ClientTimelineItem.tsx` ✅
  - [x] 개별 이력 카드 (상태별 색상 분기) ✅
- [x] `components/features/portal/ClientRentStatus.tsx` ✅
  - [x] 대여 중인 기기 반납 D-Day 표시 ✅
- [x] `actions/portal-actions.ts` 작성 ✅
  - [x] `getMyApplications()` Server Action - 사용자 신청 이력 조회 ✅
  - [x] `getMyRentals()` Server Action - 사용자 대여 중인 기기 조회 ✅

### 2.4 공지사항 ✅

- [x] `app/(public)/notices/page.tsx` (목록) ✅
  - [x] 전체/지원사업/행사-이벤트 탭으로 분류 ✅
  - [x] 고정 공지사항 표시 ✅
  - [x] 카테고리별 필터링 ✅
- [x] `app/(public)/notices/[id]/page.tsx` (상세) ✅
  - [x] 공지사항 상세 내용 표시 ✅
  - [x] 목록으로 돌아가기 버튼 ✅
  - [x] 공유 기능 (사용자 권한) ✅
- [x] 공지사항 권한 시스템 ✅
  - [x] `lib/utils/permissions.ts` - 권한 체크 유틸리티 ✅
  - [x] 사용자: 열람, 공유 권한 ✅
  - [x] 관리자/직원: CRUD 모든 기능 ✅
- [x] `app/(admin)/notices/page.tsx` (관리자용 공지사항 관리) ✅
- [x] `components/features/admin/notices/NoticeList.tsx` ✅
  - [x] 공지사항 목록 표시 ✅
  - [x] 수정/삭제 기능 ✅
- [x] `components/features/admin/notices/NoticeCreateDialog.tsx` ✅
  - [x] 공지사항 작성 폼 ✅
- [x] `components/features/admin/notices/NoticeEditDialog.tsx` ✅
  - [x] 공지사항 수정 폼 ✅
- [x] `components/features/notices/NoticeShareButton.tsx` ✅
  - [x] 공유 기능 (Web Share API, 링크 복사) ✅
- [x] `actions/notice-actions.ts` 확장 ✅
  - [x] `createNotice()` Server Action ✅
  - [x] `updateNotice()` Server Action ✅
  - [x] `deleteNotice()` Server Action ✅
  - [x] `getAllNotices()` Server Action (관리자용) ✅

---

## 🏢 Phase 3: Admin Zone (업무 시스템) - 3주

### 3.1 통합 대시보드 ✅

- [x] `app/(admin)/dashboard/page.tsx` 작성 ✅
- [x] `components/features/dashboard/AdminDashboardKpi.tsx` ✅
  - [x] 오늘의 실적 요약 카드 (신규 접수, 진행 중, 완료) ✅
- [x] `components/features/dashboard/AdminNewRequestList.tsx` ✅
  - [x] 신규 접수 건 리스트 (최신순) ✅
- [x] `components/features/dashboard/AdminTodaySchedule.tsx` ✅
  - [x] 오늘의 일정 (방문 예정) ✅
- [x] React Query 설정 (`@tanstack/react-query`) ✅
  - [x] `useDashboardStats()` 훅 ✅
- [x] `actions/dashboard-actions.ts` 작성 ✅
  - [x] `getDashboardStats()` Server Action ✅
  - [x] `getNewApplications()` Server Action ✅
  - [x] `getTodaySchedules()` Server Action ✅

### 3.2 대상자 CRM

- [ ] `app/(admin)/clients/page.tsx` 작성 (검색 및 리스트)
- [ ] `app/(admin)/clients/[id]/page.tsx` 작성 (상세 정보)
- [ ] `components/features/crm/ClientTable.tsx`
  - [ ] 대상자 목록 (이름/생년월일 검색)
  - [ ] 필터링 (장애유형, 서비스 이력)
- [ ] `components/features/crm/ClientProfileCard.tsx`
  - [ ] 대상자 기본 정보 표시
- [ ] `components/features/crm/ClientHistoryTable.tsx`
  - [ ] 서비스 이용 이력 타임라인 (5대 사업 통합)
- [ ] `actions/client-actions.ts` 작성
  - [ ] `searchClients()`, `getClientById()`, `updateClient()`

### 3.3 상담 기록 시스템

- [ ] `components/features/intake/IntakeRecordForm.tsx`
  - [ ] 상담 기록지 입력 폼 (첨부 19 양식)
  - [ ] 신체 기능 체크 (관절가동범위)
  - [ ] 인지/감각 기능 체크박스
  - [ ] 보유 보조기기 목록
- [ ] `actions/intake-actions.ts` 작성
  - [ ] `createIntakeRecord()` Server Action

### 3.4 평가 시스템

- [ ] `components/features/assessment/DomainAssessmentForm.tsx`
  - [ ] 영역별 평가지 선택 (WC, ADL, S, SP, EC, CA, L, AAC, AM)
  - [ ] 각 영역별 평가 폼 컴포넌트
    - [ ] `WheelchairAssessmentForm.tsx` (휠체어및이동)
    - [ ] `ADLAssessmentForm.tsx` (일상생활동작)
    - [ ] `SensoryAssessmentForm.tsx` (감각)
    - [ ] `PostureAssessmentForm.tsx` (자세)
    - [ ] `EnvironmentAssessmentForm.tsx` (주택및환경개조)
    - [ ] `ComputerAssessmentForm.tsx` (컴퓨터접근)
    - [ ] `LeisureAssessmentForm.tsx` (레저)
    - [ ] `AACAssessmentForm.tsx` (보완대체의사소통)
    - [ ] `VehicleAssessmentForm.tsx` (자동차개조)
- [ ] `actions/assessment-actions.ts` 작성
  - [ ] `createDomainAssessment()` Server Action

### 3.5 서비스 진행 기록

- [ ] `components/features/process/ProcessLogForm.tsx`
  - [ ] 서비스 진행 기록지 입력 (첨부 20 양식)
  - [ ] 과정 선택 (상담·평가, 시험적용, 대여, 제작 등)
  - [ ] 지원 구분 선택 (공적급여, 민간급여, 센터지원)
- [ ] `actions/process-actions.ts` 작성
  - [ ] `createProcessLog()` Server Action

---

## 🤖 Phase 4: AI 기능 구현 - 2주

### 4.1 AI SOAP 노트 생성

- [ ] Google AI Studio API Key 발급
- [ ] `lib/gemini/client.ts` 작성
- [ ] `actions/ai-actions.ts` 작성
  - [ ] `generateSoapNote(text: string)` Server Action
  - [ ] System Prompt 작성 (SOAP Note JSON 형식 강제)
  - [ ] 에러 핸들링
- [ ] `components/features/soap-note/SoapAudioRecorder.tsx`
  - [ ] 음성 녹음 컴포넌트 (Web Audio API)
  - [ ] STT 변환 (선택사항: Web Speech API 또는 Gemini STT)
- [ ] `components/features/soap-note/SoapNoteEditor.tsx`
  - [ ] SOAP 텍스트 에디터 (S, O, A, P 섹션)
  - [ ] AI 생성 버튼 연동
  - [ ] Streaming UI 패턴 (로딩 중 Skeleton)
- [ ] `components/features/soap-note/AiGenerateButton.tsx`
  - [ ] Gemini 호출 버튼
  - [ ] 로딩 상태 표시

### 4.2 RAG 챗봇 (선택사항)

- [ ] 운영 지침서 벡터화 (Supabase pgvector)
- [ ] `actions/rag-actions.ts` 작성
  - [ ] 문서 검색 및 컨텍스트 결합
- [ ] `components/features/chat/RegulationChatbot.tsx`
  - [ ] 규정 검색 챗봇 UI

---

## 📦 Phase 5: 재고 관리 시스템 - 1주

### 5.1 재고 관리

- [ ] `app/(admin)/inventory/page.tsx` 작성
- [ ] `components/features/inventory/InventoryList.tsx`
  - [ ] 기기 목록 (상태별 필터링)
  - [ ] 검색 기능
- [ ] `components/features/inventory/InventoryStatusToggle.tsx`
  - [ ] 대여/보관 상태 변경
- [ ] `components/features/inventory/QRCodeGenerator.tsx`
  - [ ] QR 코드 생성 (기기별)
- [ ] `components/features/inventory/QRCodeScanner.tsx`
  - [ ] QR 코드 스캔 (입/출고 처리)
- [ ] `actions/inventory-actions.ts` 작성
  - [ ] `updateInventoryStatus()` Server Action
  - [ ] 대여 승인 시 재고 자동 차감 로직

### 5.2 대여 관리

- [ ] 대여 승인 시 `inventory.status` → '대여중' 변경
- [ ] 반납 시 `inventory.status` → '보관' 변경
- [ ] 대여 기간 만료 알림 (D-Day 계산)

---

## 💼 Phase 6: 비즈니스 로직 구현 - 1주

### 6.1 한도 체크 로직

- [ ] 수리비 10만원 한도 체크
  - [ ] `actions/business-actions.ts` 작성
  - [ ] `checkRepairLimit(clientId: string, amount: number)` 함수
  - [ ] 연간 누적 수리비 계산
  - [ ] 초과 시 경고 모달 표시
- [ ] 맞춤제작 연 2회 횟수 제한 체크
  - [ ] `checkCustomLimit(clientId: string)` 함수
  - [ ] 연간 맞춤제작 횟수 계산
  - [ ] 초과 시 경고 모달 표시

### 6.2 개인정보 보유 기간 관리

- [ ] 개인정보 보유 기간(5년) 만료 시 알림
  - [ ] `actions/privacy-actions.ts` 작성
  - [ ] 만료 예정 데이터 조회 (1개월 전 알림)
  - [ ] 관리자 대시보드에 알림 표시

---

## 📅 Phase 7: 일정 관리 - 1주

### 7.1 캘린더 시스템

- [ ] `app/(admin)/schedule/page.tsx` 작성
- [ ] `components/features/schedule/CalendarView.tsx`
  - [ ] 월간/주간/일간 뷰
  - [ ] 방문 일정 표시
- [ ] `components/features/schedule/ScheduleForm.tsx`
  - [ ] 일정 등록 폼
- [ ] `actions/schedule-actions.ts` 작성
  - [ ] `createSchedule()`, `updateSchedule()`, `deleteSchedule()`

---

## 🎨 Phase 8: UI/UX 개선 및 반응형 - 1주

### 8.1 모바일 최적화

- [ ] 모든 페이지 모바일 반응형 검토
- [ ] 터치 제스처 최적화
- [ ] 모바일 하단 네비게이션 적용

### 8.2 접근성 (A11y) ✅

- [x] 접근성 툴바 컴포넌트 생성 (`components/accessibility/accessibility-toolbar.tsx`) ✅
  - [x] 화면 확대/축소 기능 (50% ~ 200%, 기본 100%) ✅
  - [x] 고대비 모드 전환 기능 ✅
  - [x] 음성 출력 기능 (TTS, Web Speech API) ✅
  - [x] 키보드 단축키 지원 (Alt + A: 열기/닫기, Alt + +/-: 확대/축소, Alt + 0: 리셋, Alt + H: 고대비, Alt + S: 음성) ✅
  - [x] 설정 로컬 스토리지 저장 ✅
- [x] 키보드 네비게이션 컴포넌트 생성 (`components/accessibility/keyboard-navigator.tsx`) ✅
  - [x] 스캔 모드 기능 (Alt + K: 활성화/비활성화) ✅
  - [x] Tab 키로 모든 포커스 가능한 요소 순차 탐색 ✅
  - [x] Shift + Tab으로 역방향 탐색 ✅
  - [x] 포커스된 요소 자동 스크롤 ✅
- [x] 고대비 모드 CSS 추가 (`app/globals.css`) ✅
- [x] 키보드 포커스 강화 스타일 추가 ✅
- [x] 스크린 리더 전용 클래스 추가 (`.sr-only`) ✅
- [ ] 모든 인터랙티브 요소에 aria-label 추가
- [ ] 모든 이미지에 alt 텍스트 추가
- [ ] 폼 요소에 aria-describedby 연결
- [ ] 색상 대비 검증 (WCAG AA 기준)
- [ ] 스크린 리더 테스트 (NVDA, JAWS)

---

## 🧪 Phase 9: 테스트 및 안정화 - 1주

### 9.1 기능 테스트

- [ ] 인증 플로우 테스트
- [ ] 신청서 접수 플로우 테스트
- [ ] AI SOAP 노트 생성 테스트
- [ ] 재고 관리 플로우 테스트
- [ ] 비즈니스 로직 한도 체크 테스트

### 9.2 성능 최적화

- [ ] 이미지 최적화 (`next/image` 사용)
- [ ] 코드 스플리팅 검토
- [ ] React Query 캐싱 전략 최적화

### 9.3 보안 점검

- [ ] RLS 정책 재검토
- [ ] API Key 노출 방지 확인
- [ ] XSS, CSRF 방어 확인

---

## 📊 Phase 10: 통계 및 보고서 - 1주

### 10.1 통계 대시보드

- [ ] `components/features/dashboard/StatsChart.tsx`
  - [ ] 5대 사업별 실적 그래프
  - [ ] 월별/연도별 통계
- [ ] `actions/stats-actions.ts` 작성
  - [ ] 실적 집계 쿼리

### 10.2 데이터 내보내기

- [ ] Excel 내보내기 기능 (xlsx 라이브러리)
- [ ] 사업 실적 보고서 자동 생성

---

## 🚀 Phase 11: 배포 준비 - 1주

### 11.1 환경 설정

- [ ] Vercel 프로젝트 생성
- [ ] 환경 변수 설정 (Clerk, Supabase, Gemini)
- [ ] 도메인 연결

### 11.2 CI/CD

- [ ] GitHub Actions 설정 (선택사항)
- [ ] 자동 배포 파이프라인 확인

### 11.3 문서화

- [ ] 사용자 매뉴얼 작성
- [ ] 관리자 가이드 작성
- [ ] API 문서 작성 (선택사항)

---

## 📝 개발 컨벤션 체크리스트

### 코드 스타일

- [ ] Spacing-First 정책 준수 (margin 사용 지양, padding/gap 활용)
- [ ] 컴포넌트 네이밍: `[Domain][Role][Variant]` 형식
- [ ] 불필요한 추상화 제거 (단순 래퍼 컴포넌트 금지)

### 타입 안전성

- [ ] `any` 타입 사용 금지
- [ ] `database.types.ts` 적극 활용
- [ ] Zod 스키마로 모든 폼 검증

### Next.js 15 준수

- [ ] 동적 파라미터에 `await params` 사용
- [ ] Server Actions 활용 (API Route 최소화)
- [ ] Server Components 우선 사용

### 로깅

- [ ] 핵심 기능에 로그 추가 (신청 접수, AI 생성, 재고 변경 등)

---

## 🔍 데이터베이스 스키마 개선 TODO

### 📝 마이그레이션 스크립트 작성 필요

> ⚠️ **참고**: Foreign Key 컬럼명 정리는 **이미 완료**되었습니다!  
> 아래 스크립트는 추가 필드 및 테이블 생성에 집중합니다.

다음 SQL 스크립트를 `migrations/002_add_fields_and_tables.sql` 파일로 작성:

```sql
-- ✅ Foreign Key 컬럼명 정리는 이미 완료되었습니다!
-- 실제 데이터베이스는 이미 올바르게 설정되어 있습니다.

-- 1. applications 테이블 필드 추가 ✅ (마이그레이션 파일: migrations/002_add_applications_fields.sql)
-- ALTER TABLE applications
--   ADD COLUMN IF NOT EXISTS category TEXT CHECK (category IN ('consult', 'experience', 'custom', 'aftercare', 'education')),
--   ADD COLUMN IF NOT EXISTS sub_category TEXT,
--   ADD COLUMN IF NOT EXISTS desired_date DATE,
--   ADD COLUMN IF NOT EXISTS assigned_staff_id UUID REFERENCES profiles(id);

-- 3. inventory 테이블 필드 추가 ✅ (마이그레이션 파일: migrations/003_add_inventory_fields.sql)
-- ALTER TABLE inventory
--   ADD COLUMN IF NOT EXISTS is_rental_available BOOLEAN DEFAULT true,
--   ADD COLUMN IF NOT EXISTS purchase_date DATE,
--   ADD COLUMN IF NOT EXISTS purchase_price NUMERIC,
--   ADD COLUMN IF NOT EXISTS manufacturer TEXT,
--   ADD COLUMN IF NOT EXISTS model TEXT,
--   ADD COLUMN IF NOT EXISTS qr_code TEXT;

-- 4. service_logs 테이블 생성 ✅ (마이그레이션 파일: migrations/004_create_service_logs.sql)
-- 실제 양식 문서(상담 기록지, 서비스 진행 기록지, 평가지) 기반으로 설계됨
-- CREATE TABLE IF NOT EXISTS service_logs (
--   id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
--   application_id UUID NOT NULL REFERENCES applications(id) ON DELETE CASCADE,
--   staff_id UUID REFERENCES profiles(id),
--   inventory_id UUID REFERENCES inventory(id),
--   service_date DATE DEFAULT CURRENT_DATE,
--   service_type TEXT,
--   service_area TEXT,
--   funding_source TEXT,
--   funding_detail TEXT,
--   work_type TEXT,
--   item_name TEXT,
--   work_description TEXT,
--   work_result TEXT,
--   cost_total NUMERIC,
--   cost_materials NUMERIC,
--   cost_labor NUMERIC,
--   cost_other NUMERIC,
--   images_before TEXT[],
--   images_after TEXT[],
--   remarks TEXT,
--   notes TEXT,
--   created_at TIMESTAMPTZ DEFAULT now(),
--   updated_at TIMESTAMPTZ DEFAULT now()
-- );

-- 5. schedules 테이블 생성 ✅ (마이그레이션 파일: migrations/005_create_schedules.sql)
-- CREATE TABLE IF NOT EXISTS schedules (
--   id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
--   application_id UUID REFERENCES applications(id) ON DELETE SET NULL,
--   staff_id UUID NOT NULL REFERENCES profiles(id),
--   client_id UUID REFERENCES clients(id) ON DELETE SET NULL,
--   schedule_type TEXT NOT NULL CHECK (schedule_type IN ('visit', 'consult', 'assessment', 'delivery', 'pickup')),
--   scheduled_date DATE NOT NULL,
--   scheduled_time TIME,
--   address TEXT,
--   notes TEXT,
--   status TEXT DEFAULT 'scheduled' CHECK (status IN ('scheduled', 'completed', 'cancelled')),
--   created_at TIMESTAMPTZ DEFAULT now(),
--   updated_at TIMESTAMPTZ DEFAULT now()
-- );

-- 6. notices 테이블 생성 ✅ (마이그레이션 파일: migrations/006_create_notices.sql)
-- CREATE TABLE IF NOT EXISTS notices (
--   id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
--   title TEXT NOT NULL,
--   content TEXT NOT NULL,
--   category TEXT CHECK (category IN ('notice', 'support', 'event')),
--   is_pinned BOOLEAN DEFAULT false,
--   created_by UUID REFERENCES profiles(id) ON DELETE SET NULL,
--   created_at TIMESTAMPTZ DEFAULT now(),
--   updated_at TIMESTAMPTZ
-- );

-- 7. rentals 테이블 생성 ✅ (마이그레이션 파일: migrations/007_create_rentals.sql)
-- CREATE TABLE IF NOT EXISTS rentals (
--   id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
--   application_id UUID NOT NULL REFERENCES applications(id) ON DELETE CASCADE,
--   inventory_id UUID NOT NULL REFERENCES inventory(id),
--   client_id UUID NOT NULL REFERENCES clients(id) ON DELETE CASCADE,
--   rental_start_date DATE NOT NULL,
--   rental_end_date DATE NOT NULL,
--   return_date DATE,
--   extension_count INTEGER DEFAULT 0,
--   status TEXT DEFAULT 'rented' CHECK (status IN ('rented', 'returned', 'overdue', 'damaged')),
--   created_at TIMESTAMPTZ DEFAULT now(),
--   updated_at TIMESTAMPTZ DEFAULT now()
-- );

-- 인덱스 생성
CREATE INDEX IF NOT EXISTS idx_applications_client_id ON applications(client_id);
CREATE INDEX IF NOT EXISTS idx_applications_category ON applications(category);
CREATE INDEX IF NOT EXISTS idx_applications_status ON applications(status);
CREATE INDEX IF NOT EXISTS idx_intake_records_application_id ON intake_records(application_id);
CREATE INDEX IF NOT EXISTS idx_process_logs_application_id ON process_logs(application_id);
CREATE INDEX IF NOT EXISTS idx_domain_assessments_application_id ON domain_assessments(application_id);
CREATE INDEX IF NOT EXISTS idx_service_logs_application_id ON service_logs(application_id);
CREATE INDEX IF NOT EXISTS idx_schedules_scheduled_date ON schedules(scheduled_date);
CREATE INDEX IF NOT EXISTS idx_rentals_client_id ON rentals(client_id);
CREATE INDEX IF NOT EXISTS idx_rentals_rental_end_date ON rentals(rental_end_date);
```

### ✅ 체크리스트

**Phase 1.3 데이터베이스 설정 단계에서 수행:**

- [ ] 위 마이그레이션 스크립트 실행
- [ ] Foreign Key 제약조건 확인
- [ ] 인덱스 생성 확인
- [ ] `npm run gen:types` 실행하여 타입 재생성
- [ ] RLS 정책 작성 (새 테이블 포함)

---

## 🔬 Supabase MCP를 통한 데이터베이스 학습

### MCP 서버 설정 확인

`mcp.json` 파일에 다음 설정이 되어 있습니다:

```json
{
  "supabase-co-AT": {
    "command": "npx",
    "args": [
      "-y",
      "@supabase/mcp-server-supabase@latest",
      "--read-only",
      "--project-ref=uyjbndiwyddjyjkdfuyi"
    ],
    "env": {
      "SUPABASE_ACCESS_TOKEN": "sbp_31e2d9d8e62851f8b5b15e9fe62e11e42acacdec"
    }
  }
}
```

### 데이터베이스 스키마 확인 방법

1. **MCP 리소스 조회**

   - Cursor에서 MCP 서버를 통해 테이블 목록 확인
   - 각 테이블의 컬럼 정보 확인

2. **타입 생성**

   - `npm run gen:types` 실행
   - `types/database.types.ts` 파일 확인
   - 생성된 타입을 코드에서 활용

3. **실제 데이터 확인**
   - Supabase Dashboard 접속
   - Table Editor에서 데이터 확인
   - SQL Editor에서 쿼리 실행

### 스키마 변경 시 워크플로우

1. Supabase Dashboard에서 스키마 변경 (또는 SQL 마이그레이션 실행)
2. `npm run gen:types` 실행하여 타입 재생성
3. TypeScript 타입 에러 확인 및 수정
4. 코드에서 새로운 필드/테이블 활용

---

## 📚 참고 문서

- **MRD.md**: 시장 요구사항, 5대 사업 정의
- **PRD.md**: 기능 명세, UI/UX 가이드
- **TRD.md**: 기술 설계, 아키텍처
- **Mermaid.md**: ERD, 시퀀스 다이어그램
- **DIR.md**: 디렉토리 구조 가이드
- **보조기기센터사업안내.md**: 실제 업무 규정 및 양식
- **assessform.md**: 평가 양식 상세
- **counsilform.md**: 상담 기록지 양식
- **processform.md**: 서비스 진행 기록지 양식

---

## ✅ 완료 기준 (Definition of Done)

각 Phase 완료 시 다음을 확인:

- [ ] 기능이 요구사항대로 동작하는가?
- [ ] 타입 에러가 없는가?
- [ ] 린트 에러가 없는가?
- [ ] 모바일 반응형이 적용되었는가?
- [ ] 핵심 기능에 로그가 추가되었는가?
- [ ] Spacing-First 정책을 준수했는가?

---

**마지막 업데이트**: 2025. 12. 06
</file>

</files>
